(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    469545,      11730]
NotebookOptionsPosition[    436568,      11357]
NotebookOutlinePosition[    436938,      11373]
CellTagsIndexPosition[    436895,      11370]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"path", "=", 
  RowBox[{"NotebookDirectory", "[", "]"}]}]], "Input",
 CellChangeTimes->{{3.739037382826046*^9, 3.739037406899582*^9}, {
  3.740552945889529*^9, 3.74055296028967*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"fbc5bcd9-63b5-42b3-b035-7b17f9a2e9ce"],

Cell[CellGroupData[{

Cell["Units", "Subsubsection",
 CellChangeTimes->{{3.619245666608886*^9, 3.619245678199769*^9}, {
  3.6192515663684807`*^9, 3.6192515673177557`*^9}},
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"49a94d6b-8711-45ea-915f-081fe95058f9"],

Cell[BoxData[
 RowBox[{"NKernels", "=", 
  RowBox[{"Length", "[", 
   RowBox[{"Kernels", "[", "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.751027700773085*^9, 3.7510277126313763`*^9}, {
  3.751702761354095*^9, 3.751702761448614*^9}, {3.769499333811583*^9, 
  3.769499334425988*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"85cf049b-9954-4a6d-9315-7cc3e680a3e2"],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"NKernels", "<", "80"}], ",", 
     RowBox[{"LaunchKernels", "[", 
      RowBox[{"80", "-", "NKernels"}], "]"}]}], "]"}], ";"}], " "}]], "Input",\

 CellChangeTimes->{{3.7380030625528803`*^9, 3.7380030703457108`*^9}, {
  3.739036908705781*^9, 3.739036909186357*^9}, {3.746514662117168*^9, 
  3.746514666747664*^9}, {3.750682942008061*^9, 3.750682953056987*^9}, {
  3.7510276825303583`*^9, 3.751027682647422*^9}, {3.751027715639391*^9, 
  3.751027737175623*^9}, {3.751106857788314*^9, 3.7511068604700003`*^9}, {
  3.751703855043419*^9, 3.751703861681511*^9}, {3.7518848468276443`*^9, 
  3.751884860635023*^9}, {3.755076796209956*^9, 3.755076801721034*^9}, {
  3.755249426032206*^9, 3.755249436062772*^9}, {3.755946529625237*^9, 
  3.755946534873638*^9}, {3.760359265621542*^9, 3.76035927252214*^9}, {
  3.760724118667878*^9, 3.760724121382318*^9}, {3.76949934502796*^9, 
  3.7694993487858047`*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"8f17d1ba-40f2-428b-b029-eccad248496e"],

Cell[BoxData[
 RowBox[{"font", "=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"Style", "[", 
     RowBox[{"#", ",", 
      RowBox[{"FontSize", "\[Rule]", "17"}], ",", 
      RowBox[{"FontFamily", "->", "\"\<Latin Modern Roman\>\""}], ",", 
      RowBox[{"FontSlant", "->", "Italic"}], ",", 
      RowBox[{"LineSpacing", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}]}], ",", 
      RowBox[{"FontColor", "\[Rule]", "Black"}]}], "]"}], ")"}], 
   "&"}]}]], "Input",
 CellChangeTimes->{{3.697542640146693*^9, 3.697542687502433*^9}, {
  3.6978777192124233`*^9, 3.6978777253646107`*^9}},
 CellLabel->"In[4]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"c957dc19-042f-4285-9d26-08a52727f215"],

Cell[BoxData[
 RowBox[{"fontB", "=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"Style", "[", 
     RowBox[{"#", ",", 
      RowBox[{"FontSize", "\[Rule]", "17"}], ",", 
      RowBox[{"FontFamily", "->", "\"\<Latin Modern Roman\>\""}], ",", 
      RowBox[{"FontSlant", "->", "Italic"}], ",", 
      RowBox[{"FontWeight", "\[Rule]", "Bold"}], ",", 
      RowBox[{"LineSpacing", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}]}], ",", 
      RowBox[{"FontColor", "\[Rule]", "Black"}]}], "]"}], ")"}], 
   "&"}]}]], "Input",
 CellChangeTimes->{{3.713853133221386*^9, 3.7138531480482473`*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"ac848a87-acde-4f5f-828a-6710b96ed730"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Conj", "[", "x_", "]"}], ":=", 
   RowBox[{"x", "/.", 
    RowBox[{
     RowBox[{"Complex", "[", 
      RowBox[{"a_.", ",", "b_."}], "]"}], "\[Rule]", 
     RowBox[{"Complex", "[", 
      RowBox[{"a", ",", 
       RowBox[{"-", "b"}]}], "]"}]}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.696772800069374*^9, 3.6967728394102373`*^9}},
 CellLabel->"In[6]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"fc4e306c-f1ad-4a80-b409-11ba95c4b69b"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{"vF", ",", "K", ",", " ", "CellArea", ",", "s"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Valuesh", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[HBar]", "\[Rule]", 
      RowBox[{"1.0545717", " ", 
       RowBox[{"10", "^", 
        RowBox[{"(", 
         RowBox[{"-", "34"}], ")"}]}], " ", "kg", " ", 
       RowBox[{
        RowBox[{"m", "^", "2"}], "/", "s"}]}]}], ",", 
     RowBox[{"h", "\[Rule]", 
      RowBox[{"6.62606957", " ", 
       RowBox[{"10", "^", 
        RowBox[{"(", 
         RowBox[{"-", "34"}], ")"}]}], " ", "kg", " ", 
       RowBox[{
        RowBox[{"m", "^", "2"}], "/", "s"}]}]}], ",", 
     RowBox[{"e", "\[Rule]", 
      RowBox[{"1.602176", " ", 
       RowBox[{"10", "^", 
        RowBox[{"(", 
         RowBox[{"-", "19"}], ")"}]}], " ", "Co"}]}], ",", 
     RowBox[{"a", "\[Rule]", 
      RowBox[{"0.142", " ", 
       RowBox[{"10", "^", 
        RowBox[{"(", 
         RowBox[{"-", "9"}], ")"}]}], " ", "m"}]}], ",", " ", 
     RowBox[{"CellArea", "->", 
      RowBox[{"0.051", "*", 
       RowBox[{"10", "^", 
        RowBox[{"(", 
         RowBox[{"-", "18"}], ")"}]}], " ", 
       RowBox[{"m", "^", "2"}]}]}], ",", 
     RowBox[{"kB", "\[Rule]", 
      RowBox[{"1.38065", " ", 
       RowBox[{"10", "^", 
        RowBox[{"-", "23"}]}], " ", 
       RowBox[{"m", "^", "2"}], " ", 
       RowBox[{
        RowBox[{"kg", "/", 
         RowBox[{"s", "^", "2"}]}], "/", "K"}]}]}], ",", 
     RowBox[{"vF", "\[Rule]", 
      RowBox[{
       RowBox[{"10", "^", "6"}], " ", 
       RowBox[{"m", "/", "s"}]}]}], ",", 
     RowBox[{"Tesla", "\[Rule]", 
      RowBox[{
       RowBox[{"kg", "/", "Co"}], "/", "s"}]}], ",", 
     RowBox[{"me", "\[Rule]", 
      RowBox[{"9.1093188", " ", 
       RowBox[{"10", "^", 
        RowBox[{"-", "31"}]}], " ", "kg"}]}], ",", 
     RowBox[{"\[Mu]0", "\[Rule]", 
      RowBox[{"1.2566", " ", 
       RowBox[{"10", "^", 
        RowBox[{"(", 
         RowBox[{"-", "6"}], ")"}]}], " ", 
       RowBox[{
        RowBox[{"kg", "/", "Co"}], "/", "s"}], " ", 
       RowBox[{"m", "/", 
        RowBox[{"(", 
         RowBox[{"Co", "/", "s"}], ")"}]}]}]}], ",", 
     RowBox[{"cL", "\[Rule]", 
      RowBox[{"0.674", " ", 
       RowBox[{"10", "^", 
        RowBox[{"-", "9"}]}], " ", "m"}]}], ",", 
     RowBox[{"cm", "\[Rule]", 
      RowBox[{"0.01", " ", "m"}]}], ",", " ", 
     RowBox[{"nm", "\[Rule]", 
      RowBox[{
       RowBox[{"10", "^", 
        RowBox[{"-", "9"}]}], " ", "m"}]}], ",", 
     RowBox[{"\[Gamma]0", "\[Rule]", 
      RowBox[{"3.1", " ", "1.6", " ", 
       RowBox[{"10", "^", 
        RowBox[{"-", "19"}]}], " ", "kg", " ", 
       RowBox[{
        RowBox[{"m", "^", "2"}], "/", 
        RowBox[{"s", "^", "2"}]}]}]}], ",", 
     RowBox[{"\[Epsilon]0", "\[Rule]", 
      RowBox[{"8.85", "*", 
       RowBox[{"10", "^", 
        RowBox[{"(", 
         RowBox[{"-", "12"}], ")"}]}], " ", 
       RowBox[{
        RowBox[{"Co", "/", "V"}], "/", "m"}]}]}], ",", 
     RowBox[{"c", "\[Rule]", 
      RowBox[{"3", " ", 
       RowBox[{"10", "^", "8"}], " ", 
       RowBox[{"m", "/", "s"}]}]}], ",", 
     RowBox[{"Pa", "\[Rule]", 
      RowBox[{
       RowBox[{"kg", "/", "m"}], "/", 
       RowBox[{"s", "^", "2"}]}]}], ",", 
     RowBox[{"V", "\[Rule]", 
      RowBox[{"kg", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"m", "^", "2"}], "/", 
         RowBox[{"s", "^", "2"}]}], "/", "Co"}]}]}], ",", 
     RowBox[{"Amp", "\[Rule]", 
      RowBox[{"Co", "/", "s"}]}], ",", 
     RowBox[{"Na", "->", 
      RowBox[{"6.02", " ", 
       RowBox[{"10", "^", "23"}]}]}], ",", 
     RowBox[{"eV", "\[Rule]", 
      RowBox[{"e", " ", "V"}]}]}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6192508679899197`*^9, 3.619250890107769*^9}, 
   3.619251636867425*^9, {3.619253273662959*^9, 3.619253308821328*^9}, {
   3.6192533965403337`*^9, 3.619253403981554*^9}, {3.620556742115765*^9, 
   3.620556756353491*^9}, {3.62758379310023*^9, 3.6275838012618523`*^9}, {
   3.687000601947711*^9, 3.687000623610127*^9}, {3.687246612140109*^9, 
   3.6872466168757133`*^9}, {3.6911462790887003`*^9, 
   3.6911462893579903`*^9}, {3.724943895399335*^9, 3.724943895933568*^9}},
 CellLabel->"In[7]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"1807dfc2-d7f4-4887-96ae-d94a8a71340e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"subs", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[CapitalDelta]", "\[Rule]", 
      RowBox[{"d", " ", "\[Gamma]0"}]}], ",", 
     RowBox[{"CC", "\[Rule]", 
      RowBox[{"e", "/", 
       RowBox[{"(", 
        RowBox[{"2", " ", "\[Pi]", " ", "\[HBar]"}], ")"}]}]}], ",", 
     RowBox[{"\[Alpha]", "\[Rule]", 
      RowBox[{"9", " ", 
       RowBox[{"\[Gamma]0", "^", "2"}], " ", 
       RowBox[{"a", "^", "2"}], " ", 
       RowBox[{"e", "/", 
        RowBox[{"(", 
         RowBox[{"2", " ", "\[HBar]"}], ")"}]}]}]}], ",", 
     RowBox[{"B", "\[Rule]", 
      RowBox[{
       RowBox[{"1", "/", "q"}], " ", "2", " ", "\[Pi]", " ", 
       RowBox[{"\[HBar]", "/", 
        RowBox[{"(", 
         RowBox[{"e", " ", 
          RowBox[{"a", "^", "2"}], " ", "3", " ", 
          RowBox[{
           RowBox[{"Sqrt", "[", "3", "]"}], "/", "2"}]}], ")"}]}]}]}]}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"removeDim", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"m", "\[Rule]", "1"}], ",", 
     RowBox[{"kg", "\[Rule]", "1"}], ",", 
     RowBox[{"s", "\[Rule]", "1"}], ",", 
     RowBox[{"Co", "\[Rule]", "1"}], ",", 
     RowBox[{"K", "\[Rule]", "1"}], ",", 
     RowBox[{"cm", "\[Rule]", "1"}], ",", 
     RowBox[{"g", "\[Rule]", "1"}], ",", 
     RowBox[{"V", "\[Rule]", "1"}], ",", 
     RowBox[{"nm", "\[Rule]", "1"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CC", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"e", "/", "h"}], "/.", "Valuesh"}], "/.", "removeDim"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"\[Alpha]n", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Alpha]", "/.", 
      RowBox[{"\[Alpha]", "\[Rule]", 
       RowBox[{"9", " ", 
        RowBox[{"\[Gamma]0", "^", "2"}], " ", 
        RowBox[{"a", "^", "2"}], " ", 
        RowBox[{"e", "/", 
         RowBox[{"(", 
          RowBox[{"2", " ", "\[HBar]"}], ")"}]}]}]}]}], "/.", "Valuesh"}], "/.",
     "removeDim"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"en", "=", 
   RowBox[{
    RowBox[{"e", "/.", "Valuesh"}], "/.", "removeDim"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"kBn", "=", 
   RowBox[{
    RowBox[{"kB", "/.", "Valuesh"}], "/.", "removeDim"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"\[Epsilon]n", "=", 
   RowBox[{
    RowBox[{"\[Epsilon]0", "/.", "Valuesh"}], "/.", "removeDim"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.6192515367779408`*^9, 3.619251536778974*^9}, {
  3.6192515867887783`*^9, 3.619251596269477*^9}, {3.6192516302713833`*^9, 
  3.619251632874383*^9}, {3.703333728654539*^9, 3.703333730478758*^9}},
 CellLabel->"In[9]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"cd7550ef-498b-4efe-a39d-872fc1c4d9da"],

Cell[BoxData[
 RowBox[{
  RowBox[{"subData", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vl", "\[Rule]", 
      RowBox[{"22000", " ", 
       RowBox[{"m", "/", "s"}]}]}], ",", 
     RowBox[{"vt", "\[Rule]", 
      RowBox[{"14000", " ", 
       RowBox[{"m", "/", "s"}]}]}], ",", " ", 
     RowBox[{"a", "\[Rule]", 
      RowBox[{"1.42", " ", "*", " ", 
       RowBox[{"10", "^", 
        RowBox[{"(", 
         RowBox[{"-", "10"}], ")"}]}], " ", "m"}]}], ",", " ", 
     RowBox[{"g1", "\[Rule]", 
      RowBox[{"20", "eV"}]}], ",", 
     RowBox[{"\[Rho]", "->", 
      FractionBox[
       RowBox[{"7.610026608252542`*^-7", " ", "kg"}], 
       SuperscriptBox["m", "2"]]}], ",", 
     RowBox[{"Vedge", "\[Rule]", 
      RowBox[{"0.46", " ", 
       RowBox[{"Sqrt", "[", "2", "]"}], " ", "vF"}]}], ",", 
     RowBox[{"VedgeArm", "->", 
      RowBox[{"0.5222131492040927`", " ", 
       RowBox[{"Sqrt", "[", "2", "]"}], " ", "vF"}]}]}], "}"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.6866570376428843`*^9, 3.686657084298572*^9}, {
  3.687163651307776*^9, 3.687163651459694*^9}, {3.687245518241148*^9, 
  3.687245530752322*^9}, {3.687245601238141*^9, 3.687245619984672*^9}, {
  3.6872465387223463`*^9, 3.6872465589679728`*^9}, {3.687427002938858*^9, 
  3.68742702470555*^9}, {3.687427261798696*^9, 3.6874272624357157`*^9}, {
  3.68776657889986*^9, 3.6877665808211393`*^9}, {3.688060066361911*^9, 
  3.68806006648626*^9}, {3.688120803073954*^9, 3.688120819211835*^9}, {
  3.696079767941977*^9, 3.696079778467225*^9}, {3.696087567819848*^9, 
  3.6960875681140947`*^9}},
 CellLabel->"In[16]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"a6b49869-f653-4dde-9e71-3062dfb46aa6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"nB", "[", "x_", "]"}], "=", 
   RowBox[{"1", "/", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Exp", "[", "x", "]"}], "-", "1"}], ")"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.689238366750119*^9, 3.689238378478793*^9}},
 CellLabel->"In[17]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"18cade7e-0039-4c9d-8760-e904b5076231"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nF", "[", 
   RowBox[{"e_", ",", "T_"}], "]"}], " ", "=", " ", 
  RowBox[{"1", "/", 
   RowBox[{"(", 
    RowBox[{"1", "+", 
     RowBox[{"Exp", "[", 
      RowBox[{"e", "/", "T"}], "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.687165663313286*^9, 3.6871656952258883`*^9}},
 CellLabel->"In[18]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"a5fe49b3-79e4-47ce-a50b-536bb5fd3f88"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nF", "[", "e_", "]"}], " ", "=", " ", 
  RowBox[{"1", "/", 
   RowBox[{"(", 
    RowBox[{"1", "+", 
     RowBox[{"Exp", "[", "e", "]"}]}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.6894307651920433`*^9, 3.689430770975663*^9}},
 CellLabel->"In[19]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"3650f239-918b-4aa8-911c-9ada2bbd585e"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Bilayer", " ", "LL", " ", "energy"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.68467546296198*^9, 3.684675471273346*^9}},
 CellLabel->"In[20]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"03ccd545-9585-4303-b4fe-0be829c1aa76"],

Cell[BoxData[
 RowBox[{"UnitFilling", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"nm", "^", "2"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"e", "/", "h"}], " ", "*", "Tesla"}], "//.", "Valuesh"}], 
     ")"}]}], "/.", 
   RowBox[{"m", "\[Rule]", 
    RowBox[{
     RowBox[{"10", "^", "9"}], " ", "nm", "    ", 
     RowBox[{"(*", 
      RowBox[{
      "Multiply", " ", "it", " ", "by", " ", "B", " ", "and", " ", "\[Nu]", 
       " ", "to", " ", "get", " ", "concentration", " ", "in", " ", 
       RowBox[{"1", "/", 
        RowBox[{"nm", "^", "2"}]}]}], " ", "*)"}]}]}]}]}]], "Input",
 CellChangeTimes->{{3.684822657935254*^9, 3.684822724870103*^9}, {
  3.7040077113739147`*^9, 3.704007740358976*^9}},
 CellLabel->"In[21]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"f177c360-3f6c-4074-b641-c9caf7cce5e0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"f", "[", 
   RowBox[{"x_", ",", "TT_"}], "]"}], "=", 
  RowBox[{
   RowBox[{
    RowBox[{"1", "/", 
     RowBox[{"(", 
      RowBox[{"1", "+", 
       RowBox[{"Exp", "[", 
        RowBox[{"x", "/", 
         RowBox[{"(", 
          RowBox[{"kBn", " ", "TT"}], ")"}]}], "]"}]}], ")"}]}], "//.", 
    "Valuesh"}], "/.", "removeDim"}]}]], "Input",
 CellChangeTimes->{{3.6252563039376993`*^9, 3.62525640931625*^9}, 
   3.625259274082526*^9},
 CellLabel->"In[22]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"6e31d307-3343-43d6-a1e5-eadef13b15f9"],

Cell[BoxData[
 RowBox[{"eVn", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"e", "*", "V"}], "/.", "Valuesh"}], "/.", 
   "removeDim"}]}]], "Input",
 CellChangeTimes->{{3.619273738686145*^9, 3.6192737632416143`*^9}},
 CellLabel->"In[23]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"b512c14d-f4d2-44b6-981f-885332631c30"],

Cell[BoxData[
 RowBox[{"MagnLength", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"Sqrt", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"\[HBar]", "/", "e"}], "/", 
       RowBox[{"(", 
        RowBox[{"Tesla", " ", "B"}], ")"}]}], "/", 
      RowBox[{"m", "^", "2"}]}], "]"}], "*", 
    RowBox[{"10", "^", "9"}]}], "/.", "Valuesh"}]}]], "Input",
 CellLabel->"In[24]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"920dc996-881e-4987-a43e-8437ec8b193f"],

Cell[BoxData[
 RowBox[{"coupling", "=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"e", "^", "2"}], "/", 
     RowBox[{"(", 
      RowBox[{"4", " ", "\[Pi]", " ", "\[Epsilon]0", " ", 
       RowBox[{"(", 
        RowBox[{"11", "/", "2"}], ")"}], " ", "\[HBar]", " ", "vF"}], ")"}]}],
     "/.", "Valuesh"}], "/.", "removeDim", "  ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"effective", " ", "coupling", " ", "for", " ", "\[Epsilon]"}], 
     "=", "5.0"}], " ", "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.62932122367013*^9, 3.629321275577545*^9}, {
  3.629384972448441*^9, 3.629385009513389*^9}, {3.63035528923382*^9, 
  3.6303552895546*^9}, {3.6303588190820103`*^9, 3.630358836352944*^9}},
 CellLabel->"In[25]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"dc968a0a-3bc6-4498-81a0-9d6ccba9cf4d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "multiplier", " ", "for", " ", "dimensionless", " ", "energy", " ", "to", 
    " ", "get", " ", "real", " ", "energy", " ", "in", " ", "eV"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Sqrt", "[", 
      RowBox[{"\[HBar]", " ", "e", " ", "Tesla"}], "]"}], " ", 
     RowBox[{"vF", " ", "/", "e"}]}], "/.", "Valuesh"}], "//", "PowerExpand", 
   "  "}]}]], "Input",
 CellChangeTimes->{{3.629383710493657*^9, 3.629383831426375*^9}},
 CellLabel->"In[26]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"e095fe2e-cdfb-49d7-b2b0-9d6066afb7e9"],

Cell[BoxData[
 RowBox[{"MagnLen", "=", 
  RowBox[{
   RowBox[{"Sqrt", "[", 
    RowBox[{
     RowBox[{"\[HBar]", "/", "e"}], "/", "B"}], "]"}], "/.", 
   "Valuesh"}]}]], "Input",
 CellChangeTimes->{{3.6192517423752413`*^9, 3.619251745462413*^9}},
 CellLabel->"In[27]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"6fd5080c-719c-4071-849c-283453c8c66f"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"nn", "[", 
    RowBox[{"B_", ",", "n_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"4", " ", "CC", " ", "B", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Floor", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"mu", "[", "n", "]"}], "^", "2"}], "/", 
          RowBox[{"(", 
           RowBox[{"\[Alpha]n", " ", "B", " ", "Tesla"}], ")"}]}], "]"}], "+", 
        RowBox[{"1", "/", "2"}]}], ")"}]}], "/.", "Valuesh"}], "/.", 
    "removeDim"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.6192517616300697`*^9, 3.619251777463076*^9}, {
  3.62525486206176*^9, 3.6252548644871902`*^9}},
 CellLabel->"In[28]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"2de8e3c7-8678-48c3-9091-2acde57c36b9"],

Cell[BoxData[
 RowBox[{"EM", "=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Sqrt", "[", 
      RowBox[{"\[Alpha]n", " ", "B"}], "]"}], "/", 
     RowBox[{"(", 
      RowBox[{"e", " ", "V"}], ")"}]}], "//.", "Valuesh"}], "/.", "removeDim",
    "  ", 
   RowBox[{"(*", "  ", 
    RowBox[{"monolayer", " ", "formula"}], " ", "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.625259322029459*^9, 3.6252593650487328`*^9}, {
  3.625260613319899*^9, 3.6252606141274977`*^9}, {3.625260662847206*^9, 
  3.625260681667676*^9}, {3.625260900582163*^9, 3.625260908369672*^9}, {
  3.68482315437578*^9, 3.684823191945856*^9}, {3.684823630960877*^9, 
  3.6848236723757057`*^9}, {3.684823730079973*^9, 3.684823735769368*^9}},
 CellLabel->"In[29]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"918b9294-29fb-4e45-95e5-8bd380ca0014"],

Cell[BoxData[
 RowBox[{
  RowBox[{"nn", "[", 
   RowBox[{"B_", ",", "mu_"}], "]"}], "=", 
  RowBox[{
   RowBox[{
    RowBox[{"4", " ", "CC", " ", "B", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Floor", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"mu", " ", "*", " ", "e"}], ")"}], "^", "2"}], "/", 
         RowBox[{"(", 
          RowBox[{"\[Alpha]n", " ", "B", " ", "Tesla"}], ")"}]}], "]"}], "+", 
       
       RowBox[{"1", "/", "2"}]}], ")"}], " ", 
     RowBox[{
      RowBox[{"Sign", "[", "mu", "]"}], "/", 
      RowBox[{"10", "^", "18"}]}]}], "/.", "Valuesh"}], "/.", 
   "removeDim"}]}]], "Input",
 CellChangeTimes->{{3.625254849925029*^9, 3.625254858213188*^9}, {
   3.625254924787067*^9, 3.625254933183976*^9}, {3.625255176032629*^9, 
   3.625255202382079*^9}, {3.625255236850093*^9, 3.625255272706863*^9}, 
   3.6252573557622757`*^9},
 CellLabel->"In[30]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"898ec61a-cef8-4e99-a6e0-49638d8c350b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "distance", " ", "between", " ", "holes", " ", "at", " ", "10", " ", "T"}],
    " ", "*)"}], "  ", "\[IndentingNewLine]", 
  RowBox[{"1", "/", 
   RowBox[{"Sqrt", "[", 
    RowBox[{"nn", "[", 
     RowBox[{"10", ",", "0.01"}], "]"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.630941216931366*^9, 3.6309412794225473`*^9}, {
  3.6309415031137447`*^9, 3.630941508349843*^9}},
 CellLabel->"In[31]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"b752e6e0-4916-4bcb-abdc-d8ac614c68e5"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Magnetic", " ", "length", " ", "at", " ", "10", " ", "T"}], " ", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.6309412845688868`*^9, 3.630941296941166*^9}},
 CellLabel->"In[32]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"a444f39c-f355-46d6-9240-1a4ced6cf748"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MagnLen", "/", "nm"}], "/.", 
    RowBox[{"B", "\[Rule]", 
     RowBox[{"10", " ", "Tesla"}]}]}], "//.", "Valuesh"}], "//", 
  "PowerExpand"}]], "Input",
 CellChangeTimes->{{3.630941300329809*^9, 3.630941351025128*^9}},
 CellLabel->"In[33]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"68e9b24f-0826-4d54-9329-6263229c47ea"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "B", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.626118780533607*^9, 3.6261187858812*^9}},
 CellLabel->"In[34]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"6ead5444-ea78-4cb3-a750-8f65756f5baa"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"lB", "[", "B_", "]"}], "=", 
    RowBox[{"25.6", " ", "/", 
     RowBox[{"Sqrt", "[", "B", "]"}]}]}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{"in", " ", "nm", " ", "units"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.7033362099713593`*^9, 3.703336309907675*^9}, 
   3.703336566086802*^9},
 CellLabel->"In[35]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"7afe9636-a82b-461f-a813-9fd55cc2b434"],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[HBar]", " ", 
   RowBox[{
    RowBox[{"vF", "/", 
     RowBox[{"Sqrt", "[", 
      RowBox[{"\[HBar]", "/", " ", 
       RowBox[{"(", 
        RowBox[{"e", " ", "B", " ", "Tesla"}], ")"}]}], "]"}]}], "/", 
    "eV"}]}], "//.", "Valuesh"}]], "Input",
 CellChangeTimes->{{3.703338624389371*^9, 3.7033386348322077`*^9}},
 CellLabel->"In[36]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"2197cf5f-2628-4af2-b638-1d1cd399cae5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EB", "[", "B_", "]"}], "=", 
  RowBox[{
   RowBox[{"Sqrt", "[", "B", "]"}], " ", "0.0256", "  ", 
   RowBox[{"(*", 
    RowBox[{"magnetic", " ", "energy", " ", "in", " ", "eV"}], " ", 
    "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.703338546147029*^9, 3.703338688335235*^9}, 
   3.703339007633923*^9},
 CellLabel->"In[37]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"72e86b07-e303-416b-9856-1c5037e4fab0"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"more", " ", "careful", " ", "estimate"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.6311842867539883`*^9, 3.631184299747484*^9}},
 CellLabel->"In[38]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"6712a925-064e-4ea4-a7c4-669eddc1df95"],

Cell["Hall Voltage values", "Text",
 CellChangeTimes->{{3.685175390229747*^9, 3.685175398882347*^9}},
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"1ac2fd32-dffa-4fe2-9bbb-c9da6dace3cd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Sigma]0", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Sigma]1", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Sigma]2", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{"-", "I"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"I", ",", "0"}], "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Sigma]3", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Sigma]p", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"0", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"\[Sigma]m", " ", "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"0", ",", "0"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"1", ",", "0"}], "}"}]}], "}"}]}]}], "Input",
 CellLabel->"In[39]:=",ExpressionUUID->"f75662fd-7174-4e21-a892-24bee05fc3fd"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Self-consistent density calculation in McClure model", "Subsection",
 CellChangeTimes->{{3.715092501845718*^9, 3.7150925188062143`*^9}, {
  3.7165753579094353`*^9, 
  3.716575364360639*^9}},ExpressionUUID->"24cf012f-15df-4d2f-b135-\
be6d2516ce21"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "New", " ", "parameters", " ", "with", " ", "negative", " ", "gamma3"}], 
    " ", "-", " ", 
    RowBox[{"attempt", " ", "10"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"parameters", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"g0", "\[Rule]", "3.16"}], ",", " ", 
     RowBox[{"g01", "\[Rule]", "0"}], ",", 
     RowBox[{"g02", "\[Rule]", "0"}], ",", "\n", 
     RowBox[{"g1", "->", "0.33"}], ",", 
     RowBox[{"g1e", "\[Rule]", "0.33"}], ",", "\n", 
     RowBox[{"g2", "->", 
      RowBox[{"\[Minus]", "0.018"}]}], ",", "\n", 
     RowBox[{"g3", "\[Rule]", 
      RowBox[{"-", "0.25"}]}], ",", 
     RowBox[{"g3e", "\[Rule]", 
      RowBox[{"-", "0.25"}]}], ",", "\n", 
     RowBox[{"g4", "->", "0.02"}], ",", 
     RowBox[{"g4e", "\[Rule]", "0.02"}], ",", "\n", 
     RowBox[{"g5", "->", "0.02"}], ",", " ", "\n", 
     RowBox[{"g6", "\[Rule]", 
      RowBox[{"-", "0.004"}]}], ",", " ", 
     RowBox[{"Ef", "\[Rule]", 
      RowBox[{"-", "0.022"}]}], ",", 
     RowBox[{"DeltaABe", "\[Rule]", " ", "0.025"}], ",", " ", 
     RowBox[{"DeltaAB", "\[Rule]", " ", "0.05"}]}], 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"g6", "+", " ", "g5", "-", " ", "g2"}], "/.", "parameters"}], 
     "*)"}], "}"}], "  "}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwdzl1Ik3EcxfExl+ZcJrqBSuqm0mwuqy1TutENV8YuqmVrxJhvtECm4ghJ
yJRZgaYWlNHMhFbKCH2saNDMXg1pw1JMZIQXYRYiT64CLSNbv/O/OHyuDnwV
VfWmU0KBQLCTBj1VdUf6ynjdvW9LJpjztcsCK1RnbbDb4RSNkcHsDuaAZ0n6
kvSGzstgS8/jvOjjvE7Tw+XD+wPlBlj1RGWEpbEV6XFkjLs1A9ZEXcmCU5ZJ
5vURWykU+NqZ/vyNIVjebBmG3EVfIJ5sSToUhF21ig9wsNXBfH90fvtWUmq6
qYSVselpieSC5aEcdrRFl0DZqJgZ9cf9L5lctvYzJVNBYQr6a85shncS1HKY
ULufmbjO1aeRs4URJxRkfHfD+oC9F84oA2YVucX01ArH9AW3oDRmgOmqtIV3
4d8dWYPtG8u5u8m9oQdquGg+mb6H3NY3ng09Da+nNOSjZfk0vLavJKQlb2Td
ZjqUnSuX23idsXH4F3ye8tl8lZxfLToBR7S9djjRvMqUH+7I9ZLquUINTF3p
LxolDRapHjodBQfg9CJ3EH5507TwigxGinkoqdZIJsmyH/3x0Jv2ohqqfHY7
FIU/GmZIU6zcyHQpkkIkx/1Mheund9z9RHYWhwdhsjbr7W9ybkgYgH8not5B
Pk/MbGxq8Isv8LpLx849g3pZaBVmzsrXoH98URRH5hj0m6BrUpcJ66wm5n88
UVhP
  "],
 CellLabel->"In[63]:=",ExpressionUUID->"e07025ff-2a81-4c69-a42c-240ea0dd7af7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "s", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.7360817644972677`*^9, 3.736081766810091*^9}},
 CellLabel->"In[64]:=",ExpressionUUID->"460bada1-5d00-4903-a557-030e687c3224"],

Cell[BoxData[
 RowBox[{"v3par", "=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Sqrt", "[", "3", "]"}], "/", "2"}], " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Sqrt", "[", "3", "]"}], " ", "a"}], ")"}], "/", "\[HBar]"}], 
     " ", "g3", " ", "eV"}], "/.", "parameters"}], "//.", 
   "Valuesh"}]}]], "Input",
 CellChangeTimes->{{3.736081606978929*^9, 3.736081661218526*^9}, {
  3.736081750315434*^9, 3.736081759138691*^9}},
 CellLabel->"In[65]:=",ExpressionUUID->"a4ea8601-a348-402e-b414-bfbd01930117"],

Cell[BoxData[
 RowBox[{"v4par", "=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Sqrt", "[", "3", "]"}], "/", "2"}], " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Sqrt", "[", "3", "]"}], " ", "a"}], ")"}], "/", "\[HBar]"}], 
     " ", "g4", " ", "eV"}], "/.", "parameters"}], "//.", 
   "Valuesh"}]}]], "Input",
 CellChangeTimes->{{3.736081807190097*^9, 3.736081810137865*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"9126eef7-1d37-4243-9d23-3921cb19f0c3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"a1", "=", 
    RowBox[{"{", 
     RowBox[{"1", ",", "0"}], "}"}]}], ";", " ", 
   RowBox[{"a2", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"1", "/", "2"}], ",", 
      RowBox[{
       RowBox[{"Sqrt", "[", "3", "]"}], "/", "2"}]}], "}"}]}], ";", " ", 
   RowBox[{"kv", "=", 
    RowBox[{"{", 
     RowBox[{"kx", ",", "ky"}], "}"}]}], ";", " ", 
   RowBox[{"d1", "=", 
    RowBox[{"{", 
     RowBox[{"0", ",", 
      RowBox[{"1", "/", 
       RowBox[{"Sqrt", "[", "3", "]"}]}]}], "}"}]}], ";", " ", 
   RowBox[{"d2", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"1", "/", "2"}], ",", 
      RowBox[{
       RowBox[{"-", "1"}], "/", 
       RowBox[{"(", 
        RowBox[{"2", " ", 
         RowBox[{"Sqrt", "[", "3", "]"}]}], ")"}]}]}], "}"}]}], ";", 
   RowBox[{"d3", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "1"}], "/", "2"}], ",", 
      RowBox[{
       RowBox[{"-", "1"}], "/", 
       RowBox[{"(", 
        RowBox[{"2", " ", 
         RowBox[{"Sqrt", "[", "3", "]"}]}], ")"}]}]}], "}"}]}], ";"}], 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Kx0", "=", 
   RowBox[{"4", " ", 
    RowBox[{"\[Pi]", "/", "3"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.715588663109539*^9, 3.715588739383237*^9}, {
   3.7156652054109983`*^9, 3.71566527666075*^9}, {3.715665307883731*^9, 
   3.715665418768592*^9}, {3.715665452337907*^9, 3.715665461202526*^9}, {
   3.7156655433012743`*^9, 3.715665572860682*^9}, {3.7156656035467587`*^9, 
   3.715665652491932*^9}, {3.715665884126154*^9, 3.715665913987088*^9}, {
   3.715666612881982*^9, 3.715666661603285*^9}, {3.715927465150597*^9, 
   3.7159274726378603`*^9}, {3.715932793700734*^9, 3.715932793991585*^9}, {
   3.7159338646835957`*^9, 3.715933865843978*^9}, 3.715934378771937*^9, {
   3.715934443982342*^9, 3.715934447766738*^9}, {3.715942438451612*^9, 
   3.7159424416981287`*^9}, {3.715942799771885*^9, 3.715942836757028*^9}, {
   3.7159428832894917`*^9, 3.715942892318859*^9}, {3.715942934790254*^9, 
   3.7159429350587053`*^9}, {3.71594313929309*^9, 3.715943154842243*^9}, {
   3.715943221112853*^9, 3.7159432467359037`*^9}, {3.715943309833171*^9, 
   3.715943315812855*^9}, {3.71594391210143*^9, 3.7159440091616488`*^9}, {
   3.715948223307519*^9, 3.715948228118272*^9}, {3.7159483484177*^9, 
   3.7159483698406477`*^9}, {3.715948408635174*^9, 3.7159484175898848`*^9}, {
   3.71595428630159*^9, 3.7159543040979156`*^9}, {3.716102386658064*^9, 
   3.716102392600006*^9}, {3.7161026412943153`*^9, 3.7161027181156054`*^9}, {
   3.7161027595533943`*^9, 3.71610276182714*^9}, 3.7164562084551983`*^9, {
   3.716575924774876*^9, 3.716575931039742*^9}, 3.7166242503223877`*^9, {
   3.716624294008502*^9, 3.716624382480135*^9}, 3.7166245104013157`*^9, {
   3.7166246234874067`*^9, 3.716624631026394*^9}, 3.716624664557147*^9, {
   3.716624794893614*^9, 3.716624901918488*^9}, {3.7166252688871927`*^9, 
   3.716625393046468*^9}, {3.716625443529112*^9, 3.7166254598320704`*^9}, {
   3.716651343989676*^9, 3.716651357529667*^9}, 3.716651579669403*^9, {
   3.716651896353036*^9, 3.716651898389151*^9}, 3.716652283852996*^9},
 CellLabel->"In[67]:=",ExpressionUUID->"15611549-5512-446d-a927-49f6b26c62ee"],

Cell[BoxData[
 RowBox[{"tABfull0", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"-", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Series", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", "d1"}]}], "]"}], "+", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", "d2"}]}], "]"}], "+", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", "d3"}]}], "]"}]}], ")"}], "g0"}], " ", 
              "+", 
              RowBox[{"g01", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", "2"}], "I", " ", 
                   RowBox[{"kv", ".", "d1"}]}], "]"}], "+", 
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", "2"}], "I", " ", 
                   RowBox[{"kv", ".", "d2"}]}], "]"}], "+", 
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", "2"}], "I", " ", 
                   RowBox[{"kv", ".", "d3"}]}], "]"}]}], ")"}]}], " ", "+", 
              RowBox[{"g02", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", 
                    RowBox[{"(", 
                    RowBox[{"a2", "+", "d1"}], ")"}]}]}], "]"}], "+", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", " ", 
                    RowBox[{"(", 
                    RowBox[{"a2", "-", "a1", "+", "d1"}], ")"}]}]}], "]"}], 
                 " ", "+", " ", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "a1"}], "+", "d3"}], ")"}]}]}], "]"}], " ", 
                 "+", " ", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "a2"}], "+", "d3"}], ")"}]}]}], "]"}], " ", 
                 "+", " ", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", 
                    RowBox[{"(", 
                    RowBox[{"a1", "-", "a2", "+", "d2"}], ")"}]}]}], "]"}], 
                 " ", "+", " ", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", 
                    RowBox[{"(", 
                    RowBox[{"a1", "+", "d2"}], ")"}]}]}], "]"}]}], ")"}]}]}], 
             " ", "/.", 
             RowBox[{"kx", "\[Rule]", 
              RowBox[{"Kx0", "+", "kx"}]}]}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "\[Rule]", 
               RowBox[{"\[Epsilon]", " ", "kx"}]}], ",", 
              RowBox[{"ky", "\[Rule]", 
               RowBox[{"\[Epsilon]", " ", "ky"}]}]}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Epsilon]", ",", "0", ",", "1"}], "}"}]}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{"kx", "-", 
           RowBox[{"I", " ", "ky"}]}], ")"}]}], "//", "FullSimplify"}], "//", 
       "Normal"}], ")"}]}], "/.", "parameters"}], "/.", 
   RowBox[{"\[Epsilon]", "\[Rule]", "1"}]}]}]], "Input",
 CellChangeTimes->{{3.715588663109539*^9, 3.715588739383237*^9}, {
   3.7156652054109983`*^9, 3.71566527666075*^9}, {3.715665307883731*^9, 
   3.715665418768592*^9}, {3.715665452337907*^9, 3.715665461202526*^9}, {
   3.7156655433012743`*^9, 3.715665572860682*^9}, {3.7156656035467587`*^9, 
   3.715665652491932*^9}, {3.715665884126154*^9, 3.715665913987088*^9}, {
   3.715666612881982*^9, 3.715666661603285*^9}, {3.715927465150597*^9, 
   3.7159274726378603`*^9}, {3.715932793700734*^9, 3.715932793991585*^9}, {
   3.7159338646835957`*^9, 3.715933865843978*^9}, 3.715934378771937*^9, {
   3.715934443982342*^9, 3.715934447766738*^9}, {3.715942438451612*^9, 
   3.7159424416981287`*^9}, {3.715942799771885*^9, 3.715942836757028*^9}, {
   3.7159428832894917`*^9, 3.715942892318859*^9}, {3.715942934790254*^9, 
   3.7159429350587053`*^9}, {3.71594313929309*^9, 3.715943154842243*^9}, {
   3.715943221112853*^9, 3.7159432467359037`*^9}, {3.715943309833171*^9, 
   3.715943315812855*^9}, {3.71594391210143*^9, 3.7159440091616488`*^9}, {
   3.715948223307519*^9, 3.715948228118272*^9}, {3.7159483484177*^9, 
   3.7159483698406477`*^9}, {3.715948408635174*^9, 3.7159484175898848`*^9}, {
   3.71595428630159*^9, 3.7159543040979156`*^9}, {3.716102386658064*^9, 
   3.716102392600006*^9}, {3.7161026412943153`*^9, 3.7161027181156054`*^9}, {
   3.7161027595533943`*^9, 3.71610276182714*^9}, 3.7164562084551983`*^9, {
   3.716575924774876*^9, 3.716575931039742*^9}, 3.7166242503223877`*^9, {
   3.716624294008502*^9, 3.716624382480135*^9}, 3.7166245104013157`*^9, {
   3.7166246234874067`*^9, 3.716624631026394*^9}, 3.716624664557147*^9, {
   3.716624794893614*^9, 3.716624901918488*^9}, {3.7166252688871927`*^9, 
   3.716625393046468*^9}, {3.716625443529112*^9, 3.7166254598320704`*^9}, {
   3.716651343989676*^9, 3.716651357529667*^9}, 3.716651579669403*^9, {
   3.716651896353036*^9, 3.716651898389151*^9}, 3.716652283852996*^9, {
   3.7173298973008833`*^9, 3.717329906294591*^9}, 3.7173983510459223`*^9, {
   3.7360997849816837`*^9, 3.7360997870800743`*^9}, {3.7360998611249323`*^9, 
   3.7360998870122423`*^9}, {3.7361003808858347`*^9, 3.73610039455234*^9}, 
   3.802550181981*^9},
 CellLabel->"In[69]:=",ExpressionUUID->"3d8813ea-5e41-47f6-a8d6-5859c1a5e6ae"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{"other", " ", 
    RowBox[{"valley", " ", ":", "tABfull0"}]}], "=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Series", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", "d1"}]}], "]"}], "+", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", "d2"}]}], "]"}], "+", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", "d3"}]}], "]"}]}], ")"}], "g0"}], " ", 
              "+", 
              RowBox[{"g01", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", "2"}], "I", " ", 
                   RowBox[{"kv", ".", "d1"}]}], "]"}], "+", 
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", "2"}], "I", " ", 
                   RowBox[{"kv", ".", "d2"}]}], "]"}], "+", 
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", "2"}], "I", " ", 
                   RowBox[{"kv", ".", "d3"}]}], "]"}]}], ")"}]}], " ", "+", 
              RowBox[{"g02", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", 
                    RowBox[{"(", 
                    RowBox[{"a2", "+", "d1"}], ")"}]}]}], "]"}], "+", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", " ", 
                    RowBox[{"(", 
                    RowBox[{"a2", "-", "a1", "+", "d1"}], ")"}]}]}], "]"}], 
                 " ", "+", " ", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "a1"}], "+", "d3"}], ")"}]}]}], "]"}], " ", 
                 "+", " ", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "a2"}], "+", "d3"}], ")"}]}]}], "]"}], " ", 
                 "+", " ", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", 
                    RowBox[{"(", 
                    RowBox[{"a1", "-", "a2", "+", "d2"}], ")"}]}]}], "]"}], 
                 " ", "+", " ", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"I", " ", 
                   RowBox[{"kv", ".", 
                    RowBox[{"(", 
                    RowBox[{"a1", "+", "d2"}], ")"}]}]}], "]"}]}], ")"}]}]}], 
             " ", "/.", 
             RowBox[{"kx", "\[Rule]", 
              RowBox[{
               RowBox[{"-", "Kx0"}], "+", "kx"}]}]}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "\[Rule]", 
               RowBox[{"\[Epsilon]", " ", "kx"}]}], ",", 
              RowBox[{"ky", "\[Rule]", 
               RowBox[{"\[Epsilon]", " ", "ky"}]}]}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Epsilon]", ",", "0", ",", "1"}], "}"}]}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{"kx", "-", 
           RowBox[{"I", " ", "ky"}]}], ")"}]}], "//", "FullSimplify"}], "//", 
       "Normal"}], ")"}], "/.", "parameters"}], "/.", 
    RowBox[{"\[Epsilon]", "\[Rule]", "1"}]}]}], " ", "*)"}]], "Input",
 CellChangeTimes->{
  3.7383181214599543`*^9, {3.7384015952270937`*^9, 3.738401606392522*^9}},
 CellLabel->"In[70]:=",ExpressionUUID->"d329ecc7-ac88-440c-b55f-baf9d68cdc8c"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"So", ",", " ", 
   RowBox[{"it", " ", "is", " ", "raising", " ", "operator"}]}], " ", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.717329859750046*^9, 3.717329878816947*^9}},
 CellLabel->"In[71]:=",ExpressionUUID->"a883a547-4047-4ef8-aa60-9c093f748b2a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"tCDfull0", "=", 
    RowBox[{"Conj", "[", "tABfull0", "]"}]}], ";"}], "  ", 
  RowBox[{"(*", "lowering", " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.715932833920299*^9, 3.715932878433365*^9}, {
   3.715934043989173*^9, 3.715934097342448*^9}, {3.715934129661611*^9, 
   3.715934167070031*^9}, 3.715934327601163*^9, {3.7159440494949083`*^9, 
   3.715944063205114*^9}, 3.717332205573473*^9, {3.717332291099818*^9, 
   3.717332296876006*^9}, {3.71739835291321*^9, 3.7173983613853207`*^9}},
 CellLabel->"In[72]:=",ExpressionUUID->"5e167c0c-9443-40b0-b128-d3648ec52ddc"],

Cell[BoxData[
 RowBox[{"tBDfull0", " ", "=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"-", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"g3", " ", 
         RowBox[{
          RowBox[{"Series", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Exp", "[", 
                 RowBox[{"I", " ", 
                  RowBox[{"kv", ".", "d1"}]}], "]"}], "+", 
                RowBox[{"Exp", "[", 
                 RowBox[{"I", " ", 
                  RowBox[{"kv", ".", "d2"}]}], "]"}], "+", 
                RowBox[{"Exp", "[", 
                 RowBox[{"I", " ", 
                  RowBox[{"kv", ".", "d3"}]}], "]"}]}], ")"}], "/.", 
              RowBox[{"kx", "\[Rule]", 
               RowBox[{"Kx0", "+", "kx"}]}]}], "/.", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "\[Rule]", 
                RowBox[{"\[Epsilon]", " ", "kx"}]}], ",", 
               RowBox[{"ky", "\[Rule]", 
                RowBox[{"\[Epsilon]", " ", "ky"}]}]}], "}"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"\[Epsilon]", ",", "0", ",", "1"}], "}"}]}], "]"}], "/", 
          
          RowBox[{"(", 
           RowBox[{"kx", "-", 
            RowBox[{"I", " ", "ky"}]}], ")"}]}]}], "//", "FullSimplify"}], "//",
        "Normal"}], ")"}]}], "/.", "parameters"}], "/.", 
   RowBox[{"\[Epsilon]", "\[Rule]", "1"}]}]}]], "Input",
 CellChangeTimes->{{3.715927291893489*^9, 3.71592734257535*^9}, {
   3.7159274218420773`*^9, 3.715927444222291*^9}, 3.715944113301858*^9, 
   3.715944322102735*^9, {3.715944462033766*^9, 3.715944462778933*^9}, 
   3.715954323285615*^9, 3.716456185700233*^9, {3.716625513432249*^9, 
   3.716625525023726*^9}, {3.716625611725523*^9, 3.7166256120814667`*^9}, {
   3.716625933503221*^9, 3.716625956608739*^9}, {3.716650154585738*^9, 
   3.716650155389517*^9}, {3.716651211433592*^9, 3.7166512177814007`*^9}, {
   3.716651322048112*^9, 3.7166513257312202`*^9}, {3.717330387465197*^9, 
   3.7173303930427523`*^9}, {3.717398359052709*^9, 3.717398364842348*^9}, 
   3.80255026019417*^9},
 CellLabel->"In[73]:=",ExpressionUUID->"650aa29f-7cf7-4c81-b2ef-8fafc526ea6c"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Effect", " ", "of", " ", "spatial", " ", "variation"}], " ", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8022681648642797`*^9, 3.802268171693055*^9}, {
  3.802268771623728*^9, 3.8022687752539988`*^9}},
 CellLabel->"In[74]:=",ExpressionUUID->"45e29553-4b2d-4d14-8850-3372b5765fce"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"g3", " ", 
      RowBox[{
       RowBox[{"Series", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{"kv", ".", "d1"}]}], "]"}], "+", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{"kv", ".", "d2"}]}], "]"}], "+", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{"kv", ".", "d3"}]}], "]"}]}], ")"}], "/.", 
           RowBox[{"kx", "\[Rule]", 
            RowBox[{"Kx0", "+", "kx"}]}]}], "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"kx", "\[Rule]", 
             RowBox[{"\[Epsilon]", " ", "kx"}]}], ",", 
            RowBox[{"ky", "\[Rule]", 
             RowBox[{"\[Epsilon]", " ", "ky"}]}]}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Epsilon]", ",", "0", ",", "1"}], "}"}]}], "]"}], "/", 
       RowBox[{"(", 
        RowBox[{"kx", "-", 
         RowBox[{"I", " ", "ky"}]}], ")"}]}]}], "//", "FullSimplify"}], "//", 
    "Normal"}], ")"}], "/.", 
  RowBox[{"\[Epsilon]", "\[Rule]", "1"}]}]], "Input",
 CellChangeTimes->{{3.802268965507622*^9, 3.802268967534338*^9}},
 CellLabel->"In[75]:=",ExpressionUUID->"30aedefa-321d-4b44-b231-8f37bd1e5f41"],

Cell[BoxData[
 RowBox[{"tBDe", " ", "=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"-", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"g3e", " ", 
         RowBox[{
          RowBox[{"Series", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Exp", "[", 
                 RowBox[{"I", " ", 
                  RowBox[{"kv", ".", "d1"}]}], "]"}], "+", 
                RowBox[{"Exp", "[", 
                 RowBox[{"I", " ", 
                  RowBox[{"kv", ".", "d2"}]}], "]"}], "+", 
                RowBox[{"Exp", "[", 
                 RowBox[{"I", " ", 
                  RowBox[{"kv", ".", "d3"}]}], "]"}]}], ")"}], "/.", 
              RowBox[{"kx", "\[Rule]", 
               RowBox[{"Kx0", "+", "kx"}]}]}], "/.", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "\[Rule]", 
                RowBox[{"\[Epsilon]", " ", "kx"}]}], ",", 
               RowBox[{"ky", "\[Rule]", 
                RowBox[{"\[Epsilon]", " ", "ky"}]}]}], "}"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"\[Epsilon]", ",", "0", ",", "1"}], "}"}]}], "]"}], "/", 
          
          RowBox[{"(", 
           RowBox[{"kx", "-", 
            RowBox[{"I", " ", "ky"}]}], ")"}]}]}], "//", "FullSimplify"}], "//",
        "Normal"}], ")"}]}], "/.", "parameters"}], "/.", 
   RowBox[{"\[Epsilon]", "\[Rule]", "1"}]}]}]], "Input",
 CellChangeTimes->{{3.730450850494564*^9, 3.7304508548310823`*^9}, 
   3.802550280896557*^9},
 CellLabel->"In[80]:=",ExpressionUUID->"460cf1b8-f601-4af9-8ef2-b701c288dddb"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"raising", " ", "operator"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.717330437620577*^9, 3.717330445338955*^9}},
 CellLabel->"In[81]:=",ExpressionUUID->"2f79dbe6-0345-4711-994f-b981f4784f98"],

Cell[BoxData[
 RowBox[{"tBCfull0", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"g4", " ", 
        RowBox[{
         RowBox[{"Series", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", "I"}], " ", 
                 RowBox[{"kv", ".", "d1"}]}], "]"}], "+", 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", "I"}], " ", 
                 RowBox[{"kv", ".", "d2"}]}], "]"}], "+", 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", "I"}], " ", 
                 RowBox[{"kv", ".", "d3"}]}], "]"}]}], ")"}], "/.", 
             RowBox[{"kx", "\[Rule]", 
              RowBox[{"Kx0", "+", "kx"}]}]}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "\[Rule]", 
               RowBox[{"\[Epsilon]", " ", "kx"}]}], ",", 
              RowBox[{"ky", "\[Rule]", 
               RowBox[{"\[Epsilon]", " ", "ky"}]}]}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Epsilon]", ",", "0", ",", "1"}], "}"}]}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{"kx", "+", 
           RowBox[{"I", " ", "ky"}]}], ")"}]}]}], "//", "FullSimplify"}], "//",
       "Normal"}], ")"}], "/.", "parameters"}], "/.", 
   RowBox[{"\[Epsilon]", "\[Rule]", "1"}]}]}]], "Input",
 CellChangeTimes->{{3.715936046870071*^9, 3.715936090316998*^9}, 
   3.715936133359487*^9, {3.715944436977242*^9, 3.715944443572489*^9}, {
   3.715944474314691*^9, 3.7159444750461473`*^9}, 3.7159543307999363`*^9, 
   3.7164561913406076`*^9, {3.716626038400888*^9, 3.7166260408738623`*^9}, {
   3.716650134347021*^9, 3.716650134895258*^9}, {3.716650169484126*^9, 
   3.7166501760413933`*^9}, {3.716651222991969*^9, 3.716651227525141*^9}, {
   3.716651328919915*^9, 3.716651331199649*^9}, {3.7173304825311737`*^9, 
   3.717330487558573*^9}, 3.717398369316062*^9},
 CellLabel->"In[82]:=",ExpressionUUID->"6092a7a7-45b1-42e6-a056-1a6e81d0a5f3"],

Cell[BoxData[
 RowBox[{"tBCe", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"g4e", " ", 
        RowBox[{
         RowBox[{"Series", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", "I"}], " ", 
                 RowBox[{"kv", ".", "d1"}]}], "]"}], "+", 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", "I"}], " ", 
                 RowBox[{"kv", ".", "d2"}]}], "]"}], "+", 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", "I"}], " ", 
                 RowBox[{"kv", ".", "d3"}]}], "]"}]}], ")"}], "/.", 
             RowBox[{"kx", "\[Rule]", 
              RowBox[{"Kx0", "+", "kx"}]}]}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "\[Rule]", 
               RowBox[{"\[Epsilon]", " ", "kx"}]}], ",", 
              RowBox[{"ky", "\[Rule]", 
               RowBox[{"\[Epsilon]", " ", "ky"}]}]}], "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Epsilon]", ",", "0", ",", "1"}], "}"}]}], "]"}], "/", 
         RowBox[{"(", 
          RowBox[{"kx", "+", 
           RowBox[{"I", " ", "ky"}]}], ")"}]}]}], "//", "FullSimplify"}], "//",
       "Normal"}], ")"}], "/.", "parameters"}], "/.", 
   RowBox[{"\[Epsilon]", "\[Rule]", "1"}]}]}]], "Input",
 CellChangeTimes->{{3.730450883822144*^9, 3.7304508886054983`*^9}},
 CellLabel->"In[83]:=",ExpressionUUID->"49d5625c-8340-4851-98c9-c546f35c97b1"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"lowering", " ", "operator"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.717330490457478*^9, 3.7173304976065493`*^9}, {
  3.717332378465089*^9, 3.717332380490376*^9}},
 CellLabel->"In[84]:=",ExpressionUUID->"31563ae1-740a-438f-a473-e5d4ca93a338"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"tADfull0", "=", "tBCfull0"}], ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{
   "loweing", " ", "from", " ", "A", " ", "to", " ", "D", "   ", "or", "  ", 
    "raising", " ", "from", " ", "D", " ", "to", " ", "A"}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.7159361498871193`*^9, 3.715936185329834*^9}, {
  3.7159445257035437`*^9, 3.715944530391378*^9}, {3.717332383813298*^9, 
  3.7173324069522038`*^9}, {3.7173983723151617`*^9, 3.7173983739348907`*^9}},
 CellLabel->"In[85]:=",ExpressionUUID->"3de0f436-9a2f-448e-99e6-06a12bfd167e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tADe", "=", "tBCe"}], ";"}]], "Input",
 CellChangeTimes->{{3.730450922610868*^9, 3.730450928027141*^9}},
 CellLabel->"In[86]:=",ExpressionUUID->"91b933c2-7435-4a55-bb21-98459a024c82"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{"Magnetic", " ", "field", " ", "parameter", " ", "s"}], " ", "=", 
   " ", 
   RowBox[{
    RowBox[{"2", " ", "e", " ", 
     RowBox[{"B", "/", "\[HBar]"}]}], " ", "=", " ", 
    RowBox[{"2", "/", 
     RowBox[{
      SubscriptBox["l", "B"], "^", "2"}]}]}]}], "  ", "*)"}]], "Input",
 CellChangeTimes->{{3.717325836856882*^9, 3.717325870024211*^9}},
 CellLabel->"In[87]:=",ExpressionUUID->"f13df249-5f52-4ba0-8f54-d37a049bedd1"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"We", " ", "replace", " ", "kx"}], " ", "+", " ", 
    RowBox[{
    "i", " ", "ky", " ", "with", " ", "a", " ", "lowering", " ", 
     "operator"}]}], ",", " ", 
   RowBox[{
    RowBox[{"that", " ", "acts", " ", "as", "   ", "k", " ", "psi_n"}], " ", 
    "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"s", " ", "n"}], ")"}], "^", 
       RowBox[{"(", 
        RowBox[{"1", "/", "2"}], ")"}]}], " ", "psi_", 
      RowBox[{"(", 
       RowBox[{"n", "-", "1"}], ")"}], "   ", "and", "   ", "kx"}], "-", " ", 
     
     RowBox[{
     "i", " ", "ky", " ", "with", "  ", "a", " ", "raising", " ", 
      "operator"}]}]}], ",", " ", 
   RowBox[{
    RowBox[{"that", " ", "acts", " ", "as", "  ", 
     RowBox[{"k", "^"}], "*", " ", "psi_n"}], " ", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"s", " ", 
        RowBox[{"(", 
         RowBox[{"n", "+", "1"}], ")"}]}], ")"}], "^", 
      RowBox[{"(", 
       RowBox[{"1", "/", "2"}], ")"}]}], " ", "psi_", 
     RowBox[{"(", 
      RowBox[{"n", "+", "1"}], ")"}], "    ", "on", " ", "the", " ", "basis", 
     " ", "of", " ", "psi_", "0"}]}], " ", ",", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"psi_", "1"}], " ", "..."}], ".", "  ", "of"}], " ", 
     "harmonic", " ", "oscillator", " ", "wave"}], "-", "functions"}]}], " ", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.717325888460841*^9, 3.717326086149995*^9}},
 CellLabel->"In[88]:=",ExpressionUUID->"7c627738-adcc-44eb-b537-f5404de11431"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Now", ",", " ", 
    RowBox[{
    "truncate", " ", "the", " ", "oscillator", " ", "functions", " ", "to", "  ",
      "No", " ", 
     RowBox[{"(", 
      RowBox[{"so", ",", " ", 
       RowBox[{"No", "+", 
        RowBox[{"1", " ", "states"}]}]}], ")"}], "  ", "and", " ", 
     "construct", " ", "the", " ", "sparse", " ", "Hamiltonian", " ", "of", 
     " ", "size", "  ", "4", " ", "NBilayer", " ", "x", " ", "No"}]}], " ", 
   "*)"}], " "}]], "Input",
 CellChangeTimes->{{3.717326123009836*^9, 3.7173261271507483`*^9}, {
  3.717327821104072*^9, 3.71732795162326*^9}, {3.71732801566464*^9, 
  3.7173280171272507`*^9}, {3.717336653338058*^9, 3.717336668271686*^9}},
 CellLabel->"In[89]:=",ExpressionUUID->"83d1d531-0ab2-4f36-ab6f-ddb9d461519c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"DeltaAB", "=", 
     RowBox[{
      RowBox[{"g6", "+", "g5", "-", "g2"}], "/.", "parameters"}]}], ";"}], 
   " ", "*)"}], " ", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"tAA", "=", 
    RowBox[{
     RowBox[{"g5", "/", "2"}], "/.", "parameters"}]}], ";", " ", 
   RowBox[{"tBB", "=", 
    RowBox[{
     RowBox[{"g2", "/", "2"}], "/.", "parameters"}]}], ";", " ", 
   RowBox[{"mu", "=", 
    RowBox[{
     RowBox[{"Ef", "-", "g2"}], "/.", "parameters"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.716648721406453*^9, 3.716648740770302*^9}, 
   3.716648801497128*^9, 3.716649325377014*^9, {3.716649422138743*^9, 
   3.716649465308242*^9}, {3.7166512331769247`*^9, 3.7166512511206007`*^9}, {
   3.730449297607017*^9, 3.730449302730093*^9}, 3.7304521306827517`*^9},
 CellLabel->"In[90]:=",ExpressionUUID->"255b6977-199b-4051-b205-2c6feac3282b"],

Cell[BoxData[
 RowBox[{"B2s", "=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"2", " ", "e", " ", 
     RowBox[{"Tesla", "/", "\[HBar]"}], " ", "*", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Sqrt", "[", "3", "]"}], " ", "a"}], ")"}], "^", "2"}]}], 
    ")"}], "//.", "Valuesh", "  ", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Unit", " ", "conversion", " ", "from", " ", "Tesla", " ", "to", " ", 
      "s"}], " ", ",", " ", 
     RowBox[{
     "note", " ", "that", " ", "a", " ", "in", " ", "my", " ", "vluesh", " ", 
      "is", "  ", "1.42"}]}], " ", "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.717337448402739*^9, 3.7173374817871027`*^9}, {
  3.717337512317502*^9, 3.717337572890925*^9}, {3.737142101551512*^9, 
  3.737142116253579*^9}},
 CellLabel->"In[91]:=",ExpressionUUID->"597ccff0-b8dd-4106-8af9-9d59580d337a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"0.1", " ", 
      RowBox[{"eV", "/", 
       RowBox[{"(", 
        RowBox[{"\[HBar]", " ", "vF"}], ")"}]}]}], ")"}], "^", "2"}], "/", 
   "\[Pi]"}], "//.", "Valuesh"}]], "Input",
 CellChangeTimes->{{3.716207505188208*^9, 3.716207552071704*^9}},
 CellLabel->"In[92]:=",ExpressionUUID->"a59ae8a9-e497-4f9c-977d-efacee36820c"],

Cell[BoxData[
 RowBox[{"kUnit", "=", 
  RowBox[{
   RowBox[{"1", "/", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Sqrt", "[", "3", "]"}], "a"}], ")"}]}], "//.", 
   "Valuesh"}]}]], "Input",
 CellChangeTimes->{{3.716113051187006*^9, 3.7161130561585207`*^9}, {
  3.71611311632689*^9, 3.716113119030325*^9}, {3.7161131707747393`*^9, 
  3.7161132018466797`*^9}},
 CellLabel->"In[93]:=",ExpressionUUID->"2d2209d8-b8f6-406f-b7e6-9f9d95a3f52e"],

Cell[BoxData[
 RowBox[{"Eunit", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"kUnit", "^", "2"}], " ", 
    RowBox[{
     RowBox[{
      RowBox[{"e", "^", "2"}], " ", "/", "\[Epsilon]0"}], "/", "eV"}], " ", 
    "m"}], "//.", "Valuesh", " ", 
   RowBox[{"(*", " ", 
    RowBox[{"conversion", " ", "factor", " ", "to", " ", 
     RowBox[{"eV", "/", "m"}]}], " ", "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.715158563365964*^9, 3.715158604312537*^9}},
 CellLabel->"In[98]:=",ExpressionUUID->"31f8949d-c572-4637-9dd1-285af500f4a9"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Uunit", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"d1", " ", 
      RowBox[{"kUnit", "^", "2"}], " ", 
      RowBox[{
       RowBox[{
        RowBox[{"e", "^", "2"}], " ", "/", "\[Epsilon]0"}], "/", "eV"}]}], "/.", 
     RowBox[{"d1", "\[Rule]", 
      RowBox[{"0.34", " ", "nm"}]}]}], "//.", "Valuesh"}]}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"conversion", " ", "factor", " ", "to", " ", "eV"}], " ", "*)"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.71515891965429*^9, 3.715158959066462*^9}, {
  3.715188301852418*^9, 3.715188305383264*^9}},
 CellLabel->"In[99]:=",ExpressionUUID->"eb763495-73e9-473b-9be6-830499f971cc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Epsilon]dielectric", "=", "2.5"}], ";"}]], "Input",
 CellChangeTimes->{{3.7191238587040586`*^9, 3.7191238631027*^9}, {
  3.71913233152806*^9, 3.719132331679378*^9}, {3.719134692202187*^9, 
  3.719134692697586*^9}, {3.719142300080962*^9, 3.719142300184492*^9}, {
  3.719150817753047*^9, 3.719150817880636*^9}, {3.719755573735098*^9, 
  3.7197555778711843`*^9}, {3.7197599652835217`*^9, 3.71975996719527*^9}, {
  3.7197647820822067`*^9, 3.71976478455126*^9}, {3.719779894316882*^9, 
  3.719779894440708*^9}, {3.719852689677033*^9, 3.7198526898231573`*^9}, {
  3.719861452846382*^9, 3.719861453885824*^9}, {3.719885560863659*^9, 
  3.719885561628962*^9}, {3.719906601621595*^9, 3.719906601676731*^9}, {
  3.719911620858004*^9, 3.7199116209296303`*^9}, {3.789424393233519*^9, 
  3.7894243947857037`*^9}, {3.8025498966108007`*^9, 3.802549897877864*^9}, {
  3.827065020798663*^9, 3.8270650233073797`*^9}},
 CellLabel->
  "In[100]:=",ExpressionUUID->"872f91fc-9be7-4614-a0d3-53c1fd23f745"],

Cell[BoxData[
 RowBox[{"Uunit", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"dist1", " ", 
     RowBox[{"kUnit", "^", "2"}], " ", 
     RowBox[{
      RowBox[{
       RowBox[{"e", "^", "2"}], " ", "/", "\[Epsilon]0"}], "/", 
      RowBox[{"(", "eV", ")"}]}]}], "/.", 
    RowBox[{"dist1", "\[Rule]", 
     RowBox[{
      RowBox[{"0.34", " ", "/", "\[Epsilon]dielectric"}], "  ", "nm"}]}]}], "//.",
    "Valuesh", " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"conversion", " ", "factor"}], ",", " ", 
     RowBox[{
     "to", " ", "account", " ", "for", " ", "kUnit", " ", "and", " ", 
      "electric", " ", "interaction"}]}], " ", "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.715158971594448*^9, 3.7151590070148582`*^9}, {
  3.7159727029487553`*^9, 3.715972707796938*^9}, {3.715974355429574*^9, 
  3.7159743563122597`*^9}, {3.719123825176532*^9, 3.7191238390395184`*^9}, {
  3.730461623091175*^9, 3.730461662782178*^9}},
 CellLabel->
  "In[101]:=",ExpressionUUID->"52a02c04-a738-4c51-9479-ca8932185ca7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Same", ",", " ", 
    RowBox[{
    "but", " ", "when", " ", "density", " ", "in", " ", "magnetic", " ", 
     "field", " ", "is", " ", "computed", " ", "in", " ", "Units", " ", "of", 
     " ", 
     RowBox[{"nm", "^", 
      RowBox[{"-", "2"}]}], "   ", "converts", " ", "from", " ", "density", 
     " ", "to", " ", "potential", " ", "difference"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"Uunit1", "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"10", "^", 
         RowBox[{"(", "18", ")"}]}], "dist1", "  ", 
        RowBox[{
         RowBox[{
          RowBox[{"e", "^", "2"}], " ", "/", "\[Epsilon]0"}], "/", 
         RowBox[{"(", "eV", ")"}]}]}], "/.", 
       RowBox[{"dist1", "\[Rule]", 
        RowBox[{
         RowBox[{"0.34", "/", "\[Epsilon]dielectric"}], " ", "nm"}]}]}], "//.",
       "Valuesh"}], ")"}], "/.", "removeDim"}]}]}]], "Input",
 CellChangeTimes->{{3.717496502579578*^9, 3.717496633228949*^9}, {
   3.719123847423759*^9, 3.719123853488675*^9}, 3.7191240031141863`*^9, {
   3.728998960675144*^9, 3.728998978133953*^9}},
 CellLabel->
  "In[102]:=",ExpressionUUID->"e027b9c5-fb3b-408d-a66f-9e64e6bbe5ba"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"tABfull", "=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"-", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Exp", "[", 
           RowBox[{"I", " ", 
            RowBox[{"kv", ".", "d1"}]}], "]"}], "+", 
          RowBox[{"Exp", "[", 
           RowBox[{"I", " ", 
            RowBox[{"kv", ".", "d2"}]}], "]"}], "+", 
          RowBox[{"Exp", "[", 
           RowBox[{"I", " ", 
            RowBox[{"kv", ".", "d3"}]}], "]"}]}], ")"}]}], "g0"}], " ", "+", 
      RowBox[{"g01", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", "2"}], "I", " ", 
           RowBox[{"kv", ".", "d1"}]}], "]"}], "+", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", "2"}], "I", " ", 
           RowBox[{"kv", ".", "d2"}]}], "]"}], "+", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", "2"}], "I", " ", 
           RowBox[{"kv", ".", "d3"}]}], "]"}]}], ")"}]}], " ", "+", 
      RowBox[{"g02", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Exp", "[", 
          RowBox[{"I", " ", 
           RowBox[{"kv", ".", 
            RowBox[{"(", 
             RowBox[{"a2", "+", "d1"}], ")"}]}]}], "]"}], "+", 
         RowBox[{"Exp", "[", 
          RowBox[{"I", " ", 
           RowBox[{"kv", ".", " ", 
            RowBox[{"(", 
             RowBox[{"a2", "-", "a1", "+", "d1"}], ")"}]}]}], "]"}], " ", "+",
          " ", 
         RowBox[{"Exp", "[", 
          RowBox[{"I", " ", 
           RowBox[{"kv", ".", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "a1"}], "+", "d3"}], ")"}]}]}], "]"}], " ", "+", 
         " ", 
         RowBox[{"Exp", "[", 
          RowBox[{"I", " ", 
           RowBox[{"kv", ".", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "a2"}], "+", "d3"}], ")"}]}]}], "]"}], " ", "+", 
         " ", 
         RowBox[{"Exp", "[", 
          RowBox[{"I", " ", 
           RowBox[{"kv", ".", 
            RowBox[{"(", 
             RowBox[{"a1", "-", "a2", "+", "d2"}], ")"}]}]}], "]"}], " ", "+",
          " ", 
         RowBox[{"Exp", "[", 
          RowBox[{"I", " ", 
           RowBox[{"kv", ".", 
            RowBox[{"(", 
             RowBox[{"a1", "+", "d2"}], ")"}]}]}], "]"}]}], ")"}]}]}], " ", "/.", 
     RowBox[{"kx", "\[Rule]", 
      RowBox[{"Kx0", "+", "kx"}]}]}], "/.", "parameters"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"tCDfull", "=", 
   RowBox[{
    RowBox[{"Conj", "[", "tABfull", "]"}], "//", "FullSimplify"}]}], ";", 
  "  ", 
  RowBox[{"tABfull", "=", 
   RowBox[{"tABfull", "//", "FullSimplify"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.715588663109539*^9, 3.715588739383237*^9}, {
   3.7156652054109983`*^9, 3.71566527666075*^9}, {3.715665307883731*^9, 
   3.715665418768592*^9}, {3.715665452337907*^9, 3.715665461202526*^9}, {
   3.7156655433012743`*^9, 3.715665572860682*^9}, {3.7156656035467587`*^9, 
   3.715665652491932*^9}, {3.715665884126154*^9, 3.715665913987088*^9}, {
   3.715666612881982*^9, 3.715666661603285*^9}, {3.715927465150597*^9, 
   3.7159274726378603`*^9}, {3.715932793700734*^9, 3.715932793991585*^9}, {
   3.7159338646835957`*^9, 3.715933865843978*^9}, 3.715934378771937*^9, {
   3.715934443982342*^9, 3.715934447766738*^9}, {3.715942438451612*^9, 
   3.7159424416981287`*^9}, {3.715942799771885*^9, 3.715942836757028*^9}, {
   3.7159428832894917`*^9, 3.715942892318859*^9}, {3.715942934790254*^9, 
   3.7159429350587053`*^9}, {3.71594313929309*^9, 3.715943154842243*^9}, {
   3.715943221112853*^9, 3.7159432467359037`*^9}, {3.715943309833171*^9, 
   3.715943315812855*^9}, {3.71594391210143*^9, 3.7159440091616488`*^9}, {
   3.715948223307519*^9, 3.715948228118272*^9}, {3.7159483484177*^9, 
   3.7159483698406477`*^9}, {3.715948408635174*^9, 3.7159484175898848`*^9}, {
   3.71595428630159*^9, 3.7159543040979156`*^9}, {3.716102386658064*^9, 
   3.716102392600006*^9}, {3.7161026412943153`*^9, 3.7161027181156054`*^9}, {
   3.7161027595533943`*^9, 3.71610276182714*^9}, 3.7164562084551983`*^9, {
   3.716575924774876*^9, 3.716575931039742*^9}, 3.7166242503223877`*^9, {
   3.716624294008502*^9, 3.716624382480135*^9}, 3.7166245104013157`*^9, {
   3.7166246234874067`*^9, 3.716624631026394*^9}, 3.716624664557147*^9, {
   3.716624794893614*^9, 3.716624901918488*^9}, {3.7166252688871927`*^9, 
   3.716625393046468*^9}, {3.716625443529112*^9, 3.7166254598320704`*^9}, {
   3.716651343989676*^9, 3.716651357529667*^9}, 3.716651579669403*^9, {
   3.716651896353036*^9, 3.716651898389151*^9}, 3.716652283852996*^9, {
   3.7166523226333237`*^9, 3.7166523522844*^9}, {3.7166529023355417`*^9, 
   3.7166529101233063`*^9}, {3.735650723203342*^9, 3.735650734725194*^9}, 
   3.802550318781562*^9},
 CellLabel->
  "In[103]:=",ExpressionUUID->"d68ca6f1-2c09-401e-a135-fbca485dbbec"],

Cell[BoxData[
 RowBox[{"tBDfull", " ", "=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"-", "g3"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Exp", "[", 
         RowBox[{"I", " ", 
          RowBox[{"kv", ".", "d1"}]}], "]"}], "+", 
        RowBox[{"Exp", "[", 
         RowBox[{"I", " ", 
          RowBox[{"kv", ".", "d2"}]}], "]"}], "+", 
        RowBox[{"Exp", "[", 
         RowBox[{"I", " ", 
          RowBox[{"kv", ".", "d3"}]}], "]"}]}], ")"}]}], "/.", 
     RowBox[{"kx", "\[Rule]", 
      RowBox[{"Kx0", "+", "kx"}]}]}], "/.", "parameters"}], "//", 
   "FullSimplify"}]}]], "Input",
 CellChangeTimes->{{3.715927291893489*^9, 3.71592734257535*^9}, {
   3.7159274218420773`*^9, 3.715927444222291*^9}, 3.715944113301858*^9, 
   3.715944322102735*^9, {3.715944462033766*^9, 3.715944462778933*^9}, 
   3.715954323285615*^9, 3.716456185700233*^9, {3.716625513432249*^9, 
   3.716625525023726*^9}, {3.716625611725523*^9, 3.7166256120814667`*^9}, {
   3.716625933503221*^9, 3.716625956608739*^9}, {3.716650154585738*^9, 
   3.716650155389517*^9}, {3.716651211433592*^9, 3.7166512177814007`*^9}, {
   3.716651322048112*^9, 3.7166513257312202`*^9}, {3.716652565427806*^9, 
   3.716652583278324*^9}, {3.716652923104248*^9, 3.716652954690427*^9}, 
   3.8025503338456182`*^9},
 CellLabel->
  "In[105]:=",ExpressionUUID->"c70e7d72-d032-45d5-a29c-67a38f94ff63"],

Cell[BoxData[
 RowBox[{"tBDfulle", " ", "=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"-", "g3e"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Exp", "[", 
         RowBox[{"I", " ", 
          RowBox[{"kv", ".", "d1"}]}], "]"}], "+", 
        RowBox[{"Exp", "[", 
         RowBox[{"I", " ", 
          RowBox[{"kv", ".", "d2"}]}], "]"}], "+", 
        RowBox[{"Exp", "[", 
         RowBox[{"I", " ", 
          RowBox[{"kv", ".", "d3"}]}], "]"}]}], ")"}]}], "/.", 
     RowBox[{"kx", "\[Rule]", 
      RowBox[{"Kx0", "+", "kx"}]}]}], "/.", "parameters"}], "//", 
   "FullSimplify"}]}]], "Input",
 CellChangeTimes->{{3.730451055759227*^9, 3.7304510589453363`*^9}, 
   3.802550335853702*^9},
 CellLabel->
  "In[106]:=",ExpressionUUID->"34495ccb-731d-44db-957c-44dbbcba0e20"],

Cell[BoxData[
 RowBox[{"tBCfull", "=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"g4", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "I"}], " ", 
          RowBox[{"kv", ".", "d1"}]}], "]"}], "+", 
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "I"}], " ", 
          RowBox[{"kv", ".", "d2"}]}], "]"}], "+", 
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "I"}], " ", 
          RowBox[{"kv", ".", "d3"}]}], "]"}]}], ")"}]}], "/.", 
     RowBox[{"kx", "\[Rule]", 
      RowBox[{"Kx0", "+", "kx"}]}]}], "/.", "parameters"}], "//", 
   "FullSimplify"}]}]], "Input",
 CellChangeTimes->{{3.715936046870071*^9, 3.715936090316998*^9}, 
   3.715936133359487*^9, {3.715944436977242*^9, 3.715944443572489*^9}, {
   3.715944474314691*^9, 3.7159444750461473`*^9}, 3.7159543307999363`*^9, 
   3.7164561913406076`*^9, {3.716626038400888*^9, 3.7166260408738623`*^9}, {
   3.716650134347021*^9, 3.716650134895258*^9}, {3.716650169484126*^9, 
   3.7166501760413933`*^9}, {3.716651222991969*^9, 3.716651227525141*^9}, {
   3.716651328919915*^9, 3.716651331199649*^9}, {3.7166525926902027`*^9, 
   3.716652611593316*^9}, {3.71665293757828*^9, 3.7166529675810843`*^9}},
 CellLabel->
  "In[107]:=",ExpressionUUID->"9ae5d193-5951-43f9-bf4f-dfe26cfe47c7"],

Cell[BoxData[
 RowBox[{"tBCfulle", "=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"g4e", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "I"}], " ", 
          RowBox[{"kv", ".", "d1"}]}], "]"}], "+", 
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "I"}], " ", 
          RowBox[{"kv", ".", "d2"}]}], "]"}], "+", 
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "I"}], " ", 
          RowBox[{"kv", ".", "d3"}]}], "]"}]}], ")"}]}], "/.", 
     RowBox[{"kx", "\[Rule]", 
      RowBox[{"Kx0", "+", "kx"}]}]}], "/.", "parameters"}], "//", 
   "FullSimplify"}]}]], "Input",
 CellChangeTimes->{{3.730451402802163*^9, 3.73045140377532*^9}},
 CellLabel->
  "In[109]:=",ExpressionUUID->"e92e65d5-c5a3-47f4-9dcd-ac66133cca7d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tADfull", "=", "tBCfull"}], ";"}]], "Input",
 CellChangeTimes->{{3.7159361498871193`*^9, 3.715936185329834*^9}, {
  3.7159445257035437`*^9, 3.715944530391378*^9}},
 CellLabel->
  "In[110]:=",ExpressionUUID->"2f31ee07-9815-44e6-bdee-5eca63a7cbf4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tADfulle", "=", "tBCfulle"}], ";"}]], "Input",
 CellChangeTimes->{{3.730451413913364*^9, 3.730451416625235*^9}},
 CellLabel->
  "In[111]:=",ExpressionUUID->"e700b1b1-55fb-4493-8cbc-61792b9a89c0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"NBilayer", "=", "7"}], ";"}]], "Input",
 CellChangeTimes->{{3.7177753839068527`*^9, 3.7177753891652317`*^9}, {
  3.7336392265823793`*^9, 3.733639227214035*^9}, {3.767344341544313*^9, 
  3.767344345750691*^9}, {3.8025498452651253`*^9, 3.8025498456063137`*^9}},
 CellLabel->
  "In[112]:=",ExpressionUUID->"c5d83ee8-460a-4b1f-8603-ea8531b8c2e9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ConstructH", "[", 
   RowBox[{"DeltaVector_", ",", " ", "NBilayer_", ",", "kx1_", ",", "ky1_"}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "UpperDiag1", ",", "UpperDiag2", ",", "UpperDiag3", ",", "UpperDiag4", 
      ",", "LowerDiag1", ",", "LowerDiag2", ",", "LowerDiag3", ",", 
      "LowerDiag4", ",", "Diag0", ",", "H"}], "}"}], ",", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "I", " ", "use", " ", "here", " ", "the", " ", "notations", " ", "from",
        " ", "PRL", " ", "99"}], ",", " ", 
      RowBox[{"146804", "  ", "Bernevig"}], ",", " ", 
      RowBox[{"...", " ", "2007"}]}], " ", "*)"}], "\n", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"UpperDiag1", "=", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"tfull", ",", "0", ",", 
             RowBox[{"-", "kp"}], ",", "0"}], "}"}], ",", 
           RowBox[{"{", "NBilayer", "}"}]}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"-", "2"}]}], "]"}], "]"}]}], ";"}], " ", "*)"}], "\n", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"UpperDiag2", "=", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t1", ",", "0", ",", "t1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", "NBilayer", "}"}]}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"-", "3"}]}], "]"}], "]"}]}], ";"}], " ", "*)"}], "\n", 
    RowBox[{
     RowBox[{"LowerDiag1", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"tABfull", ",", "tBCfulle", ",", "tCDfull", ",", 
             RowBox[{"Conj", "[", "tADfulle", "]"}]}], "}"}], ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"tABfull", ",", "tBCfull", ",", "tCDfull", ",", 
               RowBox[{"Conj", "[", "tADfull", "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"NBilayer", "-", "2"}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"tABfull", ",", "tBCfulle", ",", "tCDfull", ",", 
             RowBox[{"Conj", "[", "tADfulle", "]"}]}], "}"}]}], "]"}], "]"}], 
        "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"-", "2"}]}], "]"}], "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"kx", "\[Rule]", "kx1"}], ",", 
         RowBox[{"ky", "\[Rule]", "ky1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{"LowerDiag2", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"g1e", "/.", "parameters"}], ",", "tBDfulle", ",", 
             RowBox[{"g1e", "/.", "parameters"}], ",", 
             RowBox[{"Conj", "[", "tBDfulle", "]"}]}], "}"}], ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"g1", "/.", "parameters"}], ",", "tBDfull", ",", 
               RowBox[{"g1", "/.", "parameters"}], ",", 
               RowBox[{"Conj", "[", "tBDfull", "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"NBilayer", "-", "2"}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"g1e", "/.", "parameters"}], ",", "tBDfulle", ",", 
             RowBox[{"g1e", "/.", "parameters"}], ",", 
             RowBox[{"Conj", "[", "tBDfulle", "]"}]}], "}"}]}], "]"}], "]"}], 
        "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"-", "3"}]}], "]"}], "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"kx", "\[Rule]", "kx1"}], ",", 
         RowBox[{"ky", "\[Rule]", "ky1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{"LowerDiag3", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"tADfulle", ",", "0", ",", 
             RowBox[{"Conj", "[", "tBCfulle", "]"}], ",", "0"}], "}"}], ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"tADfull", ",", "0", ",", 
               RowBox[{"Conj", "[", "tBCfull", "]"}], ",", "0"}], "}"}], ",", 
             
             RowBox[{"{", 
              RowBox[{"NBilayer", "-", "2"}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"tADfulle", ",", "0", ",", 
             RowBox[{"Conj", "[", "tBCfulle", "]"}], ",", "0"}], "}"}]}], 
          "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"-", "4"}]}], "]"}], "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"kx", "\[Rule]", "kx1"}], ",", 
         RowBox[{"ky", "\[Rule]", "ky1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{"LowerDiag4", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"tAA", "/.", "parameters"}], ",", 
             RowBox[{"tBB", "/.", "parameters"}], ",", 
             RowBox[{"tAA", "/.", "parameters"}], ",", 
             RowBox[{"tBB", "/.", "parameters"}]}], "}"}], ",", 
           RowBox[{"{", "NBilayer", "}"}]}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"-", "5"}]}], "]"}], "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"kx", "\[Rule]", "kx1"}], ",", 
         RowBox[{"ky", "\[Rule]", "ky1"}]}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"UpperDiag1", "=", 
      RowBox[{"Conj", "[", "LowerDiag1", "]"}]}], ";", 
     RowBox[{"UpperDiag2", "=", 
      RowBox[{"Conj", "[", "LowerDiag2", "]"}]}], ";", 
     RowBox[{"UpperDiag3", "=", 
      RowBox[{"Conj", "[", "LowerDiag3", "]"}]}], ";", 
     RowBox[{"UpperDiag4", "=", 
      RowBox[{"Conj", "[", "LowerDiag4", "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"H", "=", 
      RowBox[{
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"DeltaVector", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", "DeltaABe", " ", "-", 
               " ", "mu"}], "/.", "parameters"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"DeltaVector", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "-", "mu"}], "/.", 
              "parameters"}]}], "}"}], ",", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "+", "DeltaAB", " ", "-", " ", "mu"}], "/.", 
                 "parameters"}], ",", 
                RowBox[{
                 RowBox[{"#", "-", "mu"}], "/.", "parameters"}]}], "}"}], 
              "&"}], ",", 
             RowBox[{"DeltaVector", "[", 
              RowBox[{"[", 
               RowBox[{"2", ";;", 
                RowBox[{"-", "2"}]}], "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"DeltaVector", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}], "+", "DeltaABe", " ", "-", 
               " ", "mu"}], "/.", "parameters"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"DeltaVector", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}], "-", "mu"}], "/.", 
              "parameters"}]}], "}"}]}], "]"}], "]"}], "]"}], "+", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"UpperDiag1", ",", "1"}], "]"}], "+", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"UpperDiag2", ",", "2"}], "]"}], "+", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"UpperDiag3", ",", "3"}], "]"}], "+", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"UpperDiag4", ",", "4"}], "]"}], "+", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"LowerDiag1", ",", 
         RowBox[{"-", "1"}]}], "]"}], "+", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"LowerDiag2", ",", 
         RowBox[{"-", "2"}]}], "]"}], "+", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"LowerDiag3", ",", 
         RowBox[{"-", "3"}]}], "]"}], "+", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"LowerDiag4", ",", 
         RowBox[{"-", "4"}]}], "]"}]}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7150122798609056`*^9, 3.715012293016562*^9}, {
   3.71502746637738*^9, 3.7150276122747583`*^9}, {3.7150762241287813`*^9, 
   3.715076339561453*^9}, {3.715076638226881*^9, 3.715076638357554*^9}, {
   3.715079797960782*^9, 3.715079804425684*^9}, {3.7150801645469522`*^9, 
   3.7150801731922073`*^9}, {3.7150962810406733`*^9, 3.715096313402298*^9}, {
   3.715493280969256*^9, 3.7154933069448338`*^9}, {3.715926456795589*^9, 
   3.715926534835615*^9}, {3.7159266075724688`*^9, 3.715926609324615*^9}, {
   3.7159266720500507`*^9, 3.715926699250846*^9}, {3.7159267359246473`*^9, 
   3.715926786874687*^9}, {3.715927265461885*^9, 3.7159272721026154`*^9}, {
   3.71592749323136*^9, 3.715927498891595*^9}, {3.715927608301217*^9, 
   3.7159276119227753`*^9}, {3.715928184563157*^9, 3.715928185071303*^9}, {
   3.715932056961636*^9, 3.715932065758582*^9}, {3.715935469355242*^9, 
   3.71593547584648*^9}, {3.7159360346788177`*^9, 3.715936037096589*^9}, {
   3.715936575119665*^9, 3.715936587928278*^9}, {3.715936689006309*^9, 
   3.715936692593721*^9}, {3.715936736911771*^9, 3.7159367417507687`*^9}, {
   3.715936775618266*^9, 3.715936792699642*^9}, {3.715936862849558*^9, 
   3.715936967404169*^9}, {3.7159370634419737`*^9, 3.7159370640031137`*^9}, {
   3.71593712374839*^9, 3.715937209483173*^9}, {3.7159373683606663`*^9, 
   3.7159374293649683`*^9}, {3.7159452616506443`*^9, 3.715945308374538*^9}, {
   3.7159462708516912`*^9, 3.715946306169196*^9}, {3.71662687935728*^9, 
   3.71662688635815*^9}, {3.7166270527877903`*^9, 3.716627056348776*^9}, {
   3.716627087317873*^9, 3.716627103302063*^9}, {3.716628972035212*^9, 
   3.716629003368577*^9}, {3.7166493507500877`*^9, 3.716649354951235*^9}, {
   3.716649394602578*^9, 3.7166494179953833`*^9}, {3.716649500736075*^9, 
   3.71664957894007*^9}, {3.73045148706747*^9, 3.730451580657942*^9}, {
   3.7304518212113657`*^9, 3.730451888801103*^9}, {3.730451930984458*^9, 
   3.730451960141685*^9}, 3.827324524704584*^9, {3.827324571785799*^9, 
   3.827324621455917*^9}, {3.82732467013544*^9, 3.827324720571105*^9}, {
   3.827324759208435*^9, 3.827324761476817*^9}, 3.827324824202056*^9, {
   3.8273818628175592`*^9, 3.827381864182796*^9}},
 CellLabel->
  "In[113]:=",ExpressionUUID->"5ae539fe-b1b2-4c3f-a0d1-aa481ced1b34"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ConstructHbulk", "[", 
   RowBox[{"kx1_", ",", "ky1_", ",", "kz_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "Diag", ",", "UpperDiag1", ",", "UpperDiag2", ",", "UpperDiag3", ",", 
      "UpperDiag4", ",", "LowerDiag1", ",", "LowerDiag2", ",", "LowerDiag3", 
      ",", "LowerDiag4", ",", "Diag0", ",", "H"}], "}"}], ",", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "I", " ", "use", " ", "here", " ", "the", " ", "notations", " ", "from",
        " ", "PRL", " ", "99"}], ",", " ", 
      RowBox[{"146804", "  ", "Bernevig"}], ",", " ", 
      RowBox[{"...", " ", "2007"}]}], " ", "*)"}], "\n", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"UpperDiag1", "=", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"tfull", ",", "0", ",", 
             RowBox[{"-", "kp"}], ",", "0"}], "}"}], ",", 
           RowBox[{"{", "NBilayer", "}"}]}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"-", "2"}]}], "]"}], "]"}]}], ";"}], " ", "*)"}], "\n", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"UpperDiag2", "=", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t1", ",", "0", ",", "t1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", "NBilayer", "}"}]}], "]"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"-", "3"}]}], "]"}], "]"}]}], ";"}], " ", "*)"}], "\n", 
    RowBox[{
     RowBox[{"Diag", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"DeltaAB", "+", 
          RowBox[{"tAA", "*", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", "kz"}], "]"}]}], "+", 
          RowBox[{"tAA", "*", 
           RowBox[{"Exp", "[", 
            RowBox[{
             RowBox[{"-", "I"}], " ", "kz"}], "]"}]}], "-", "mu"}], "/.", 
         "parameters"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"tBB", "*", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", "kz"}], "]"}]}], "+", 
          RowBox[{"tBB", "*", 
           RowBox[{"Exp", "[", 
            RowBox[{
             RowBox[{"-", "I"}], " ", "kz"}], "]"}]}], "-", "mu"}], "/.", 
         "parameters"}], ",", 
        RowBox[{
         RowBox[{"DeltaAB", "+", 
          RowBox[{"tAA", "*", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", "kz"}], "]"}]}], "+", 
          RowBox[{"tAA", "*", 
           RowBox[{"Exp", "[", 
            RowBox[{
             RowBox[{"-", "I"}], " ", "kz"}], "]"}]}], "-", "mu"}], "/.", 
         "parameters"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"tBB", "*", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", "kz"}], "]"}]}], "+", 
          RowBox[{"tBB", "*", 
           RowBox[{"Exp", "[", 
            RowBox[{
             RowBox[{"-", "I"}], " ", "kz"}], "]"}]}], "-", "mu"}], "/.", 
         "parameters"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"LowerDiag1", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"tABfull", ",", 
          RowBox[{"tBCfull", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"-", "I"}], " ", 
               RowBox[{"kz", "/", "2"}]}], "]"}], "+", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{"kz", "/", "2"}]}], "]"}]}], ")"}]}], " ", ",", 
          "tCDfull", ",", 
          RowBox[{
           RowBox[{"Conj", "[", "tADfull", "]"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"-", "I"}], " ", 
               RowBox[{"kz", "/", "2"}]}], "]"}], "+", " ", 
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{"kz", "/", "2"}]}], "]"}]}], ")"}]}]}], "}"}], "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"-", "2"}]}], "]"}], "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"kx", "\[Rule]", "kx1"}], ",", 
         RowBox[{"ky", "\[Rule]", "ky1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{"LowerDiag2", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"g1", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{"kz", "/", "2"}]}], "]"}], "+", 
              RowBox[{"Exp", "[", 
               RowBox[{
                RowBox[{"-", "I"}], " ", 
                RowBox[{"kz", "/", "2"}]}], "]"}]}], ")"}]}], "/.", 
           "parameters"}], ",", 
          RowBox[{"tBDfull", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{"kz", "/", "2"}]}], "]"}], " ", "+", " ", 
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"-", "I"}], " ", 
               RowBox[{"kz", "/", "2"}]}], "]"}]}], ")"}]}], " ", ",", 
          RowBox[{
           RowBox[{"g1", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Exp", "[", 
               RowBox[{"I", " ", 
                RowBox[{"kz", "/", "2"}]}], "]"}], "+", 
              RowBox[{"Exp", "[", 
               RowBox[{
                RowBox[{"-", "I"}], " ", 
                RowBox[{"kz", "/", "2"}]}], "]"}]}], ")"}]}], "/.", 
           "parameters"}], ",", 
          RowBox[{
           RowBox[{"Conj", "[", "tBDfull", "]"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{"kz", "/", "2"}]}], "]"}], "+", 
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"-", "I"}], " ", 
               RowBox[{"kz", "/", "2"}]}], "]"}]}], ")"}]}]}], "}"}], "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"-", "3"}]}], "]"}], "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"kx", "\[Rule]", "kx1"}], ",", 
         RowBox[{"ky", "\[Rule]", "ky1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{"LowerDiag3", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"tADfull", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{"kz", "/", "2"}]}], "]"}], "+", 
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"-", "I"}], " ", 
               RowBox[{"kz", "/", "2"}]}], "]"}]}], ")"}]}], ",", "0", ",", 
          RowBox[{
           RowBox[{"Conj", "[", "tBCfull", "]"}], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"I", " ", 
               RowBox[{"kz", "/", "2"}]}], "]"}], "+", 
             RowBox[{"Exp", "[", 
              RowBox[{
               RowBox[{"-", "I"}], " ", 
               RowBox[{"kz", "/", "2"}]}], "]"}]}], ")"}]}], ",", "0"}], 
         "}"}], "[", 
        RowBox[{"[", 
         RowBox[{";;", 
          RowBox[{"-", "4"}]}], "]"}], "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"kx", "\[Rule]", "kx1"}], ",", 
         RowBox[{"ky", "\[Rule]", "ky1"}]}], "}"}]}]}], ";", "\n", 
     RowBox[{"UpperDiag1", "=", 
      RowBox[{"Conj", "[", "LowerDiag1", "]"}]}], ";", 
     RowBox[{"UpperDiag2", "=", 
      RowBox[{"Conj", "[", "LowerDiag2", "]"}]}], ";", 
     RowBox[{"UpperDiag3", "=", 
      RowBox[{"Conj", "[", "LowerDiag3", "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"H", "=", 
      RowBox[{
       RowBox[{"DiagonalMatrix", "[", "Diag", "]"}], "+", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"UpperDiag1", ",", "1"}], "]"}], "+", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"UpperDiag2", ",", "2"}], "]"}], "+", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"UpperDiag3", ",", "3"}], "]"}], "+", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"LowerDiag1", ",", 
         RowBox[{"-", "1"}]}], "]"}], "+", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"LowerDiag2", ",", 
         RowBox[{"-", "2"}]}], "]"}], "+", 
       RowBox[{"DiagonalMatrix", "[", 
        RowBox[{"LowerDiag3", ",", 
         RowBox[{"-", "3"}]}], "]"}]}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.715937562723874*^9, 3.715937576606016*^9}, {
   3.715937945149749*^9, 3.715938108101941*^9}, {3.715938141915292*^9, 
   3.715938162332178*^9}, {3.7159382929453773`*^9, 3.715938356826593*^9}, 
   3.7159385062513847`*^9, {3.715938589736932*^9, 3.715938605050352*^9}, {
   3.7159387084584503`*^9, 3.7159387100841503`*^9}, {3.7159387428561907`*^9, 
   3.715938785785346*^9}, {3.715938819273501*^9, 3.715938870774333*^9}, {
   3.7159389851422863`*^9, 3.715938998738947*^9}, {3.715939034355605*^9, 
   3.715939077802256*^9}, {3.7159392826621647`*^9, 3.715939293866322*^9}, {
   3.715945121518601*^9, 3.7159451512054977`*^9}, {3.7159454098063927`*^9, 
   3.7159454502430487`*^9}, {3.7159455419308777`*^9, 
   3.7159455878339252`*^9}, {3.715945654917804*^9, 3.715945702732832*^9}, {
   3.715945850532819*^9, 3.715945912191221*^9}, {3.715945952397628*^9, 
   3.715945956992766*^9}, {3.715945991947927*^9, 3.715946070376919*^9}, {
   3.715946133916375*^9, 3.715946161829281*^9}, {3.715946198754661*^9, 
   3.715946252637212*^9}, {3.715954227026919*^9, 3.7159542274370003`*^9}, {
   3.7159543592556973`*^9, 3.7159543597404327`*^9}, {3.7166286932826643`*^9, 
   3.716628698288937*^9}, {3.716628743246457*^9, 3.716628756435547*^9}, {
   3.716628795703699*^9, 3.716628848774819*^9}, {3.7166498388864927`*^9, 
   3.716649904234283*^9}, {3.716650035002572*^9, 3.716650051312532*^9}, {
   3.716651007811487*^9, 3.716651017861616*^9}},
 CellLabel->
  "In[114]:=",ExpressionUUID->"1a39292d-cd99-44f4-b2d9-454eaaad985d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Hbulk", "=", 
   RowBox[{
    RowBox[{"ConstructHbulk", "[", 
     RowBox[{"kx", ",", "ky", ",", "kz"}], "]"}], "//", "Simplify"}]}], 
  ";"}]], "Input",
 CellLabel->
  "In[115]:=",ExpressionUUID->"5baf7e01-a9ee-497e-8cb0-dbb91312b3ec"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"<<", 
    RowBox[{"(", 
     RowBox[{"path", "<>", "\"\<DensityTableeps27DresselhausCorr\>\""}], 
     ")"}]}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.735553269338204*^9, 3.735553297147026*^9}, {
   3.735554672182403*^9, 3.735554674881996*^9}, {3.7682918888243*^9, 
   3.768291894593141*^9}, {3.768292154283876*^9, 3.768292178399539*^9}, {
   3.768895644539681*^9, 3.768895644964336*^9}, {3.787060258831173*^9, 
   3.787060281759153*^9}, {3.789304810902499*^9, 3.7893048333086653`*^9}, {
   3.7894244118091507`*^9, 3.7894244206772747`*^9}, 3.8004439224690027`*^9, {
   3.8023338527537937`*^9, 3.802333853246217*^9}, 3.802550434538722*^9, {
   3.802782191023382*^9, 3.802782193770372*^9}},
 CellLabel->
  "In[116]:=",ExpressionUUID->"7fd9e6d8-7e75-4e1f-82d4-e9683cc6510d"],

Cell[CellGroupData[{

Cell["\<\
Fermi-level as a function of magnetic field - from bulk dispersion\
\>", "Subsubsection",
 CellChangeTimes->{{3.729255621728612*^9, 
  3.729255653272245*^9}},ExpressionUUID->"4253705d-4291-4026-8477-\
f83f70ccb27c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"tAA", "=", 
    RowBox[{
     RowBox[{"g5", "/", "2"}], "/.", "parameters"}]}], ";", " ", 
   RowBox[{"tBB", "=", 
    RowBox[{
     RowBox[{"g2", "/", "2"}], "/.", "parameters"}]}], ";", " ", 
   RowBox[{"DeltaSpin", "=", "0"}], ";", " ", 
   RowBox[{"muFull", "=", 
    RowBox[{
     RowBox[{"Ef", "-", "g2", "+", 
      RowBox[{"EFermiInterp", "[", "B", "]"}]}], "  ", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"+", 
        RowBox[{"EFermiInterp", "[", "10", "]"}]}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"EFermiInterp", "[", "20", "]"}], "-", 
          RowBox[{"EFermiInterp", "[", "10", "]"}]}], ")"}], 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"B", "-", "10"}], ")"}], "/", "10"}]}]}], " ", "*)"}], " ", 
     "/.", "parameters"}]}], ";"}], "  "}]], "Input",
 CellChangeTimes->{{3.8027652656250563`*^9, 3.802765274012128*^9}, 
   3.827323630528755*^9},
 CellLabel->
  "In[117]:=",ExpressionUUID->"4d391f04-292d-4dc5-85e8-ea1acf95c1d7"],

Cell[BoxData["parameters"], "Input",
 CellChangeTimes->{{3.8027652856562*^9, 3.8027652875472383`*^9}},
 CellLabel->
  "In[118]:=",ExpressionUUID->"da960dd0-294e-46c9-9978-dcc0a6a780dc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"NoBulk", "=", "100"}], ";"}]], "Input",
 CellChangeTimes->{{3.82732374434129*^9, 3.827323754949258*^9}},
 CellLabel->
  "In[119]:=",ExpressionUUID->"af4de08b-e20e-4d02-8c6b-ec1f432202ee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BulkH", "[", 
   RowBox[{"kz_", ",", "B_", ",", "No_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      StyleBox[
       RowBox[{"valuelistCj", "=", 
        RowBox[{"{", "}"}]}],
       FontColor->GrayLevel[0]], 
      StyleBox[",",
       FontColor->GrayLevel[0]], 
      StyleBox[
       RowBox[{"valuelist", "=", 
        RowBox[{"{", "}"}]}],
       FontColor->GrayLevel[0]], 
      StyleBox[",",
       FontColor->GrayLevel[0]], 
      StyleBox[
       RowBox[{"valuelist1", "=", 
        RowBox[{"{", "}"}]}],
       FontColor->GrayLevel[0]], 
      StyleBox[",",
       FontColor->GrayLevel[0]], 
      RowBox[{"s", " ", "=", 
       RowBox[{"B2s", " ", "B"}]}]}], " ", "}"}], ",", "\[IndentingNewLine]", 
    
    RowBox[{
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"valuelist", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"valuelist", ",", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"4", " ", "n"}], " ", "+", " ", "4", "-", "1"}], ",", 
                RowBox[{
                 RowBox[{"4", "  ", "n"}], " ", "+", " ", "4", "-", "1"}]}], 
               "}"}], " ", "\[Rule]", " ", 
              RowBox[{"DeltaAB", "-", "mu", "+", " ", 
               RowBox[{"tAA", " ", "2", " ", 
                RowBox[{"Cos", "[", 
                 RowBox[{"2", " ", "kz"}], "]"}]}]}]}], "/.", "parameters"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"4", " ", "n"}], " ", "+", " ", "4", "-", "3"}], ",", 
               
               RowBox[{
                RowBox[{"4", "  ", "n"}], " ", "+", " ", "4", "-", "3"}]}], 
              "}"}], " ", "\[Rule]", " ", 
             RowBox[{
              RowBox[{"-", "mu"}], "+", 
              RowBox[{"tBB", " ", "2", " ", 
               RowBox[{"Cos", "[", 
                RowBox[{"2", " ", "kz"}], "]"}]}], "+", "DeltaSpin"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"4", "  ", "n"}], " ", "+", " ", "4", "-", "2"}], 
                ",", 
                RowBox[{
                 RowBox[{"4", "  ", "n"}], " ", "+", " ", "4", "-", "2"}]}], 
               "}"}], " ", "\[Rule]", " ", 
              RowBox[{"DeltaAB", "-", "mu", "+", 
               RowBox[{"tAA", " ", "2", " ", 
                RowBox[{"Cos", "[", 
                 RowBox[{"2", " ", "kz"}], "]"}]}]}]}], "/.", "parameters"}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"4", " ", "n"}], " ", "+", " ", "4"}], ",", 
               RowBox[{
                RowBox[{"4", "  ", "n"}], " ", "+", " ", "4"}]}], "}"}], " ", 
             "\[Rule]", " ", 
             RowBox[{
              RowBox[{"-", "mu"}], "+", 
              RowBox[{"tBB", " ", "2", " ", 
               RowBox[{"Cos", "[", 
                RowBox[{"2", " ", "kz"}], "]"}]}], "-", "DeltaSpin"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"4", " ", 
                 RowBox[{"(", 
                  RowBox[{"n", "+", "1"}], ")"}]}], " ", "+", " ", "4", "-", 
                "3"}], ",", 
               RowBox[{
                RowBox[{"4", "  ", 
                 RowBox[{"(", "n", ")"}]}], " ", "+", " ", "4", "-", "1"}]}], 
              "}"}], "\[Rule]", 
             RowBox[{"tABfull0", " ", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"n", "+", "1"}], ")"}], " ", "s"}], "]"}]}]}], ",", 
            " ", 
            RowBox[{"(*", " ", 
             RowBox[{"raising", " ", "from", " ", "A", " ", "to", " ", "B"}], 
             "  ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"4", " ", 
                 RowBox[{"(", 
                  RowBox[{"n", "-", "1"}], ")"}]}], " ", "+", " ", "4", "-", 
                "2"}], ",", 
               RowBox[{
                RowBox[{"4", " ", 
                 RowBox[{"(", "n", ")"}]}], " ", "+", " ", "4", "-", "3"}]}], 
              "}"}], "\[Rule]", 
             RowBox[{"tBCfull0", " ", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{"(", "n", ")"}], " ", "s"}], "]"}], " ", "2", " ", 
              RowBox[{"Cos", "[", "kz", "]"}]}]}], ",", "  ", 
            RowBox[{"(*", " ", 
             RowBox[{"lowering", " ", "from", " ", "B", " ", "to", " ", "C"}],
              " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"4", " ", 
                  RowBox[{"(", "n", ")"}]}], " ", "+", " ", "4", "-", "2"}], 
                ",", 
                RowBox[{
                 RowBox[{"4", " ", 
                  RowBox[{"(", "n", ")"}]}], " ", "+", " ", "4", "-", "1"}]}],
                "}"}], "\[Rule]", 
              RowBox[{"g1", " ", "2", " ", 
               RowBox[{"Cos", "[", "kz", "]"}]}]}], "/.", "parameters"}], " ",
             ",", "   ", 
            RowBox[{"(*", " ", 
             RowBox[{"A", " ", "to", " ", "C", " ", "hopping"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"4", " ", 
                 RowBox[{"(", 
                  RowBox[{"n", "+", "1"}], ")"}]}], " ", "+", " ", "4"}], ",", 
               RowBox[{
                RowBox[{"4", "  ", 
                 RowBox[{"(", "n", ")"}]}], " ", "+", " ", "4", "-", "3"}]}], 
              "}"}], "\[Rule]", 
             RowBox[{"tBDfull0", " ", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"n", "+", "1"}], ")"}], " ", "s"}], "]"}], " ", "2", 
              " ", 
              RowBox[{"Cos", "[", "kz", "]"}]}]}], ",", " ", 
            RowBox[{"(*", " ", 
             RowBox[{"raising", " ", "from", " ", "B", " ", "to", " ", "D"}], 
             "  ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"4", 
                 RowBox[{"(", 
                  RowBox[{"n", "-", "1"}], ")"}]}], " ", "+", " ", "4"}], ",", 
               RowBox[{
                RowBox[{"4", " ", 
                 RowBox[{"(", "n", ")"}]}], " ", "+", " ", "4", "-", "2"}]}], 
              "}"}], "\[Rule]", 
             RowBox[{"tCDfull0", " ", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{"(", "n", ")"}], " ", "s"}], "]"}]}]}], ",", " ", 
            RowBox[{"(*", 
             RowBox[{"lowering", " ", "from", " ", "C", " ", "to", " ", "D"}],
              "  ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"4", " ", 
                 RowBox[{"(", 
                  RowBox[{"n", "-", "1"}], ")"}]}], " ", "+", " ", "4"}], ",", 
               RowBox[{
                RowBox[{"4", " ", 
                 RowBox[{"(", "n", ")"}]}], " ", "+", " ", "4", "-", "1"}]}], 
              "}"}], "\[Rule]", 
             RowBox[{"tADfull0", " ", 
              RowBox[{"Sqrt", "[", 
               RowBox[{
                RowBox[{"(", "n", ")"}], " ", "s"}], "]"}], " ", "2", " ", 
              RowBox[{"Cos", "[", "kz", "]"}]}]}]}], "  ", 
           RowBox[{"(*", " ", 
            RowBox[{"lowering", " ", "from", " ", "A", " ", "to", " ", "D"}], 
            " ", "*)"}], "\[IndentingNewLine]", "}"}]}], "]"}]}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"n", ",", "0", ",", "No"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"valuelist", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"valuelist", ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"0", "<", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "<=", 
             RowBox[{
              RowBox[{"4", " ", 
               RowBox[{"(", 
                RowBox[{"No", "+", "1"}], ")"}]}], "-", "2"}]}], ")"}], " ", "&&",
            " ", 
           RowBox[{"(", 
            RowBox[{"0", "<", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}], "\[LessEqual]", 
             RowBox[{
              RowBox[{"4", 
               RowBox[{"(", 
                RowBox[{"No", "+", "1"}], ")"}]}], "-", "2"}]}], ")"}]}], 
          ")"}], "&"}]}], "]"}]}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"valuelistCj", "=", 
      RowBox[{"valuelist", "/.", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}], "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"b", ",", "a"}], "}"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"valuelist1", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"valuelist", ",", "valuelistCj"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Normal", "[", 
      RowBox[{"SparseArray", "[", "valuelist1", "]"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.7177746119315577`*^9, 3.71777470871982*^9}, {
   3.717776520599073*^9, 3.7177765220902557`*^9}, {3.7177768740852118`*^9, 
   3.7177768741588173`*^9}, {3.7177769631482277`*^9, 3.717776964270104*^9}, {
   3.717779600651312*^9, 3.7177796011079597`*^9}, {3.717781901475816*^9, 
   3.717781901547289*^9}, {3.717783505955757*^9, 3.717783590166398*^9}, {
   3.717783630317348*^9, 3.7177836408013763`*^9}, {3.718384121781577*^9, 
   3.7183841224903*^9}, 3.718384199168676*^9, {3.718384770011836*^9, 
   3.7183847701328287`*^9}, {3.718385886741807*^9, 3.718385905444028*^9}, {
   3.718385943002479*^9, 3.718386029010641*^9}, {3.7183860891603117`*^9, 
   3.7183861057216473`*^9}, 3.718387554781826*^9, {3.7191365226078587`*^9, 
   3.7191365691784477`*^9}, {3.719664450754599*^9, 3.7196645524681892`*^9}, {
   3.7196648749059563`*^9, 3.719664979654654*^9}, {3.719665968001556*^9, 
   3.719666029639201*^9}, {3.7196660653739033`*^9, 3.719666117283532*^9}, {
   3.719666594338984*^9, 3.719666613836933*^9}, {3.719666688451755*^9, 
   3.719666730871759*^9}, {3.719666773336116*^9, 3.719666778318034*^9}, {
   3.719667768732462*^9, 3.7196677700263767`*^9}, {3.719667883044086*^9, 
   3.719667904015766*^9}, {3.7196679357615547`*^9, 3.7196679429391317`*^9}, {
   3.719668022146456*^9, 3.719668046173237*^9}, {3.719668938555564*^9, 
   3.719669104331697*^9}, {3.719669183393227*^9, 3.719669189995245*^9}, 
   3.719669241471702*^9, {3.719669301690217*^9, 3.719669356574903*^9}, {
   3.719669660780674*^9, 3.719669685861809*^9}, {3.719670636939432*^9, 
   3.719670645061523*^9}, {3.719671307243143*^9, 3.719671333459888*^9}, {
   3.719671712637825*^9, 3.719671777343108*^9}, {3.719672057063158*^9, 
   3.719672066677246*^9}, {3.7196858554200897`*^9, 3.719685855641018*^9}, {
   3.7196858886643972`*^9, 3.719685888812697*^9}, {3.719687101591865*^9, 
   3.719687102399321*^9}, {3.71969088886335*^9, 3.71969091598205*^9}, {
   3.719691221460403*^9, 3.719691223896509*^9}, {3.719691274382465*^9, 
   3.719691277161347*^9}, {3.719691312261051*^9, 3.7196913151843367`*^9}, {
   3.719691352222681*^9, 3.719691474669393*^9}, {3.719822727650405*^9, 
   3.719822749705768*^9}, {3.7304528794663*^9, 3.7304528821311407`*^9}},
 CellLabel->
  "In[120]:=",ExpressionUUID->"f7504dcd-fac0-4e89-8d48-60edc238512e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"HB", "=", 
   RowBox[{"BulkH", "[", 
    RowBox[{"kz", ",", "B", ",", "NoBulk"}], "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[121]:=",ExpressionUUID->"74f3f29a-b1bb-4bf4-8408-20f60abf6503"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BisectionFindRoot", "[", 
   RowBox[{"f_", ",", "range_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"c", ",", "a", ",", "b"}], "}"}], ",", 
    RowBox[{
     RowBox[{"a", "=", 
      RowBox[{"range", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", 
     RowBox[{"b", "=", 
      RowBox[{"range", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", "a", "]"}], "*", 
         RowBox[{"f", "[", "b", "]"}]}], ">", "0"}], ",", 
       RowBox[{"Return", "[", "None", "]"}]}], "]"}], ";", "\n", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"c", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"a", "+", "b"}], ")"}], "/", "2"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"f", "[", "a", "]"}], "*", 
            RowBox[{"f", "[", "c", "]"}]}], ">", "0"}], ",", 
          RowBox[{"a", "=", "c"}], ",", 
          RowBox[{"b", "=", "c"}]}], "]"}], ";", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"a", ",", "b", ",", "c"}], "]"}], ";"}], "*)"}], 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"a", "-", "b"}], "]"}], "<", "0.000000001"}], ",", 
          RowBox[{"Return", "[", "c", "]"}]}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "100"}], "}"}]}], "]"}], ";", 
     RowBox[{"Return", "[", "c", "]"}]}]}], "]"}]}]], "Input",
 CellLabel->
  "In[122]:=",ExpressionUUID->"d2a747a7-0baf-4c20-94b0-425a0e148e05"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7328822790695763`*^9, 3.732882283217403*^9}, 
   3.827324198327024*^9},
 CellLabel->
  "In[123]:=",ExpressionUUID->"c7d41c4f-12ad-446b-ac18-44b852cb3568"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"muFull", "=", 
    RowBox[{
     RowBox[{"Ef", "-", "g2"}], " ", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"+", 
        RowBox[{"EFermiInterp", "[", "10", "]"}]}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"EFermiInterp", "[", "20", "]"}], "-", 
          RowBox[{"EFermiInterp", "[", "10", "]"}]}], ")"}], 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"B", "-", "10"}], ")"}], "/", "10"}]}]}], " ", "*)"}], " ", 
     "/.", "parameters"}]}], ";"}], "  "}]], "Input",
 CellChangeTimes->{{3.73545488571148*^9, 3.735454889997547*^9}},
 CellLabel->
  "In[124]:=",ExpressionUUID->"0c34780d-d747-4e55-8167-4d7deb7cedfd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "BulkSpectrum", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BulkSpectrum", "[", 
    RowBox[{
     RowBox[{"kz1_", "?", "NumericQ"}], ",", 
     RowBox[{"B1_", "?", "NumericQ"}]}], "]"}], ":=", 
   RowBox[{"Sort", "[", 
    RowBox[{"Eigenvalues", "[", 
     RowBox[{"HB", "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"kz", "\[Rule]", "kz1"}], ",", 
        RowBox[{"B", "\[Rule]", "B1"}]}], "}"}]}], "]"}], 
    RowBox[{"(*", 
     RowBox[{",", 
      RowBox[{
       RowBox[{
        RowBox[{"Abs", "[", "#1", "]"}], "<", 
        RowBox[{"Abs", "[", "#2", "]"}]}], "&"}]}], "*)"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{3.827323889571971*^9},
 CellLabel->
  "In[125]:=",ExpressionUUID->"c14f5f9b-9373-4f9e-99ff-3f457d35f7bc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ParallelEvaluate", "[", 
   RowBox[{"Clear", "[", "spectrumdata", "]"}], "]"}], ";", " ", 
  RowBox[{"Clear", "[", "spectrumdata", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"spectrumdata", "[", "B_", "]"}], ":=", 
   RowBox[{
    RowBox[{"spectrumdata", "[", "B", "]"}], "=", 
    RowBox[{"Transpose", "[", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"kz", ",", "#"}], "}"}], "&"}], ",", 
         RowBox[{"BulkSpectrum", "[", 
          RowBox[{"kz", ",", "B"}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"kz", ",", "0", ",", 
         RowBox[{"\[Pi]", "/", "2"}], ",", "0.02"}], "}"}]}], "]"}], 
     "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.719834551065859*^9, 3.7198346017936707`*^9}, {
  3.802760932383526*^9, 3.802760940724749*^9}, {3.802765469213935*^9, 
  3.802765471624861*^9}},
 CellLabel->
  "In[127]:=",ExpressionUUID->"6873da32-2552-4522-8c6c-c090315b97e8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "Ne", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Ne", "[", 
     RowBox[{
      RowBox[{"B_", "?", "NumericQ"}], ",", 
      RowBox[{"mu_", "?", "NumericQ"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"dat", ",", "kz", ",", 
        RowBox[{"Nbands", "=", "20"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"dat", "=", 
        RowBox[{"spectrumdata", "[", "B", "]"}]}], ";", " ", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"eband", "[", "i", "]"}], "=", 
          RowBox[{"Interpolation", "[", 
           RowBox[{"dat", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"2", " ", "NoBulk"}], "+", "1", "+", "i"}], "]"}], 
            "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "Nbands"}], "}"}]}], "]"}], ";", "  ", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"hband", "[", "i", "]"}], "=", 
          RowBox[{"Interpolation", "[", 
           RowBox[{"dat", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"2", " ", "NoBulk"}], "+", "2", "-", "i"}], "]"}], 
            "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "Nbands"}], "}"}]}], "]"}], " ", ";", 
       " ", 
       RowBox[{"ke", "=", 
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{"nF", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"eband", "[", "i", "]"}], "[", "kz", "]"}], "-", 
               "mu"}], ",", "0.0002"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "Nbands"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"kz", ",", "0", ",", 
            RowBox[{"\[Pi]", "/", "2"}]}], "}"}], ",", 
          RowBox[{
          "Method", "\[Rule]", "\"\<InterpolationPointsSubdivision\>\""}], 
          ",", 
          RowBox[{"PrecisionGoal", "\[Rule]", "7"}]}], "]"}]}], ";", 
       RowBox[{"kh", "=", 
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{"nF", "[", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"hband", "[", "i", "]"}], "[", "kz", "]"}], "-", 
                 "mu"}], ")"}]}], ",", "0.0002"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "Nbands"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"kz", ",", "0", ",", 
            RowBox[{"\[Pi]", "/", "2"}]}], "}"}], ",", 
          RowBox[{
          "Method", "\[Rule]", "\"\<InterpolationPointsSubdivision\>\""}], 
          ",", 
          RowBox[{"PrecisionGoal", "\[Rule]", "7"}]}], "]"}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"ke", "-", "kh"}], ")"}], " ", "4", " ", "B", " ", 
        RowBox[{
         RowBox[{"UnitFilling", "/", 
          RowBox[{"(", 
           RowBox[{"\[Pi]", "/", "2"}], ")"}]}], " ", "/", 
         RowBox[{"(", " ", 
          RowBox[{"2", "*", "0.335"}], " ", ")"}]}]}]}]}], "]"}]}], ";"}], 
  "  "}]}], "Input",
 CellChangeTimes->{{3.719834437913705*^9, 3.719834488425705*^9}, {
  3.7198345203223553`*^9, 3.719834540898024*^9}, {3.71983501243436*^9, 
  3.719835149306616*^9}, {3.7198355508188763`*^9, 3.719835791523732*^9}, {
  3.719835861723853*^9, 3.7198359540915403`*^9}, {3.7198360142848167`*^9, 
  3.719836110820088*^9}, {3.7198363419971857`*^9, 3.7198363664203777`*^9}, {
  3.719836881349771*^9, 3.719836882028617*^9}, {3.719837656438364*^9, 
  3.7198376568373013`*^9}, {3.719839505832337*^9, 3.719839508839427*^9}, {
  3.7320046195492907`*^9, 3.732004621848483*^9}, {3.7328802656020947`*^9, 
  3.732880267936757*^9}, {3.73288086968272*^9, 3.732880871969388*^9}, {
  3.7347820614774714`*^9, 3.734782062320752*^9}, {3.734782146137087*^9, 
  3.7347821716980143`*^9}, {3.734782324504648*^9, 3.73478232682822*^9}},
 CellLabel->
  "In[129]:=",ExpressionUUID->"e22dd971-0a28-4f01-9125-8e6545d305d1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Nel", "[", 
     RowBox[{
      RowBox[{"B_", "?", "NumericQ"}], ",", 
      RowBox[{"mu_", "?", "NumericQ"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"dat", ",", "kz", ",", 
        RowBox[{"Nbands", "=", "20"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"dat", "=", 
        RowBox[{"spectrumdata", "[", "B", "]"}]}], ";", " ", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"eband", "[", "i", "]"}], "=", 
          RowBox[{"Interpolation", "[", 
           RowBox[{"dat", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"2", " ", "NoBulk"}], "+", "1", "+", "i"}], "]"}], 
            "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "Nbands"}], "}"}]}], "]"}], ";", "  ", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"hband", "[", "i", "]"}], "=", 
          RowBox[{"Interpolation", "[", 
           RowBox[{"dat", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"2", " ", "NoBulk"}], "+", "2", "-", "i"}], "]"}], 
            "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "Nbands"}], "}"}]}], "]"}], " ", ";", 
       " ", 
       RowBox[{"ke", "=", 
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{"nF", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"eband", "[", "i", "]"}], "[", "kz", "]"}], "-", 
               "mu"}], ",", "0.0002"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "Nbands"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"kz", ",", "0", ",", 
            RowBox[{"\[Pi]", "/", "2"}]}], "}"}], ",", 
          RowBox[{
          "Method", "\[Rule]", "\"\<InterpolationPointsSubdivision\>\""}], 
          ",", 
          RowBox[{"PrecisionGoal", "\[Rule]", "7"}]}], "]"}]}], ";", 
       RowBox[{"kh", "=", 
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{"nF", "[", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"hband", "[", "i", "]"}], "[", "kz", "]"}], "-", 
                 "mu"}], ")"}]}], ",", "0.0002"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "Nbands"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"kz", ",", "0", ",", 
            RowBox[{"\[Pi]", "/", "2"}]}], "}"}], ",", 
          RowBox[{
          "Method", "\[Rule]", "\"\<InterpolationPointsSubdivision\>\""}], 
          ",", 
          RowBox[{"PrecisionGoal", "\[Rule]", "7"}]}], "]"}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"(", "ke", ")"}], " ", "4", " ", "B", " ", 
        RowBox[{
         RowBox[{"UnitFilling", "/", 
          RowBox[{"(", 
           RowBox[{"\[Pi]", "/", "2"}], ")"}]}], " ", "/", 
         RowBox[{"(", " ", 
          RowBox[{"2", "*", "0.335"}], " ", ")"}]}]}]}]}], "]"}]}], ";"}], 
  "  "}]], "Input",
 CellChangeTimes->{{3.734782394973247*^9, 3.734782399838537*^9}},
 CellLabel->
  "In[131]:=",ExpressionUUID->"badca6ea-f032-4dd0-bc99-91e0cfa1c704"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{
   "Measured", " ", "difference", " ", "of", " ", "e", " ", "and", " ", 
    RowBox[{"holes", ":", "  ", "2.44"}]}], " ", ",", "  ", 
   RowBox[{"2.22", "  ", 
    RowBox[{"10", "^", "12"}], "   ", "per", " ", "6", " ", "nm", " ", 
    "sample"}]}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.734781431171586*^9, 3.734781442002294*^9}, {
  3.734781476034423*^9, 3.73478150536029*^9}},
 CellLabel->
  "In[132]:=",ExpressionUUID->"3bea85c0-bdb4-44c0-b691-b56592d8ddc0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ParallelEvaluate", "[", 
   RowBox[{"Clear", "[", "EFermiCorrection", "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EFermiCorrection", "[", 
    RowBox[{
     RowBox[{"B_", "?", "NumericQ"}], ",", 
     RowBox[{"n0_", "?", "NumericQ"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "mu1", "}"}], ",", 
     RowBox[{"BisectionFindRoot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"10", "^", "18"}], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Ne", "[", 
             RowBox[{"B", ",", "#"}], "]"}], "-", "n0"}], ")"}]}], ")"}], 
        "&"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.02"}], ",", "0.02"}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.719823914298511*^9, 3.719824157008142*^9}, {
   3.719824233320792*^9, 3.719824233680099*^9}, {3.719834420106826*^9, 
   3.719834421937711*^9}, {3.719836186099717*^9, 3.7198362558673277`*^9}, {
   3.719836318556054*^9, 3.719836329179235*^9}, {3.7198363915239983`*^9, 
   3.719836391659238*^9}, {3.7198364429077682`*^9, 3.719836451947349*^9}, {
   3.719836646132489*^9, 3.7198366723156223`*^9}, {3.719837037021031*^9, 
   3.7198370643958178`*^9}, {3.719837735325618*^9, 3.71983774057272*^9}, {
   3.719837785389415*^9, 3.719837819700638*^9}, {3.719837921333696*^9, 
   3.7198379263728027`*^9}, {3.7198383560381393`*^9, 3.719838363180757*^9}, {
   3.719839158814624*^9, 3.719839165806081*^9}, {3.7304536597991667`*^9, 
   3.730453661605379*^9}, {3.731075935688733*^9, 3.731075941484126*^9}, {
   3.731076291822927*^9, 3.7310762944012823`*^9}, {3.731076574368886*^9, 
   3.731076600305138*^9}, {3.7328794001275167`*^9, 3.732879402494739*^9}, 
   3.73288023566444*^9, {3.732880407704471*^9, 3.732880420783389*^9}, 
   3.7328805362726583`*^9, {3.732880571368865*^9, 3.73288057632032*^9}, {
   3.80276090028605*^9, 3.802760922859837*^9}},
 CellLabel->
  "In[133]:=",ExpressionUUID->"b84ced9f-c6ee-4311-b4c3-f61a58b7ec7c"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"EFermiCorrectionData", "=", 
   RowBox[{"ParallelTable", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"spectrumdata", "[", "B", "]"}], ";", 
      RowBox[{"{", 
       RowBox[{"B", ",", 
        RowBox[{"EFermiCorrection", "[", 
         RowBox[{"B", ",", "0"}], "]"}]}], "}"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"B", ",", "0.75", ",", "10", ",", "0.25"}], "}"}]}], "]"}]}], 
  " ", "*)"}]], "Input",
 CellChangeTimes->{{3.730453290478705*^9, 3.730453391570129*^9}, {
  3.7304592681559553`*^9, 3.730459270648699*^9}, {3.731074613329866*^9, 
  3.731074621807232*^9}, {3.734782525452819*^9, 3.734782536097109*^9}, {
  3.73545492190038*^9, 3.735454923308847*^9}, {3.7361444206248703`*^9, 
  3.736144421505067*^9}, {3.802760825037218*^9, 3.802760828382687*^9}, {
  3.8027615582575912`*^9, 3.802761589604526*^9}, {3.802761711753722*^9, 
  3.8027617163135157`*^9}, {3.827325422395907*^9, 3.8273254266388617`*^9}},
 CellLabel->
  "In[136]:=",ExpressionUUID->"5c5b8777-b6e4-4176-b0fa-0932ce9f1a5f"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{"EFermiCorrectionData", ",", 
   RowBox[{"Joined", "\[Rule]", "True"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.730455172893087*^9, 3.7304551752601843`*^9}},
 CellLabel->
  "In[137]:=",ExpressionUUID->"d346f16e-dc08-4237-a213-03b3cf4d633b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EFermiInterp", "=", 
   RowBox[{"Interpolation", "[", 
    RowBox[{"EFermiCorrectionData", ",", 
     RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.719842119110784*^9, 3.7198421866247396`*^9}, 
   3.719842343698083*^9},
 CellLabel->
  "In[138]:=",ExpressionUUID->"726e0406-4ef7-4032-bcf6-756076d7202d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Save", "[", 
     RowBox[{
      RowBox[{"path", "<>", "\"\<EFermiInterp19params\>\""}], ",", 
      RowBox[{"{", 
       RowBox[{"EFermiInterp", ",", "EFermiCorrectionData"}], "}"}]}], "]"}], 
    ";"}], " ", "*)"}], " "}]], "Input",
 CellChangeTimes->{{3.719842265230241*^9, 3.7198422994007053`*^9}, {
  3.719843783410963*^9, 3.719843787946121*^9}, {3.730459197693406*^9, 
  3.730459232894236*^9}, {3.7310801947007723`*^9, 3.731080214914001*^9}, {
  3.732879031862726*^9, 3.7328790324384108`*^9}, {3.732879338767396*^9, 
  3.7328793460621977`*^9}, {3.734782589595634*^9, 3.734782596359955*^9}, {
  3.74920550299719*^9, 3.749205510647152*^9}, {3.749207429388275*^9, 
  3.749207430884061*^9}, {3.749208926084466*^9, 3.749208927561089*^9}, {
  3.827381921908938*^9, 3.82738192539018*^9}},
 CellLabel->
  "In[139]:=",ExpressionUUID->"6d845c55-a078-4464-9c27-0c2da46104de"],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{"dat", ",", 
   RowBox[{"Joined", "\[Rule]", "True"}], ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.05"}], ",", "0.05"}], "}"}]}]}], "]"}]], "Input",
 CellChangeTimes->{{3.719670349535771*^9, 3.719670351127503*^9}, {
  3.719670469007176*^9, 
  3.719670472451614*^9}},ExpressionUUID->"c738bb13-86a7-4c2d-8c1f-\
509510e459ed"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Self-consistent screening calculation", "Subsubsection",
 CellChangeTimes->{{3.8270651306115294`*^9, 
  3.8270651421545477`*^9}},ExpressionUUID->"1d49cf78-46fd-4116-a870-\
007344145e53"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"nF", "[", "EE_", "]"}], "=", 
   RowBox[{"Piecewise", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"EE", ">", "15"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{"EE", "<", 
          RowBox[{"-", "15"}]}]}], "}"}]}], "}"}], ",", 
     RowBox[{"1", "/", 
      RowBox[{"(", 
       RowBox[{"1", "+", 
        RowBox[{"Exp", "[", "EE", "]"}]}], ")"}]}]}], "]"}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.715096248567462*^9, 3.715096249273494*^9}, {
   3.715096323668342*^9, 3.715096334360508*^9}, 3.715096383215098*^9, 
   3.7153162346248693`*^9},
 CellLabel->
  "In[140]:=",ExpressionUUID->"698c6ace-122c-477d-8a4f-cd8cfac3017c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Temp", "=", "0.0005"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DensityVector", "[", 
    RowBox[{"DeltaVector_", ",", "kx1_", ",", "ky1_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"H", ",", "spec"}], "}"}], ",", 
     RowBox[{
      RowBox[{"H", "=", 
       RowBox[{"ConstructH", "[", 
        RowBox[{"DeltaVector", ",", " ", "NBilayer", ",", "kx1", ",", "ky1"}],
         "]"}]}], ";", 
      RowBox[{"spec", "=", 
       RowBox[{
        RowBox[{"Eigensystem", "[", "H", "]"}], "//", "Transpose"}]}], ";", 
      " ", 
      RowBox[{"Plus", "@@", 
       RowBox[{"(", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"nF", "[", 
              RowBox[{
               RowBox[{"Re", "[", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "Temp"}], "]"}], 
             "*", 
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}], "^", "2"}]}], ")"}], 
           "&"}], ",", " ", "spec"}], "]"}], ")"}]}]}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.715096207891306*^9, 3.715096246428999*^9}, {
   3.7151047110655813`*^9, 3.71510471581616*^9}, {3.7151047472367*^9, 
   3.715104812746662*^9}, {3.715104911869709*^9, 3.715104956283554*^9}, {
   3.71510501806468*^9, 3.7151050208328247`*^9}, {3.7151051332920218`*^9, 
   3.7151051345251713`*^9}, {3.7151053852369328`*^9, 3.715105435398252*^9}, {
   3.715106196392952*^9, 3.715106205464679*^9}, {3.7152519045457573`*^9, 
   3.715251905121518*^9}, {3.715316261774136*^9, 3.7153163420562887`*^9}, {
   3.71531650143993*^9, 3.7153165044657993`*^9}, {3.715317816434514*^9, 
   3.715317817856563*^9}, {3.715318234807766*^9, 3.7153182554481373`*^9}, {
   3.715318979364506*^9, 3.7153190046021643`*^9}, 3.7153190519531403`*^9, {
   3.715953341423175*^9, 3.71595334742517*^9}, {3.715953573992115*^9, 
   3.715953577051507*^9}, 3.716701854349*^9, {3.802450803057878*^9, 
   3.802450808548975*^9}},
 CellLabel->
  "In[141]:=",ExpressionUUID->"3e16542d-2cbd-4e77-aebd-d51c1e6968f1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DensityVector1", "[", 
    RowBox[{"H_", ",", "kx1_", ",", "ky1_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"spec", "=", 
       RowBox[{
        RowBox[{"Eigensystem", "[", 
         RowBox[{"H", "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"kx", "\[Rule]", "kx1"}], ",", 
            RowBox[{"ky", "\[Rule]", "ky1"}]}], "}"}]}], "]"}], "//", 
        "Transpose"}]}], "}"}], ",", " ", 
     RowBox[{"Plus", "@@", 
      RowBox[{"(", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"nF", "[", 
             RowBox[{
              RowBox[{"Re", "[", 
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "Temp"}], "]"}], 
            "*", 
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}], "^", "2"}]}], ")"}], 
          "&"}], ",", " ", "spec"}], "]"}], ")"}]}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.715105004496616*^9, 3.7151050121053963`*^9}, {
   3.715105140191123*^9, 3.715105141742231*^9}, 3.71510872323562*^9, 
   3.7151092221942263`*^9, {3.715114731793983*^9, 3.715114733329989*^9}, {
   3.715251895428009*^9, 3.715251895925939*^9}, {3.715316538998534*^9, 
   3.715316539884857*^9}, {3.7153177979485807`*^9, 3.7153177995737762`*^9}, {
   3.715318368138687*^9, 3.7153183748464317`*^9}, {3.715319060864524*^9, 
   3.715319071125615*^9}, {3.7159532820111523`*^9, 3.715953284516638*^9}, {
   3.715953353925323*^9, 3.71595336072184*^9}},
 CellLabel->
  "In[143]:=",ExpressionUUID->"a4a52c9a-7592-4bb0-b931-26c92b92ca1c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DensityBand", "[", 
    RowBox[{"H_", ",", "kx1_", ",", "ky1_", ",", "band_"}], "]"}], ":=", 
   RowBox[{"nF", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Sort", "[", 
       RowBox[{"Re", "[", 
        RowBox[{"Eigenvalues", "[", 
         RowBox[{"H", "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"kx", "\[Rule]", "kx1"}], ",", 
            RowBox[{"ky", "\[Rule]", "ky1"}]}], "}"}]}], "]"}], "]"}], "]"}], 
      "[", 
      RowBox[{"[", "band", "]"}], "]"}], "/", "Temp"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.80052945743784*^9, 3.8005294643246326`*^9}, {
  3.800529554880217*^9, 3.8005295791658077`*^9}, {3.800529617150374*^9, 
  3.800529711716461*^9}},
 CellLabel->
  "In[144]:=",ExpressionUUID->"bd98820a-c59f-44e8-887d-77c25fb213b1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Delta", "=", 
    RowBox[{"-", "0.1"}]}], ";", " ", 
   RowBox[{"DeltaVector", "=", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Delta", ",", "Delta"}], "}"}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"2", " ", "NBilayer"}], "-", "2"}], "}"}]}], "]"}]}], 
     "]"}]}], ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{"example", " ", "for", " ", "test"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DeltaVector0", "=", 
    RowBox[{"Table", "[", 
     RowBox[{"0", ",", 
      RowBox[{"{", 
       RowBox[{"2", " ", "NBilayer"}], "}"}]}], "]"}]}], ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{"example", " ", "for", " ", "test"}], " ", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.715096394230157*^9, 3.715096398359116*^9}, 
   3.715104840603285*^9, {3.7151050998476143`*^9, 3.7151051063705807`*^9}, {
   3.715106786872856*^9, 3.715106801186758*^9}, {3.715157389142125*^9, 
   3.715157398138288*^9}, {3.715493348134794*^9, 3.715493361869975*^9}, {
   3.7159535995307217`*^9, 3.715953600962957*^9}},
 CellLabel->
  "In[145]:=",ExpressionUUID->"7463fefa-dff7-4b65-af16-74bf3c10a0ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"H0", "=", 
   RowBox[{"ConstructH", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{"0", ",", 
       RowBox[{"{", 
        RowBox[{"2", " ", "NBilayer"}], "}"}]}], "]"}], ",", "NBilayer", ",", 
     "kx", ",", "ky"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{
  3.7672776485730333`*^9, {3.767277742854954*^9, 3.767277743909087*^9}, 
   3.76770368379463*^9},
 CellLabel->
  "In[147]:=",ExpressionUUID->"2df46e57-7731-4066-af59-21666b039aab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "conv", "]"}], ";"}]], "Input",
 CellLabel->
  "In[148]:=",ExpressionUUID->"35607c69-c464-4085-af81-e6f07cd15749"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AddSublattice", "[", "DensVector_", "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"DensVector", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"2", " ", "i"}], "-", "1"}], "]"}], "]"}], "+", 
     RowBox[{"DensVector", "[", 
      RowBox[{"[", 
       RowBox[{"2", " ", "i"}], "]"}], "]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{
       RowBox[{"Length", "[", "DensVector", "]"}], "/", "2"}]}], "}"}]}], 
   "]"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"Adds", " ", "sublattice", " ", "densities"}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.715108089136594*^9, 3.715108240563486*^9}, {
  3.715114098863268*^9, 3.715114100418927*^9}},
 CellLabel->
  "In[149]:=",ExpressionUUID->"6766f8f1-63f3-47bd-a60f-1e2c3d140e21"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "DensityVector0", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DensityVector0", "[", 
    RowBox[{"kx_", ",", "ky_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"H", ",", "spec"}], "}"}], ",", 
     RowBox[{
      RowBox[{"H0", "=", 
       RowBox[{"ConstructH", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"2", " ", "NBilayer"}], "}"}]}], "]"}], ",", " ", 
         "NBilayer", ",", "kx", ",", "ky"}], "]"}]}], ";", " ", 
      RowBox[{"spec", "=", 
       RowBox[{
        RowBox[{"Eigensystem", "[", "H0", "]"}], "//", "Transpose"}]}], ";", 
      " ", 
      RowBox[{"Plus", "@@", 
       RowBox[{"(", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"nF", "[", 
              RowBox[{
               RowBox[{"Re", "[", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "Temp"}], "]"}], 
             "*", 
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}], "^", "2"}]}], ")"}], 
           "&"}], ",", " ", "spec"}], "]"}], ")"}]}]}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7160136602418756`*^9, 3.716013675939459*^9}, {
  3.716013711942415*^9, 3.716013721866807*^9}, {3.716013764780713*^9, 
  3.716013831248212*^9}, {3.716139107807623*^9, 3.7161391286711273`*^9}},
 CellLabel->
  "In[150]:=",ExpressionUUID->"f02eb37e-7202-4b1a-bbc9-f36f5ab789f3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", "FindDensity", "]"}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Lambda", "=", "1"}], ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"abskpoints", "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{"k", ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "0.0", ",", "0.2", ",", "0.002"}], "}"}]}], "]"}], 
     ",", 
     RowBox[{"Table", "[", 
      RowBox[{"k", ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "0.25", ",", "0.5", ",", "0.05"}], "}"}]}], "]"}], 
     ",", 
     RowBox[{"Table", "[", 
      RowBox[{"k", ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "0.6", ",", 
         RowBox[{"4", " ", 
          RowBox[{"\[Pi]", "/", "3"}]}], ",", "0.2"}], "}"}]}], "]"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"anglekpoints", "=", 
   RowBox[{"Table", "[", 
    RowBox[{"\[Alpha]", ",", 
     RowBox[{"{", 
      RowBox[{"\[Alpha]", ",", 
       RowBox[{
        RowBox[{"-", "\[Pi]"}], "/", "3"}], ",", 
       RowBox[{"\[Pi]", "/", "3"}], ",", 
       RowBox[{"2", " ", 
        RowBox[{
         RowBox[{"\[Pi]", "/", "3"}], "/", "40"}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kpoints", "=", 
   RowBox[{"Outer", "[", 
    RowBox[{"List", ",", "abskpoints", ",", "anglekpoints"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"denstab0", "=", 
    RowBox[{"Outer", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"AddSublattice", "[", 
         RowBox[{"DensityVector0", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "#1"}], " ", 
            RowBox[{"Cos", "[", "#2", "]"}]}], ",", 
           RowBox[{"#1", " ", 
            RowBox[{"Sin", "[", "#2", "]"}]}]}], "]"}], "]"}], ")"}], "&"}], 
      ",", "abskpoints", ",", "anglekpoints"}], "]"}]}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{"density", " ", "table", " ", "for", " ", "zero", " ", "doping"}], 
   " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"densinterp0", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Interpolation", "[", 
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Transpose", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"kpoints", ",", 
             RowBox[{"denstab0", "[", 
              RowBox[{"[", 
               RowBox[{";;", ",", ";;", ",", "i"}], "]"}], "]"}]}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}], ",", "1"}], 
        "]"}], ",", 
       RowBox[{"InterpolationOrder", "\[Rule]", "2"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"2", " ", "NBilayer"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dens00", "=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"3", "*", 
       RowBox[{"4", "/", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"2", " ", "\[Pi]"}], ")"}], "^", "2"}]}], 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{"NIntegrate", "[", 
          RowBox[{
           RowBox[{"k", " ", 
            RowBox[{
             RowBox[{"densinterp0", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "[", 
             RowBox[{"k", ",", "\[Alpha]"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"k", ",", "0", ",", "0.3"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"\[Alpha]", ",", 
             RowBox[{
              RowBox[{"-", " ", "\[Pi]"}], "/", "3"}], ",", 
             RowBox[{"\[Pi]", "/", "3"}]}], "}"}], ",", 
           RowBox[{"AccuracyGoal", "\[Rule]", "7"}]}], "]"}], "+", 
         RowBox[{"NIntegrate", "[", 
          RowBox[{
           RowBox[{"k", " ", 
            RowBox[{
             RowBox[{"densinterp0", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "[", 
             RowBox[{"k", ",", "\[Alpha]"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"k", ",", "0.3", ",", 
             RowBox[{"4", " ", 
              RowBox[{"\[Pi]", "/", "6"}]}]}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"\[Alpha]", ",", 
             RowBox[{
              RowBox[{"-", " ", "\[Pi]"}], "/", "3"}], ",", 
             RowBox[{"\[Pi]", "/", "3"}]}], "}"}], ",", 
           RowBox[{"AccuracyGoal", "\[Rule]", "3"}]}], "]"}], 
         "\[IndentingNewLine]", "+", " ", 
         RowBox[{"NIntegrate", "[", 
          RowBox[{
           RowBox[{"k", " ", 
            RowBox[{
             RowBox[{"densinterp0", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "[", 
             RowBox[{"k", ",", "\[Alpha]"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"k", ",", 
             RowBox[{"4", " ", 
              RowBox[{"\[Pi]", "/", "6"}]}], ",", 
             RowBox[{"4", " ", 
              RowBox[{"\[Pi]", "/", "3"}]}]}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"\[Alpha]", ",", 
             RowBox[{"-", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "3"}], " ", "-", " ", 
                RowBox[{"ArcCos", "[", 
                 RowBox[{"4", " ", 
                  RowBox[{"\[Pi]", "/", 
                   RowBox[{"(", 
                    RowBox[{"6", " ", "k"}], ")"}]}]}], "]"}]}], ")"}]}], ",", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "3"}], " ", "-", " ", 
               RowBox[{"ArcCos", "[", 
                RowBox[{"4", " ", 
                 RowBox[{"\[Pi]", "/", 
                  RowBox[{"(", 
                   RowBox[{"6", " ", "k"}], ")"}]}]}], "]"}]}], ")"}]}], 
            "}"}], ",", 
           RowBox[{"AccuracyGoal", "\[Rule]", "2"}]}], "]"}]}], ")"}]}], ",", 
      
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"2", " ", "NBilayer"}]}], "}"}]}], "]"}]}], ";"}], 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dens0", "=", 
   RowBox[{"dens00", "-", 
    RowBox[{
     RowBox[{"Total", "[", "dens00", "]"}], "/", 
     RowBox[{"Length", "[", "dens00", "]"}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    StyleBox[
     RowBox[{"FindDensity", "[", "DeltaVector_", "]"}],
     FontColor->RGBColor[1, 0, 0]], ":=", 
    RowBox[{"Module", "[", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"denstab", ",", "densinterp", ",", "H", ",", "dens"}], "}"}], 
      ",", "  ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"Parameterize", " ", "by"}], " ", "|", "k", "|", " ", 
         RowBox[{"and", " ", "angle"}]}], ",", " ", 
        RowBox[{
        "in", " ", "the", " ", "range", " ", "0", " ", "to", " ", "2", " ", 
         RowBox[{"\[Pi]", "/", "3"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      
      RowBox[{
       RowBox[{"H", "=", 
        RowBox[{"ConstructH", "[", 
         RowBox[{"DeltaVector", ",", " ", "NBilayer", ",", "kx", ",", "ky"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"H0", "=", 
          RowBox[{"ConstructH", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{"0", ",", 
              RowBox[{"{", 
               RowBox[{"2", " ", "NBilayer"}], "}"}]}], "]"}], ",", " ", 
            "NBilayer", ",", "kx", ",", "ky"}], "]"}]}], ";"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"denstab", "=", 
        RowBox[{
         RowBox[{"Outer", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"AddSublattice", "[", 
              RowBox[{"DensityVector1", "[", 
               RowBox[{"H", ",", 
                RowBox[{
                 RowBox[{"-", "#1"}], " ", 
                 RowBox[{"Cos", "[", "#2", "]"}]}], ",", 
                RowBox[{"#1", " ", 
                 RowBox[{"Sin", "[", "#2", "]"}]}]}], "]"}], "]"}], ")"}], 
            "&"}], ",", "abskpoints", ",", "anglekpoints"}], "]"}], "-", 
         "denstab0"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "This", " ", "is", " ", "for", " ", "2", " ", "Nb", " ", "layers"}], 
         ",", " ", 
         RowBox[{
         "now", " ", "I", " ", "total", " ", "it", " ", "in", " ", "the", " ",
           "layers"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"densinterp", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"Transpose", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"kpoints", ",", 
                  RowBox[{"denstab", "[", 
                   RowBox[{"[", 
                    RowBox[{";;", ",", ";;", ",", "i"}], "]"}], "]"}]}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}], ",", 
              "1"}], "]"}], ",", 
            RowBox[{"InterpolationOrder", "\[Rule]", "2"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"2", " ", "NBilayer"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"Plot3D", "[", 
           RowBox[{
            RowBox[{"k", " ", 
             RowBox[{
              RowBox[{"densinterp", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"k", ",", "a"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", "0", ",", "0.1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "0", ",", 
              RowBox[{"2", " ", 
               RowBox[{"\[Pi]", "/", "3"}]}]}], "}"}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"Plot3D", "[", 
           RowBox[{
            RowBox[{"k", " ", 
             RowBox[{
              RowBox[{"densinterp", "[", 
               RowBox[{"[", "5", "]"}], "]"}], "[", 
              RowBox[{"k", ",", "a"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", "0", ",", "0.1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"a", ",", "0", ",", 
              RowBox[{"2", " ", 
               RowBox[{"\[Pi]", "/", "3"}]}]}], "}"}], ",", " ", 
            RowBox[{"PlotRange", "->", "All"}]}], "]"}], "]"}], ";"}], "*)"}],
        "\[IndentingNewLine]", 
       RowBox[{"dens", "=", 
        RowBox[{"dens0", "+", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"3", "*", 
            RowBox[{"4", "/", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"2", " ", "\[Pi]"}], ")"}], "^", "2"}]}], 
            RowBox[{"(", " ", 
             RowBox[{
              RowBox[{"NIntegrate", "[", 
               RowBox[{
                RowBox[{"k", " ", 
                 RowBox[{
                  RowBox[{"densinterp", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "[", 
                  RowBox[{"k", ",", "\[Alpha]"}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"k", ",", "0", ",", "0.3"}], "}"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"\[Alpha]", ",", 
                  RowBox[{
                   RowBox[{"-", " ", "\[Pi]"}], "/", "3"}], ",", 
                  RowBox[{"\[Pi]", "/", "3"}]}], "}"}], ",", 
                RowBox[{
                "Method", "\[Rule]", 
                 "\"\<InterpolationPointsSubdivision\>\""}], ",", " ", 
                RowBox[{"AccuracyGoal", "\[Rule]", "7"}]}], "]"}], "+", 
              RowBox[{"NIntegrate", "[", 
               RowBox[{
                RowBox[{"k", " ", 
                 RowBox[{
                  RowBox[{"densinterp", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "[", 
                  RowBox[{"k", ",", "\[Alpha]"}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"k", ",", "0.3", ",", 
                  RowBox[{"4", " ", 
                   RowBox[{"\[Pi]", "/", "6"}]}]}], "}"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"\[Alpha]", ",", 
                  RowBox[{
                   RowBox[{"-", " ", "\[Pi]"}], "/", "3"}], ",", 
                  RowBox[{"\[Pi]", "/", "3"}]}], "}"}], ",", 
                RowBox[{
                "Method", "\[Rule]", 
                 "\"\<InterpolationPointsSubdivision\>\""}], ",", 
                RowBox[{"AccuracyGoal", "\[Rule]", "3"}]}], "]"}], 
              "\[IndentingNewLine]", "+", " ", 
              RowBox[{"NIntegrate", "[", 
               RowBox[{
                RowBox[{"k", " ", 
                 RowBox[{
                  RowBox[{"densinterp", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "[", 
                  RowBox[{"k", ",", "\[Alpha]"}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"k", ",", 
                  RowBox[{"4", " ", 
                   RowBox[{"\[Pi]", "/", "6"}]}], ",", 
                  RowBox[{"4", " ", 
                   RowBox[{"\[Pi]", "/", "3"}]}]}], "}"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"\[Alpha]", ",", 
                  RowBox[{"-", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"\[Pi]", "/", "3"}], " ", "-", " ", 
                    RowBox[{"ArcCos", "[", 
                    RowBox[{"4", " ", 
                    RowBox[{"\[Pi]", "/", 
                    RowBox[{"(", 
                    RowBox[{"6", " ", "k"}], ")"}]}]}], "]"}]}], ")"}]}], ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"\[Pi]", "/", "3"}], " ", "-", " ", 
                    RowBox[{"ArcCos", "[", 
                    RowBox[{"4", " ", 
                    RowBox[{"\[Pi]", "/", 
                    RowBox[{"(", 
                    RowBox[{"6", " ", "k"}], ")"}]}]}], "]"}]}], ")"}]}], 
                 "}"}], ",", 
                RowBox[{
                "Method", "\[Rule]", 
                 "\"\<InterpolationPointsSubdivision\>\""}], ",", 
                RowBox[{"AccuracyGoal", "\[Rule]", "2"}]}], "]"}]}], ")"}]}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"2", " ", "NBilayer"}]}], "}"}]}], "]"}]}]}]}]}], 
     "]"}]}], ";"}], "  ", 
  RowBox[{"(*", 
   RowBox[{"Here", ",", " ", 
    RowBox[{
    "we", " ", "have", " ", "accounted", " ", "for", " ", "an", " ", "extra", 
     " ", "factor", " ", "of", " ", "4"}]}], " ", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.7151082870781517`*^9, 3.7151083214547253`*^9}, {
   3.7151083826253977`*^9, 3.715108427989951*^9}, {3.715108474604596*^9, 
   3.71510861257862*^9}, {3.715108676007928*^9, 3.715108679830483*^9}, {
   3.715109148418633*^9, 3.7151093050709352`*^9}, {3.715113529323517*^9, 
   3.715113573584057*^9}, {3.71511360399482*^9, 3.715113759076851*^9}, {
   3.715114564919832*^9, 3.715114567216297*^9}, {3.7151147187797003`*^9, 
   3.715114719241727*^9}, {3.715114754579258*^9, 3.715114820922942*^9}, {
   3.715114874407731*^9, 3.715114965711771*^9}, {3.715115039225719*^9, 
   3.71511504226328*^9}, {3.715115430773287*^9, 3.715115464992291*^9}, {
   3.7151155149174337`*^9, 3.71511566771461*^9}, 3.7151158418029613`*^9, {
   3.7151159993795557`*^9, 3.715116016393458*^9}, {3.715251615465724*^9, 
   3.715251651026984*^9}, 3.715251706435664*^9, {3.7154935709833517`*^9, 
   3.715493571622571*^9}, {3.715954787602233*^9, 3.715954802813644*^9}, {
   3.715954946191922*^9, 3.7159549567625*^9}, {3.715955090017659*^9, 
   3.715955134560534*^9}, {3.7159551668445883`*^9, 3.715955235384404*^9}, {
   3.715955288103692*^9, 3.715955292959049*^9}, {3.715955343227737*^9, 
   3.7159553948281183`*^9}, {3.715955432727065*^9, 3.715955462358042*^9}, {
   3.715955493362885*^9, 3.715955631855583*^9}, {3.715955736009204*^9, 
   3.715955884431973*^9}, {3.715955989649457*^9, 3.71595603014889*^9}, {
   3.715956064161731*^9, 3.715956064601721*^9}, {3.7159561362935266`*^9, 
   3.7159561794109707`*^9}, {3.715956223709689*^9, 3.7159562334103317`*^9}, {
   3.715956288217863*^9, 3.715956377587989*^9}, {3.715956426221278*^9, 
   3.715956497359065*^9}, {3.7159627474114447`*^9, 3.715962803697253*^9}, {
   3.715962880364276*^9, 3.715962892636518*^9}, {3.715968229956245*^9, 
   3.715968238061714*^9}, 3.715968317986857*^9, {3.715970066519918*^9, 
   3.7159700705085697`*^9}, {3.7159702167321787`*^9, 3.715970223926299*^9}, {
   3.715970265782173*^9, 3.7159702960903254`*^9}, {3.715970343425363*^9, 
   3.7159703655159388`*^9}, {3.715970397598958*^9, 3.715970437498321*^9}, {
   3.715970510128634*^9, 3.7159705598524733`*^9}, {3.715971064332893*^9, 
   3.715971064457535*^9}, {3.71597121724257*^9, 3.715971240942667*^9}, {
   3.7159712891446247`*^9, 3.715971289701852*^9}, {3.715974533312173*^9, 
   3.7159745882688828`*^9}, {3.715975042747476*^9, 3.715975044778634*^9}, {
   3.716013609780785*^9, 3.716013627055162*^9}, {3.716013737595251*^9, 
   3.7160137403558807`*^9}, {3.716014131964802*^9, 3.716014065107465*^9}, {
   3.7160141963116503`*^9, 3.716014351735985*^9}, {3.716014396411798*^9, 
   3.716014400391473*^9}, {3.716103275670376*^9, 3.7161032818463907`*^9}, {
   3.716212228302515*^9, 3.716212307446267*^9}, {3.7162123977836113`*^9, 
   3.716212436799534*^9}, {3.71621250719174*^9, 3.7162125476549873`*^9}, {
   3.716231557764741*^9, 3.716231580166216*^9}, {3.716231631608244*^9, 
   3.71623164221122*^9}, {3.7162317073847923`*^9, 3.716231709047162*^9}, {
   3.716231765761067*^9, 3.7162317972965803`*^9}, {3.716232047381031*^9, 
   3.716232052107317*^9}, {3.716232246696867*^9, 3.716232465367054*^9}, {
   3.716457648398367*^9, 3.716457652521476*^9}, {3.716654677560679*^9, 
   3.716654677637538*^9}, {3.7167019185730886`*^9, 3.716701936823835*^9}, {
   3.716748824719592*^9, 3.716748878463209*^9}, {3.716815130214108*^9, 
   3.7168151678279552`*^9}, {3.716815217853374*^9, 3.716815247908392*^9}, {
   3.716815365765441*^9, 3.7168153686363993`*^9}, {3.716815440829734*^9, 
   3.716815498308959*^9}, {3.716815737430361*^9, 3.71681573794121*^9}, {
   3.7168158856301537`*^9, 3.716815906373353*^9}, {3.7168159507022943`*^9, 
   3.716815983220931*^9}, {3.716816510959201*^9, 3.7168165438287354`*^9}, {
   3.716825411122878*^9, 3.716825419113855*^9}, {3.716825453582407*^9, 
   3.7168254743421392`*^9}, {3.716825954538136*^9, 3.7168261001656637`*^9}, {
   3.7168835860858927`*^9, 3.71688360110056*^9}, {3.7168848598546543`*^9, 
   3.716884864716445*^9}, {3.717139251433729*^9, 3.717139262360938*^9}, {
   3.7171789178597727`*^9, 3.7171789179540873`*^9}, {3.717957183321261*^9, 
   3.717957188497121*^9}, {3.7304596013786917`*^9, 3.7304596275136003`*^9}, {
   3.7304596638136883`*^9, 3.730459692886004*^9}, {3.730459732229966*^9, 
   3.730459735750448*^9}, 3.730460204487897*^9, 3.73046095044687*^9, {
   3.7310679731289186`*^9, 3.731067975656124*^9}, {3.731068065651528*^9, 
   3.7310680813518467`*^9}, {3.77139651541467*^9, 3.771396539128684*^9}},
 CellLabel->
  "In[152]:=",ExpressionUUID->"a99d30f2-9c5d-472b-b3a5-d785c29f958f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   StyleBox[
    RowBox[{"FindDensityBand", "[", 
     RowBox[{"DeltaVector_", ",", "band_"}], "]"}],
    FontColor->RGBColor[1, 0, 0]], ":=", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"denstab", ",", "densinterp", ",", "H", ",", "dens"}], "}"}], 
     ",", "  ", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
        RowBox[{"Parameterize", " ", "by"}], " ", "|", "k", "|", " ", 
        RowBox[{"and", " ", "angle"}]}], ",", " ", 
       RowBox[{
       "in", " ", "the", " ", "range", " ", "0", " ", "to", " ", "2", " ", 
        RowBox[{"\[Pi]", "/", "3"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"H", "=", 
       RowBox[{"ConstructH", "[", 
        RowBox[{"DeltaVector", ",", " ", "NBilayer", ",", "kx", ",", "ky"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"H0", "=", 
         RowBox[{"ConstructH", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{"0", ",", 
             RowBox[{"{", 
              RowBox[{"2", " ", "NBilayer"}], "}"}]}], "]"}], ",", " ", 
           "NBilayer", ",", "kx", ",", "ky"}], "]"}]}], ";"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"densinterp", "=", 
       RowBox[{"Interpolation", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Outer", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"#1", ",", "#2"}], "}"}], ",", 
                RowBox[{"DensityBand", "[", 
                 RowBox[{"H", ",", 
                  RowBox[{
                   RowBox[{"-", "#1"}], " ", 
                   RowBox[{"Cos", "[", "#2", "]"}]}], ",", 
                  RowBox[{"#1", " ", 
                   RowBox[{"Sin", "[", "#2", "]"}]}], ",", "band"}], "]"}]}], 
               "}"}], "&"}], ",", "abskpoints", ",", "anglekpoints"}], "]"}], 
           ",", "1"}], "]"}], ",", 
         RowBox[{"InterpolationOrder", "\[Rule]", "2"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dens", "=", 
       RowBox[{"3", "*", 
        RowBox[{"4", "/", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"2", " ", "\[Pi]"}], ")"}], "^", "2"}]}], 
        RowBox[{"(", " ", 
         RowBox[{
          RowBox[{"NIntegrate", "[", 
           RowBox[{
            RowBox[{"k", " ", 
             RowBox[{"densinterp", "[", 
              RowBox[{"k", ",", "\[Alpha]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", "0", ",", "0.3"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"\[Alpha]", ",", 
              RowBox[{
               RowBox[{"-", " ", "\[Pi]"}], "/", "3"}], ",", 
              RowBox[{"\[Pi]", "/", "3"}]}], "}"}], ",", 
            RowBox[{
            "Method", "\[Rule]", "\"\<InterpolationPointsSubdivision\>\""}], 
            ",", " ", 
            RowBox[{"AccuracyGoal", "\[Rule]", "7"}]}], "]"}], "+", 
          RowBox[{"NIntegrate", "[", 
           RowBox[{
            RowBox[{"k", " ", 
             RowBox[{"densinterp", "[", 
              RowBox[{"k", ",", "\[Alpha]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", "0.3", ",", 
              RowBox[{"4", " ", 
               RowBox[{"\[Pi]", "/", "6"}]}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"\[Alpha]", ",", 
              RowBox[{
               RowBox[{"-", " ", "\[Pi]"}], "/", "3"}], ",", 
              RowBox[{"\[Pi]", "/", "3"}]}], "}"}], ",", 
            RowBox[{
            "Method", "\[Rule]", "\"\<InterpolationPointsSubdivision\>\""}], 
            ",", 
            RowBox[{"AccuracyGoal", "\[Rule]", "3"}]}], "]"}], 
          "\[IndentingNewLine]", "+", " ", 
          RowBox[{"NIntegrate", "[", 
           RowBox[{
            RowBox[{"k", " ", 
             RowBox[{"densinterp", "[", 
              RowBox[{"k", ",", "\[Alpha]"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", 
              RowBox[{"4", " ", 
               RowBox[{"\[Pi]", "/", "6"}]}], ",", 
              RowBox[{"4", " ", 
               RowBox[{"\[Pi]", "/", "3"}]}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"\[Alpha]", ",", 
              RowBox[{"-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[Pi]", "/", "3"}], " ", "-", " ", 
                 RowBox[{"ArcCos", "[", 
                  RowBox[{"4", " ", 
                   RowBox[{"\[Pi]", "/", 
                    RowBox[{"(", 
                    RowBox[{"6", " ", "k"}], ")"}]}]}], "]"}]}], ")"}]}], ",", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "3"}], " ", "-", " ", 
                RowBox[{"ArcCos", "[", 
                 RowBox[{"4", " ", 
                  RowBox[{"\[Pi]", "/", 
                   RowBox[{"(", 
                    RowBox[{"6", " ", "k"}], ")"}]}]}], "]"}]}], ")"}]}], 
             "}"}], ",", 
            RowBox[{
            "Method", "\[Rule]", "\"\<InterpolationPointsSubdivision\>\""}], 
            ",", 
            RowBox[{"AccuracyGoal", "\[Rule]", "2"}]}], "]"}]}], 
         ")"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8005298315841293`*^9, 3.800529832319866*^9}, {
  3.8005454923987617`*^9, 3.80054550106004*^9}, {3.800545593182971*^9, 
  3.800545811263722*^9}, {3.800545844154786*^9, 3.8005458524199*^9}, {
  3.800545935252225*^9, 3.800545953452692*^9}, {3.800550156765654*^9, 
  3.800550161706172*^9}},
 CellLabel->
  "In[161]:=",ExpressionUUID->"34a2f599-2370-43d0-8dec-c53ae780e83f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Solve self-consistent Hartree equations for zero magnetic field\
\>", "Subsubsection",
 CellChangeTimes->{{3.7304615231087093`*^9, 
  3.730461544305594*^9}},ExpressionUUID->"38a906b4-8957-4973-92d7-\
00c9c19b29a5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"M3", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"j", "\[GreaterEqual]", "i"}], ",", "1", ",", "0"}], "]"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{
        RowBox[{"2", " ", "NBilayer"}], "-", "1"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", 
       RowBox[{
        RowBox[{"2", " ", "NBilayer"}], "-", "1"}]}], "}"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"M3T", "=", 
   RowBox[{"Transpose", "[", "M3", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"id", "=", 
    RowBox[{"IdentityMatrix", "[", 
     RowBox[{
      RowBox[{"2", " ", "NBilayer"}], "-", "1"}], "]"}]}], ";"}], " "}], "\n", 
 RowBox[{
  RowBox[{"MM", " ", "=", " ", 
   RowBox[{
    RowBox[{"M3T", ".", "M3"}], "+", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"\[Epsilon]dielectric", "-", "1"}], ")"}], "/", "4"}], " ", 
     "*", "id"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"uMM", "=", 
    RowBox[{"Uunit", " ", "MM"}]}], ";"}], "  "}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DeltaU", "=", 
    RowBox[{"Table", "[", 
     RowBox[{"0.01", ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{
         RowBox[{"2", " ", "NBilayer"}], "-", "1"}]}], "}"}]}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"iteration2", "[", 
    RowBox[{"DeltaVector_", ",", "epsmin_", ",", "nb_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "u1", ",", " ", "utilde", ",", "densold", ",", "LinearResp", ",", 
       "initialError", ",", "eps", ",", "ErrMin", ",", 
       RowBox[{"conv", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"densold", "=", 
       RowBox[{"FindDensity", "[", "DeltaVector", "]"}]}], " ", ";", " ", 
      RowBox[{"u1", "=", 
       RowBox[{"DeltaVector", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", 
      RowBox[{"utilde", "=", 
       RowBox[{"DeltaVector", "[", 
        RowBox[{"[", 
         RowBox[{"2", ";;"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"initialError", "=", " ", 
       RowBox[{"utilde", "-", "u1", "-", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Uunit", " ", "*", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"i", "-", "1"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "2", ",", 
               RowBox[{"2", " ", "NBilayer"}]}], "}"}]}], "]"}], "*", "nb"}], 
          "+", " ", 
          RowBox[{"uMM", ".", 
           RowBox[{"(", 
            RowBox[{"densold", "[", 
             RowBox[{"[", 
              RowBox[{"2", ";;"}], "]"}], "]"}], ")"}]}], "-", 
          RowBox[{"Uunit", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"\[Epsilon]dielectric", "-", "1"}], ")"}], "/", "4"}], 
           " ", 
           RowBox[{"densold", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], " ", ")"}]}]}], ";", 
      RowBox[{"ErrMin", "=", 
       RowBox[{"Min", "[", 
        RowBox[{"Abs", "[", "initialError", "]"}], "]"}]}], ";", 
      RowBox[{"ErrMax", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", "initialError", "]"}], "]"}]}], ";", "  ", 
      "\[IndentingNewLine]", 
      RowBox[{"eps", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Sign", "[", "#", "]"}], " ", 
           RowBox[{"Max", "[", 
            RowBox[{"epsmin", ",", 
             RowBox[{"Abs", "[", "#", "]"}]}], "]"}]}], "&"}], ",", 
         "DeltaU"}], "]"}]}], ";", " ", 
      RowBox[{"(*", "initialError", " ", "*)"}], " ", "\[IndentingNewLine]", 
      RowBox[{"(*", "  ", 
       RowBox[{
        RowBox[{"PrintTemporary", "[", 
         RowBox[{"\"\<Max Error=\>\"", ",", 
          RowBox[{"Max", "[", 
           RowBox[{"Abs", "[", "initialError", "]"}], "]"}], ",", 
          "\"\< Min Error=\>\"", ",", "ErrMin", ",", " ", 
          "\"\< Full Error\>\"", ",", " ", "initialError"}], "]"}], ";"}], 
       "*)"}], " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "reset", " ", "utilde", " ", "to", " ", "zero", " ", "in", " ", "the", 
        " ", "next", " ", "cycle"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ErrMax", ">", "10"}], ",", 
        RowBox[{
         RowBox[{"DeltaU", "=", 
          RowBox[{"-", "utilde"}]}], ";", 
         RowBox[{"Goto", "[", "End", "]"}]}]}], "]"}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"LinearResp", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Delta1", "=", 
            RowBox[{"DeltaVector", "+", 
             RowBox[{
              RowBox[{"UnitVector", "[", 
               RowBox[{
                RowBox[{"2", " ", "NBilayer"}], ",", "i"}], "]"}], "*", 
              RowBox[{"eps", "[", 
               RowBox[{"[", 
                RowBox[{"i", "-", "1"}], "]"}], "]"}]}]}]}], ";", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"FindDensity", "[", "Delta1", "]"}], "-", "densold"}], 
              ")"}], "[", 
             RowBox[{"[", 
              RowBox[{"2", ";;"}], "]"}], "]"}], "/", 
            RowBox[{"eps", "[", 
             RowBox[{"[", 
              RowBox[{"i", "-", "1"}], "]"}], "]"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "2", ",", 
            RowBox[{"2", " ", "NBilayer"}]}], "}"}]}], "]"}], "//", 
        "Transpose"}]}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"PrintTemporary", "[", 
         RowBox[{"LinearResp", "//", "MatrixForm"}], "]"}], ";"}], "*)"}], 
      " ", "\[IndentingNewLine]", 
      RowBox[{"DeltaU", "=", 
       RowBox[{"LinearSolve", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"uMM", ".", "LinearResp"}], "-", "id"}], ",", 
         "initialError"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Label", "[", "End", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"DeltaVector", "+", 
       RowBox[{"conv", " ", 
        RowBox[{"Prepend", "[", 
         RowBox[{"DeltaU", ",", "0"}], "]"}]}]}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.715365976448502*^9, 3.715365984830435*^9}, {
   3.715366018092957*^9, 3.715366077317498*^9}, {3.71536644535458*^9, 
   3.71536644829539*^9}, 3.715367176534227*^9, {3.717924253670698*^9, 
   3.71792425706997*^9}, {3.7179297579875593`*^9, 3.7179297906350517`*^9}, 
   3.7179361449422703`*^9, 3.718358968461121*^9, {3.718389466155631*^9, 
   3.7183894675699778`*^9}, {3.718430750085939*^9, 3.718430753248317*^9}, {
   3.7292448340877457`*^9, 3.729244951966339*^9}, {3.7292450049584312`*^9, 
   3.729245013660474*^9}, {3.729245100842719*^9, 3.729245133170013*^9}, {
   3.729246271211768*^9, 3.72924627187958*^9}, 3.729246304895042*^9, {
   3.729257792318735*^9, 3.72925780392505*^9}, 3.730461560173455*^9, {
   3.7304620982095623`*^9, 3.7304621260469437`*^9}, {3.730462235304915*^9, 
   3.7304622481398687`*^9}, 3.730463930109591*^9, {3.730464241547882*^9, 
   3.730464243673296*^9}, {3.786908764616946*^9, 3.786908787227648*^9}, {
   3.786908856882185*^9, 3.786908883251333*^9}, {3.7869089255696583`*^9, 
   3.786908943643964*^9}, {3.786908996555027*^9, 3.7869090413303223`*^9}},
 CellLabel->
  "In[162]:=",ExpressionUUID->"b6c4c3c9-e6fd-4ad7-8f55-6142aff8b312"],

Cell[BoxData[
 RowBox[{
  RowBox[{"iteration1", "[", 
   RowBox[{"DeltaVector_", ",", "conv_", ",", "nb_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "Evector", ",", " ", "Uvector", ",", "dens", ",", "u1", ",", "utilde"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"dens", "=", 
      RowBox[{"FindDensity", "[", "DeltaVector", "]"}]}], " ", ";", " ", 
     RowBox[{"u1", "=", 
      RowBox[{"DeltaVector", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", 
     RowBox[{"utilde", "=", 
      RowBox[{"DeltaVector", "[", 
       RowBox[{"[", 
        RowBox[{"2", ";;"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"initialError", "=", " ", 
      RowBox[{"utilde", "-", "u1", "-", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Uunit", " ", "*", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"i", "-", "1"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "2", ",", 
              RowBox[{"2", " ", "NBilayer"}]}], "}"}]}], "]"}], "*", "nb"}], 
         "+", " ", 
         RowBox[{"uMM", ".", 
          RowBox[{"(", 
           RowBox[{"dens", "[", 
            RowBox[{"[", 
             RowBox[{"2", ";;"}], "]"}], "]"}], ")"}]}], " ", "-", 
         RowBox[{"Uunit", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"\[Epsilon]dielectric", "-", "1"}], ")"}], "/", "4"}], 
          " ", 
          RowBox[{"dens", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}]}], ")"}]}]}], ";", 
     RowBox[{"ErrMax", "=", 
      RowBox[{"Max", "[", 
       RowBox[{"Abs", "[", "initialError", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Evector", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"nb", "+", 
         RowBox[{"Plus", "@@", 
          RowBox[{"(", 
           RowBox[{"dens", "[", 
            RowBox[{"[", 
             RowBox[{"i", ";;"}], "]"}], "]"}], ")"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "dens", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Uvector", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Plus", "@@", 
           RowBox[{"(", 
            RowBox[{"Evector", "[", 
             RowBox[{"[", 
              RowBox[{"2", ";;", "i"}], "]"}], "]"}], ")"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "dens", "]"}]}], "}"}]}], "]"}], " ", 
        "Uunit"}], "  ", "-", 
       RowBox[{"Uunit", " ", 
        RowBox[{"(", 
         RowBox[{"\[Epsilon]dielectric", "-", "1"}], ")"}], " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"dens", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "-", "dens"}], ")"}], "/", 
         "4"}]}], " ", "+", 
       RowBox[{"DeltaVector", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}]}], ";", " ", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Add", " ", "a", " ", "contribution", " ", "from", " ", "the", " ", 
       "unscreened", " ", "component"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"DeltaVector", 
       RowBox[{"(", 
        RowBox[{"1", "-", "conv"}], ")"}]}], "+", 
      RowBox[{"conv", " ", "Uvector"}]}]}]}], " ", "]"}], " "}]], "Input",
 CellChangeTimes->{{3.7154914453888493`*^9, 3.715491557115094*^9}, {
   3.715493134985346*^9, 3.715493149200383*^9}, {3.715974495913047*^9, 
   3.715974496456271*^9}, {3.7160133981365747`*^9, 3.7160134111871443`*^9}, {
   3.7160134643979177`*^9, 3.716013466093822*^9}, 3.716014636950561*^9, {
   3.716015086011016*^9, 3.7160150987520523`*^9}, 3.7175045170336323`*^9, {
   3.7181135849579067`*^9, 3.7181135912530737`*^9}, {3.7181137206393948`*^9, 
   3.7181137938754263`*^9}, {3.718114445694652*^9, 3.7181144463913813`*^9}, {
   3.7292451634523697`*^9, 3.729245254243907*^9}, {3.72924530460429*^9, 
   3.729245340845986*^9}, 3.729246311975973*^9, 3.7292463533477783`*^9, {
   3.729246418080518*^9, 3.729246419631168*^9}, {3.730462211566844*^9, 
   3.730462215509191*^9}, {3.7304622646195803`*^9, 3.730462286694941*^9}, {
   3.786909241648424*^9, 3.7869092509013987`*^9}, {3.7984529889736958`*^9, 
   3.798453026724777*^9}, {3.798453114761243*^9, 3.7984531178804817`*^9}},
 CellLabel->
  "In[169]:=",ExpressionUUID->"274c8d5d-f92d-4b8f-bd97-65bd773dfd3e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Good", " ", "at", " ", "high", " ", "temperatures"}], " ", "*)"}],
   "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"PotentialDensNonlinear", "[", 
     RowBox[{"Delta_", ",", "nb_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"dens", ",", 
        RowBox[{"DeltaVector", "=", "Delta"}], ",", 
        RowBox[{"maxiterations", "=", "10"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"DeltaU", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"Temp", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{
             RowBox[{"2", " ", "NBilayer"}], "-", "1"}]}], "}"}]}], "]"}]}], 
       ";", 
       RowBox[{"ErrMax", "=", "1"}], ";", 
       RowBox[{"counter", "=", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"ErrMax", ">", "0.00001"}], " ", "&&", " ", 
           RowBox[{"counter", "<", "maxiterations"}]}], ")"}], ",", 
         RowBox[{
          RowBox[{"DeltaVector", "=", 
           RowBox[{"iteration2", "[", 
            RowBox[{"DeltaVector", ",", "0.0001", ",", "nb"}], "]"}]}], ";", 
          RowBox[{"counter", "++"}]}]}], " ", "]"}], 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{";", " ", 
          RowBox[{"PrintTemporary", "[", 
           RowBox[{"\"\<Error=\>\"", ",", "ErrMax"}], "]"}]}], "]"}], "*)"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"dens", "=", 
        RowBox[{"FindDensity", "[", "DeltaVector", "]"}]}], " ", ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"counter", "\[Equal]", "maxiterations"}], ",", 
         RowBox[{"PrintTemporary", "[", 
          RowBox[{
          "\"\<Not converged at B=\>\"", ",", " ", "B", ",", " ", 
           "\"\< U=\>\"", ",", 
           RowBox[{"Delta", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", "\"\< ErrMax=\>\"", ",",
            "ErrMax"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"DeltaVector", ",", "dens"}], "}"}]}]}], "]"}]}], 
   ";"}]}]], "Input",
 CellChangeTimes->{{3.7160144518615847`*^9, 3.716014549306719*^9}, {
   3.716015000025353*^9, 3.7160150104662857`*^9}, {3.7160151402500563`*^9, 
   3.716015171556531*^9}, {3.7160156322061567`*^9, 3.716015705158854*^9}, {
   3.716015794494299*^9, 3.716014803791774*^9}, {3.716103667691505*^9, 
   3.716103688274825*^9}, {3.716114685272169*^9, 3.716114685399781*^9}, {
   3.716122373424271*^9, 3.7161223820315113`*^9}, {3.716129983951058*^9, 
   3.7161299864543867`*^9}, {3.716138805377563*^9, 3.716138812802114*^9}, {
   3.716185257427671*^9, 3.716185274875182*^9}, 3.7162338696577682`*^9, {
   3.716748718659593*^9, 3.7167487324998407`*^9}, {3.716749062349345*^9, 
   3.716749062501348*^9}, {3.716782111883327*^9, 3.716782117339582*^9}, {
   3.7168173552614317`*^9, 3.716817371076404*^9}, {3.716885025355487*^9, 
   3.716885031835206*^9}, {3.71713939017527*^9, 3.7171393903108788`*^9}, 
   3.7171567420548487`*^9, 3.7171569375832663`*^9, 3.717157980104598*^9, {
   3.7175045308730907`*^9, 3.7175045320038147`*^9}, {3.717504576805668*^9, 
   3.717504606935915*^9}, {3.717504787608164*^9, 3.7175048098053093`*^9}, {
   3.717505308070355*^9, 3.717505309695793*^9}, {3.717505468553495*^9, 
   3.717505478265718*^9}, {3.717589402479129*^9, 3.7175894137716217`*^9}, {
   3.717697404149391*^9, 3.717697404582654*^9}, {3.717789182908087*^9, 
   3.717789226778247*^9}, {3.717789258098049*^9, 3.717789258558278*^9}, {
   3.717835981906459*^9, 3.717836007446353*^9}, {3.717877204605083*^9, 
   3.717877224602405*^9}, {3.71795481345312*^9, 3.717954839130643*^9}, {
   3.717954893186154*^9, 3.717954894800045*^9}, {3.717956723990737*^9, 
   3.717956724191821*^9}, {3.718055096521648*^9, 3.7180551921503973`*^9}, {
   3.7180552221955757`*^9, 3.718055245217218*^9}, {3.718055579573106*^9, 
   3.718055743352543*^9}, {3.718097585856472*^9, 3.718097586267741*^9}, {
   3.718260652682485*^9, 3.718260654364053*^9}, {3.719132435016636*^9, 
   3.719132437480146*^9}, {3.7204276940063066`*^9, 3.7204276941657743`*^9}, {
   3.72042777088756*^9, 3.720427774872181*^9}, {3.720438500663601*^9, 
   3.7204385394103317`*^9}, {3.729256620571465*^9, 3.729256633258854*^9}, {
   3.7292566646669064`*^9, 3.729256673923044*^9}, {3.7292571708284073`*^9, 
   3.729257178019799*^9}, {3.729287783290086*^9, 3.7292877869182777`*^9}, {
   3.729287862594152*^9, 3.729287864786471*^9}, {3.730462521955037*^9, 
   3.7304625383483057`*^9}, {3.730462576569975*^9, 3.7304625831240873`*^9}, {
   3.7304633331909018`*^9, 3.7304633368624353`*^9}, {3.730465355160137*^9, 
   3.730465357385297*^9}, {3.798519785944334*^9, 3.798519793224833*^9}, {
   3.80234145285673*^9, 3.8023414834215384`*^9}, {3.802341527616148*^9, 
   3.802341533363381*^9}},
 CellLabel->
  "In[170]:=",ExpressionUUID->"007b4ca5-bd6d-4ffa-b91d-968653ff6167"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Useful", " ", "at", " ", "low", " ", "temperatures"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"PotentialDensNonlinear1", "[", 
      RowBox[{"Delta_", ",", "nb_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"dens", ",", 
         RowBox[{"DeltaVector", "=", "Delta"}], ",", 
         RowBox[{"maxiterations", "=", "100"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ErrMax", "=", "1"}], ";", 
        RowBox[{"counter", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ErrMax", ">", "0.001"}], " ", "&&", " ", 
            RowBox[{"counter", "<", "maxiterations"}]}], ")"}], ",", 
          RowBox[{
           RowBox[{"DeltaVector", "=", 
            RowBox[{"iteration1", "[", 
             RowBox[{"DeltaVector", ",", "0.002", ",", "nb"}], "]"}]}], ";", 
           RowBox[{"counter", "++"}]}]}], " ", 
         RowBox[{"(*", 
          RowBox[{";", " ", 
           RowBox[{"PrintTemporary", "[", 
            RowBox[{"\"\<Error=\>\"", ",", "ErrMax"}], "]"}]}], "*)"}], "]"}],
         ";", " ", "\[IndentingNewLine]", 
        RowBox[{"dens", "=", 
         RowBox[{"FindDensity", "[", "DeltaVector", "]"}]}], " ", ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"counter", "\[Equal]", "maxiterations"}], ",", 
          RowBox[{"PrintTemporary", "[", 
           RowBox[{
           "\"\<Not converged at B=\>\"", ",", " ", "B", ",", " ", 
            "\"\< U=\>\"", ",", 
            RowBox[{"Delta", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", " ", "\"\< ErrMax=\>\"", 
            ",", "ErrMax"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"DeltaVector", ",", "dens"}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PotentialDensNonlinear2", "[", 
      RowBox[{"Delta_", ",", "nb_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"dens", ",", 
         RowBox[{"DeltaVector", "=", "Delta"}], ",", 
         RowBox[{"maxiterations", "=", "100"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ErrMax", "=", "1"}], ";", 
        RowBox[{"counter", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ErrMax", ">", "0.0002"}], " ", "&&", " ", 
            RowBox[{"counter", "<", "maxiterations"}]}], ")"}], ",", 
          RowBox[{
           RowBox[{"DeltaVector", "=", 
            RowBox[{"iteration1", "[", 
             RowBox[{"DeltaVector", ",", "0.001", ",", "nb"}], "]"}]}], ";", 
           RowBox[{"counter", "++"}]}]}], " ", 
         RowBox[{"(*", 
          RowBox[{";", " ", 
           RowBox[{"PrintTemporary", "[", 
            RowBox[{"\"\<Error=\>\"", ",", "ErrMax"}], "]"}]}], "*)"}], "]"}],
         ";", " ", "\[IndentingNewLine]", 
        RowBox[{"dens", "=", 
         RowBox[{"FindDensity", "[", "DeltaVector", "]"}]}], " ", ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"counter", "\[Equal]", "maxiterations"}], ",", 
          RowBox[{"PrintTemporary", "[", 
           RowBox[{
           "\"\<Not converged at B=\>\"", ",", " ", "B", ",", " ", 
            "\"\< U=\>\"", ",", 
            RowBox[{"Delta", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", " ", "\"\< ErrMax=\>\"", 
            ",", "ErrMax"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"DeltaVector", ",", "dens"}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{
  3.718113654557617*^9, {3.71811391374883*^9, 3.718113968330278*^9}, {
   3.718114000992313*^9, 3.7181140585674334`*^9}, {3.718188002482991*^9, 
   3.718188007508424*^9}, {3.7182606106666*^9, 3.718260624183127*^9}, {
   3.719132419424797*^9, 3.719132429567965*^9}, {3.7197447215025673`*^9, 
   3.7197447404537153`*^9}, {3.7198527646690187`*^9, 3.719852764792062*^9}, {
   3.7198857782096786`*^9, 3.7198857787584467`*^9}, {3.719915354094782*^9, 
   3.719915354237812*^9}, {3.7199248819994164`*^9, 3.7199248820863743`*^9}, {
   3.719934261456933*^9, 3.719934268879725*^9}, {3.720040455638474*^9, 
   3.720040464309156*^9}, 3.720111714794425*^9, {3.720111764420374*^9, 
   3.7201117690515823`*^9}, 3.720468106995542*^9, {3.720468139444556*^9, 
   3.720468159988544*^9}, {3.72046825945568*^9, 3.720468263751898*^9}, {
   3.729256605738997*^9, 3.729256638370598*^9}, {3.729256679163176*^9, 
   3.729256689507303*^9}, {3.7292571256123533`*^9, 3.729257145459408*^9}, {
   3.7292877726136303`*^9, 3.7292877774203672`*^9}, {3.729287872244375*^9, 
   3.729287874901704*^9}, {3.729503842826805*^9, 3.729503859418427*^9}, {
   3.730313522026886*^9, 3.730313534275284*^9}, {3.730385942105654*^9, 
   3.730385943361808*^9}, {3.73046259644696*^9, 3.730462642857994*^9}, {
   3.79848780518506*^9, 3.798487830596224*^9}, {3.8024016816484613`*^9, 
   3.802401700559692*^9}, {3.802422353648506*^9, 3.802422363606101*^9}, 
   3.8024225790372543`*^9, {3.802422650435626*^9, 3.80242265690425*^9}, {
   3.802516688480834*^9, 3.802516702779661*^9}, {3.8027767251701307`*^9, 
   3.8027767288272676`*^9}},
 CellLabel->
  "In[171]:=",ExpressionUUID->"2ee92818-082b-41bc-9b65-ee7884ebb645"],

Cell[BoxData[
 RowBox[{"ULinear", "=", 
  RowBox[{"Prepend", "[", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{"0", ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"2", " ", "NBilayer"}], "-", "1"}], "}"}]}], "]"}], ",", 
    "1"}], "]"}], "  ", 
  RowBox[{"(*", 
   RowBox[{"Most", " ", "stupid", " ", "initial", " ", "guess"}], 
   "*)"}]}]], "Input",
 CellLabel->
  "In[173]:=",ExpressionUUID->"d866fd60-ae85-46dc-9255-932825050486"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Vrange", "=", "0.2"}], ";"}]], "Input",
 CellChangeTimes->{{3.730463054976741*^9, 3.730463061807982*^9}},
 CellLabel->
  "In[174]:=",ExpressionUUID->"acb51225-3d15-4766-8265-15174d884a49"],

Cell[BoxData[
 RowBox[{
  RowBox[{"m", "^", "2"}], " ", 
  RowBox[{
   RowBox[{"kUnit", "^", "2"}], " ", "/", 
   RowBox[{"10", "^", "4", "  ", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{
      "This", " ", "is", " ", "a", " ", "unit", " ", "of", " ", "density", 
       " ", "for", " ", "B"}], "=", 
      RowBox[{"0", " ", "calculation"}]}], " ", "*)"}]}]}]}]], "Input",
 CellChangeTimes->{{3.7304632480204687`*^9, 3.730463271271564*^9}},
 CellLabel->
  "In[175]:=",ExpressionUUID->"5650da93-3ee0-44ef-af97-c1db289027d7"],

Cell[BoxData[
 RowBox[{"nbrange", "=", "0.001"}]], "Input",
 CellChangeTimes->{{3.730463107804895*^9, 3.7304631112587442`*^9}, {
  3.730463157723712*^9, 3.730463168126873*^9}},
 CellLabel->
  "In[176]:=",ExpressionUUID->"6391a25d-1738-4dfa-9baa-5f23623d6b04"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DataTableB0", "=", 
   RowBox[{"ParallelTable", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Voltage", ",", 
       RowBox[{"Quiet", "[", 
        RowBox[{"PotentialDensNonlinear", "[", 
         RowBox[{
          RowBox[{"ULinear", "*", "Voltage"}], ",", "0"}], " ", "]"}], 
        "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"Voltage", ",", 
       RowBox[{"-", "Vrange"}], ",", "Vrange", ",", "0.005"}], "}"}]}], 
    "]"}]}], " ", ";"}]], "Input",
 CellChangeTimes->{{3.730463038985037*^9, 3.7304630745358143`*^9}, {
  3.730463186870534*^9, 3.73046320082286*^9}, {3.7304680893267612`*^9, 
  3.730468089950047*^9}, {3.7869151858865213`*^9, 3.786915193152356*^9}},
 CellLabel->
  "In[177]:=",ExpressionUUID->"93868f96-4deb-4884-9de0-c2c8edfb8c8e"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"DataTableB1", "=", 
    RowBox[{"ParallelMap", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"Quiet", "[", 
          RowBox[{"PotentialDensNonlinear", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", "0"}], " ", "]"}], 
          "]"}]}], "}"}], "&"}], ",", "DataTableB0"}], "]"}]}], " ", ";"}], 
  "*)"}]], "Input",
 CellChangeTimes->{
  3.82722715169484*^9, {3.827382024338541*^9, 
   3.827382029673813*^9}},ExpressionUUID->"a9a96965-1242-4962-be76-\
d8b107fe74c1"],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{
   RowBox[{"DataTableB1", "=", 
    RowBox[{"ParallelMap", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"Quiet", "[", 
          RowBox[{"PotentialDensNonlinear1", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", "0"}], " ", "]"}], 
          "]"}]}], "}"}], "&"}], ",", "DataTableB0"}], "]"}]}], " ", 
   ";"}]}]], "Input",
 CellChangeTimes->{
  3.8024395073957367`*^9, 3.802516672887244*^9, {3.827227161022547*^9, 
   3.827227164716743*^9}, {3.827256236000925*^9, 3.827256240243206*^9}},
 CellLabel->
  "In[182]:=",ExpressionUUID->"4e2867da-8802-490c-8ed9-d8f116b7fe56"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DataTableB0", "=", "DataTableB1"}], ";"}]], "Input",
 CellLabel->
  "In[183]:=",ExpressionUUID->"b09440a0-9949-46a1-ae5d-4675de940063"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DataTableB1", "=", 
    RowBox[{"ParallelMap", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"Quiet", "[", 
          RowBox[{"PotentialDensNonlinear2", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}], ",", "0"}], " ", "]"}], 
          "]"}]}], "}"}], "&"}], ",", "DataTableB0"}], "]"}]}], " ", ";"}], 
  " "}]], "Input",
 CellChangeTimes->{{3.730463038985037*^9, 3.7304630745358143`*^9}, {
   3.730463186870534*^9, 3.73046320082286*^9}, {3.7304680893267612`*^9, 
   3.730468089950047*^9}, {3.7869151858865213`*^9, 3.786915193152356*^9}, {
   3.798269949552616*^9, 3.798269951372294*^9}, {3.798274330620742*^9, 
   3.798274332090042*^9}, 3.79835822076791*^9, {3.798360059407419*^9, 
   3.7983601308093777`*^9}, {3.7983601954699507`*^9, 3.798360219705164*^9}, {
   3.798360275988924*^9, 3.798360276547002*^9}, {3.798367561347674*^9, 
   3.798367564243869*^9}, {3.8025300523496437`*^9, 3.8025300533911657`*^9}, {
   3.827065692704525*^9, 3.827065695412225*^9}, {3.827263338007791*^9, 
   3.8272633430301456`*^9}},
 CellLabel->
  "In[184]:=",ExpressionUUID->"450edf26-4bd4-47a4-8cd9-cb8222eaf1ce"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DataTableB0", "=", "DataTableB1"}], ";"}]], "Input",
 CellChangeTimes->{{3.7984877588184977`*^9, 3.798487774287636*^9}, {
  3.827065698380028*^9, 3.8270657009994993`*^9}, {3.8272633467251043`*^9, 
  3.827263353306464*^9}},
 CellLabel->
  "In[185]:=",ExpressionUUID->"88f2c191-660a-497f-8a77-db36c5cac642"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DensityTable", "=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"Plus", "@@", 
          RowBox[{"(", 
           RowBox[{"#", "[", 
            RowBox[{"[", 
             RowBox[{"2", ",", "2"}], "]"}], "]"}], ")"}]}]}], "}"}], "&"}], 
      ",", "DataTableB0"}], "]"}]}], " ", ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{"makes", " ", "a", " ", "table", " ", "of", " ", 
    RowBox[{"{", 
     RowBox[{"Voltage", ",", "TotalDensity"}], "}"}], "  ", "out", " ", "of", 
    " ", "a", " ", "full", " ", "data", " ", "table"}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.716015847970551*^9, 3.716016005079948*^9}, {
   3.716017476700753*^9, 3.7160174839143763`*^9}, 3.716017521378819*^9, {
   3.7304681616586733`*^9, 3.730468161911673*^9}, 3.802674004840218*^9},
 CellLabel->
  "In[186]:=",ExpressionUUID->"e2ceb268-0db8-4835-ae11-a3b713491fb3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PotentialTable", "=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"(", 
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "1"}], "]"}], "]"}], ")"}]}], "}"}], "&"}], ",",
       "DataTableB0"}], "]"}]}], " ", ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{"makes", " ", "a", " ", "table", " ", "of", " ", 
    RowBox[{"{", 
     RowBox[{"Voltage", ",", "Potential"}], "}"}], "  ", "out", " ", "of", 
    " ", "a", " ", "full", " ", "data", " ", "table"}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.716019234403421*^9, 3.716019284539219*^9}, 
   3.716019457061276*^9, {3.730468168529777*^9, 3.7304681688437977`*^9}},
 CellLabel->
  "In[187]:=",ExpressionUUID->"52338ece-0cb2-46af-b50d-3dbb19416990"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DensityData", "=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"(", 
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "2"}], "]"}], "]"}], ")"}]}], "}"}], "&"}], ",",
       "DataTableB0"}], "]"}]}], " ", ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{"makes", " ", "a", " ", "table", " ", "of", " ", 
    RowBox[{"{", 
     RowBox[{"Voltage", ",", 
      RowBox[{"Density", " ", "Distribution"}]}], "}"}], "  ", "out", " ", 
    "of", " ", "a", " ", "full", " ", "data", " ", "table"}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.716104385843472*^9, 3.716104407411427*^9}, {
  3.716104442781435*^9, 3.716104462387595*^9}, {3.730468178947686*^9, 
  3.7304681792188387`*^9}},
 CellLabel->
  "In[188]:=",ExpressionUUID->"bdb3c85d-400f-4ad1-96a1-b1c8ad60408b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"dens", "[", "i", "]"}], "=", 
     RowBox[{
      RowBox[{"ParallelMap", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"Quiet", "[", 
            RowBox[{"FindDensityBand", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", "i"}], "]"}], "]"}]}], 
          "}"}], "&"}], ",", "PotentialTable"}], "]"}], "//", 
      "Interpolation"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{
       RowBox[{"2", " ", "NBilayer"}], " ", "-", "1"}], ",", " ", 
      RowBox[{
       RowBox[{"2", " ", "NBilayer"}], "+", "2"}]}], "}"}]}], "]"}], " ", 
  ";"}]], "Input",
 CellChangeTimes->{{3.80055004579385*^9, 3.8005500790761147`*^9}, {
  3.800550116491981*^9, 3.800550117269279*^9}, {3.8005502175146217`*^9, 
  3.8005503152250423`*^9}, {3.8005510814393053`*^9, 3.8005510826443233`*^9}, {
  3.8005511627773113`*^9, 3.800551165757821*^9}, {3.800551417885126*^9, 
  3.80055148655002*^9}, {3.800551534924768*^9, 3.800551542784012*^9}},
 CellLabel->
  "In[189]:=",ExpressionUUID->"fff5092f-91fb-4c63-bc47-5fc367e68f89"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"DataTable", "=", "DataTable1"}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.717178966497897*^9, 3.717178976553566*^9}, {
  3.719560394528852*^9, 3.719560397152721*^9}},
 CellLabel->
  "In[190]:=",ExpressionUUID->"de89712c-4941-42ab-87f0-b971cad051f0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Save", "[", 
   RowBox[{
    RowBox[{"path", "<>", "\"\<DensityTableeps25Attempt10\>\""}], ",", 
    RowBox[{"{", 
     RowBox[{
     "DataTableB0", ",", "DensityData", ",", "PotentialTable", ",", 
      "DensityTable", ",", "dens"}], "}"}]}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.7160181716688747`*^9, 3.716018219178328*^9}, {
   3.7160218354636593`*^9, 3.7160218390856733`*^9}, {3.716114816929201*^9, 
   3.71611483340906*^9}, {3.719514057940504*^9, 3.719514061344092*^9}, {
   3.730468187495528*^9, 3.730468196849134*^9}, {3.767703736213645*^9, 
   3.767703742368639*^9}, {3.786914130356039*^9, 3.786914142104463*^9}, {
   3.7869614511127577`*^9, 3.78696145419261*^9}, {3.789290187312323*^9, 
   3.789290190550281*^9}, {3.789414333799567*^9, 3.7894143451117887`*^9}, {
   3.8023333068340883`*^9, 3.8023333073795843`*^9}, {3.802350825663007*^9, 
   3.8023508333469687`*^9}, {3.8024494465847797`*^9, 3.802449449068754*^9}, {
   3.8024561329748173`*^9, 3.802456133783362*^9}, {3.802456954007518*^9, 
   3.802456956654771*^9}, {3.802674027088848*^9, 3.8026740302518377`*^9}, {
   3.8026848399142103`*^9, 3.802684840114477*^9}, 3.802691959167458*^9, {
   3.8026983392862177`*^9, 3.802698339462784*^9}, {3.8027123762475433`*^9, 
   3.802712377073948*^9}, {3.802721545514021*^9, 3.802721545626424*^9}, {
   3.80274824614953*^9, 3.8027482469208717`*^9}, {3.802767254985318*^9, 
   3.8027672551496077`*^9}, {3.827065642518487*^9, 3.827065650930497*^9}, {
   3.8270738803436823`*^9, 3.827073883891666*^9}, {3.827122621045208*^9, 
   3.827122637488553*^9}, {3.827159792222226*^9, 3.827159792793956*^9}, {
   3.827175315015296*^9, 3.827175321550208*^9}, {3.82719680552883*^9, 
   3.8271968060384207`*^9}, {3.827208845297511*^9, 3.827208845773572*^9}, {
   3.827220775734045*^9, 3.827220776054184*^9}, {3.827238261044147*^9, 
   3.827238261273562*^9}, {3.8272877495363607`*^9, 3.827287750021247*^9}},
 CellLabel->
  "In[191]:=",ExpressionUUID->"7455c5ca-2c44-4c4f-b056-5d0d37b56fd9"],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{
   RowBox[{
    RowBox[{"<<", 
     RowBox[{"(", 
      RowBox[{"path", "<>", "\"\<DensityTableeps25Attempt10\>\""}], ")"}]}], 
    ";"}], "  ", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"<<", 
      RowBox[{"(", 
       RowBox[{"path", "<>", "\"\<DensityTableeps13\>\""}], ")"}]}], ";"}], 
    "*)"}], " ", 
   RowBox[{
    RowBox[{"Vrange", "=", "0.2"}], ";"}]}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAGIQzfm217LhzGvHvEUmjiC6ayKPO4hmu70BTD9g/bW6
EUgvEg9dB6Jbjs1/BKIl9rY9AdElne/ZFgHphxc+g+mW6C0iIJrJe5UoiGZV
e3T5IJC+kPwTTDP9lbR/BaRP9BWD6TlL1psqn33teL38HJguL/MsrwTS5xb7
gGk+y5WrDwLpFu0N60D0VI9Hpp+BtIWChRmI/pKRYaV+DuhunSlgWsxvtyeI
Pv/9sReIFmH/UgaiV8cwlYPocwwVYlPPv3b8t/I+mH50s9IURHc4dIBp1l9t
jiB62r4QVxD9QSnQPk7yjaPuq/dgWmvWiUgQ3erQGAWidxg6H2/0fuN4QvPD
SRBtYSQtkBDyxvHNcx0wraOtfGwGkNbacwZMX9ll9q/6wxvHA/N0GGqANADT
Fs6l
  "],
 CellLabel->
  "In[217]:=",ExpressionUUID->"015a9733-27fc-4c7d-a5d1-c6acfbe82764"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{"<<", 
    RowBox[{"(", 
     RowBox[{"path", "<>", "\"\<DensityTableeps14Gamma3CorrectSign20\>\""}], 
     ")"}]}], ";"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.7713968574797077`*^9, 3.771396860457637*^9}, {
  3.7717279728366833`*^9, 3.7717279744295607`*^9}, {3.786961459714004*^9, 
  3.7869614620803213`*^9}},
 CellLabel->
  "In[193]:=",ExpressionUUID->"55864ca2-304a-4456-b64a-3e44018848e8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DensityInterp", "=", 
   RowBox[{"Interpolation", "[", 
    RowBox[{"DensityTable", ",", 
     RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.7160148372952147`*^9, 3.7160148572389307`*^9}, {
   3.716017803722312*^9, 3.7160178218577538`*^9}, 3.716021718238318*^9, 
   3.716021769854332*^9},
 CellLabel->
  "In[194]:=",ExpressionUUID->"9b451fc8-0657-466b-b6f5-75e83de13767"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Dens2V", "[", "dens_", "]"}], ":=", 
    RowBox[{"V", "/.", 
     RowBox[{"FindRoot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"m", "^", "2"}], " ", 
         RowBox[{"kUnit", "^", "2"}], "  ", 
         RowBox[{"DensityInterp", "[", "V", "]"}]}], "-", 
        RowBox[{"dens", " ", 
         RowBox[{"10", "^", "16"}]}]}], ",", 
       RowBox[{"{", 
        RowBox[{"V", ",", "0"}], "}"}]}], "]"}]}]}], ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{"in", " ", "units", " ", "of", " ", 
    RowBox[{"10", "^", "12"}]}], " ", "*)"}], " "}]], "Input",
 CellChangeTimes->{{3.718016612612728*^9, 3.718016699619021*^9}, {
  3.718016803588591*^9, 3.7180168360213623`*^9}, {3.718016923444035*^9, 
  3.7180169284036818`*^9}},
 CellLabel->
  "In[195]:=",ExpressionUUID->"f7084978-6622-435a-8b47-0c86726478ea"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "Smooth", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Smooth", "[", 
    RowBox[{"f_", ",", 
     RowBox[{"x_", "?", "NumericQ"}], ",", 
     RowBox[{"delta_", "?", "NumericQ"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"1", "/", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Sqrt", "[", "\[Pi]", "]"}], 
       RowBox[{"Erf", "[", "3", "]"}], "delta"}], ")"}]}], " ", 
    RowBox[{"NIntegrate", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"x", "+", "x1"}], "]"}], " ", "*", 
       RowBox[{"Exp", "[", 
        RowBox[{"-", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"x1", "/", "delta"}], ")"}], "^", "2"}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"x1", ",", 
        RowBox[{
         RowBox[{"-", "3"}], " ", "delta"}], ",", 
        RowBox[{"3", " ", "delta"}]}], "}"}]}], "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7172261539470882`*^9, 3.717226328720024*^9}, {
  3.717226371768825*^9, 3.717226408047962*^9}, {3.717226561960862*^9, 
  3.7172265831849318`*^9}},
 CellLabel->
  "In[196]:=",ExpressionUUID->"8ccce1e8-a436-4066-b3b1-6c6287029ef1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DensityInterpS", "=", 
   RowBox[{"Interpolation", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"V", ",", 
         RowBox[{"Smooth", "[", 
          RowBox[{"DensityInterp", ",", "V", ",", "0.010"}], "]"}]}], "}"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"V", ",", 
         RowBox[{"-", "Vrange"}], ",", "Vrange", ",", "0.005"}], "}"}]}], 
      "]"}], ",", 
     RowBox[{"InterpolationOrder", "\[Rule]", "2"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.717226056740629*^9, 3.717226181703665*^9}, {
   3.717226614889003*^9, 3.7172266214802847`*^9}, {3.717226680288837*^9, 
   3.717226719112298*^9}, {3.717226757857601*^9, 3.7172267579760723`*^9}, {
   3.717236131913772*^9, 3.717236132425129*^9}, {3.7180150680509863`*^9, 
   3.7180150681701937`*^9}, {3.718015148283619*^9, 3.7180151483696117`*^9}, {
   3.7180153586112623`*^9, 3.718015358698515*^9}, 3.7195588738558407`*^9, {
   3.719559391264229*^9, 3.7195594077916107`*^9}, {3.719598099538275*^9, 
   3.7195981004081182`*^9}, {3.719737279950881*^9, 3.719737280062467*^9}, {
   3.7313142025931273`*^9, 3.7313142031358957`*^9}, {3.7314298424523907`*^9, 
   3.7314298429266644`*^9}, {3.731507357308544*^9, 3.731507376693925*^9}, {
   3.731606554320065*^9, 3.73160655507294*^9}, {3.7319625425887814`*^9, 
   3.731962545720784*^9}, 3.731962609242687*^9, {3.731962671055725*^9, 
   3.731962671831134*^9}, {3.7319628685571003`*^9, 3.731962870201682*^9}, {
   3.732712166947247*^9, 3.732712167416099*^9}},
 CellLabel->
  "In[198]:=",ExpressionUUID->"1fb19a4d-6932-4033-ae3a-a661cb976cb3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Do", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"densS", "[", "i", "]"}], "=", 
     RowBox[{"Interpolation", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"V", ",", 
           RowBox[{"Smooth", "[", 
            RowBox[{
             RowBox[{"dens", "[", "i", "]"}], ",", "V", ",", "0.010"}], 
            "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"V", ",", 
           RowBox[{"-", "Vrange"}], ",", "Vrange", ",", "0.005"}], "}"}]}], 
        "]"}], ",", 
       RowBox[{"InterpolationOrder", "\[Rule]", "2"}]}], "]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{
       RowBox[{"2", " ", "NBilayer"}], " ", "-", "1"}], ",", " ", 
      RowBox[{
       RowBox[{"2", " ", "NBilayer"}], "+", "2"}]}], "}"}]}], "]"}], " ", 
  ";"}]], "Input",
 CellChangeTimes->{{3.800558387162208*^9, 3.800558448302143*^9}},
 CellLabel->
  "In[199]:=",ExpressionUUID->"593232fd-7013-4b14-8d2d-465f6a465dee"],

Cell[BoxData[
 RowBox[{"plotdens1", "=", 
  RowBox[{"Plot", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"m", "^", "2"}], " ", 
     RowBox[{
      RowBox[{"kUnit", "^", "2"}], " ", "/", 
      RowBox[{"10", "^", "4"}]}], " ", 
     RowBox[{"DensityInterp", "[", 
      RowBox[{"-", "V"}], "]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"V", ",", 
      RowBox[{"-", "Vrange"}], ",", "Vrange"}], "}"}], ",", 
    RowBox[{"Frame", "\[Rule]", "True"}], ",", 
    RowBox[{"FrameLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
      "\"\<V,V\>\"", ",", 
       "\"\<\!\(\*SubscriptBox[\(n\), \
\(total\)]\),\!\(\*SuperscriptBox[\(cm\), \(-2\)]\)\>\""}], "}"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.716017547197344*^9, 3.71601756599336*^9}, {
   3.716017625539857*^9, 3.7160176265377493`*^9}, {3.7160180725555162`*^9, 
   3.716018159322894*^9}, {3.716099792456079*^9, 3.716099794224812*^9}, {
   3.716114845089385*^9, 3.716114852018692*^9}, 3.7172264924737453`*^9, 
   3.717336209528433*^9},
 CellLabel->
  "In[200]:=",ExpressionUUID->"38177dbb-f60f-45ae-9cde-f79fc77e0e28"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"path", "<>", "\"\<plotdens1.pdf\>\""}], ",", "plotdens1"}], 
   "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.7160181617880983`*^9, 3.716018166482016*^9}, {
  3.7160182577389383`*^9, 3.716018275722131*^9}},
 CellLabel->
  "In[201]:=",ExpressionUUID->"5fcca4ec-8016-4285-862e-89eb36e12e36"],

Cell[BoxData[
 RowBox[{"plotDOS1", "=", 
  RowBox[{"ParametricPlot", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"m", "^", "2"}], " ", 
       RowBox[{
        RowBox[{"kUnit", "^", "2"}], " ", "/", 
        RowBox[{"10", "^", "4"}]}], "  ", 
       RowBox[{
        RowBox[{"DensityInterpS", "[", "V", "]"}], "/", 
        RowBox[{"10", "^", "12"}]}]}], ",", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"m", "^", "2"}]}], " ", 
       RowBox[{
        RowBox[{"kUnit", "^", "2"}], " ", "/", 
        RowBox[{"10", "^", "4"}]}], " ", 
       RowBox[{
        RowBox[{
         RowBox[{"DensityInterpS", "'"}], "[", "V", "]"}], "/", 
        RowBox[{"10", "^", "12"}]}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"V", ",", 
      RowBox[{"-", "0.2"}], ",", "0.2"}], "}"}], ",", 
    RowBox[{"Frame", "\[Rule]", "True"}], ",", 
    RowBox[{"FrameLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
      "\"\<\!\(\*SubscriptBox[\(n\), \(total\)]\), \
\!\(\*SuperscriptBox[\(10\), \(12\)]\)\!\(\*SuperscriptBox[\(cm\), \
\(-2\)]\)\>\"", ",", 
       "\"\<\!\(\*SubscriptBox[\(dn\), \(total\)]\)/dV, \!\(\*SuperscriptBox[\
\(10\), \(\(12\)\(\\\ \)\)]\)\!\(\*SuperscriptBox[\(cm\), \
\(-2\)]\)\!\(\*SuperscriptBox[\(eV\), \(-1\)]\)\>\""}], "}"}]}], ",", 
    RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "6"}], ",", "6"}], "}"}], ",", "All"}], "}"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.716104015054196*^9, 3.716104078235546*^9}, {
   3.716114863074574*^9, 3.716114869834041*^9}, {3.716698811105061*^9, 
   3.716698816678032*^9}, {3.716781974306192*^9, 3.716781983657826*^9}, {
   3.717226638714231*^9, 3.7172266419856997`*^9}, 3.7173361821774054`*^9, 
   3.7173362187614393`*^9, {3.717405064888136*^9, 3.717405068810339*^9}, {
   3.7180150417484922`*^9, 3.718015057586043*^9}, {3.719559552801203*^9, 
   3.719559574712511*^9}, {3.7195980649335213`*^9, 3.7195980689184723`*^9}, {
   3.719646867643446*^9, 3.719646871786422*^9}},
 CellLabel->
  "In[202]:=",ExpressionUUID->"76e12f14-032e-49ec-97b5-2440fc27bdc8"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Comparison with experiment", "Subsubsection",
 CellChangeTimes->{{3.731094889131208*^9, 
  3.731094896775255*^9}},ExpressionUUID->"efd1eaac-9bd1-427d-a2bb-\
c7fde3ebc7f2"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Conversion", " ", "to", " ", "capacitance", " ", 
   RowBox[{"units", ":"}]}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.731094942098618*^9, 3.731094954226795*^9}},
 CellLabel->
  "In[203]:=",ExpressionUUID->"d4b50d6a-4b8a-468a-bd2b-3339832e598f"],

Cell[BoxData[
 RowBox[{"ToCapacitance", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"e", "^", "2"}], " ", 
    RowBox[{"10", "^", "12"}], " ", 
    RowBox[{"cm", "^", 
     RowBox[{"-", "2"}]}], " ", 
    RowBox[{
     RowBox[{"eV", "^", 
      RowBox[{"-", "1"}]}], "/", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Co", "/", "V"}], "/", 
       RowBox[{"m", "^", "2"}]}], ")"}]}]}], "//.", "Valuesh"}]}]], "Input",
 CellChangeTimes->{{3.731094971555529*^9, 3.731095014281459*^9}, {
  3.731095265132309*^9, 3.7310953020984507`*^9}},
 CellLabel->
  "In[204]:=",ExpressionUUID->"32779f9b-64af-4f2d-8e92-8403c69089b6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "Smooth", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Smooth", "[", 
    RowBox[{"f_", ",", 
     RowBox[{"x_", "?", "NumericQ"}], ",", 
     RowBox[{"delta_", "?", "NumericQ"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"1", "/", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Sqrt", "[", "\[Pi]", "]"}], 
       RowBox[{"Erf", "[", "3", "]"}], "delta"}], ")"}]}], " ", 
    RowBox[{"NIntegrate", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"x", "+", "x1"}], "]"}], " ", "*", 
       RowBox[{"Exp", "[", 
        RowBox[{"-", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"x1", "/", "delta"}], ")"}], "^", "2"}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"x1", ",", 
        RowBox[{
         RowBox[{"-", "3"}], " ", "delta"}], ",", 
        RowBox[{"3", " ", "delta"}]}], "}"}]}], "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7172261539470882`*^9, 3.717226328720024*^9}, {
  3.717226371768825*^9, 3.717226408047962*^9}, {3.717226561960862*^9, 
  3.7172265831849318`*^9}},
 CellLabel->
  "In[205]:=",ExpressionUUID->"497948ad-44fc-478c-a0e4-0d31a166827c"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Capacitance", " ", "per", " ", "unit", " ", "area", " ", 
   RowBox[{"unit", ":"}]}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.731095171441379*^9, 3.7310951840735083`*^9}, {
  3.731095219268196*^9, 3.731095222398726*^9}},
 CellLabel->
  "In[207]:=",ExpressionUUID->"346f6c48-faec-44f6-837e-ce6c82a6317e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Co", "/", "V"}], "/", 
   RowBox[{"m", "^", "2"}]}], "//.", "Valuesh"}]], "Input",
 CellChangeTimes->{{3.731095190716476*^9, 3.731095228595316*^9}},
 CellLabel->
  "In[208]:=",ExpressionUUID->"915e4098-355c-48c2-9807-2528052bb0e7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Data1", "=", 
   RowBox[{
    RowBox[{"Import", "[", 
     RowBox[{"path", "<>", "\"\<Sample1c.xls\>\""}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"1", ",", 
      RowBox[{"150", ";;", "760"}]}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.731094933483202*^9, 3.7310949354549313`*^9}, {
  3.7310961520801897`*^9, 3.731096162885549*^9}, {3.731096213566242*^9, 
  3.7310962903686447`*^9}, {3.7310980420967417`*^9, 3.731098108387217*^9}},
 CellLabel->
  "In[209]:=",ExpressionUUID->"cabe12a6-71f1-493f-9c65-d7f27810dbf1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Data2", "=", 
   RowBox[{
    RowBox[{"Import", "[", 
     RowBox[{"path", "<>", "\"\<Sample2c.xls\>\""}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.731096492138302*^9, 3.731096494697126*^9}},
 CellLabel->
  "In[210]:=",ExpressionUUID->"5758717a-c149-4abf-8a6f-acaad110e36c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Data3", "=", 
   RowBox[{
    RowBox[{"Import", "[", 
     RowBox[{"path", "<>", "\"\<Sample3c.xls\>\""}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.731096502266756*^9, 3.731096505124527*^9}},
 CellLabel->
  "In[211]:=",ExpressionUUID->"0970a56f-4c9f-4340-88b9-c34c8946f2f7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Data4", "=", 
   RowBox[{
    RowBox[{"Import", "[", 
     RowBox[{"path", "<>", "\"\<Sample4c.xls\>\""}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.731096510992531*^9, 3.7310965132484913`*^9}},
 CellLabel->
  "In[212]:=",ExpressionUUID->"597d1753-49e1-4a4b-8116-0bc98175d65c"],

Cell[BoxData[
 RowBox[{"Length", "[", "Data1", "]"}]], "Input",
 CellChangeTimes->{{3.731098048955648*^9, 3.731098053611133*^9}},
 CellLabel->
  "In[213]:=",ExpressionUUID->"7ec20cc9-bf99-4c39-9b42-3041cdc5cf58"],

Cell[BoxData[
 RowBox[{"plDat", "=", 
  RowBox[{"ListPlot", "[", 
   RowBox[{"{", 
    RowBox[{"Data1", ",", "Data2", ",", "Data3", ",", "Data4"}], "}"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.731096309330658*^9, 3.731096315685958*^9}, {
  3.731096477219305*^9, 3.731096481120036*^9}, {3.731096517776164*^9, 
  3.731096532964161*^9}},
 CellLabel->
  "In[214]:=",ExpressionUUID->"5df856c1-a352-4208-b655-9f9edf4b3fbe"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Example plot A", "Subsubsection",
 CellChangeTimes->{{3.73555446724365*^9, 3.735554471456346*^9}, {
  3.735554547819016*^9, 
  3.735554548324712*^9}},ExpressionUUID->"5ed24085-0c71-42b6-a228-\
0e362efd3c4b"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{"<<", 
    RowBox[{"(", 
     RowBox[{"path", "<>", "\"\<DensityTableeps14Gamma3CorrectSign20\>\""}], 
     ")"}]}], ";"}], "  ", "*)"}]], "Input",
 CellChangeTimes->{{3.735553269338204*^9, 3.735553297147026*^9}, {
  3.735554672182403*^9, 3.735554674881996*^9}, {3.7682918888243*^9, 
  3.768291894593141*^9}, {3.768292154283876*^9, 3.768292178399539*^9}, {
  3.768895644539681*^9, 3.768895644964336*^9}, {3.7869141824297867`*^9, 
  3.786914185462977*^9}},
 CellLabel->
  "In[215]:=",ExpressionUUID->"2b63f5f9-e8be-4753-a470-039a38d02ab4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Vrange", "=", "0.2"}], ";"}]], "Input",
 CellChangeTimes->{{3.730463054976741*^9, 3.730463061807982*^9}},
 CellLabel->
  "In[216]:=",ExpressionUUID->"fa429598-c7fd-4f75-a9bd-b48033641e1c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"m", "^", "2"}], " ", 
  RowBox[{
   RowBox[{"kUnit", "^", "2"}], " ", "/", 
   RowBox[{"10", "^", "4", "  ", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{
      "This", " ", "is", " ", "a", " ", "unit", " ", "of", " ", "density", 
       " ", "for", " ", "B"}], "=", 
      RowBox[{"0", " ", "calculation"}]}], " ", "*)"}]}]}]}]], "Input",
 CellChangeTimes->{{3.7304632480204687`*^9, 3.730463271271564*^9}},
 CellLabel->
  "In[217]:=",ExpressionUUID->"5b2f124c-99de-4041-8389-f1954f47dbec"],

Cell[BoxData[
 RowBox[{"nbrange", "=", "0.001"}]], "Input",
 CellChangeTimes->{{3.730463107804895*^9, 3.7304631112587442`*^9}, {
  3.730463157723712*^9, 3.730463168126873*^9}},
 CellLabel->
  "In[218]:=",ExpressionUUID->"c7e78ada-6468-42f1-ae52-e8c4c98d52f2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{"Smooth", ",", "c", ",", "n"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Smooth", "[", 
    RowBox[{"f_", ",", 
     RowBox[{"x_", "?", "NumericQ"}], ",", 
     RowBox[{"delta_", "?", "NumericQ"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"1", "/", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Sqrt", "[", "\[Pi]", "]"}], 
       RowBox[{"Erf", "[", "3", "]"}], "delta"}], ")"}]}], " ", 
    RowBox[{"NIntegrate", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"x", "+", "x1"}], "]"}], " ", "*", 
       RowBox[{"Exp", "[", 
        RowBox[{"-", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"x1", "/", "delta"}], ")"}], "^", "2"}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"x1", ",", 
        RowBox[{
         RowBox[{"-", "3"}], " ", "delta"}], ",", 
        RowBox[{"3", " ", "delta"}]}], "}"}]}], "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7172261539470882`*^9, 3.717226328720024*^9}, {
  3.717226371768825*^9, 3.717226408047962*^9}, {3.717226561960862*^9, 
  3.7172265831849318`*^9}, {3.787078122411169*^9, 3.787078122565825*^9}, {
  3.787078227066625*^9, 3.787078227297138*^9}},
 CellLabel->
  "In[219]:=",ExpressionUUID->"192c1118-d3bf-4ca7-9b5b-6524f791d7a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DensityInterp", "=", 
   RowBox[{"Interpolation", "[", 
    RowBox[{"DensityTable", ",", 
     RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.7160148372952147`*^9, 3.7160148572389307`*^9}, {
   3.716017803722312*^9, 3.7160178218577538`*^9}, 3.716021718238318*^9, 
   3.716021769854332*^9},
 CellLabel->
  "In[221]:=",ExpressionUUID->"4f8cb151-c690-4b5d-b29f-36484001053f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Dens2V", "[", "dens_", "]"}], ":=", 
    RowBox[{"V", "/.", 
     RowBox[{"FindRoot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"m", "^", "2"}], " ", 
         RowBox[{"kUnit", "^", "2"}], "  ", 
         RowBox[{"DensityInterp", "[", "V", "]"}]}], "-", 
        RowBox[{"dens", " ", 
         RowBox[{"10", "^", "16"}]}]}], ",", 
       RowBox[{"{", 
        RowBox[{"V", ",", "0"}], "}"}]}], "]"}]}]}], ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{"in", " ", "units", " ", "of", " ", 
    RowBox[{"10", "^", "12"}]}], " ", "*)"}], " "}]], "Input",
 CellChangeTimes->{{3.718016612612728*^9, 3.718016699619021*^9}, {
  3.718016803588591*^9, 3.7180168360213623`*^9}, {3.718016923444035*^9, 
  3.7180169284036818`*^9}},
 CellLabel->
  "In[222]:=",ExpressionUUID->"53ff7f9f-fdcf-4e7e-bde4-250c15eab455"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DensityInterpS", "=", 
   RowBox[{"Interpolation", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"V", ",", 
         RowBox[{"Smooth", "[", 
          RowBox[{"DensityInterp", ",", "V", ",", "0.01"}], "]"}]}], "}"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"V", ",", 
         RowBox[{"-", "Vrange"}], ",", "Vrange", ",", "0.005"}], "}"}]}], 
      "]"}], ",", 
     RowBox[{"InterpolationOrder", "\[Rule]", "2"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.717226056740629*^9, 3.717226181703665*^9}, {
   3.717226614889003*^9, 3.7172266214802847`*^9}, {3.717226680288837*^9, 
   3.717226719112298*^9}, {3.717226757857601*^9, 3.7172267579760723`*^9}, {
   3.717236131913772*^9, 3.717236132425129*^9}, {3.7180150680509863`*^9, 
   3.7180150681701937`*^9}, {3.718015148283619*^9, 3.7180151483696117`*^9}, {
   3.7180153586112623`*^9, 3.718015358698515*^9}, 3.7195588738558407`*^9, {
   3.719559391264229*^9, 3.7195594077916107`*^9}, {3.719598099538275*^9, 
   3.7195981004081182`*^9}, {3.719737279950881*^9, 3.719737280062467*^9}, {
   3.7313142025931273`*^9, 3.7313142031358957`*^9}, {3.7314298424523907`*^9, 
   3.7314298429266644`*^9}, {3.731507357308544*^9, 3.731507376693925*^9}, {
   3.731606554320065*^9, 3.73160655507294*^9}, {3.7319625425887814`*^9, 
   3.731962545720784*^9}, 3.731962609242687*^9, {3.731962671055725*^9, 
   3.731962671831134*^9}, {3.7319628685571003`*^9, 3.731962870201682*^9}, {
   3.732712166947247*^9, 3.732712167416099*^9}, {3.802520722637372*^9, 
   3.802520753154532*^9}, {3.802545690825457*^9, 3.802545691187457*^9}, {
   3.802545744397481*^9, 3.802545744931292*^9}, {3.802757160274294*^9, 
   3.8027571615768557`*^9}},
 CellLabel->
  "In[223]:=",ExpressionUUID->"30aa2fa0-da6c-421b-99a5-988aee72ba68"],

Cell[BoxData[
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"m", "^", "2"}], " ", 
    RowBox[{
     RowBox[{"kUnit", "^", "2"}], " ", "/", 
     RowBox[{"10", "^", "4"}]}], "  ", 
    RowBox[{
     RowBox[{"DensityInterpS", "[", 
      RowBox[{"-", "V"}], "]"}], "/", 
     RowBox[{"10", "^", "12"}]}]}], ",", 
   RowBox[{"{", 
    RowBox[{"V", ",", 
     RowBox[{"-", "Vrange"}], ",", "Vrange"}], "}"}], ",", 
   RowBox[{"AxesLabel", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
     "\"\<V (V)\>\"", ",", "  ", 
      "\"\<n (\!\(\*SuperscriptBox[\(10\), \(12\)]\) \
\!\(\*SuperscriptBox[\(cm\), \(-2\)]\))\>\""}], "}"}]}]}], "]"}]], "Input",
 CellChangeTimes->{{3.751285657930779*^9, 3.751285706160709*^9}, {
  3.751285809527342*^9, 3.7512858201282*^9}, {3.7514486631805773`*^9, 
  3.7514487039978943`*^9}},
 CellLabel->
  "In[224]:=",ExpressionUUID->"e92fcdfa-522b-4de0-b513-ef4b5808953c"],

Cell[BoxData[
 RowBox[{"densityData", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"V", ",", 
      RowBox[{
       RowBox[{"m", "^", "2"}], " ", 
       RowBox[{
        RowBox[{"kUnit", "^", "2"}], " ", "/", 
        RowBox[{"10", "^", "4"}]}], "  ", 
       RowBox[{
        RowBox[{"DensityInterpS", "[", 
         RowBox[{"-", "V"}], "]"}], "/", 
        RowBox[{"10", "^", "12"}]}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"V", ",", 
      RowBox[{"-", "Vrange"}], ",", "Vrange", ",", "0.0025"}], "}"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7512858505176067`*^9, 3.751285896956396*^9}},
 CellLabel->
  "In[225]:=",ExpressionUUID->"59614ef2-d15c-47dd-919e-ddaab12d5bc9"],

Cell[BoxData[
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{"path", "<>", "\"\<V-Dens.txt\>\""}], ",", "densityData", ",", 
   "\"\<Table\>\""}], "]"}]], "Input",
 CellChangeTimes->{{3.751285908746089*^9, 3.751285942960888*^9}},
 CellLabel->
  "In[226]:=",ExpressionUUID->"18fba55a-95b3-432a-95e6-6ba783deb459"],

Cell[BoxData[
 RowBox[{
  RowBox[{"densityshift", "=", 
   RowBox[{"-", "0.3"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7327121192547827`*^9, 3.732712150406932*^9}, {
   3.7327122176333523`*^9, 3.73271224508823*^9}, {3.802520620162137*^9, 
   3.802520666298101*^9}, {3.8025298911082687`*^9, 3.8025298916636963`*^9}, 
   3.802545593909212*^9, 3.802545629437767*^9, 3.802691047400312*^9, 
   3.827319393644109*^9},
 CellLabel->
  "In[227]:=",ExpressionUUID->"e82a0814-290a-490e-b7f2-012516c3e831"],

Cell[BoxData[
 RowBox[{"thData", "=", 
  RowBox[{"Interpolation", "[", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"m", "^", "2"}], " ", 
         RowBox[{
          RowBox[{"kUnit", "^", "2"}], " ", "/", 
          RowBox[{"10", "^", "4"}]}], "  ", 
         RowBox[{
          RowBox[{"DensityInterpS", "[", "V", "]"}], "/", 
          RowBox[{"10", "^", "12"}]}]}], "-", "densityshift"}], ",", 
       RowBox[{
        RowBox[{"-", "1"}], "/", 
        RowBox[{"(", 
         RowBox[{"ToCapacitance", " ", 
          RowBox[{"m", "^", "2"}], " ", 
          RowBox[{
           RowBox[{"kUnit", "^", "2"}], " ", "/", 
           RowBox[{"10", "^", "4"}]}], " ", 
          RowBox[{
           RowBox[{
            RowBox[{"DensityInterpS", "'"}], "[", "V", "]"}], "/", 
           RowBox[{"10", "^", "12"}]}]}], ")"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"V", ",", 
       RowBox[{"-", "0.2"}], ",", "0.2", ",", "0.001"}], "}"}]}], "]"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.731097880433528*^9, 3.7310979294434357`*^9}, {
  3.732712108028077*^9, 3.73271211675491*^9}},
 CellLabel->
  "In[228]:=",ExpressionUUID->"ca1b5ffb-51f1-4d01-a8b8-ba2a4e0ace1f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"thDatat", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"m", "^", "2"}], " ", 
         RowBox[{
          RowBox[{"kUnit", "^", "2"}], " ", "/", 
          RowBox[{"10", "^", "4"}]}], "  ", 
         RowBox[{
          RowBox[{"DensityInterpS", "[", "V", "]"}], "/", 
          RowBox[{"10", "^", "12"}]}]}], "-", "densityshift"}], ",", 
       RowBox[{
        RowBox[{"-", "1"}], "/", 
        RowBox[{"(", 
         RowBox[{"ToCapacitance", " ", 
          RowBox[{"m", "^", "2"}], " ", 
          RowBox[{
           RowBox[{"kUnit", "^", "2"}], " ", "/", 
           RowBox[{"10", "^", "4"}]}], " ", 
          RowBox[{
           RowBox[{
            RowBox[{"DensityInterpS", "'"}], "[", "V", "]"}], "/", 
           RowBox[{"10", "^", "12"}]}]}], ")"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"V", ",", 
       RowBox[{"-", "0.2"}], ",", "0.2", ",", "0.001"}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.800561517932019*^9, 3.8005615251453323`*^9}},
 CellLabel->
  "In[229]:=",ExpressionUUID->"73c132c1-9a9a-4877-8e23-43033deec2d6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"thData1", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"m", "^", "2"}], " ", 
         RowBox[{
          RowBox[{"kUnit", "^", "2"}], " ", "/", 
          RowBox[{"10", "^", "4"}]}], "  ", 
         RowBox[{
          RowBox[{"DensityInterpS", "[", "V", "]"}], "/", 
          RowBox[{"10", "^", "12"}]}]}], "-", "densityshift"}], ",", 
       RowBox[{
        RowBox[{"-", "1"}], "/", 
        RowBox[{"(", 
         RowBox[{"ToCapacitance", " ", 
          RowBox[{"m", "^", "2"}], " ", 
          RowBox[{
           RowBox[{"kUnit", "^", "2"}], " ", "/", 
           RowBox[{"10", "^", "4"}]}], " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"dens", "[", "19", "]"}], "'"}], "[", "V", "]"}], "/", 
           RowBox[{"10", "^", "12"}]}]}], ")"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"V", ",", 
       RowBox[{"-", "0.2"}], ",", "0.2", ",", "0.001"}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.800561166060418*^9, 3.8005611846037893`*^9}, {
   3.800561532412839*^9, 3.800561536221807*^9}, 3.800561580353812*^9},
 CellLabel->
  "In[230]:=",ExpressionUUID->"54f2fdeb-0060-4b4b-bb88-22dfe98c68e4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"thData2", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"m", "^", "2"}], " ", 
         RowBox[{
          RowBox[{"kUnit", "^", "2"}], " ", "/", 
          RowBox[{"10", "^", "4"}]}], "  ", 
         RowBox[{
          RowBox[{"DensityInterpS", "[", "V", "]"}], "/", 
          RowBox[{"10", "^", "12"}]}]}], "-", "densityshift"}], ",", 
       RowBox[{
        RowBox[{"-", "1"}], "/", 
        RowBox[{"(", 
         RowBox[{"ToCapacitance", " ", 
          RowBox[{"m", "^", "2"}], " ", 
          RowBox[{
           RowBox[{"kUnit", "^", "2"}], " ", "/", 
           RowBox[{"10", "^", "4"}]}], " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"dens", "[", "20", "]"}], "'"}], "[", "V", "]"}], "/", 
           RowBox[{"10", "^", "12"}]}]}], ")"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"V", ",", 
       RowBox[{"-", "0.2"}], ",", "0.2", ",", "0.001"}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.800561204366673*^9, 3.8005612097933807`*^9}, {
   3.800561541895446*^9, 3.800561546904695*^9}, 3.8005615774023657`*^9},
 CellLabel->
  "In[231]:=",ExpressionUUID->"26459371-c727-4cda-b88f-435b2a9b4cbd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"thData3", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"m", "^", "2"}], " ", 
         RowBox[{
          RowBox[{"kUnit", "^", "2"}], " ", "/", 
          RowBox[{"10", "^", "4"}]}], "  ", 
         RowBox[{
          RowBox[{"DensityInterpS", "[", "V", "]"}], "/", 
          RowBox[{"10", "^", "12"}]}]}], "-", "densityshift"}], ",", 
       RowBox[{
        RowBox[{"-", "1"}], "/", 
        RowBox[{"(", 
         RowBox[{"ToCapacitance", " ", 
          RowBox[{"m", "^", "2"}], " ", 
          RowBox[{
           RowBox[{"kUnit", "^", "2"}], " ", "/", 
           RowBox[{"10", "^", "4"}]}], " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"dens", "[", "21", "]"}], "'"}], "[", "V", "]"}], "/", 
           RowBox[{"10", "^", "12"}]}]}], ")"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"V", ",", 
       RowBox[{"-", "0.2"}], ",", "0.2", ",", "0.001"}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.800561219146058*^9, 3.800561224328259*^9}, {
  3.800561561227366*^9, 3.8005615761496277`*^9}},
 CellLabel->
  "In[232]:=",ExpressionUUID->"20b8b190-fd74-430b-9e7d-07e89560f523"],

Cell[BoxData[
 RowBox[{
  RowBox[{"thData4", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"m", "^", "2"}], " ", 
         RowBox[{
          RowBox[{"kUnit", "^", "2"}], " ", "/", 
          RowBox[{"10", "^", "4"}]}], "  ", 
         RowBox[{
          RowBox[{"DensityInterpS", "[", "V", "]"}], "/", 
          RowBox[{"10", "^", "12"}]}]}], "-", "densityshift"}], ",", 
       RowBox[{
        RowBox[{"-", "1"}], "/", 
        RowBox[{"(", 
         RowBox[{"ToCapacitance", " ", 
          RowBox[{"m", "^", "2"}], " ", 
          RowBox[{
           RowBox[{"kUnit", "^", "2"}], " ", "/", 
           RowBox[{"10", "^", "4"}]}], " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"dens", "[", "22", "]"}], "'"}], "[", "V", "]"}], "/", 
           RowBox[{"10", "^", "12"}]}]}], ")"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"V", ",", 
       RowBox[{"-", "0.2"}], ",", "0.2", ",", "0.001"}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.800561242726965*^9, 3.800561247760359*^9}, {
  3.800561568919321*^9, 3.800561574006936*^9}},
 CellLabel->
  "In[233]:=",ExpressionUUID->"e72cc15a-cb7b-4abe-9a8c-0e4392e10c6a"],

Cell[BoxData[
 RowBox[{"c1", "=", 
  RowBox[{"c", "/.", 
   RowBox[{"FindFit", "[", 
    RowBox[{"Data1", ",", 
     RowBox[{
      RowBox[{"thData", "[", "n", "]"}], " ", "-", " ", "c"}], ",", "c", ",", 
     "n"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.731098189038659*^9, 3.731098259934266*^9}},
 CellLabel->
  "In[234]:=",ExpressionUUID->"14fd0723-7eda-474c-a3fa-a715bcf6f823"],

Cell[BoxData[
 RowBox[{"c2", "=", 
  RowBox[{"c", "/.", 
   RowBox[{"FindFit", "[", 
    RowBox[{"Data2", ",", 
     RowBox[{
      RowBox[{"thData", "[", "n", "]"}], " ", "-", " ", "c"}], ",", "c", ",", 
     "n"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.731098276347554*^9, 3.731098278975878*^9}},
 CellLabel->
  "In[235]:=",ExpressionUUID->"e268f994-8d0b-4b6b-a08c-695e38acf5ba"],

Cell[BoxData[
 RowBox[{"c3", "=", 
  RowBox[{"c", "/.", 
   RowBox[{"FindFit", "[", 
    RowBox[{"Data3", ",", 
     RowBox[{
      RowBox[{"thData", "[", "n", "]"}], " ", "-", " ", "c"}], ",", "c", ",", 
     "n"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.7310982830948467`*^9, 3.7310982888655167`*^9}},
 CellLabel->
  "In[236]:=",ExpressionUUID->"c1d0a7b4-6b05-488b-adc5-68d75123aeff"],

Cell[BoxData[
 RowBox[{"c4", "=", 
  RowBox[{"c", "/.", 
   RowBox[{"FindFit", "[", 
    RowBox[{"Data4", ",", 
     RowBox[{
      RowBox[{"thData", "[", "n", "]"}], " ", "-", " ", "c"}], ",", "c", ",", 
     "n"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.731098293657365*^9, 3.731098298461409*^9}},
 CellLabel->
  "In[237]:=",ExpressionUUID->"202eb550-5aa5-4c78-8b92-c4a923c48845"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plData1", "=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"1", "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "+", "c1"}], ")"}]}]}], "}"}], 
       "&"}], ",", "Data1"}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.731098313671974*^9, 3.731098379687086*^9}, {
   3.7355537503438253`*^9, 3.735553754678185*^9}, 3.80275720186626*^9},
 CellLabel->
  "In[238]:=",ExpressionUUID->"88c47a26-0e08-4313-92a6-41f3ebe47d3b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plData2", "=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"1", "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "+", "c2"}], ")"}]}]}], "}"}], 
        "&"}], ",", "Data2"}], "]"}], ",", 
     RowBox[{"PlotStyle", "\[Rule]", "Red"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.731098473148188*^9, 3.73109848611943*^9}, {
   3.735553759891921*^9, 3.7355537632365923`*^9}, 3.802757199645566*^9},
 CellLabel->
  "In[239]:=",ExpressionUUID->"f1fbd689-3bf0-4e4e-9a9e-fb917d3ed16c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plData3", "=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"1", "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "+", "c3"}], ")"}]}]}], "}"}], 
        "&"}], ",", "Data3"}], "]"}], ",", 
     RowBox[{"PlotStyle", "\[Rule]", "Green"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7310985403305063`*^9, 3.73109855457489*^9}, {
   3.7355537726738167`*^9, 3.7355537759736433`*^9}, 3.802757197721579*^9},
 CellLabel->
  "In[240]:=",ExpressionUUID->"000d225a-0918-47f1-83a5-98e07bd85002"],

Cell[BoxData[
 RowBox[{
  RowBox[{"plData4", "=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"1", "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "+", "c4"}], ")"}]}]}], "}"}], 
        "&"}], ",", "Data4"}], "]"}], ",", 
     RowBox[{"PlotStyle", "\[Rule]", "Blue"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7310985645765133`*^9, 3.7310985744494543`*^9}, {
   3.735553781723914*^9, 3.735553785892907*^9}, 3.802757196499176*^9},
 CellLabel->
  "In[241]:=",ExpressionUUID->"57313a9e-e133-4bbf-854f-0f06d5b8af43"],

Cell[BoxData[
 RowBox[{"plTh", "=", 
  RowBox[{"Plot", "[", 
   RowBox[{
    RowBox[{"1", "/", 
     RowBox[{"thData", "[", "n", "]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"n", ",", 
      RowBox[{"-", "6"}], ",", "6"}], "}"}], ",", 
    RowBox[{"Frame", "\[Rule]", "True"}], ",", 
    RowBox[{"FrameLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
      "\"\<\!\(\*SubscriptBox[\(n\), \(total\)]\), \
\!\(\*SuperscriptBox[\(10\), \(12\)]\)\!\(\*SuperscriptBox[\(cm\), \
\(-2\)]\)\>\"", ",", "\"\<c\>\""}], "}"}]}], ",", 
    RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "6"}], ",", "6"}], "}"}], ",", "All"}], "}"}]}], ",", 
    RowBox[{"PlotStyle", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"Black", ",", 
       RowBox[{"Thickness", "[", "0.01", "]"}]}], "}"}]}]}], "]"}]}]], "Input",\

 CellChangeTimes->{{3.731096365994948*^9, 3.731096411044392*^9}, {
  3.73109794853913*^9, 3.73109800582548*^9}, {3.731098383849389*^9, 
  3.7310983860811787`*^9}, {3.731098427389604*^9, 3.731098433335825*^9}, {
  3.735553721418818*^9, 3.735553732301643*^9}, {3.735554887547242*^9, 
  3.735554888620553*^9}, {3.827084424853539*^9, 3.827084439109398*^9}},
 CellLabel->
  "In[242]:=",ExpressionUUID->"278d1930-3dd5-428b-b851-0d8e9f8ecd08"],

Cell[BoxData[
 RowBox[{"font1", "=", 
  RowBox[{
   RowBox[{"Style", "[", 
    RowBox[{"#", ",", 
     RowBox[{"FontSize", "\[Rule]", "20"}], ",", 
     RowBox[{"FontColor", "\[Rule]", "Black"}]}], "]"}], "&"}]}]], "Input",
 CellChangeTimes->{{3.7355535875856457`*^9, 3.735553614863904*^9}, {
  3.7355541837163563`*^9, 3.735554190231616*^9}},
 CellLabel->
  "In[243]:=",ExpressionUUID->"0ad28f61-dadf-4d9d-bc31-daa531e0384a"],

Cell[BoxData["parameters"], "Input",
 CellChangeTimes->{{3.787077813316145*^9, 3.787077814668552*^9}},
 CellLabel->
  "In[244]:=",ExpressionUUID->"2a24f437-a11c-4add-bda1-4a35ed63e29c"],

Cell[BoxData[
 RowBox[{"plotTot", "=", 
  RowBox[{"Show", "[", 
   RowBox[{
   "plData1", ",", "plData2", ",", "plData3", ",", "plData4", ",", "plTh", 
    ",", " ", 
    RowBox[{"Frame", "\[Rule]", "True"}], ",", 
    RowBox[{"FrameLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
       "font1", "@", 
        "\"\<n (\!\(\*SuperscriptBox[\(10\), \(12\)]\) \
\!\(\*SuperscriptBox[\(cm\), \(-2\)]\))\>\""}], ",", " ", 
       RowBox[{
       "font1", "@", 
        "\"\<\!\(\*SubscriptBox[\(C\), \(q\)]\) (F \
\!\(\*SuperscriptBox[\(m\), \(-2\)]\))\>\""}]}], " ", "}"}]}], ",", 
    RowBox[{"FrameTicksStyle", "\[Rule]", 
     RowBox[{"Directive", "[", 
      RowBox[{"Black", ",", 
       RowBox[{"FontSize", "\[Rule]", "20"}]}], "]"}]}], ",", 
    RowBox[{"Axes", "\[Rule]", "None"}], ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "6"}], ",", "6"}], "}"}], ",", " ", "Automatic"}], 
      "}"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBWIQPV1nS1LjmdeOf8JWpoDotFMKBSC6oW4emLYN4asG
0UuePq4H0QzzBDtBtPTJs9NA9Kx3QnNA9IMpvHNBtEXW/I0MV187vmo/cBRE
K+T/PwWiP2VcOA2iZ9SlXAbRUyRTr4Do2af2vATRB74ffw+ib0u8/wqiG39e
+Q+i3QWYeBiB9AXJC2B6lvl8ERAd5KYkA6LZO7NtQPR2tTww/exJUjiI5tdQ
iADRc+cFx4Ho+BUa6SDa+u/bbBAtErc2H0S7Od4xmSnyxtFv8VIzED0vSkfU
3fyN4yVzNzEQvfSUuCKIttkTqg2id/gaBoDoV99XBoHokCub1v8LeON4YHH9
BhANAK8urNs=
  "],
 CellLabel->
  "In[245]:=",ExpressionUUID->"a18199f3-6b02-4962-a50c-524aa21a1746"],

Cell[BoxData[
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{"path", "<>", "\"\<CapacitanceAttempt10.pdf\>\""}], ",", 
   "plotTot"}], "]"}]], "Input",
 CellChangeTimes->{{3.731098860462648*^9, 3.731098867869707*^9}, {
   3.731098913999526*^9, 3.7310989373405123`*^9}, {3.731165324955241*^9, 
   3.731165326461462*^9}, {3.731230473219693*^9, 3.7312304839231157`*^9}, {
   3.731962937509132*^9, 3.731962941582534*^9}, {3.732712337692809*^9, 
   3.7327123380312757`*^9}, {3.735554093148755*^9, 3.735554096016168*^9}, {
   3.735554995145172*^9, 3.7355549955834417`*^9}, {3.7356483652265997`*^9, 
   3.735648368691526*^9}, 3.827073512712595*^9, {3.827073593047909*^9, 
   3.8270735932037563`*^9}, {3.827073909934476*^9, 3.8270739107567987`*^9}, {
   3.827122669197667*^9, 3.827122669340576*^9}, {3.827159819829067*^9, 
   3.827159820424355*^9}, {3.827175350493801*^9, 3.827175351410406*^9}, {
   3.827196780357768*^9, 3.827196780519106*^9}, {3.827208829123465*^9, 
   3.8272088292329187`*^9}, {3.827220791981728*^9, 3.8272207922765102`*^9}, {
   3.8272455832265167`*^9, 3.827245583418025*^9}, {3.8272877207921457`*^9, 
   3.827287721288353*^9}},
 CellLabel->
  "In[377]:=",ExpressionUUID->"39aa315f-9d35-45fd-8a1e-3bda29332e92"]
}, Closed]],

Cell[CellGroupData[{

Cell["Moire effects", "Subsubsection",
 CellChangeTimes->{{3.827065150581747*^9, 
  3.827065160607798*^9}},ExpressionUUID->"0c131b81-5765-4250-a4d3-\
826901dfb991"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"<<", 
   RowBox[{"(", 
    RowBox[{
    "path", "<>", "\"\<DensityTableeps25NegativeGamma3gamma2-15\>\""}], 
    ")"}]}], " ", "*)"}]], "Input",
 CellChangeTimes->{
  3.827084774094159*^9, {3.8271236238477907`*^9, 3.827123629300775*^9}, {
   3.827159949728546*^9, 3.8271599535858917`*^9}},
 CellLabel->
  "In[247]:=",ExpressionUUID->"b83d5c9f-bdd1-46c4-80ab-6eb56fd924bb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Vrange", "=", "0.2"}], ";"}]], "Input",
 CellChangeTimes->{{3.730463054976741*^9, 3.730463061807982*^9}},
 CellLabel->
  "In[236]:=",ExpressionUUID->"9d149ec9-6c73-49f1-b158-049525677d91"],

Cell[BoxData[
 RowBox[{
  RowBox[{"m", "^", "2"}], " ", 
  RowBox[{
   RowBox[{"kUnit", "^", "2"}], " ", "/", 
   RowBox[{"10", "^", "4", "  ", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{
      "This", " ", "is", " ", "a", " ", "unit", " ", "of", " ", "density", 
       " ", "for", " ", "B"}], "=", 
      RowBox[{"0", " ", "calculation"}]}], " ", "*)"}]}]}]}]], "Input",
 CellChangeTimes->{{3.7304632480204687`*^9, 3.730463271271564*^9}},
 CellLabel->
  "In[237]:=",ExpressionUUID->"ac820f34-36d6-414f-9b68-6c38724a4bfe"],

Cell[BoxData[
 RowBox[{"nbrange", "=", "0.001"}]], "Input",
 CellChangeTimes->{{3.730463107804895*^9, 3.7304631112587442`*^9}, {
  3.730463157723712*^9, 3.730463168126873*^9}},
 CellLabel->
  "In[238]:=",ExpressionUUID->"122b3b6f-c4fe-452c-924d-8e51d1b39e80"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "Smooth", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Smooth", "[", 
    RowBox[{"f_", ",", 
     RowBox[{"x_", "?", "NumericQ"}], ",", 
     RowBox[{"delta_", "?", "NumericQ"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"1", "/", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Sqrt", "[", "\[Pi]", "]"}], 
       RowBox[{"Erf", "[", "3", "]"}], "delta"}], ")"}]}], " ", 
    RowBox[{"NIntegrate", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"x", "+", "x1"}], "]"}], " ", "*", 
       RowBox[{"Exp", "[", 
        RowBox[{"-", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"x1", "/", "delta"}], ")"}], "^", "2"}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"x1", ",", 
        RowBox[{
         RowBox[{"-", "3"}], " ", "delta"}], ",", 
        RowBox[{"3", " ", "delta"}]}], "}"}]}], "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7172261539470882`*^9, 3.717226328720024*^9}, {
  3.717226371768825*^9, 3.717226408047962*^9}, {3.717226561960862*^9, 
  3.7172265831849318`*^9}},
 CellLabel->
  "In[239]:=",ExpressionUUID->"bb4aee88-a11f-4440-9158-43784f62beca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DensityInterp", "=", 
   RowBox[{"Interpolation", "[", 
    RowBox[{"DensityTable", ",", 
     RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.7160148372952147`*^9, 3.7160148572389307`*^9}, {
   3.716017803722312*^9, 3.7160178218577538`*^9}, 3.716021718238318*^9, 
   3.716021769854332*^9},
 CellLabel->
  "In[241]:=",ExpressionUUID->"cca2784f-fb2d-457c-bdda-553abae0944b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Dens2V", "[", "dens_", "]"}], ":=", 
    RowBox[{"V", "/.", 
     RowBox[{"FindRoot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"m", "^", "2"}], " ", 
         RowBox[{"kUnit", "^", "2"}], "  ", 
         RowBox[{"DensityInterp", "[", "V", "]"}]}], "-", 
        RowBox[{"dens", " ", 
         RowBox[{"10", "^", "16"}]}]}], ",", 
       RowBox[{"{", 
        RowBox[{"V", ",", "0"}], "}"}]}], "]"}]}]}], ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{"in", " ", "units", " ", "of", " ", 
    RowBox[{"10", "^", "12"}]}], " ", "*)"}], " "}]], "Input",
 CellChangeTimes->{{3.718016612612728*^9, 3.718016699619021*^9}, {
  3.718016803588591*^9, 3.7180168360213623`*^9}, {3.718016923444035*^9, 
  3.7180169284036818`*^9}},
 CellLabel->
  "In[242]:=",ExpressionUUID->"ea91f3c6-abbb-4321-9448-b398e83ad4d2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DensityInterpS", "=", 
   RowBox[{"Interpolation", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"V", ",", 
         RowBox[{"Smooth", "[", 
          RowBox[{"DensityInterp", ",", "V", ",", "0.010"}], "]"}]}], "}"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"V", ",", 
         RowBox[{"-", "Vrange"}], ",", "Vrange", ",", "0.005"}], "}"}]}], 
      "]"}], ",", 
     RowBox[{"InterpolationOrder", "\[Rule]", "2"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.717226056740629*^9, 3.717226181703665*^9}, {
   3.717226614889003*^9, 3.7172266214802847`*^9}, {3.717226680288837*^9, 
   3.717226719112298*^9}, {3.717226757857601*^9, 3.7172267579760723`*^9}, {
   3.717236131913772*^9, 3.717236132425129*^9}, {3.7180150680509863`*^9, 
   3.7180150681701937`*^9}, {3.718015148283619*^9, 3.7180151483696117`*^9}, {
   3.7180153586112623`*^9, 3.718015358698515*^9}, 3.7195588738558407`*^9, {
   3.719559391264229*^9, 3.7195594077916107`*^9}, {3.719598099538275*^9, 
   3.7195981004081182`*^9}, {3.719737279950881*^9, 3.719737280062467*^9}, {
   3.7313142025931273`*^9, 3.7313142031358957`*^9}, {3.7314298424523907`*^9, 
   3.7314298429266644`*^9}, {3.731507357308544*^9, 3.731507376693925*^9}, {
   3.731606554320065*^9, 3.73160655507294*^9}, {3.7319625425887814`*^9, 
   3.731962545720784*^9}, 3.731962609242687*^9, {3.731962671055725*^9, 
   3.731962671831134*^9}, {3.7319628685571003`*^9, 3.731962870201682*^9}, {
   3.732712166947247*^9, 3.732712167416099*^9}},
 CellLabel->
  "In[243]:=",ExpressionUUID->"411ca99e-48e4-4a1b-8d62-71465b69c519"],

Cell[BoxData[
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"m", "^", "2"}], " ", 
    RowBox[{
     RowBox[{"kUnit", "^", "2"}], " ", "/", 
     RowBox[{"10", "^", "4"}]}], "  ", 
    RowBox[{
     RowBox[{"DensityInterpS", "[", 
      RowBox[{"-", "V"}], "]"}], "/", 
     RowBox[{"10", "^", "12"}]}]}], ",", 
   RowBox[{"{", 
    RowBox[{"V", ",", 
     RowBox[{"-", "Vrange"}], ",", "Vrange"}], "}"}], ",", 
   RowBox[{"AxesLabel", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
     "\"\<V (V)\>\"", ",", "  ", 
      "\"\<n (\!\(\*SuperscriptBox[\(10\), \(12\)]\) \
\!\(\*SuperscriptBox[\(cm\), \(-2\)]\))\>\""}], "}"}]}]}], "]"}]], "Input",
 CellChangeTimes->{{3.751285657930779*^9, 3.751285706160709*^9}, {
  3.751285809527342*^9, 3.7512858201282*^9}, {3.7514486631805773`*^9, 
  3.7514487039978943`*^9}},
 CellLabel->
  "In[244]:=",ExpressionUUID->"4d92fa38-bb7b-47cd-88f2-e5df5fbb4eac"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Moire effects", "Subsection",
 CellChangeTimes->{{3.768458781423032*^9, 
  3.768458788486558*^9}},ExpressionUUID->"aaefed61-d328-401d-9a0c-\
e224b1ea4dbc"],

Cell[BoxData[
 RowBox[{"kUnit", "=", 
  RowBox[{
   RowBox[{"1", "/", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Sqrt", "[", "3", "]"}], " ", "a"}], ")"}]}], "//.", 
   "Valuesh"}]}]], "Input",
 CellChangeTimes->{{3.769499831279347*^9, 3.7694998547305326`*^9}},
 CellLabel->
  "In[178]:=",ExpressionUUID->"cef19a74-2f0c-410f-a9e3-5fe96020bf2b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Area inside the surface state", "Subsection",
 CellChangeTimes->{{3.768041980617741*^9, 
  3.768041995412675*^9}},ExpressionUUID->"d55ee351-ed8b-4195-934f-\
19a890ca2f4e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"\[Delta]Moire", "=", "0.018"}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{"%", " ", "of", " ", "lattice", " ", "mismatch"}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.770353156217411*^9, 3.770353177569721*^9}, {
  3.7709713051605263`*^9, 3.7709713056062727`*^9}},
 CellLabel->
  "In[179]:=",ExpressionUUID->"346b8f7f-b567-435c-86c7-be345c9b5bba"],

Cell[BoxData[
 RowBox[{"bvecbasis", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"RotationMatrix", "[", 
      RowBox[{
       RowBox[{"\[Pi]", "/", "3"}], " ", "n"}], "]"}], ".", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"4", " ", 
         RowBox[{"\[Pi]", "/", 
          RowBox[{"Sqrt", "[", "3", "]"}]}], " ", "\[Delta]"}], "/.", 
        RowBox[{"\[Delta]", "\[Rule]", "\[Delta]Moire"}]}]}], "}"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"n", ",", "0", ",", "1"}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.768458800529818*^9, 3.768458838473956*^9}, {
   3.769890202335328*^9, 3.769890202519718*^9}, {3.769932814509281*^9, 
   3.7699328378163767`*^9}, {3.769936072739627*^9, 3.769936072830305*^9}, 
   3.770353184489736*^9},
 CellLabel->
  "In[180]:=",ExpressionUUID->"d514712e-154f-4663-8009-e8bc879a15c9"],

Cell[BoxData[
 RowBox[{"bvecs3", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"RotationMatrix", "[", 
      RowBox[{
       RowBox[{"\[Pi]", "/", "3"}], " ", "n"}], "]"}], ".", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"4", " ", 
         RowBox[{"\[Pi]", "/", 
          RowBox[{"Sqrt", "[", "3", "]"}]}], " ", "\[Delta]"}], "/.", 
        RowBox[{"\[Delta]", "\[Rule]", "\[Delta]Moire"}]}]}], "}"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"n", ",", "0", ",", "2"}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7684590046274347`*^9, 3.768459011753108*^9}, {
   3.768459078118074*^9, 3.768459086118449*^9}, {3.769890208695964*^9, 
   3.7698902088483143`*^9}, {3.769936076672544*^9, 3.769936076795566*^9}, 
   3.770353191017023*^9},
 CellLabel->
  "In[181]:=",ExpressionUUID->"9960ad0b-f91d-417b-89b4-b9b5ff66b744"],

Cell[BoxData[
 RowBox[{"bvecs6", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"RotationMatrix", "[", 
      RowBox[{
       RowBox[{"\[Pi]", "/", "3"}], " ", "n"}], "]"}], ".", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"4", " ", 
         RowBox[{"\[Pi]", "/", 
          RowBox[{"Sqrt", "[", "3", "]"}]}], " ", "\[Delta]"}], "/.", 
        RowBox[{"\[Delta]", "\[Rule]", "\[Delta]Moire"}]}]}], "}"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"n", ",", "0", ",", "5"}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.768459429839037*^9, 3.768459434250935*^9}, {
  3.769890214522481*^9, 3.7698902147431593`*^9}, {3.7699360793283587`*^9, 
  3.769936079483193*^9}, {3.770353196217387*^9, 3.7703531965917473`*^9}},
 CellLabel->
  "In[182]:=",ExpressionUUID->"07473e82-d08a-4d3e-8ca0-8b1d8d498401"],

Cell[BoxData[
 RowBox[{"Gvecs", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"RotationMatrix", "[", 
      RowBox[{
       RowBox[{"\[Pi]", "/", "3"}], " ", "n"}], "]"}], ".", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"4", " ", 
         RowBox[{"\[Pi]", "/", 
          RowBox[{"Sqrt", "[", "3", "]"}]}], " ", "\[Delta]"}], "/.", 
        RowBox[{"\[Delta]", "\[Rule]", "\[Delta]Moire"}]}]}], "}"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"n", ",", "0", ",", "5"}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7682925947797956`*^9, 3.768292652871853*^9}, {
   3.768292710836396*^9, 3.768292874040028*^9}, {3.768293783433893*^9, 
   3.768293804092607*^9}, {3.768492382775588*^9, 3.7684923831377363`*^9}, {
   3.768492866724286*^9, 3.7684928695881147`*^9}, {3.769890220867882*^9, 
   3.769890221025951*^9}, {3.769936082184471*^9, 3.769936082323421*^9}, 
   3.770353201412015*^9},
 CellLabel->
  "In[183]:=",ExpressionUUID->"e70d6529-a9b3-4369-82d7-c766180ac9d7"],

Cell[BoxData[
 RowBox[{"Glen", "=", 
  RowBox[{"Gvecs", "[", 
   RowBox[{"[", 
    RowBox[{"1", ",", "2"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.768492820360907*^9, 3.768492827732622*^9}, {
  3.7684929023682213`*^9, 3.768492904616787*^9}},
 CellLabel->
  "In[184]:=",ExpressionUUID->"8f609db0-d198-4e2c-8d80-40ccc12688c9"],

Cell[BoxData[
 RowBox[{"Glen", "*", "kUnit"}]], "Input",
 CellChangeTimes->{{3.80036279361707*^9, 3.800362802211645*^9}},
 CellLabel->
  "In[185]:=",ExpressionUUID->"888ab80c-7496-40f3-bce1-4294a1da048e"],

Cell[BoxData[
 RowBox[{"MoireBZ", "=", 
  RowBox[{
   RowBox[{"ImplicitRegion", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"bvecs6", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ".", 
         RowBox[{"{", 
          RowBox[{"x", ",", "y"}], "}"}]}], "\[LessEqual]", 
        RowBox[{
         RowBox[{"Glen", "^", "2"}], "/", "2"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "6"}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "y"}], "}"}]}], "]"}], "//", 
   "FullSimplify"}]}]], "Input",
 CellChangeTimes->{{3.768458945870687*^9, 3.768458962780634*^9}, {
  3.7684589931211853`*^9, 3.7684590940258007`*^9}, {3.768459129918192*^9, 
  3.768459253535263*^9}, {3.768459320893599*^9, 3.768459384451909*^9}, {
  3.768459439334401*^9, 3.768459472990347*^9}, {3.768496688696493*^9, 
  3.768496690528859*^9}},
 CellLabel->
  "In[186]:=",ExpressionUUID->"98422401-6a41-4ffa-9e85-6d3382aef272"],

Cell[BoxData[
 RowBox[{
  RowBox[{"shiftVector1", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "Glen"}], "/", 
      RowBox[{"Sqrt", "[", "3", "]"}]}], ",", "0"}], "}"}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.7689004086203136`*^9, 3.768900441583776*^9}, {
  3.769253873774761*^9, 3.7692539064453783`*^9}},
 CellLabel->
  "In[187]:=",ExpressionUUID->"c8bfa95d-09b8-4933-9dd8-5ae2186ef6d1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"shiftVector2", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "Glen"}], "/", 
      RowBox[{"(", 
       RowBox[{"2", " ", 
        RowBox[{"Sqrt", "[", "3", "]"}]}], ")"}]}], ",", 
     RowBox[{"Glen", "/", "2"}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7692520420345163`*^9, 3.769252058995193*^9}},
 CellLabel->
  "In[188]:=",ExpressionUUID->"006c9196-3e2a-47f7-abea-fb12b981e65f"],

Cell[BoxData[
 RowBox[{"MoireBZ1", "=", 
  RowBox[{
   RowBox[{"ImplicitRegion", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"bvecs6", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ".", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "+", 
            RowBox[{"Glen", "/", 
             RowBox[{"Sqrt", "[", "3", "]"}]}]}], ",", "y"}], "}"}]}], 
        "\[LessEqual]", 
        RowBox[{
         RowBox[{"Glen", "^", "2"}], "/", "2"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "6"}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "y"}], "}"}]}], "]"}], "//", 
   "FullSimplify"}]}]], "Input",
 CellChangeTimes->{{3.768898134197311*^9, 3.768898150700379*^9}, {
  3.769320762366815*^9, 3.769320762921179*^9}},
 CellLabel->
  "In[189]:=",ExpressionUUID->"1477a417-1d50-4364-9854-be8f25667e5a"],

Cell[BoxData[
 RowBox[{"MoireBZ1Cond", "=", 
  RowBox[{"And", " ", "@@", " ", 
   RowBox[{"(", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"bvecs6", "[", 
         RowBox[{"[", "i", "]"}], "]"}], ".", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"x", "+", 
           RowBox[{"Glen", "/", 
            RowBox[{"Sqrt", "[", "3", "]"}]}]}], ",", "y"}], "}"}]}], 
       "\[LessEqual]", 
       RowBox[{
        RowBox[{"Glen", "^", "2"}], "/", "2"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "6"}], "}"}]}], "]"}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.769863509352024*^9, 3.769863563025342*^9}},
 CellLabel->
  "In[190]:=",ExpressionUUID->"734e89ad-4cb3-4179-ada8-5abd3aac7c35"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"rcutoff", "=", "0.02"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"subtractRegion", "=", 
  RowBox[{"ImplicitRegion", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x", ">", 
       RowBox[{"-", "rcutoff"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"x", "/", "2"}], "+", 
        RowBox[{"y", "*", 
         RowBox[{
          RowBox[{"Sqrt", "[", "3", "]"}], "/", "2"}]}]}], "<", "rcutoff"}], 
      ",", 
      RowBox[{
       RowBox[{
        RowBox[{"x", "/", "2"}], "-", 
        RowBox[{"y", "*", 
         RowBox[{
          RowBox[{"Sqrt", "[", "3", "]"}], "/", "2"}]}]}], "<", "rcutoff"}]}],
      "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "y"}], "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.769498340436612*^9, 3.769498378235773*^9}, {
   3.769498504038671*^9, 3.769498522697914*^9}, {3.769503615118445*^9, 
   3.769503652334158*^9}, 3.7695101328315887`*^9, {3.769868810561542*^9, 
   3.769868812625803*^9}, {3.7698902995094624`*^9, 3.769890299894248*^9}, {
   3.769961011029038*^9, 3.769961012149169*^9}, {3.7699714175148163`*^9, 
   3.769971422448398*^9}, {3.770102788981646*^9, 3.770102789127577*^9}, {
   3.7709713827058897`*^9, 3.770971389343223*^9}, {3.771395662191688*^9, 
   3.7713956633813868`*^9}, 3.783195565459928*^9, 3.78722656168883*^9},
 CellLabel->
  "In[191]:=",ExpressionUUID->"29da0194-d015-4814-bf28-8cd69e7f4e5d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"subtractRegionCond", "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"x", ">", 
      RowBox[{"-", "rcutoff"}]}], ")"}], " ", "&&", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"x", "/", "2"}], "+", 
       RowBox[{"y", "*", 
        RowBox[{
         RowBox[{"Sqrt", "[", "3", "]"}], "/", "2"}]}]}], "<", "rcutoff"}], 
     ")"}], " ", "&&", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"x", "/", "2"}], "-", 
       RowBox[{"y", "*", 
        RowBox[{
         RowBox[{"Sqrt", "[", "3", "]"}], "/", "2"}]}]}], "<", "rcutoff"}], 
     ")"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.769863407271615*^9, 3.7698634715499983`*^9}},
 CellLabel->
  "In[193]:=",ExpressionUUID->"28b77a28-d46f-4000-ad42-f73bb4237957"],

Cell[BoxData[
 RowBox[{"Boole", "[", "subtractRegionCond", "]"}]], "Input",
 CellChangeTimes->{{3.769863431348081*^9, 3.769863441817155*^9}},
 CellLabel->
  "In[194]:=",ExpressionUUID->"ad622b4f-b440-410c-acea-cf87e90bd241"],

Cell[BoxData[
 RowBox[{"MoireBZ0", "=", 
  RowBox[{"RegionDifference", "[", 
   RowBox[{
    RowBox[{"Region", "[", 
     RowBox[{"ImplicitRegion", "[", 
      RowBox[{
       RowBox[{"Join", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"bvecs6", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ".", 
            RowBox[{"{", 
             RowBox[{"x", ",", "y"}], "}"}]}], "\[LessEqual]", 
           RowBox[{
            RowBox[{"Glen", "^", "2"}], "/", "2"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "6"}], "}"}]}], "]"}], 
        RowBox[{"(*", 
         RowBox[{",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "x"}], " ", 
             RowBox[{"Sqrt", "[", "3", "]"}]}], "<", "y", "<", 
            RowBox[{"x", " ", 
             RowBox[{"Sqrt", "[", "3", "]"}]}]}], "}"}]}], "*)"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "y"}], "}"}]}], "]"}], "]"}], ",", 
    RowBox[{"Region", "[", "subtractRegion", "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7694979025191517`*^9, 3.7694979811611*^9}, {
   3.769498199024465*^9, 3.7694982753241*^9}, 3.7694983323983717`*^9, {
   3.76949842812624*^9, 3.769498469579501*^9}, {3.7701026989405613`*^9, 
   3.770102769664795*^9}, {3.770102997918304*^9, 3.770103002944131*^9}},
 CellLabel->
  "In[196]:=",ExpressionUUID->"204fbc63-7880-4b23-aa33-1af969482587"],

Cell[BoxData[
 RowBox[{"MoireBZ2", "=", 
  RowBox[{"RegionDifference", "[", 
   RowBox[{
    RowBox[{"Region", "[", 
     RowBox[{"ImplicitRegion", "[", 
      RowBox[{
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"bvecs6", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ".", 
             RowBox[{"{", 
              RowBox[{"x", ",", "y"}], "}"}]}], "\[LessEqual]", 
            RowBox[{
             RowBox[{"Glen", "^", "2"}], "/", "2"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "6"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "0.01"}], "<", "x", "<", "0.01"}], "}"}]}], "]"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "y"}], "}"}]}], "]"}], "]"}], ",", 
    RowBox[{"Region", "[", "subtractRegion", "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.770037203354157*^9, 3.770037203594454*^9}, {
  3.770037522082939*^9, 3.77003753531549*^9}},
 CellLabel->
  "In[197]:=",ExpressionUUID->"128719b0-de6f-49f0-831d-ed1b10f356f9"],

Cell[BoxData[
 RowBox[{"MoireBZ1", "=", 
  RowBox[{"RegionDifference", "[", 
   RowBox[{
    RowBox[{"Region", "[", 
     RowBox[{"ImplicitRegion", "[", 
      RowBox[{
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"bvecs6", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ".", 
             RowBox[{"{", 
              RowBox[{"x", ",", "y"}], "}"}]}], "\[LessEqual]", 
            RowBox[{
             RowBox[{"Glen", "^", "2"}], "/", "2"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "6"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"0.04", "<", "x", "<", "0.076"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "y"}], "}"}]}], "]"}], "]"}], ",", 
    RowBox[{"Region", "[", "subtractRegion", "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7700379316998568`*^9, 3.77003794300334*^9}, {
  3.770038094657604*^9, 3.770038108003284*^9}, {3.7701007312357388`*^9, 
  3.770100745534713*^9}},
 CellLabel->
  "In[198]:=",ExpressionUUID->"8a17b706-279c-4621-a984-0b8d38d56d02"],

Cell[BoxData[
 RowBox[{"BZBoundary", "=", 
  RowBox[{"PolarPlot", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Glen", "/", "2"}], "/", 
     RowBox[{"Cos", "[", 
      RowBox[{"phi", "-", 
       RowBox[{"\[Pi]", "/", "2"}], " ", "-", 
       RowBox[{
        RowBox[{"\[Pi]", "/", "3"}], " ", 
        RowBox[{"Round", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"phi", "-", 
            RowBox[{"\[Pi]", "/", "2"}]}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"\[Pi]", "/", "3"}], ")"}]}], " ", "]"}]}]}], "]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"phi", ",", "0", ",", 
      RowBox[{"2", " ", "\[Pi]"}]}], "}"}], ",", 
    RowBox[{"PlotStyle", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"Black", ",", " ", "Dotted"}], "}"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.771226435967288*^9, 3.771226454734625*^9}},
 CellLabel->
  "In[199]:=",ExpressionUUID->"442dc9cb-ed51-41dc-85c6-5ef7a3ee9f34"],

Cell[BoxData[
 RowBox[{"Glen", " ", "/", 
  RowBox[{"Sqrt", "[", "3", "]"}], "  ", 
  RowBox[{"(*", 
   RowBox[{
   "Position", " ", "of", " ", "right", " ", "K", " ", "point", " ", "of", 
    " ", "mini", " ", "BZ"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.783096799347293*^9, 3.783096909188081*^9}},
 CellLabel->
  "In[200]:=",ExpressionUUID->"a50d5eff-c5ef-42f0-bb4f-d456f711246d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Show", "[", 
   RowBox[{
    RowBox[{"Region", "[", "MoireBZ", "]"}], ",", 
    RowBox[{"PolarPlot", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Glen", "/", "2"}], "/", 
       RowBox[{"Cos", "[", 
        RowBox[{"phi", "-", 
         RowBox[{"\[Pi]", "/", "2"}], " ", "-", 
         RowBox[{
          RowBox[{"\[Pi]", "/", "3"}], " ", 
          RowBox[{"Round", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"phi", "-", 
              RowBox[{"\[Pi]", "/", "2"}]}], ")"}], "/", 
            RowBox[{"(", 
             RowBox[{"\[Pi]", "/", "3"}], ")"}]}], " ", "]"}]}]}], "]"}]}], 
      ",", 
      RowBox[{"{", 
       RowBox[{"phi", ",", "0", ",", 
        RowBox[{"2", " ", "\[Pi]"}]}], "}"}]}], "]"}]}], "]"}], 
  " "}]], "Input",
 CellChangeTimes->{{3.769243292340925*^9, 3.7692434467470493`*^9}, {
  3.769243504001583*^9, 3.769243569441926*^9}, {3.769243627653479*^9, 
  3.769243740936652*^9}},
 CellLabel->
  "In[201]:=",ExpressionUUID->"0fa0333d-fb31-43cb-be1e-e5a0e0880dd6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{"Folding1", ",", "Folding"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.768901476878398*^9, 3.768901486895445*^9}},
 CellLabel->
  "In[202]:=",ExpressionUUID->"4d7fb728-4687-4a71-a9b0-713ce214c186"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Folding", "[", 
   RowBox[{"xvec_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"NumericQ", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "&&", " ", 
        RowBox[{"NumericQ", "[", 
         RowBox[{"#", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ")"}], "&"}], ")"}]}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"z", "=", "xvec"}], "}"}], ",", 
    RowBox[{
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"z", "-=", 
          RowBox[{
           RowBox[{"bvecs3", "[", 
            RowBox[{"[", "i", "]"}], "]"}], " ", 
           RowBox[{"Round", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"bvecs3", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ".", "z"}], "/", 
             RowBox[{"Glen", "^", "2"}]}], "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "3"}], "}"}]}], "]"}], ",", "2"}], "]"}], ";", 
     "z"}]}], "]"}], " "}]], "Input",
 CellChangeTimes->{{3.7688982976617527`*^9, 3.7688983478660707`*^9}, {
  3.7688983833471603`*^9, 3.768898545931302*^9}, {3.768899069664535*^9, 
  3.768899110915016*^9}, {3.7688992716592417`*^9, 3.7688993424491663`*^9}, {
  3.768899381381125*^9, 3.768899409070362*^9}, {3.768899865990649*^9, 
  3.768899866147853*^9}, {3.768899910312311*^9, 3.76889991046891*^9}, {
  3.7688999413437147`*^9, 3.768899977810514*^9}, {3.768901424142761*^9, 
  3.768901460975753*^9}, {3.768901588803936*^9, 3.7689015981156883`*^9}, {
  3.771059386047955*^9, 3.77105939311084*^9}},
 CellLabel->
  "In[203]:=",ExpressionUUID->"4d031e5b-8bad-4583-8f3e-be16f89a1cd1"],

Cell[BoxData[
 RowBox[{"Folding", "[", 
  RowBox[{"{", 
   RowBox[{"0.1", ",", 
    RowBox[{"-", "0.1"}]}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.771052561398958*^9, 3.771052593796875*^9}},
 CellLabel->
  "In[204]:=",ExpressionUUID->"753f08d7-905b-455a-a71a-81d108e03c5a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Folding1", "[", 
     RowBox[{"xvec_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"NumericQ", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "&&", " ", 
          RowBox[{"NumericQ", "[", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ")"}], "&"}], ")"}]}], 
     "]"}], ":=", 
    RowBox[{
     RowBox[{"Folding", "[", 
      RowBox[{"xvec", "+", "shiftVector1"}], "]"}], "-", "shiftVector1"}]}], 
   ";"}], " "}]], "Input",
 CellChangeTimes->{{3.768900365258548*^9, 3.768900399015285*^9}, {
   3.7689004532857857`*^9, 3.768900468839015*^9}, 3.768901474523856*^9, {
   3.768901611364682*^9, 3.7689016293512373`*^9}, {3.7692539454211693`*^9, 
   3.769253956529882*^9}},
 CellLabel->
  "In[205]:=",ExpressionUUID->"11efb39c-3a2c-400b-99bb-25649b2f16d6"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"DensityPlot", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "*", 
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "&"}], ")"}], "@", 
     RowBox[{"Folding", "[", 
      RowBox[{"{", 
       RowBox[{"x", ",", " ", "y"}], "}"}], "]"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", 
      RowBox[{"-", "0.15"}], ",", "0.15"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"y", ",", 
      RowBox[{"-", "0.15"}], ",", "0.15"}], "}"}], ",", 
    RowBox[{"PlotPoints", "\[Rule]", "50"}]}], "]"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.768898628488864*^9, 3.768898733806013*^9}, {
  3.7688988805423107`*^9, 3.7688988869430532`*^9}, {3.768898972455181*^9, 
  3.768898978657936*^9}, {3.768900012437627*^9, 3.768900016402815*^9}, {
  3.768900485622368*^9, 3.768900489157498*^9}},
 CellLabel->
  "In[206]:=",ExpressionUUID->"271fd118-8d6f-4f60-84bb-0ef9fbc5c2a0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MoireCutoff", "=", "0.2"}], ";"}]], "Input",
 CellChangeTimes->{{3.7684607790545187`*^9, 3.768460789452031*^9}, {
   3.768460960344111*^9, 3.768460974518633*^9}, 3.7684999990528927`*^9, 
   3.7685006617427683`*^9, {3.769868793847673*^9, 3.7698688040980473`*^9}},
 CellLabel->
  "In[207]:=",ExpressionUUID->"c65d4366-a0e7-4659-b0b9-50ffa2acd8c5"],

Cell[BoxData[
 RowBox[{"ShiftVectorGrid", "=", 
  RowBox[{"Select", "[", 
   RowBox[{
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"bvecbasis", "[", 
           RowBox[{"[", "1", "]"}], "]"}], " ", "a"}], " ", "+", 
         RowBox[{
          RowBox[{"bvecbasis", "[", 
           RowBox[{"[", "2", "]"}], "]"}], " ", "b"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", 
          RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"b", ",", 
          RowBox[{"-", "5"}], ",", "5"}], "}"}]}], "]"}], ",", "1"}], "]"}], 
    ",", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "^", "2"}], "+", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "^", "2"}]}], "<", 
      RowBox[{"MoireCutoff", "^", "2"}]}], "&"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7684607645343723`*^9, 3.7684609237753077`*^9}},
 CellLabel->
  "In[208]:=",ExpressionUUID->"562b882b-de31-49e3-b4c1-93426c99d93b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Moire", " ", 
    RowBox[{"vectors", ":"}]}], " ", "*)"}], " "}]], "Input",
 CellChangeTimes->{{3.768235627583743*^9, 3.768235634450336*^9}, {
  3.76829246129819*^9, 3.768292472098946*^9}, {3.768292591973176*^9, 
  3.7682925921671658`*^9}},
 CellLabel->
  "In[209]:=",ExpressionUUID->"7853ad54-ae03-47b9-a410-95559dbaec3f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "vargamma4", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.8025854485923347`*^9, 3.802585455219344*^9}},
 CellLabel->
  "In[210]:=",ExpressionUUID->"9d44c29c-cea8-42d0-a61e-618d238900d3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MoireParams", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"U0", "\[Rule]", "0.0085"}], ",", 
      RowBox[{"U1", "\[Rule]", "0.017"}], ",", 
      RowBox[{"U3", "\[Rule]", 
       RowBox[{"-", "0.0147"}]}], ",", 
      RowBox[{"vargamma4", "\[Rule]", "0.03"}], ",", 
      RowBox[{"vargamma1", "\[Rule]", "0.03"}]}], "}"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "U1", " ", "and", " ", "U3", " ", "with", " ", "opposite", " ", "sign", 
    " ", "due", " ", "to", " ", 
    RowBox[{"K", "'"}], " ", "valley"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.768493552975416*^9, 3.768493606995244*^9}, {
   3.7692833365581636`*^9, 3.769283342181827*^9}, {3.770353249637416*^9, 
   3.770353270084613*^9}, {3.7831937202535267`*^9, 3.783193747926958*^9}, {
   3.802334927666951*^9, 3.8023349663551292`*^9}, {3.802585443328568*^9, 
   3.8025854468076277`*^9}, {3.802587034855302*^9, 3.802587039523209*^9}, {
   3.8025886212012672`*^9, 3.8025886248288593`*^9}, 3.8025972388271303`*^9, 
   3.80278275667669*^9, {3.802838565552643*^9, 3.8028385672562237`*^9}, {
   3.802843038459834*^9, 3.802843046297119*^9}},
 CellLabel->
  "In[211]:=",ExpressionUUID->"dd745587-6132-4b55-abb7-3e89733e9ef5"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{"MoireParams", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"U0", "\[Rule]", "0.012"}], ",", 
      RowBox[{"U1", "\[Rule]", 
       RowBox[{"-", "0.017"}]}], ",", 
      RowBox[{"U3", "\[Rule]", "0.0147"}]}], "}"}]}], ";"}], " ", 
  "*)"}]], "Input",
 CellChangeTimes->{
  3.7692833511997213`*^9, {3.769503744648044*^9, 3.769503749134006*^9}, {
   3.770229315064117*^9, 3.7702293325451202`*^9}, {3.7703532641378937`*^9, 
   3.770353267170493*^9}},
 CellLabel->
  "In[212]:=",ExpressionUUID->"46befc28-33a1-4e70-88a4-268f4c9a3ca8"],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{"(*", "  ", 
   RowBox[{
    RowBox[{"MoireParams", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"U0", "\[Rule]", "0.00"}], ",", 
       RowBox[{"U1", "\[Rule]", 
        RowBox[{"-", "0.0"}]}], ",", 
       RowBox[{"U3", "\[Rule]", "0.0"}]}], "}"}]}], ";"}], "*)"}], 
  " "}]], "Input",
 CellChangeTimes->{{3.768496851459177*^9, 3.768496857234645*^9}, {
  3.768498818169998*^9, 3.768498820639072*^9}, {3.7684991355661507`*^9, 
  3.7684991396792383`*^9}, {3.768499717548441*^9, 3.768499722001728*^9}},
 CellLabel->
  "In[213]:=",ExpressionUUID->"f2b8113a-929d-4d6d-8022-e564dde24a11"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{
   "Sort", " ", "in", " ", "a", " ", "way", " ", "to", " ", "find", " ", 
    "the", " ", "branch", " ", "with", " ", "maximal", " ", "surface", " ", 
    "wave"}], "-", "function"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.770981523298645*^9, 3.7709815612880096`*^9}},
 CellLabel->
  "In[214]:=",ExpressionUUID->"860174a8-9f7f-439e-96ba-bcfcc2fde5b9"],

Cell[CellGroupData[{

Cell["Dispersion without Moire and expected nesting", "Subsubsection",
 CellChangeTimes->{{3.800295630832855*^9, 
  3.8002956505037823`*^9}},ExpressionUUID->"1a8aa1d9-a347-4064-b30b-\
549e06066848"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SurfaceDispersion", "[", 
    RowBox[{"dens_", ",", "branches_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"kxmin", "=", 
        RowBox[{"-", "0.09001"}]}], ",", 
       RowBox[{"kxmax", "=", "0.08"}], ",", 
       RowBox[{"kymin", "=", 
        RowBox[{"-", "0.08001"}]}], ",", 
       RowBox[{"kymax", "=", "0.08"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"DeltaVector", "=", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"PotentialTable", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
             RowBox[{
              RowBox[{"Round", "[", 
               RowBox[{
                RowBox[{"Dens2V", "[", "dens", "]"}], "*", "200"}], "]"}], 
              "/", "200"}]}], ")"}], "&"}]}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"H", "=", 
       RowBox[{"ConstructH", "[", 
        RowBox[{"DeltaVector", ",", " ", "NBilayer", ",", "kx", ",", "ky"}], 
        "]"}]}], ";", " ", 
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "branches", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"OrdSpectrum", "[", 
        RowBox[{"kx1_", ",", "ky1_"}], "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", "}"}], ",", 
         RowBox[{
          RowBox[{"es", "=", 
           RowBox[{
            RowBox[{"Sort", "[", 
             RowBox[{
              RowBox[{"Transpose", "[", 
               RowBox[{"Eigensystem", "[", 
                RowBox[{"H", "/.", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"kx", "\[Rule]", "kx1"}], ",", 
                   RowBox[{"ky", "\[Rule]", "ky1"}]}], "}"}]}], "]"}], "]"}], 
              ",", "  ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"#1", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "<", 
                 RowBox[{"#2", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "&"}]}], "]"}], 
            "[", 
            RowBox[{"[", "branches", "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"essurfaceness", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{"es", "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "2", ",", "1"}], "]"}], "]"}], "]"}], "^", 
             "2"}], "+", 
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{"es", "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "2", ",", "2"}], "]"}], "]"}], "]"}], "^", 
             "2"}], "+", 
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{"es", "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "2", ",", "3"}], "]"}], "]"}], "]"}], "^", 
             "2"}], "+", 
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{"es", "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "2", ",", "4"}], "]"}], "]"}], "]"}], "^", 
             "2"}]}]}], ";", " ", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Matrix", " ", "of", " ", "size", " ", "len"}], " ", ",", 
            " ", "flattened"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"es", "[", 
             RowBox[{"[", 
              RowBox[{";;", ",", "1"}], "]"}], "]"}], ",", "essurfaceness"}], 
           "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"branches0", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"kx2", ",", "ky2"}], "}"}], ",", 
               RowBox[{"{", "len", "}"}]}], "]"}], ",", 
             RowBox[{"Sequence", "@@", 
              RowBox[{"OrdSpectrum", "[", 
               RowBox[{"kx2", ",", "ky2"}], "]"}]}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"kx2", ",", "kxmin", ",", "kxmax", ",", "0.002"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"ky2", ",", "kymin", ",", "kymax", ",", "0.002"}], 
            "}"}]}], "]"}], ",", "1"}], "]"}]}], ";", "  ", 
      RowBox[{"(*", " ", 
       RowBox[{"quick", " ", "step", " ", "version"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"branches2", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"branches0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "1"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"branches1", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Interpolation", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{";;", ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}], "]"}], ",", 
            RowBox[{"Interpolation", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{";;", ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}]}], "]"}], "]"}], "]"}]}], 
           "}"}], "&"}], ",", "branches2"}], "]"}]}]}]}], "]"}]}], 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.800295791569434*^9, 3.800295813916039*^9}, {
   3.8002958468358927`*^9, 3.800295928779737*^9}, {3.8002959711413517`*^9, 
   3.8002959785330267`*^9}, 3.800296035433728*^9, 3.800296096390609*^9, {
   3.800296129103109*^9, 3.800296186000703*^9}, {3.8002962217643137`*^9, 
   3.800296361014516*^9}, {3.8002964544305677`*^9, 3.80029648426446*^9}, 
   3.800296571585622*^9, {3.8002977572548723`*^9, 3.800297785876911*^9}, {
   3.800297872657899*^9, 3.800297902287057*^9}, {3.800297975360424*^9, 
   3.800297976684094*^9}, {3.800298016482284*^9, 3.800298036060541*^9}, {
   3.800340497896017*^9, 3.800340513738266*^9}},
 CellLabel->
  "In[215]:=",ExpressionUUID->"0f6b3dc1-25ce-4bec-9ec8-0560517e6d62"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Ordinarydisp", "=", 
   RowBox[{"ParallelTable", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", 
       RowBox[{"Quiet", "[", 
        RowBox[{"SurfaceDispersion", "[", 
         RowBox[{"n", ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", ">", "0.5"}], ",", 
            RowBox[{"{", 
             RowBox[{"15", ",", "16"}], "}"}], ",", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"n", "<", 
               RowBox[{"-", "0.5"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"13", ",", "14"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"14", ",", "15"}], "}"}]}], "]"}]}], "]"}]}], "]"}], 
        "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", 
       RowBox[{"-", "4.2"}], ",", "4", ",", "0.1"}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.7691925611671057`*^9, 3.769192618594913*^9}, {
   3.769244713681484*^9, 3.7692447138806257`*^9}, {3.769366377662774*^9, 
   3.7693663847913847`*^9}, {3.769446543081997*^9, 3.7694465432645617`*^9}, {
   3.7694495628542128`*^9, 3.769449563450678*^9}, {3.7694501063619223`*^9, 
   3.769450135663384*^9}, {3.7694886474232273`*^9, 3.7694887069788094`*^9}, {
   3.769500402516749*^9, 3.769500403243218*^9}, {3.76950351372252*^9, 
   3.769503522694161*^9}, {3.769503704641879*^9, 3.76950371483006*^9}, {
   3.7695038873548117`*^9, 3.769503888670581*^9}, {3.769505507527752*^9, 
   3.769505512256172*^9}, {3.769870103564333*^9, 3.7698701101833363`*^9}, {
   3.770975653548376*^9, 3.7709756561468687`*^9}, 3.77098164019246*^9, {
   3.771063580349957*^9, 3.7710636470605793`*^9}, {3.771063716330406*^9, 
   3.771063758283532*^9}, {3.7713955197351017`*^9, 3.771395533726347*^9}, {
   3.771983901252964*^9, 3.7719839050881*^9}, {3.783195631432708*^9, 
   3.78319563309503*^9}, {3.800102130241555*^9, 3.800102130734879*^9}, {
   3.8002933028795033`*^9, 3.8002933035538893`*^9}, {3.800296690975953*^9, 
   3.800296701394352*^9}, 3.8004423109296017`*^9, {3.800443477914304*^9, 
   3.800443482230386*^9}, {3.802601579248465*^9, 3.802601617697019*^9}, {
   3.8026016978716383`*^9, 3.802601721234886*^9}, {3.802782248532433*^9, 
   3.802782269426869*^9}},
 CellLabel->
  "In[295]:=",ExpressionUUID->"89e33bdf-2a67-4655-9a34-e08e997f3899"],

Cell[BoxData[
 RowBox[{
  RowBox[{"OrdinarydispFull", "=", 
   RowBox[{"ParallelTable", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", 
       RowBox[{"Quiet", "[", 
        RowBox[{"SurfaceDispersion", "[", 
         RowBox[{"n", ",", 
          RowBox[{"Range", "[", 
           RowBox[{"NBilayer", ",", 
            RowBox[{"3", " ", "NBilayer"}]}], "]"}]}], "]"}], "]"}]}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", 
       RowBox[{"-", "4.2"}], ",", "4", ",", "0.1"}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8841816749901857`*^9, 3.88418167584006*^9}, {
  3.884181729812233*^9, 3.884181787130761*^9}},
 CellLabel->
  "In[245]:=",ExpressionUUID->"2922273c-6ecb-4aae-9688-786a7a804afa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DumpSave", "[", 
   RowBox[{
    RowBox[{"path", "<>", "\"\<OrdinaryDispEps25Attempt10.mx\>\""}], ",", 
    "OrdinarydispFull"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.884181844275331*^9, 3.884181857318221*^9}},
 CellLabel->
  "In[246]:=",ExpressionUUID->"0a244af9-bfbd-42a9-b914-6e8f4b25b98b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DumpSave", "[", 
   RowBox[{
    RowBox[{"path", "<>", "\"\<OrdinaryDispEps25NegGamma3g2-15.mx\>\""}], ",",
     "Ordinarydisp"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.7691925611671057`*^9, 3.769192618594913*^9}, {
   3.769244713681484*^9, 3.7692447138806257`*^9}, {3.769366377662774*^9, 
   3.7693663847913847`*^9}, {3.769446543081997*^9, 3.7694465432645617`*^9}, {
   3.7694495628542128`*^9, 3.769449563450678*^9}, {3.7694501063619223`*^9, 
   3.769450135663384*^9}, {3.7694886474232273`*^9, 3.7694887069788094`*^9}, {
   3.769500402516749*^9, 3.769500403243218*^9}, {3.76950351372252*^9, 
   3.769503522694161*^9}, {3.769503704641879*^9, 3.76950371483006*^9}, {
   3.7695038873548117`*^9, 3.769503888670581*^9}, {3.769505507527752*^9, 
   3.769505512256172*^9}, {3.769870103564333*^9, 3.7698701101833363`*^9}, {
   3.770975653548376*^9, 3.7709756561468687`*^9}, 3.77098164019246*^9, {
   3.771063580349957*^9, 3.7710636470605793`*^9}, {3.771063716330406*^9, 
   3.771063758283532*^9}, {3.7713955197351017`*^9, 3.771395533726347*^9}, {
   3.771983901252964*^9, 3.7719839050881*^9}, {3.783195631432708*^9, 
   3.78319563309503*^9}, {3.800102130241555*^9, 3.800102130734879*^9}, {
   3.8002933028795033`*^9, 3.8002933035538893`*^9}, {3.800296690975953*^9, 
   3.800296701394352*^9}, 3.8004423109296017`*^9, {3.800443477914304*^9, 
   3.800443482230386*^9}, {3.802601579248465*^9, 3.802601617697019*^9}, {
   3.8026016978716383`*^9, 3.802601721234886*^9}, {3.802782248532433*^9, 
   3.802782269426869*^9}, {3.827084827039022*^9, 3.827084839901453*^9}, {
   3.8271236765397987`*^9, 3.827123678781282*^9}},
 CellLabel->
  "In[296]:=",ExpressionUUID->"fb8a20e9-e0fb-47d0-aa9f-4377ac139f9e"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"Save", "[", 
   RowBox[{
    RowBox[{"path", "<>", "\"\<OrdinaryDispEps30ThesisSurfaceness4\>\""}], 
    ",", "Ordinarydisp"}], "]"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.800444223926499*^9, 3.8004442443725243`*^9}, {
  3.802782237864114*^9, 3.802782240305974*^9}},
 CellLabel->
  "In[297]:=",ExpressionUUID->"2b172dbd-22b5-461a-9eb4-e84a98203d57"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OrdinaryBranch", "[", "n_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Select", "[", 
     RowBox[{"OrdinarydispFull", ",", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "-", "n"}], "]"}], "<", "0.051"}],
         ")"}], "&"}]}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8841819250496798`*^9, 3.884181931421401*^9}},
 CellLabel->
  "In[247]:=",ExpressionUUID->"bdfed843-2be3-4709-8d4c-8223b016642f"],

Cell[BoxData[
 RowBox[{"Plot3D", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"OrdinaryBranch", "[", "2.1", "]"}], "[", 
     RowBox[{"[", 
      RowBox[{"5", ",", "1"}], "]"}], "]"}], "[", 
    RowBox[{"kx", ",", "ky"}], "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"kx", ",", 
     RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"ky", ",", 
     RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8841819908133*^9, 3.8841820599939327`*^9}, {
  3.884182093049728*^9, 3.884182098929337*^9}},
 CellLabel->
  "In[251]:=",ExpressionUUID->"f054fbff-4122-49ab-8289-1927a8d6777a"],

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{"<<", 
   RowBox[{"(", 
    RowBox[{"path", "<>", "\"\<OrdinaryDispEps25NegGamma3g2-15.mx\>\""}], 
    ")"}], " "}]}]], "Input",
 CellChangeTimes->{{3.800442283655365*^9, 3.8004422959610243`*^9}, {
  3.800444235450425*^9, 3.800444236444723*^9}, {3.800445955396941*^9, 
  3.800445956371916*^9}, {3.802782230946631*^9, 3.802782234405545*^9}, {
  3.884179334703915*^9, 3.884179389583908*^9}},
 CellLabel->
  "In[216]:=",ExpressionUUID->"1aac7d6a-8584-4d6e-adc6-112817804eab"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OrdinaryBranch", "[", "n_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Select", "[", 
     RowBox[{"Ordinarydisp", ",", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "-", "n"}], "]"}], "<", "0.051"}],
         ")"}], "&"}]}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.76948873186934*^9, 3.769488833868698*^9}, {
   3.769490116903109*^9, 3.769490117085133*^9}, {3.7709756263249397`*^9, 
   3.770975626474669*^9}, {3.770975662988817*^9, 3.770975678388516*^9}, {
   3.800296764027673*^9, 3.80029679197642*^9}, 3.800298168446293*^9},
 CellLabel->
  "In[299]:=",ExpressionUUID->"71402810-029b-4e70-bf4d-79257d6a036b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "DoPlotOrdinary", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.800347055874303*^9, 3.800347066914414*^9}},
 CellLabel->
  "In[300]:=",ExpressionUUID->"7f324b77-607e-4364-a826-ecfe19e79442"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"kxmin", "=", 
   RowBox[{"-", "0.1"}]}], ";", 
  RowBox[{"kxmax", "=", "0.08"}], ";", 
  RowBox[{"kymin", "=", 
   RowBox[{"-", "0.09"}]}], ";", 
  RowBox[{"kymax", "=", "0.09"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DoPlotOrdinary", "[", 
   RowBox[{"n_", ",", "Branches_", ",", "colors_", ",", 
    RowBox[{"threshold_:", "0.06"}], ",", 
    RowBox[{"vectorshift_:", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.033"}], ",", "0"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "Branches", "]"}]}], ",", "toplot"}], "}"}], 
    ",", 
    RowBox[{
     RowBox[{"toplot", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
         RowBox[{"[", "i", "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "Branches"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pl", "=", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"cp", "=", 
            RowBox[{"ContourPlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"toplot", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", 
                 RowBox[{"kx", ",", "ky"}], "]"}], ")"}], "\[Equal]", "0"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"kx", ",", "kxmin", ",", "kxmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"ky", ",", "kymin", ",", "kymax"}], "}"}], ",", 
              RowBox[{"PlotPoints", "\[Rule]", "40"}], ",", 
              RowBox[{"ContourShading", "\[Rule]", "None"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"bsps", "=", 
            RowBox[{"Cases", "[", 
             RowBox[{
              RowBox[{"Normal", "[", "cp", "]"}], ",", 
              RowBox[{
               RowBox[{"Line", "[", "x_", "]"}], "\[RuleDelayed]", 
               RowBox[{"BSplineFunction", "[", "x", "]"}]}], ",", "All"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ParametricPlot", "[", 
            RowBox[{
             RowBox[{"Evaluate", "@", 
              RowBox[{"Through", "[", 
               RowBox[{"bsps", "@", "t"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"t", ",", "0", ",", "1"}], "}"}], ",", 
             RowBox[{"PlotStyle", "\[Rule]", "Normal"}], ",", 
             RowBox[{"Frame", "\[Rule]", "True"}], ",", 
             RowBox[{"ColorFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Directive", "[", 
                 RowBox[{
                  RowBox[{"colors", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  RowBox[{"Opacity", "[", 
                   RowBox[{"3", "*", 
                    RowBox[{
                    RowBox[{"toplot", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", 
                    RowBox[{"#1", ",", "#2"}], "]"}]}], 
                   RowBox[{"(*", 
                    RowBox[{"UnitStep", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"toplot", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "[", 
                    RowBox[{"#1", ",", "#2"}], "]"}], "-", "threshold"}], 
                    "]"}], "*)"}], "]"}]}], "]"}], "&"}], ")"}]}], ",", 
             RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"kxmin", ",", "kxmax"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"kymin", ",", "kymax"}], "}"}]}], "}"}]}]}], "]"}]}],
           " ", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ",", 
        RowBox[{"Graphics", "[", 
         RowBox[{"{", 
          RowBox[{"Black", ",", "Dashed", ",", 
           RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
           RowBox[{"Arrow", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"vectorshift", "+", 
               RowBox[{
                RowBox[{"ShiftVectorGrid", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "/", "2"}]}], ",", 
              RowBox[{"vectorshift", "-", 
               RowBox[{
                RowBox[{"ShiftVectorGrid", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "/", "2"}]}]}], "}"}], 
            "]"}]}], "}"}], "]"}], ",", 
        RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
        RowBox[{"FrameTicks", "->", "None"}], ",", 
        RowBox[{"Axes", "\[Rule]", "None"}]}], "]"}]}], ";", " ", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"path", "<>", "\"\<OrdinaryFSn=\>\"", "<>", 
        RowBox[{"StringReplace", "[", 
         RowBox[{
          RowBox[{"ToString", "[", "n", "]"}], ",", 
          RowBox[{"\"\<.\>\"", "\[Rule]", "\"\<_\>\""}]}], "]"}], "<>", 
        "\"\<.pdf\>\""}], ",", "pl"}], "]"}], ";", "pl"}]}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.800256282698289*^9, 3.8002562826996813`*^9}, {
   3.8002564123047323`*^9, 3.8002564124055243`*^9}, {3.8002564715944242`*^9, 
   3.800256486029975*^9}, {3.800256517878071*^9, 3.8002566293807583`*^9}, {
   3.800256667505402*^9, 3.800256708364801*^9}, {3.80025679571812*^9, 
   3.8002567992745256`*^9}, {3.8002569635515537`*^9, 3.800256996197077*^9}, 
   3.800257037733008*^9, {3.800257277405538*^9, 3.8002572844518833`*^9}, {
   3.800257343176292*^9, 3.800257343631628*^9}, {3.800257387380601*^9, 
   3.800257400251565*^9}, {3.800257472090844*^9, 3.800257476609681*^9}, {
   3.800257527145002*^9, 3.800257531395804*^9}, {3.800257565521946*^9, 
   3.800257586214148*^9}, 3.800257628339691*^9, {3.8002578428365183`*^9, 
   3.800257846356336*^9}, {3.8002578995040693`*^9, 3.800257928444798*^9}, {
   3.800258325796176*^9, 3.800258372981462*^9}, {3.800258599899601*^9, 
   3.800258624922125*^9}, {3.8002597737366858`*^9, 3.8002598679800577`*^9}, {
   3.8002603935562763`*^9, 3.800260393667797*^9}, {3.800260449160193*^9, 
   3.800260457700245*^9}, {3.800260543705143*^9, 3.800260544340844*^9}, {
   3.80026072641191*^9, 3.800260764585816*^9}, {3.800266395542358*^9, 
   3.8002664554357433`*^9}, {3.800267258530558*^9, 3.800267280520956*^9}, {
   3.8002875017057333`*^9, 3.8002875020069637`*^9}, {3.8002918173344603`*^9, 
   3.800291817877017*^9}, {3.800336666089363*^9, 3.800336685792296*^9}, {
   3.800336719114058*^9, 3.800336815732777*^9}, {3.8003372575337133`*^9, 
   3.800337260203993*^9}, {3.80033729066535*^9, 3.800337434655518*^9}, {
   3.8003375356190987`*^9, 3.800337661486828*^9}, {3.8003376950284986`*^9, 
   3.800337737636529*^9}, {3.80033777078972*^9, 3.8003377760771227`*^9}, {
   3.800337875282476*^9, 3.800337880541877*^9}, {3.800338099619698*^9, 
   3.800338122835453*^9}, {3.800339990760318*^9, 3.800340031976399*^9}, {
   3.800340228059925*^9, 3.800340255396789*^9}, {3.800346956825357*^9, 
   3.800346973766193*^9}, 3.802782580359954*^9},
 CellLabel->
  "In[301]:=",ExpressionUUID->"5c4570e1-a863-40fb-8507-d6382adeacdb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DoPlotOrdinary1", "[", 
   RowBox[{"n_", ",", "Branches_", ",", "colors_", ",", 
    RowBox[{"threshold_:", "0.06"}], ",", 
    RowBox[{"vectorshift_:", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.033"}], ",", "0"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "Branches", "]"}]}], ",", "toplot"}], "}"}], 
    ",", 
    RowBox[{
     RowBox[{"toplot", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
         RowBox[{"[", "i", "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "Branches"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pl", "=", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"cp", "=", 
           RowBox[{"ContourPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"toplot", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "[", 
                RowBox[{"kx", ",", "ky"}], "]"}], ")"}], "\[Equal]", "0"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"kx", ",", "kxmin", ",", "kxmax"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"ky", ",", "kymin", ",", "kymax"}], "}"}], ",", 
             RowBox[{"PlotPoints", "\[Rule]", "40"}], ",", 
             RowBox[{"ContourShading", "\[Rule]", "None"}], ",", 
             RowBox[{"ContourStyle", "\[Rule]", 
              RowBox[{"colors", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "Branches"}], "}"}]}], "]"}], ",", 
        RowBox[{"Graphics", "[", 
         RowBox[{"{", 
          RowBox[{"Black", ",", "Dashed", ",", 
           RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
           RowBox[{"Arrow", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"vectorshift", "+", 
               RowBox[{
                RowBox[{"ShiftVectorGrid", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "/", "2"}]}], ",", 
              RowBox[{"vectorshift", "-", 
               RowBox[{
                RowBox[{"ShiftVectorGrid", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "/", "2"}]}]}], "}"}], 
            "]"}]}], "}"}], "]"}], ",", 
        RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
        RowBox[{"FrameTicks", "->", "None"}], ",", 
        RowBox[{"Axes", "\[Rule]", "None"}]}], "]"}]}], ";", " ", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"path", "<>", "\"\<OrdinaryFS1n=\>\"", "<>", 
        RowBox[{"StringReplace", "[", 
         RowBox[{
          RowBox[{"ToString", "[", "n", "]"}], ",", 
          RowBox[{"\"\<.\>\"", "\[Rule]", "\"\<_\>\""}]}], "]"}], "<>", 
        "\"\<.pdf\>\""}], ",", "pl"}], "]"}], ";", "pl"}]}], "]"}]}]], "Input",\

 CellChangeTimes->{
  3.8004459993519163`*^9, {3.800446048835163*^9, 3.8004461312600613`*^9}, {
   3.80044621972539*^9, 3.800446278164481*^9}, {3.800446311971985*^9, 
   3.800446312399006*^9}, 3.802782581177835*^9},
 CellLabel->
  "In[303]:=",ExpressionUUID->"525ebcb4-170f-40fc-8512-37940fb8ea7c"],

Cell[BoxData[
 RowBox[{"DoPlotOrdinary1", "[", 
  RowBox[{
   RowBox[{"-", "3.8"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Red"}], "}"}], ",", "0.05", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "0.029"}], ",", "0.014"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{
  3.800446158830783*^9, {3.8026730958386908`*^9, 3.80267316249043*^9}, {
   3.802782323080695*^9, 3.802782366652759*^9}, {3.802782487488256*^9, 
   3.802782493359654*^9}},
 CellLabel->
  "In[304]:=",ExpressionUUID->"aae43b48-b728-4010-8980-656dee89114b"],

Cell[BoxData[
 RowBox[{"DoPlotOrdinary", "[", 
  RowBox[{
   RowBox[{"-", "4.2"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Red"}], "}"}], ",", "0.05", ",", 
   RowBox[{"{", 
    RowBox[{"0.027", ",", "0.012"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.800340392243393*^9, 3.800340408600219*^9}, {
  3.800340463572591*^9, 3.80034046369387*^9}, {3.800340891743073*^9, 
  3.800340900170794*^9}},
 CellLabel->
  "In[305]:=",ExpressionUUID->"475778f4-13ad-4045-871b-b242c3fa5041"],

Cell[BoxData[
 RowBox[{"DoPlotOrdinary1", "[", 
  RowBox[{
   RowBox[{"-", "2.6"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Red"}], "}"}], ",", "0.05", ",", 
   RowBox[{"{", 
    RowBox[{"0.030", ",", "0"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{3.800446351605706*^9},
 CellLabel->
  "In[306]:=",ExpressionUUID->"cf654af9-f765-4544-b975-74f66e70f532"],

Cell[BoxData[
 RowBox[{"DoPlotOrdinary", "[", 
  RowBox[{
   RowBox[{"-", "2.4"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Red"}], "}"}], ",", "0.02", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "0.030"}], ",", "0"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.800340316773085*^9, 3.800340376923921*^9}, {
  3.802673188769039*^9, 3.8026732336239443`*^9}},
 CellLabel->
  "In[307]:=",ExpressionUUID->"807cd1e7-a053-4eb5-adf0-01a86de4a482"],

Cell[BoxData[
 RowBox[{"DoPlotOrdinary1", "[", 
  RowBox[{
   RowBox[{"-", "1.4"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Red"}], "}"}], ",", "0.02"}], "]"}]], "Input",
 CellChangeTimes->{
  3.800446371370577*^9, {3.802601949939184*^9, 3.80260195232123*^9}},
 CellLabel->
  "In[308]:=",ExpressionUUID->"c54bbacb-ff8d-410c-94c7-b1544df42232"],

Cell[BoxData[
 RowBox[{"DoPlotOrdinary", "[", 
  RowBox[{
   RowBox[{"-", "1.4"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Red"}], "}"}], ",", "0.05"}], "]"}]], "Input",
 CellChangeTimes->{{3.8003402752260237`*^9, 3.8003402833865356`*^9}},
 CellLabel->
  "In[309]:=",ExpressionUUID->"ae5b378f-aa98-4793-9cb4-0c25c1e16931"],

Cell[BoxData[
 RowBox[{"DoPlotOrdinary1", "[", 
  RowBox[{"1.8", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Blue", ",", "Blue"}], "}"}], ",", "0.05"}], "]"}]], "Input",
 CellChangeTimes->{
  3.8004463880556192`*^9, {3.802673051921773*^9, 3.802673052103134*^9}, {
   3.802782551217795*^9, 3.8027825575003853`*^9}},
 CellLabel->
  "In[310]:=",ExpressionUUID->"8a1d30cc-70a0-4fd6-be12-3cb5129d221a"],

Cell[BoxData[
 RowBox[{"DoPlotOrdinary", "[", 
  RowBox[{"0.8", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Blue", ",", "Blue"}], "}"}], ",", "0.05"}], "]"}]], "Input",
 CellChangeTimes->{{3.80033796765277*^9, 3.800337972511825*^9}, {
  3.800338006913649*^9, 3.8003380348999662`*^9}, {3.80267328821494*^9, 
  3.802673291664953*^9}},
 CellLabel->
  "In[311]:=",ExpressionUUID->"0f095dd3-6a83-4839-839a-922dbf500f56"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8026733882847357`*^9, 3.8026733948178663`*^9}},
 CellLabel->
  "In[312]:=",ExpressionUUID->"1807ac40-42b5-4b51-878f-f28723f4e03b"],

Cell[BoxData[
 RowBox[{"DoPlotOrdinary1", "[", 
  RowBox[{"2.0", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Blue", ",", "Blue"}], "}"}], ",", "0.05"}], "]"}]], "Input",
 CellChangeTimes->{3.8004464004470377`*^9},
 CellLabel->
  "In[313]:=",ExpressionUUID->"f796bc5c-7b8c-41ba-8482-eb4ec84cdaf4"],

Cell[BoxData[
 RowBox[{"DoPlotOrdinary", "[", 
  RowBox[{"2.0", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Blue", ",", "Blue"}], "}"}], ",", "0.05"}], "]"}]], "Input",
 CellChangeTimes->{{3.8003368012041893`*^9, 3.800336844726058*^9}, {
   3.800336880313593*^9, 3.800336917203918*^9}, 3.800336953085092*^9, {
   3.800337803687421*^9, 3.800337818835301*^9}, {3.800337919091228*^9, 
   3.8003379208867893`*^9}, {3.800338044945238*^9, 3.800338045148837*^9}},
 CellLabel->
  "In[314]:=",ExpressionUUID->"ef80128c-0aef-4af7-80e5-f44eccf01ad0"],

Cell[BoxData[
 RowBox[{"DoPlotOrdinary1", "[", 
  RowBox[{"3.5", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Blue", ",", "Blue"}], "}"}], ",", "0.05", ",", 
   RowBox[{"{", 
    RowBox[{"0.032", ",", "0.011"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{3.8004464168107567`*^9},
 CellLabel->
  "In[315]:=",ExpressionUUID->"fec03556-7f4d-44dd-bcae-34551a6b7783"],

Cell[BoxData[
 RowBox[{"DoPlotOrdinary", "[", 
  RowBox[{"3.5", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Blue", ",", "Blue"}], "}"}], ",", "0.05", ",", 
   RowBox[{"{", 
    RowBox[{"0.032", ",", "0.011"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.800339908926499*^9, 3.800339921098257*^9}, {
  3.800340046406355*^9, 3.800340102905641*^9}},
 CellLabel->
  "In[316]:=",ExpressionUUID->"ea403e1d-140e-4350-a19a-2775d7ec7804"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Moire dispersion", "Subsubsection",
 CellChangeTimes->{{3.800295620524263*^9, 
  3.800295623924047*^9}},ExpressionUUID->"5830d457-c132-42a5-859e-\
f3bc716806dc"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MoireDispersion", "[", 
    RowBox[{"dens_", ",", "branches_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"kxmin", "=", 
        RowBox[{"-", "0.08001"}]}], ",", 
       RowBox[{"kxmax", "=", "0.08"}], ",", 
       RowBox[{"kymin", "=", 
        RowBox[{"-", "0.08001"}]}], ",", 
       RowBox[{"kymax", "=", "0.08"}], ",", "branches1", ",", "branches2", 
       ",", "branches0"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"DeltaVector", "=", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"PotentialTable", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
             RowBox[{
              RowBox[{"Round", "[", 
               RowBox[{
                RowBox[{"Dens2V", "[", "dens", "]"}], "*", "200"}], "]"}], 
              "/", "200"}]}], ")"}], "&"}]}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"H", "=", 
       RowBox[{"ConstructH", "[", 
        RowBox[{"DeltaVector", ",", " ", "NBilayer", ",", "kx", ",", "ky"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "ShiftVectorGrid", "]"}]}], ";", " ", 
      RowBox[{"lenb", "=", 
       RowBox[{"Length", "[", "branches", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"MoireSpectrum", "[", 
        RowBox[{"kx1_", ",", "ky1_"}], "]"}], ":=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", "}"}], ",", 
         RowBox[{
          RowBox[{"es", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Sort", "[", 
               RowBox[{
                RowBox[{"Transpose", "[", 
                 RowBox[{"Eigensystem", "[", 
                  RowBox[{"H", "/.", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"kx", "\[Rule]", 
                    RowBox[{"kx1", "+", 
                    RowBox[{"ShiftVectorGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}]}]}], ",", 
                    RowBox[{"ky", "\[Rule]", 
                    RowBox[{"ky1", "+", 
                    RowBox[{"ShiftVectorGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}]}]}]}], "}"}]}], 
                  "]"}], "]"}], ",", "  ", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<", 
                   RowBox[{"#2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "&"}]}], "]"}], 
              "[", 
              RowBox[{"[", "branches", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "len"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"essurfaceness", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"es", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", ";;", ",", "2", ",", "1"}], "]"}], "]"}], 
               "]"}], "^", "2"}], "+", 
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"es", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", ";;", ",", "2", ",", "2"}], "]"}], "]"}], 
               "]"}], "^", "2"}], "+", 
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"es", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", ";;", ",", "2", ",", "3"}], "]"}], "]"}], 
               "]"}], "^", "2"}], "+", 
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{"es", "[", 
                RowBox[{"[", 
                 RowBox[{";;", ",", ";;", ",", "2", ",", "4"}], "]"}], "]"}], 
               "]"}], "^", "2"}]}], "]"}]}], ";", " ", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "Matrix", " ", "of", " ", "size", " ", "len", " ", "x", " ", 
             "lenb"}], ",", " ", "flattened"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"HMoire", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"v4elem", "=", 
                 RowBox[{"Total", "[", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ShiftVectorGrid", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "-", 
                    RowBox[{"ShiftVectorGrid", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[Equal]", 
                    RowBox[{"Gvecs", "[", 
                    RowBox[{"[", "m", "]"}], "]"}]}], ",", 
                    RowBox[{"(", 
                    RowBox[{"kx1", " ", "+", " ", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"ShiftVectorGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "+", 
                    RowBox[{"ShiftVectorGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "1"}], "]"}], "]"}]}], ")"}], "/", 
                    "2"}], " ", "-", " ", 
                    RowBox[{"I", " ", 
                    RowBox[{"(", 
                    RowBox[{"ky1", " ", "+", " ", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"ShiftVectorGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "+", 
                    RowBox[{"ShiftVectorGrid", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "2"}], "]"}], "]"}]}], ")"}], "/", 
                    "2"}]}], ")"}]}]}], ")"}], ",", "0"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"m", ",", "6"}], "}"}]}], "]"}], "]"}]}], ";", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"i", "\[Equal]", "j"}], " ", "&&", " ", 
                    RowBox[{"n1", "==", "n2"}]}], ",", 
                   RowBox[{"es", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "n1", ",", "1"}], "]"}], "]"}], ",", 
                   "0"}], "]"}], " ", "+", " ", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Conjugate", "[", 
                    RowBox[{"es", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "n2", ",", "2", ",", "2"}], "]"}], 
                    "]"}], "]"}], ",", 
                    RowBox[{"Conjugate", "[", 
                    RowBox[{"es", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "n2", ",", "2", ",", "1"}], "]"}], 
                    "]"}], "]"}]}], "}"}], ".", " ", 
                  RowBox[{"Total", "[", 
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ShiftVectorGrid", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "-", 
                    RowBox[{"ShiftVectorGrid", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "\[Equal]", 
                    RowBox[{"Gvecs", "[", 
                    RowBox[{"[", "m", "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"U0", " ", "\[Sigma]0"}], "+", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "1"}], ")"}], "^", 
                    RowBox[{"(", 
                    RowBox[{"m", "-", "1"}], ")"}]}], " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"I", " ", "U3", " ", "\[Sigma]3"}], " ", "+", " ", 
                    RowBox[{"U1", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Gvecs", "[", 
                    RowBox[{"[", 
                    RowBox[{"m", ",", "2"}], "]"}], "]"}]}], "/", "Glen"}], 
                    " ", "\[Sigma]1"}], " ", "+", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Gvecs", "[", 
                    RowBox[{"[", 
                    RowBox[{"m", ",", "1"}], "]"}], "]"}], "/", "Glen"}], " ",
                     "\[Sigma]2"}]}], ")"}]}]}], ")"}]}]}], ",", 
                    RowBox[{"0", "\[Sigma]0"}]}], "]"}], "/.", 
                    "MoireParams"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"m", ",", "6"}], "}"}]}], "]"}], "]"}], ".", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"es", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "n1", ",", "2", ",", "2"}], "]"}], 
                    "]"}], ",", 
                    RowBox[{"es", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "n1", ",", "2", ",", "1"}], "]"}], 
                    "]"}]}], "}"}]}], "+", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Sqrt", "[", "3", "]"}], "/", "2"}], " ", 
                  RowBox[{"(", 
                   RowBox[{"vargamma4", "/.", "MoireParams"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Conjugate", "[", 
                    RowBox[{"es", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "n2", ",", "2", ",", "2"}], "]"}], 
                    "]"}], "]"}], " ", 
                    RowBox[{"es", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "n1", ",", "2", ",", "4"}], "]"}], 
                    "]"}], "  ", "v4elem"}], " ", "+", " ", 
                    RowBox[{
                    RowBox[{"Conjugate", "[", 
                    RowBox[{"es", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "n2", ",", "2", ",", "4"}], "]"}], 
                    "]"}], "]"}], " ", 
                    RowBox[{"es", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "n1", ",", "2", ",", "2"}], "]"}], 
                    "]"}], "  ", 
                    RowBox[{"Conjugate", "[", "v4elem", " ", "]"}]}]}], 
                   ")"}]}], "+", " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"vargamma1", "/.", "MoireParams"}], ")"}], " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Conjugate", "[", 
                    RowBox[{"es", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "n2", ",", "2", ",", "1"}], "]"}], 
                    "]"}], "]"}], " ", 
                    RowBox[{"es", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "n1", ",", "2", ",", "3"}], "]"}], 
                    "]"}]}], "  ", "+", " ", 
                    RowBox[{
                    RowBox[{"Conjugate", "[", 
                    RowBox[{"es", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "n2", ",", "2", ",", "3"}], "]"}], 
                    "]"}], "]"}], " ", 
                    RowBox[{"es", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "n1", ",", "2", ",", "1"}], "]"}], 
                    "]"}]}]}], " ", ")"}]}]}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "len"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"n1", ",", "lenb"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "len"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"n2", ",", "lenb"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"3", ",", "4"}], "}"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"esMoire", "=", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Eigensystem", "[", "HMoire", "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"esMoire", "=", 
           RowBox[{"Sort", "[", 
            RowBox[{"esMoire", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Re", "[", 
                RowBox[{"#1", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "<", 
               RowBox[{"Re", "[", 
                RowBox[{"#2", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Re", "[", 
             RowBox[{"esMoire", "[", 
              RowBox[{"[", 
               RowBox[{";;", ",", "1"}], "]"}], "]"}], "]"}], ",", 
            RowBox[{"Abs", "[", 
             RowBox[{
              RowBox[{"esMoire", "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "2"}], "]"}], "]"}], ".", 
              "essurfaceness"}], "]"}]}], "}"}]}]}], " ", 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"branches0", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"kx2", ",", "ky2"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"len", "*", "lenb"}], "}"}]}], "]"}], ",", 
             RowBox[{"Sequence", "@@", 
              RowBox[{"MoireSpectrum", "[", 
               RowBox[{"kx2", ",", "ky2"}], "]"}]}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"kx2", ",", "kxmin", ",", "kxmax", ",", "0.001"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"ky2", ",", "kymin", ",", "kymax", ",", "0.001"}], 
            "}"}]}], "]"}], ",", "1"}], "]"}]}], ";", "  ", 
      RowBox[{"(*", " ", 
       RowBox[{"quick", " ", "step", " ", "version"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"branches2", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"branches0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3", ",", "1"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"branches1", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Interpolation", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{";;", ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}], "]"}], ",", 
            RowBox[{"Interpolation", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", 
               RowBox[{";;", ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "3"}], "}"}]}], "]"}], "]"}], "]"}]}], 
           "}"}], "&"}], ",", "branches2"}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.771062517054695*^9, 3.771062519190377*^9}, {
   3.771062596189234*^9, 3.771062609049389*^9}, {3.771062654597372*^9, 
   3.7710626814036283`*^9}, {3.771062952306069*^9, 3.771062985219009*^9}, {
   3.771063195257265*^9, 3.771063205252927*^9}, {3.771063248693227*^9, 
   3.771063316780815*^9}, {3.77106337309487*^9, 3.771063384777597*^9}, {
   3.771063427533751*^9, 3.7710634641907377`*^9}, {3.771078648287199*^9, 
   3.771078717897768*^9}, {3.771983711732132*^9, 3.771983845534047*^9}, {
   3.78315472850041*^9, 3.783154745881846*^9}, {3.783193876002016*^9, 
   3.7831939541110353`*^9}, {3.80008673554574*^9, 3.800086757518859*^9}, {
   3.800086810392428*^9, 3.800086813891138*^9}, {3.80008684605365*^9, 
   3.800086874455378*^9}, {3.800086913811254*^9, 3.800086932066255*^9}, {
   3.800086969989614*^9, 3.800086990643943*^9}, {3.800087658274247*^9, 
   3.800087670002906*^9}, {3.800087702995973*^9, 3.800087837661728*^9}, {
   3.800099378793405*^9, 3.800099409839069*^9}, {3.800099444696343*^9, 
   3.800099515065671*^9}, {3.800099773821677*^9, 3.800099791574785*^9}, {
   3.800099934584949*^9, 3.8000999579464207`*^9}, {3.8001000017665863`*^9, 
   3.8001000130862513`*^9}, {3.800100044495476*^9, 3.800100120111994*^9}, {
   3.800100213168816*^9, 3.800100239609561*^9}, {3.800100290297675*^9, 
   3.800100437347887*^9}, {3.800100982510878*^9, 3.800101018713139*^9}, {
   3.800101518765695*^9, 3.800101523715748*^9}, {3.800101666424119*^9, 
   3.800101678705378*^9}, {3.800101789313882*^9, 3.800101809613185*^9}, {
   3.8001019067766037`*^9, 3.800101914490073*^9}, {3.800101968657888*^9, 
   3.800101970174111*^9}, 3.800102004726025*^9, {3.800102098646052*^9, 
   3.800102102252853*^9}, {3.800274859684524*^9, 3.8002748720547543`*^9}, {
   3.802337356250345*^9, 3.802337364019349*^9}, {3.802337430545043*^9, 
   3.802337523415633*^9}, {3.802337556233634*^9, 3.8023376420625467`*^9}, {
   3.802585524321604*^9, 3.802585539116572*^9}, 3.8025883433340816`*^9, {
   3.8025883944944687`*^9, 3.802588404310997*^9}, {3.802588458040728*^9, 
   3.8025884715989513`*^9}, {3.8025885352141857`*^9, 3.802588610678905*^9}, {
   3.80259164758375*^9, 3.802591714839452*^9}, {3.802718566291423*^9, 
   3.8027185758709106`*^9}, {3.802782702014484*^9, 3.802782704986722*^9}, {
   3.802843167317561*^9, 3.802843210055224*^9}},
 CellLabel->
  "In[219]:=",ExpressionUUID->"c0cac0e7-472c-4e58-b610-81bab6460a38"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Direct computation of Moire ", "Subsection",
 CellChangeTimes->{{3.787060441077652*^9, 3.787060453684483*^9}, 
   3.800443559919446*^9},ExpressionUUID->"58e99f97-18fa-407e-a271-\
28394414f688"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"disp", "=", 
   RowBox[{"ParallelTable", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", 
       RowBox[{"Quiet", "[", 
        RowBox[{"MoireDispersion", "[", 
         RowBox[{"n", ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", ">", "0.5"}], ",", 
            RowBox[{"{", 
             RowBox[{"15", ",", "16"}], "}"}], ",", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"n", "<", 
               RowBox[{"-", "0.5"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"13", ",", "14"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"14", ",", "15"}], "}"}]}], "]"}]}], "]"}]}], "]"}], 
        "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", 
       RowBox[{"-", "4.2"}], ",", "4", ",", "0.1"}], "}"}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"DumpSave", "[", 
   RowBox[{
    RowBox[{"path", "<>", "\"\<MoireDispEps25Attempt10.mx\>\""}], ",", 
    "disp"}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.7691925611671057`*^9, 3.769192618594913*^9}, {
   3.769244713681484*^9, 3.7692447138806257`*^9}, {3.769366377662774*^9, 
   3.7693663847913847`*^9}, {3.769446543081997*^9, 3.7694465432645617`*^9}, {
   3.7694495628542128`*^9, 3.769449563450678*^9}, {3.7694501063619223`*^9, 
   3.769450135663384*^9}, {3.7694886474232273`*^9, 3.7694887069788094`*^9}, {
   3.769500402516749*^9, 3.769500403243218*^9}, {3.76950351372252*^9, 
   3.769503522694161*^9}, {3.769503704641879*^9, 3.76950371483006*^9}, {
   3.7695038873548117`*^9, 3.769503888670581*^9}, {3.769505507527752*^9, 
   3.769505512256172*^9}, {3.769870103564333*^9, 3.7698701101833363`*^9}, {
   3.770975653548376*^9, 3.7709756561468687`*^9}, 3.77098164019246*^9, {
   3.771063580349957*^9, 3.7710636470605793`*^9}, {3.771063716330406*^9, 
   3.771063758283532*^9}, {3.7713955197351017`*^9, 3.771395533726347*^9}, {
   3.771983901252964*^9, 3.7719839050881*^9}, {3.783195631432708*^9, 
   3.78319563309503*^9}, {3.800102130241555*^9, 3.800102130734879*^9}, {
   3.8002933028795033`*^9, 3.8002933035538893`*^9}, {3.800443626952958*^9, 
   3.800443634992237*^9}, {3.8025504901159353`*^9, 3.802550515298038*^9}, {
   3.80255061484179*^9, 3.802550650720653*^9}, {3.802782722864279*^9, 
   3.8027827285459433`*^9}, {3.80283861013792*^9, 3.8028386112137527`*^9}, {
   3.827085022220993*^9, 3.827085040411751*^9}, {3.8271237089862547`*^9, 
   3.827123711796885*^9}, 3.827175379927805*^9, {3.827208901058906*^9, 
   3.827208901537524*^9}, {3.8272383346474257`*^9, 3.8272383441254473`*^9}, {
   3.827287707771925*^9, 3.827287708324048*^9}},
 CellLabel->
  "In[318]:=",ExpressionUUID->"3e71a3c8-8f6f-4658-9abf-1933a64dd6c3"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{"Save", "[", 
    RowBox[{
     RowBox[{"path", "<>", "\"\<MoireDispEps27DresselhausCorr.mx\>\""}], ",", 
     "disp"}], "]"}], ";"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.800444265134103*^9, 3.800444276073172*^9}, 
   3.802550548999505*^9},
 CellLabel->
  "In[320]:=",ExpressionUUID->"780dda66-5363-4fff-9074-c05359837437"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"<<", 
    RowBox[{"(", 
     RowBox[{"path", "<>", "\"\<MoireDispEps25Attempt10.mx\>\""}], ")"}]}], 
   ";"}], " "}]], "Input",
 CellChangeTimes->{{3.797679435308119*^9, 3.7976794622932587`*^9}, 
   3.800443650148367*^9, {3.800444270000566*^9, 3.800444270400103*^9}, {
   3.8004464384093113`*^9, 3.800446439012105*^9}, 3.8025508332705917`*^9, {
   3.802787617567417*^9, 3.802787624893326*^9}, {3.80283865696166*^9, 
   3.8028386611887503`*^9}, {3.884179894932212*^9, 3.884179904980543*^9}},
 CellLabel->
  "In[225]:=",ExpressionUUID->"636d581d-5a18-486a-aa51-ad1e08adb0e8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Branch", "[", "n_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Select", "[", 
    RowBox[{"disp", ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "-", "n"}], "]"}], "<", "0.051"}], 
       ")"}], "&"}]}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"1", ",", "2"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.76948873186934*^9, 3.769488833868698*^9}, {
  3.769490116903109*^9, 3.769490117085133*^9}, {3.7709756263249397`*^9, 
  3.770975626474669*^9}, {3.770975662988817*^9, 3.770975678388516*^9}},
 CellLabel->
  "In[226]:=",ExpressionUUID->"13601ffa-a59d-4d48-80c6-b14a9bb6ba38"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{"OrdinaryBranch", "[", "n_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Select", "[", 
     RowBox[{"Ordinarydisp", ",", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "-", "n"}], "]"}], "<", "0.05"}], 
        ")"}], "&"}]}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"1", ",", "2"}], "]"}], "]"}]}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.769511922741919*^9, 3.769511930653842*^9}, {
  3.7702293615907593`*^9, 3.770229364122258*^9}},
 CellLabel->
  "In[323]:=",ExpressionUUID->"8b5e984e-ef4b-457a-bfab-3b92dc5b4adc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"n", "=", "2.1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"pl2", "=", 
  RowBox[{"Plot3D", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"3", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"4", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"5", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"kx", ",", "ky"}], "}"}], "\[Element]", "MoireBZ"}], ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.05"}], ",", "0.05"}], "}"}]}], ",", 
    RowBox[{"ClippingStyle", "\[Rule]", "None"}], ",", 
    RowBox[{"PlotPoints", "\[Rule]", "40"}], ",", 
    RowBox[{"Mesh", "\[Rule]", "False"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.768902200800651*^9, 3.768902203982953*^9}, {
   3.7694888973295507`*^9, 3.76948890426122*^9}, 3.769498084265641*^9, {
   3.7694985610644083`*^9, 3.769498571736429*^9}, {3.769498614279537*^9, 
   3.769498617091756*^9}, {3.769929805763681*^9, 3.769929813646174*^9}, {
   3.7699298864352703`*^9, 3.76992989164991*^9}, {3.7699718833275127`*^9, 
   3.769971889052442*^9}, 3.77098166985215*^9, {3.770997420020068*^9, 
   3.770997420365841*^9}, {3.7710856115440702`*^9, 3.7710856165534573`*^9}, {
   3.771085741819952*^9, 3.771085751719789*^9}, {3.7710858070983267`*^9, 
   3.77108586941533*^9}, {3.7831518182790327`*^9, 3.783151818395852*^9}, {
   3.783233334804389*^9, 3.783233346380199*^9}, {3.8841799309239798`*^9, 
   3.8841799878726673`*^9}, {3.8841800345841084`*^9, 3.884180048161977*^9}, {
   3.884180119772354*^9, 3.884180121996471*^9}, {3.884183439405177*^9, 
   3.884183460689631*^9}, {3.884184053517817*^9, 3.884184054524301*^9}, {
   3.884184317779917*^9, 3.884184326784587*^9}, {3.8841844139647713`*^9, 
   3.884184418463718*^9}, {3.884188728621641*^9, 3.88418872913966*^9}},
 CellLabel->
  "In[300]:=",ExpressionUUID->"e8d2089f-def7-4ea6-bf27-42066323eab5"],

Cell[BoxData[
 RowBox[{"pl1", "=", 
  RowBox[{"Plot3D", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"4", ",", "1"}], "]"}], "]"}], "[", 
       RowBox[{"kx", ",", "ky"}], "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"5", ",", "1"}], "]"}], "]"}], "[", 
       RowBox[{"kx", ",", "ky"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"6", ",", "1"}], "]"}], "]"}], "[", 
       RowBox[{"kx", ",", "ky"}], "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"7", ",", "1"}], "]"}], "]"}], "[", 
       RowBox[{"kx", ",", "ky"}], "]"}], ",", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"OrdinaryBranch", "[", "2.1", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"9", ",", "1"}], "]"}], "]"}], "[", 
         RowBox[{"kx", ",", "ky"}], "]"}], ","}], "*)"}], 
      RowBox[{
       RowBox[{
        RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"10", ",", "1"}], "]"}], "]"}], "[", 
       RowBox[{"kx", ",", "ky"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"11", ",", "1"}], "]"}], "]"}], "[", 
       RowBox[{"kx", ",", "ky"}], "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"12", ",", "1"}], "]"}], "]"}], "[", 
       RowBox[{"kx", ",", "ky"}], "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"kx", ",", 
      RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ky", ",", 
      RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}], ",", 
    RowBox[{"AxesLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
      "\"\<kx (\!\(\*SuperscriptBox[\(nm\), \(-1\)]\))\>\"", ",", 
       "\"\<ky (\!\(\*SuperscriptBox[\(nm\), \(-1\)]\))\>\"", ",", 
       "\"\<\[Epsilon]-\!\(\*SubscriptBox[\(\[Epsilon]\), \(F\)]\) \
(eV)\>\""}], "}"}]}], ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.05"}], ",", "0.05"}], "}"}]}], ",", 
    RowBox[{"ClippingStyle", "\[Rule]", "None"}], ",", 
    RowBox[{"PlotPoints", "\[Rule]", "40"}], ",", 
    RowBox[{"Mesh", "\[Rule]", "False"}], ",", 
    RowBox[{"PlotStyle", "\[Rule]", 
     RowBox[{"Directive", "[", 
      RowBox[{"Opacity", "[", "0.5", "]"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.884183557717313*^9, 3.884183633626259*^9}, {
  3.8841836837526407`*^9, 3.884183709037619*^9}, {3.8841837414747763`*^9, 
  3.884183743499144*^9}, {3.884183957869342*^9, 3.884183980768051*^9}, {
  3.884184038523335*^9, 3.884184039777135*^9}, {3.884185997063284*^9, 
  3.8841860020513*^9}, {3.884186087762786*^9, 3.884186114060245*^9}, {
  3.884188655162857*^9, 3.884188706572378*^9}},
 CellLabel->
  "In[302]:=",ExpressionUUID->"2dc7c35d-86c3-49be-aee2-acde5b0abf54"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{"pl1", ",", "pl2", ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.05"}], ",", "0"}], "}"}]}], ",", 
   RowBox[{"AxesStyle", "\[Rule]", "Black"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.884184361860775*^9, 3.884184367735574*^9}, {
   3.884184430849525*^9, 3.884184443330637*^9}, 3.884185926212329*^9, 
   3.884188965785265*^9, {3.884189021928782*^9, 3.8841890292928553`*^9}},
 CellLabel->
  "In[303]:=",ExpressionUUID->"66f19b22-d7a9-40f9-bdff-56a30c8b9906"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"n", "=", "3.8"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"pl2", "=", 
  RowBox[{"Plot3D", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"3", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"4", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"5", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"kx", ",", "ky"}], "}"}], "\[Element]", "MoireBZ"}], ",", 
    RowBox[{"AxesLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
      "\"\<kx (\!\(\*SuperscriptBox[\(nm\), \(-1\)]\))\>\"", ",", 
       "\"\<ky (\!\(\*SuperscriptBox[\(nm\), \(-1\)]\))\>\"", ",", 
       "\"\<\[Epsilon]-\!\(\*SubscriptBox[\(\[Epsilon]\), \(F\)]\) \
(eV)\>\""}], "}"}]}], ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.05"}], ",", "0.05"}], "}"}]}], ",", 
    RowBox[{"ClippingStyle", "\[Rule]", "None"}], ",", 
    RowBox[{"PlotPoints", "\[Rule]", "40"}], ",", 
    RowBox[{"Mesh", "\[Rule]", "False"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.768902200800651*^9, 3.768902203982953*^9}, {
   3.7694888973295507`*^9, 3.76948890426122*^9}, 3.769498084265641*^9, {
   3.7694985610644083`*^9, 3.769498571736429*^9}, {3.769498614279537*^9, 
   3.769498617091756*^9}, {3.769929805763681*^9, 3.769929813646174*^9}, {
   3.7699298864352703`*^9, 3.76992989164991*^9}, {3.7699718833275127`*^9, 
   3.769971889052442*^9}, 3.77098166985215*^9, {3.770997420020068*^9, 
   3.770997420365841*^9}, {3.7710856115440702`*^9, 3.7710856165534573`*^9}, {
   3.771085741819952*^9, 3.771085751719789*^9}, {3.7710858070983267`*^9, 
   3.77108586941533*^9}, {3.7831518182790327`*^9, 3.783151818395852*^9}, {
   3.783233334804389*^9, 3.783233346380199*^9}, {3.8841799309239798`*^9, 
   3.8841799878726673`*^9}, {3.8841800345841084`*^9, 3.884180048161977*^9}, {
   3.884180119772354*^9, 3.884180121996471*^9}, {3.884183439405177*^9, 
   3.884183460689631*^9}, {3.884184053517817*^9, 3.884184054524301*^9}, {
   3.884184317779917*^9, 3.884184326784587*^9}, {3.8841844139647713`*^9, 
   3.884184418463718*^9}, {3.884186153072966*^9, 3.884186161038411*^9}, 
   3.884186979675376*^9, 3.8841885786199636`*^9, 3.8841887618769283`*^9},
 CellLabel->
  "In[295]:=",ExpressionUUID->"9554032b-fe78-4567-b60f-f73fd49b052f"],

Cell[BoxData[
 RowBox[{"pl1", "=", 
  RowBox[{"Plot3D", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"4", ",", "1"}], "]"}], "]"}], "[", 
       RowBox[{"kx", ",", "ky"}], "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"5", ",", "1"}], "]"}], "]"}], "[", 
       RowBox[{"kx", ",", "ky"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"6", ",", "1"}], "]"}], "]"}], "[", 
       RowBox[{"kx", ",", "ky"}], "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"7", ",", "1"}], "]"}], "]"}], "[", 
       RowBox[{"kx", ",", "ky"}], "]"}], ",", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"OrdinaryBranch", "[", "2.1", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"9", ",", "1"}], "]"}], "]"}], "[", 
         RowBox[{"kx", ",", "ky"}], "]"}], ","}], "*)"}], 
      RowBox[{
       RowBox[{
        RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"10", ",", "1"}], "]"}], "]"}], "[", 
       RowBox[{"kx", ",", "ky"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"11", ",", "1"}], "]"}], "]"}], "[", 
       RowBox[{"kx", ",", "ky"}], "]"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"OrdinaryBranch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"12", ",", "1"}], "]"}], "]"}], "[", 
       RowBox[{"kx", ",", "ky"}], "]"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"kx", ",", 
      RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ky", ",", 
      RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}], ",", 
    RowBox[{"AxesLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
      "\"\<kx (\!\(\*SuperscriptBox[\(nm\), \(-1\)]\))\>\"", ",", 
       "\"\<ky (\!\(\*SuperscriptBox[\(nm\), \(-1\)]\))\>\"", ",", 
       "\"\<\[Epsilon]-\!\(\*SubscriptBox[\(\[Epsilon]\), \(F\)]\) \
(eV)\>\""}], "}"}]}], ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.05"}], ",", "0.05"}], "}"}]}], ",", 
    RowBox[{"ClippingStyle", "\[Rule]", "None"}], ",", 
    RowBox[{"PlotPoints", "\[Rule]", "40"}], ",", 
    RowBox[{"Mesh", "\[Rule]", "False"}], ",", 
    RowBox[{"PlotStyle", "\[Rule]", 
     RowBox[{"Directive", "[", 
      RowBox[{"Opacity", "[", "0.5", "]"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.884183557717313*^9, 3.884183633626259*^9}, {
  3.8841836837526407`*^9, 3.884183709037619*^9}, {3.8841837414747763`*^9, 
  3.884183743499144*^9}, {3.884183957869342*^9, 3.884183980768051*^9}, {
  3.884184038523335*^9, 3.884184039777135*^9}, {3.884185997063284*^9, 
  3.8841860020513*^9}, {3.884186087762786*^9, 3.884186114060245*^9}, {
  3.884188752185308*^9, 3.8841887563926277`*^9}},
 CellLabel->
  "In[297]:=",ExpressionUUID->"7c0a2e9f-308f-40bd-9e08-f8943d6b7ed6"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{"pl1", ",", "pl2", ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.05"}], ",", "0"}], "}"}]}], ",", 
   RowBox[{"AxesStyle", "\[Rule]", "Black"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.884184361860775*^9, 3.884184367735574*^9}, {
   3.884184430849525*^9, 3.884184443330637*^9}, 3.884185926212329*^9, {
   3.884188888750421*^9, 3.8841888962604322`*^9}},
 CellLabel->
  "In[299]:=",ExpressionUUID->"768a1e01-c9c1-40ca-bbf9-160c8630420d"],

Cell[BoxData[
 RowBox[{"Show", "[", 
  RowBox[{"pl1", ",", "pl2", ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.05"}], ",", "0.05"}], "}"}]}]}], "]"}]], "Input",
 CellChangeTimes->{{3.884184361860775*^9, 3.884184367735574*^9}, {
   3.884184430849525*^9, 3.884184443330637*^9}, 3.884185926212329*^9, {
   3.8841865046848*^9, 3.8841865053115063`*^9}},
 CellLabel->
  "In[277]:=",ExpressionUUID->"5c9bccf6-bade-48eb-923c-334b4dd83320"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"rcutoff", "=", "0.024"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"subtractRegion", "=", 
  RowBox[{"ImplicitRegion", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x", ">", 
       RowBox[{"-", "rcutoff"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"x", "/", "2"}], "+", 
        RowBox[{"y", "*", 
         RowBox[{
          RowBox[{"Sqrt", "[", "3", "]"}], "/", "2"}]}]}], "<", "rcutoff"}], 
      ",", 
      RowBox[{
       RowBox[{
        RowBox[{"x", "/", "2"}], "-", 
        RowBox[{"y", "*", 
         RowBox[{
          RowBox[{"Sqrt", "[", "3", "]"}], "/", "2"}]}]}], "<", "rcutoff"}]}],
      "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "y"}], "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.769498340436612*^9, 3.769498378235773*^9}, {
   3.769498504038671*^9, 3.769498522697914*^9}, {3.769503615118445*^9, 
   3.769503652334158*^9}, 3.7695101328315887`*^9, {3.769868810561542*^9, 
   3.769868812625803*^9}, {3.7698902995094624`*^9, 3.769890299894248*^9}, {
   3.769961011029038*^9, 3.769961012149169*^9}, {3.7699714175148163`*^9, 
   3.769971422448398*^9}, {3.770102788981646*^9, 3.770102789127577*^9}},
 CellLabel->
  "In[326]:=",ExpressionUUID->"cfdc8ad4-253e-4e30-b69f-2d76c57b16b3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"subtractRegionCond", "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"x", ">", 
      RowBox[{"-", "rcutoff"}]}], ")"}], " ", "&&", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"x", "/", "2"}], "+", 
       RowBox[{"y", "*", 
        RowBox[{
         RowBox[{"Sqrt", "[", "3", "]"}], "/", "2"}]}]}], "<", "rcutoff"}], 
     ")"}], " ", "&&", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"x", "/", "2"}], "-", 
       RowBox[{"y", "*", 
        RowBox[{
         RowBox[{"Sqrt", "[", "3", "]"}], "/", "2"}]}]}], "<", "rcutoff"}], 
     ")"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.769863407271615*^9, 3.7698634715499983`*^9}},
 CellLabel->
  "In[328]:=",ExpressionUUID->"f9340707-0cc7-4e0c-be97-e2bf1fd6fe78"],

Cell[BoxData[
 RowBox[{"MoireBZ0", "=", 
  RowBox[{"RegionDifference", "[", 
   RowBox[{
    RowBox[{"Region", "[", 
     RowBox[{"ImplicitRegion", "[", 
      RowBox[{
       RowBox[{"Join", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"bvecs6", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ".", 
            RowBox[{"{", 
             RowBox[{"x", ",", "y"}], "}"}]}], "\[LessEqual]", 
           RowBox[{
            RowBox[{"Glen", "^", "2"}], "/", "2"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "6"}], "}"}]}], "]"}], 
        RowBox[{"(*", 
         RowBox[{",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "x"}], " ", 
             RowBox[{"Sqrt", "[", "3", "]"}]}], "<", "y", "<", 
            RowBox[{"x", " ", 
             RowBox[{"Sqrt", "[", "3", "]"}]}]}], "}"}]}], "*)"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "y"}], "}"}]}], "]"}], "]"}], ",", 
    RowBox[{"Region", "[", "subtractRegion", "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7694979025191517`*^9, 3.7694979811611*^9}, {
   3.769498199024465*^9, 3.7694982753241*^9}, 3.7694983323983717`*^9, {
   3.76949842812624*^9, 3.769498469579501*^9}, {3.7701026989405613`*^9, 
   3.770102769664795*^9}, {3.770353419805337*^9, 3.7703534446263523`*^9}},
 CellLabel->
  "In[329]:=",ExpressionUUID->"2f817d62-49ed-4241-acfd-2c2161b361b8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Branch1", "[", 
   RowBox[{
    RowBox[{"n_", "?", "NumericQ"}], ",", 
    RowBox[{"i_", "?", "IntegerQ"}], ",", 
    RowBox[{"kx1_", "?", "NumericQ"}], ",", 
    RowBox[{"ky1_", "?", "NumericQ"}]}], "]"}], ":=", "  ", 
  RowBox[{
   RowBox[{
    RowBox[{"Branch", "[", "n", "]"}], "[", 
    RowBox[{"[", "i", "]"}], "]"}], "@@", 
   RowBox[{"Folding", "[", 
    RowBox[{"{", 
     RowBox[{"kx1", ",", "ky1"}], "}"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.7712253970725393`*^9, 3.771225403706478*^9}, {
  3.771225450404284*^9, 3.77122552874797*^9}},
 CellLabel->
  "In[220]:=",ExpressionUUID->"63454f06-024d-4d17-9dc6-16b91df90ce2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DoPlot", "[", 
   RowBox[{"n_", ",", "Branches_", ",", "colors_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "Branches", "]"}]}], ",", "toplot"}], "}"}], 
    ",", 
    RowBox[{
     RowBox[{"toplot", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Branch", "[", "n", "]"}], "[", 
         RowBox[{"[", "i", "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "Branches"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Show", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ContourPlot", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"toplot", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "@@", 
             RowBox[{"Folding", "[", 
              RowBox[{"{", 
               RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], "\[Equal]", "0"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"kx", ",", 
             RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"ky", ",", 
             RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}], ",", 
           RowBox[{"ContourStyle", "\[Rule]", 
            RowBox[{"colors", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ",", 
           RowBox[{"Frame", "\[Rule]", "None"}], ",", 
           RowBox[{"FrameLabel", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\\*SubscriptBox[\\(k\\), \\(x\\)]\\) \
(\\!\\(\\*SuperscriptBox[\\(a\\), \\(-1\\)]\\))\>\"", ",", 
              "\"\<\\!\\(\\*SubscriptBox[\\(k\\), \\(y\\)]\\) \
(\\!\\(\\*SuperscriptBox[\\(a\\), \\(-1\\)]\\))\>\""}], "}"}]}], ",", 
           RowBox[{"FrameStyle", "\[Rule]", 
            RowBox[{"Directive", "[", 
             RowBox[{
              RowBox[{"FontFamily", "\[Rule]", "\"\<MathJax_Main\>\""}], ",", 
              
              RowBox[{"FontSize", "\[Rule]", "15"}]}], "]"}]}]}], "]"}], ",", 
         
         RowBox[{"{", 
          RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ",", "BZBoundary"}], 
      "]"}]}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"kxmin", "=", 
   RowBox[{"-", "0.12"}]}], ";", 
  RowBox[{"kxmax", "=", "0.12"}], ";", 
  RowBox[{"kymin", "=", 
   RowBox[{"-", "0.12"}]}], ";", 
  RowBox[{"kymax", "=", "0.12"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DoPlotNew", "[", 
   RowBox[{"n_", ",", "Branches_", ",", "colors_", ",", 
    RowBox[{"threshold_:", "0.06"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "Branches", "]"}]}], ",", "toplot"}], "}"}], 
    ",", 
    RowBox[{
     RowBox[{"toplot", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Branch", "[", "n", "]"}], "[", 
         RowBox[{"[", "i", "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "Branches"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pl", "=", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"cp", "=", 
            RowBox[{"ContourPlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"toplot", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "1"}], "]"}], "]"}], "@@", 
                 RowBox[{"Folding", "[", 
                  RowBox[{"{", 
                   RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ")"}], 
               "\[Equal]", "0"}], ",", 
              RowBox[{"{", 
               RowBox[{"kx", ",", "kxmin", ",", "kxmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"ky", ",", "kymin", ",", "kymax"}], "}"}], ",", 
              RowBox[{"PlotPoints", "\[Rule]", "30"}], ",", 
              RowBox[{"ContourShading", "\[Rule]", "None"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"bsps", "=", 
            RowBox[{"Cases", "[", 
             RowBox[{
              RowBox[{"Normal", "[", "cp", "]"}], ",", 
              RowBox[{
               RowBox[{"Line", "[", "x_", "]"}], "\[RuleDelayed]", 
               RowBox[{"BSplineFunction", "[", "x", "]"}]}], ",", "All"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ParametricPlot", "[", 
            RowBox[{
             RowBox[{"Evaluate", "@", 
              RowBox[{"Through", "[", 
               RowBox[{"bsps", "@", "t"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"t", ",", "0", ",", "1"}], "}"}], ",", 
             RowBox[{"PlotStyle", "\[Rule]", "Normal"}], ",", 
             RowBox[{"Frame", "\[Rule]", "True"}], ",", 
             RowBox[{"ColorFunction", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Directive", "[", 
                 RowBox[{
                  RowBox[{"colors", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  RowBox[{"Opacity", "[", 
                   RowBox[{"UnitStep", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"toplot", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], "@@", 
                    RowBox[{"Folding", "[", 
                    RowBox[{"{", 
                    RowBox[{"#1", ",", "#2"}], "}"}], "]"}]}], "-", 
                    "threshold"}], "]"}], "]"}]}], "]"}], "&"}], ")"}]}], ",", 
             RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"kxmin", ",", "kxmax"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"kymin", ",", "kymax"}], "}"}]}], "}"}]}]}], "]"}]}],
           " ", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ",", "BZBoundary", ",", 
        
        RowBox[{"Axes", "\[Rule]", "False"}], ",", 
        RowBox[{"FrameTicks", "->", "None"}], ",", 
        RowBox[{"AspectRatio", "\[Rule]", "1"}]}], "]"}]}], ";", " ", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"path", "<>", "\"\<FSn=\>\"", "<>", 
        RowBox[{"StringReplace", "[", 
         RowBox[{
          RowBox[{"ToString", "[", "n", "]"}], ",", 
          RowBox[{"\"\<.\>\"", "\[Rule]", "\"\<_\>\""}]}], "]"}], "<>", 
        "\"\<.pdf\>\""}], ",", "pl"}], "]"}], ";", "pl"}]}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.800256282698289*^9, 3.8002562826996813`*^9}, {
   3.8002564123047323`*^9, 3.8002564124055243`*^9}, {3.8002564715944242`*^9, 
   3.800256486029975*^9}, {3.800256517878071*^9, 3.8002566293807583`*^9}, {
   3.800256667505402*^9, 3.800256708364801*^9}, {3.80025679571812*^9, 
   3.8002567992745256`*^9}, {3.8002569635515537`*^9, 3.800256996197077*^9}, 
   3.800257037733008*^9, {3.800257277405538*^9, 3.8002572844518833`*^9}, {
   3.800257343176292*^9, 3.800257343631628*^9}, {3.800257387380601*^9, 
   3.800257400251565*^9}, {3.800257472090844*^9, 3.800257476609681*^9}, {
   3.800257527145002*^9, 3.800257531395804*^9}, {3.800257565521946*^9, 
   3.800257586214148*^9}, 3.800257628339691*^9, {3.8002578428365183`*^9, 
   3.800257846356336*^9}, {3.8002578995040693`*^9, 3.800257928444798*^9}, {
   3.800258325796176*^9, 3.800258372981462*^9}, {3.800258599899601*^9, 
   3.800258624922125*^9}, {3.8002597737366858`*^9, 3.8002598679800577`*^9}, {
   3.8002603935562763`*^9, 3.800260393667797*^9}, {3.800260449160193*^9, 
   3.800260457700245*^9}, {3.800260543705143*^9, 3.800260544340844*^9}, {
   3.80026072641191*^9, 3.800260764585816*^9}, {3.800266395542358*^9, 
   3.8002664554357433`*^9}, {3.800267258530558*^9, 3.800267280520956*^9}, {
   3.8002875017057333`*^9, 3.8002875020069637`*^9}, {3.8002918173344603`*^9, 
   3.800291817877017*^9}, {3.800446460840374*^9, 3.800446463389707*^9}, 
   3.800446607808053*^9, {3.800446653325965*^9, 3.800446681153693*^9}, 
   3.800451202535222*^9},
 CellLabel->
  "In[221]:=",ExpressionUUID->"1a40ef39-d22b-40d1-9b21-a0c417fc2d9b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DoPlotNew1", "[", 
   RowBox[{"n_", ",", "Branches_", ",", "colors_", ",", 
    RowBox[{"threshold_:", "0.06"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"len", "=", 
       RowBox[{"Length", "[", "Branches", "]"}]}], ",", "toplot"}], "}"}], 
    ",", 
    RowBox[{
     RowBox[{"toplot", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Branch", "[", "n", "]"}], "[", 
         RowBox[{"[", "i", "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "Branches"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"pl", "=", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"ContourPlot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"toplot", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "@@", 
               RowBox[{"Folding", "[", 
                RowBox[{"{", 
                 RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ")"}], "\[Equal]",
              "0"}], ",", 
            RowBox[{"{", 
             RowBox[{"kx", ",", "kxmin", ",", "kxmax"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"ky", ",", "kymin", ",", "kymax"}], "}"}], ",", 
            RowBox[{"PlotPoints", "\[Rule]", "50"}], ",", 
            RowBox[{"ContourShading", "\[Rule]", "None"}], ",", 
            RowBox[{"ContourStyle", "\[Rule]", 
             RowBox[{"colors", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "len"}], "}"}]}], "]"}], ",", "BZBoundary", ",", 
        
        RowBox[{"Axes", "\[Rule]", "False"}], ",", 
        RowBox[{"FrameTicks", "->", "None"}], ",", 
        RowBox[{"AspectRatio", "\[Rule]", "1"}]}], "]"}]}], ";", " ", 
     RowBox[{"Export", "[", 
      RowBox[{
       RowBox[{"path", "<>", "\"\<FS1n=\>\"", "<>", 
        RowBox[{"StringReplace", "[", 
         RowBox[{
          RowBox[{"ToString", "[", "n", "]"}], ",", 
          RowBox[{"\"\<.\>\"", "\[Rule]", "\"\<_\>\""}]}], "]"}], "<>", 
        "\"\<.pdf\>\""}], ",", "pl"}], "]"}], ";", "pl"}]}], "]"}]}]], "Input",\

 CellChangeTimes->{{3.8004464684885073`*^9, 3.800446516671801*^9}, {
   3.8004465768249598`*^9, 3.800446578727358*^9}, {3.8004466239843063`*^9, 
   3.800446624080101*^9}, 3.800451189844985*^9, {3.802856642325121*^9, 
   3.8028566424252577`*^9}},
 CellLabel->
  "In[224]:=",ExpressionUUID->"099e2ab3-3697-4d81-9c19-59f09ea2c34b"],

Cell[BoxData[
 RowBox[{"Plot3D", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Branch", "[", 
        RowBox[{"-", "3.6"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"12", ",", "1"}], "]"}], "]"}], "@@", 
      RowBox[{"Folding", "[", 
       RowBox[{"{", 
        RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Branch", "[", 
        RowBox[{"-", "3.6"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"13", ",", "1"}], "]"}], "]"}], "@@", 
      RowBox[{"Folding", "[", 
       RowBox[{"{", 
        RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Branch", "[", 
        RowBox[{"-", "3.6"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"14", ",", "1"}], "]"}], "]"}], "@@", 
      RowBox[{"Folding", "[", 
       RowBox[{"{", 
        RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"kx", ",", 
     RowBox[{"-", "0.12"}], ",", "0.12"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"ky", ",", 
     RowBox[{"-", "0.12"}], ",", "0.12"}], "}"}], ",", 
   RowBox[{"AxesLabel", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"\"\<kx\>\"", ",", "\"\<ky\>\"", ",", "\"\<\[Epsilon]\>\""}], 
     "}"}]}], ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.01"}], ",", "0.00"}], "}"}]}], ",", 
   RowBox[{"ClippingStyle", "\[Rule]", "None"}], ",", 
   RowBox[{"PlotPoints", "\[Rule]", "60"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.800341520154406*^9, 3.800341528812406*^9}, {
  3.80259702969909*^9, 3.80259705756964*^9}, {3.802855178853045*^9, 
  3.802855202996842*^9}},
 CellLabel->
  "In[337]:=",ExpressionUUID->"16f0119e-e609-4362-a30f-c886e118d046"],

Cell[BoxData[
 RowBox[{"DoPlotNew", "[", 
  RowBox[{
   RowBox[{"-", "3.0"}], ",", 
   RowBox[{"{", 
    RowBox[{"12", ",", "13", ",", "14"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Red", ",", "Blue"}], "}"}], ",", "0.002"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.800266955868135*^9, 3.8002669579636717`*^9}, {
   3.80026702708253*^9, 3.800267032125868*^9}, {3.800267909830789*^9, 
   3.8002679185395813`*^9}, {3.80027808968824*^9, 3.800278090144393*^9}, 
   3.800278642071341*^9, {3.8002895918376904`*^9, 3.80028959370424*^9}, {
   3.800290609986546*^9, 3.800290610083336*^9}, {3.800291047169909*^9, 
   3.800291047257663*^9}, {3.8028554798833237`*^9, 3.802855555756755*^9}},
 CellLabel->
  "In[339]:=",ExpressionUUID->"d3dddecb-f529-43b5-97f8-de47b678bcad"],

Cell[BoxData[
 RowBox[{"Plot3D", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Branch", "[", "1.5", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1"}], "]"}], "]"}], "@@", 
      RowBox[{"Folding", "[", 
       RowBox[{"{", 
        RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Branch", "[", "1.5", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"2", ",", "1"}], "]"}], "]"}], "@@", 
      RowBox[{"Folding", "[", 
       RowBox[{"{", 
        RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Branch", "[", "1.5", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"3", ",", "1"}], "]"}], "]"}], "@@", 
      RowBox[{"Folding", "[", 
       RowBox[{"{", 
        RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"kx", ",", 
     RowBox[{"-", "0.12"}], ",", "0.12"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"ky", ",", 
     RowBox[{"-", "0.12"}], ",", "0.12"}], "}"}], ",", 
   RowBox[{"AxesLabel", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"\"\<kx\>\"", ",", "\"\<ky\>\"", ",", "\"\<\[Epsilon]\>\""}], 
     "}"}]}], ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "0.005"}], ",", "0.00"}], "}"}]}], ",", 
   RowBox[{"ClippingStyle", "\[Rule]", "None"}], ",", 
   RowBox[{"PlotPoints", "\[Rule]", "60"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.802597063417246*^9, 3.802597092353621*^9}, {
  3.802597143601543*^9, 3.802597151044634*^9}, {3.802787728302827*^9, 
  3.802787736069868*^9}},
 CellLabel->
  "In[340]:=",ExpressionUUID->"969409ac-f973-4d5c-9dbc-2c4ab0a8e6cc"],

Cell[BoxData[
 RowBox[{"DoPlotNew1", "[", 
  RowBox[{
   RowBox[{"-", "3.6"}], ",", 
   RowBox[{"{", 
    RowBox[{"12", ",", "13", ",", "14"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Blue", ",", "Blue"}], "}"}], ",", "0.03"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.802855061593115*^9, 3.8028551041747026`*^9}, {
  3.80285514628354*^9, 3.802855152919435*^9}},
 CellLabel->
  "In[342]:=",ExpressionUUID->"9a18ff82-c298-4325-bfa9-0c2d716ea795"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dop", "=", 
   RowBox[{"-", "3.6"}]}], ";", " ", 
  RowBox[{"Plot3D", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "dop", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"12", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "dop", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"13", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "dop", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"14", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"kx", ",", 
      RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ky", ",", 
      RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}], ",", 
    RowBox[{"AxesLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<kx\>\"", ",", "\"\<ky\>\"", ",", "\"\<\[Epsilon]\>\""}], 
      "}"}]}], ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.05"}], ",", "0.00"}], "}"}]}], ",", 
    RowBox[{"ClippingStyle", "\[Rule]", "None"}], ",", 
    RowBox[{"PlotPoints", "\[Rule]", "60"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.770976315540504*^9, 3.770976323972142*^9}, {
   3.770977427607894*^9, 3.7709774375174093`*^9}, {3.770977486576233*^9, 
   3.770977503264715*^9}, {3.80027386431108*^9, 3.800273875280264*^9}, {
   3.8002864341875753`*^9, 3.8002864451186*^9}, {3.800286794749537*^9, 
   3.800286802278803*^9}, {3.800291332576191*^9, 3.8002913581182413`*^9}, {
   3.80285618428789*^9, 3.8028561991493187`*^9}, {3.827762359944632*^9, 
   3.827762411837953*^9}, {3.827762563859645*^9, 3.827762568168804*^9}, 
   3.827762964902733*^9, 3.82781585331641*^9},
 CellLabel->
  "In[397]:=",ExpressionUUID->"3da948cd-ba84-456e-8792-a6e5eb9be930"],

Cell[BoxData[
 RowBox[{"DoPlotNew1", "[", 
  RowBox[{
   RowBox[{"-", "3.8"}], ",", 
   RowBox[{"{", 
    RowBox[{"12", ",", "13", ",", "14"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Blue", ",", "Blue"}], "}"}], ",", "0.12"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.827496319850456*^9, 3.82749634616638*^9}},
 CellLabel->
  "In[365]:=",ExpressionUUID->"2535407c-9ce6-47d2-bf10-efab68ad6f1f"],

Cell[BoxData[
 RowBox[{"DoPlotNew1", "[", 
  RowBox[{
   RowBox[{"-", "3.6"}], ",", 
   RowBox[{"{", 
    RowBox[{"12", ",", "13", ",", "14"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Red", ",", "Blue"}], "}"}], ",", "0.12"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.827496072372212*^9, 3.8274960907404613`*^9}},
 CellLabel->
  "In[363]:=",ExpressionUUID->"dc63683c-557b-45c9-b4f2-580302bc1bfc"],

Cell[BoxData[
 RowBox[{"DoPlotNew1", "[", 
  RowBox[{
   RowBox[{"-", "3.1"}], ",", 
   RowBox[{"{", 
    RowBox[{"12", ",", "13", ",", "14"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Red", ",", "Blue"}], "}"}], ",", "0.12"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.827495881575892*^9, 3.827495881954496*^9}, {
  3.827495992710165*^9, 3.8274959959248953`*^9}, {3.82749604636834*^9, 
  3.827496049190516*^9}},
 CellLabel->
  "In[361]:=",ExpressionUUID->"104d7a0c-41ab-4c5f-abca-7cfdb234849f"],

Cell[BoxData[
 RowBox[{"DoPlotNew1", "[", 
  RowBox[{
   RowBox[{"-", "2.6"}], ",", 
   RowBox[{"{", 
    RowBox[{"12", ",", "13", ",", "14"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Red", ",", "Blue"}], "}"}], ",", "0.12"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.827495925849716*^9, 3.827495927648876*^9}, {
  3.827495961205543*^9, 3.827495961360495*^9}},
 CellLabel->
  "In[359]:=",ExpressionUUID->"ba47beca-72a2-4109-b899-0db07fb258ba"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dop", "=", 
   RowBox[{"-", "2.0"}]}], ";", " ", 
  RowBox[{"Plot3D", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "dop", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"12", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "dop", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"13", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "dop", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"14", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"kx", ",", 
      RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ky", ",", 
      RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}], ",", 
    RowBox[{"AxesLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<kx\>\"", ",", "\"\<ky\>\"", ",", "\"\<\[Epsilon]\>\""}], 
      "}"}]}], ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.05"}], ",", "0.00"}], "}"}]}], ",", 
    RowBox[{"ClippingStyle", "\[Rule]", "None"}], ",", 
    RowBox[{"PlotPoints", "\[Rule]", "60"}], ",", 
    RowBox[{"Mesh", "\[Rule]", "None"}], ",", 
    RowBox[{"PlotStyle", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Directive", "[", 
        RowBox[{"Opacity", "[", "1", "]"}], "]"}], ",", " ", 
       RowBox[{"Directive", "[", 
        RowBox[{"Opacity", "[", "1", "]"}], "]"}], ",", 
       RowBox[{"Directive", "[", 
        RowBox[{"Opacity", "[", "0.7", "]"}], "]"}]}], "}"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.770976315540504*^9, 3.770976323972142*^9}, {
   3.770977427607894*^9, 3.7709774375174093`*^9}, {3.770977486576233*^9, 
   3.770977503264715*^9}, {3.80027386431108*^9, 3.800273875280264*^9}, {
   3.8002864341875753`*^9, 3.8002864451186*^9}, {3.800286794749537*^9, 
   3.800286802278803*^9}, {3.800291332576191*^9, 3.8002913581182413`*^9}, {
   3.80285618428789*^9, 3.8028561991493187`*^9}, {3.827762359944632*^9, 
   3.827762411837953*^9}, {3.827762563859645*^9, 3.827762568168804*^9}, 
   3.827762964902733*^9, {3.82781328791849*^9, 3.827813291268223*^9}, 
   3.827815845125134*^9, {3.8278180490929947`*^9, 3.827818112386889*^9}, {
   3.827818186640601*^9, 3.827818188115099*^9}},
 CellLabel->
  "In[403]:=",ExpressionUUID->"0bcf34a0-2678-4b8e-9ff0-929142093eaa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dop", "=", "2.1"}], ";", " ", 
  RowBox[{"Plot3D", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "dop", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"12", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "dop", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"13", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "dop", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"14", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"kx", ",", "ky"}], "}"}], "\[Element]", "MoireBZ"}], ",", 
    RowBox[{"AxesLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<kx\>\"", ",", "\"\<ky\>\"", ",", "\"\<\[Epsilon]\>\""}], 
      "}"}]}], ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.05"}], ",", "0.00"}], "}"}]}], ",", 
    RowBox[{"ClippingStyle", "\[Rule]", "None"}], ",", 
    RowBox[{"PlotPoints", "\[Rule]", "60"}], ",", 
    RowBox[{"Mesh", "\[Rule]", "None"}], ",", 
    RowBox[{"PlotStyle", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Directive", "[", 
        RowBox[{"Opacity", "[", "1", "]"}], "]"}], ",", " ", 
       RowBox[{"Directive", "[", 
        RowBox[{"Opacity", "[", "1", "]"}], "]"}], ",", 
       RowBox[{"Directive", "[", 
        RowBox[{"Opacity", "[", "0.7", "]"}], "]"}]}], "}"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.770976315540504*^9, 3.770976323972142*^9}, {
   3.770977427607894*^9, 3.7709774375174093`*^9}, {3.770977486576233*^9, 
   3.770977503264715*^9}, {3.80027386431108*^9, 3.800273875280264*^9}, {
   3.8002864341875753`*^9, 3.8002864451186*^9}, {3.800286794749537*^9, 
   3.800286802278803*^9}, {3.800291332576191*^9, 3.8002913581182413`*^9}, {
   3.80285618428789*^9, 3.8028561991493187`*^9}, {3.827762359944632*^9, 
   3.827762411837953*^9}, {3.827762563859645*^9, 3.827762568168804*^9}, 
   3.827762964902733*^9, {3.82781328791849*^9, 3.827813291268223*^9}, 
   3.827815845125134*^9, {3.8278180490929947`*^9, 3.827818112386889*^9}, {
   3.827818186640601*^9, 3.827818188115099*^9}, {3.827821511827941*^9, 
   3.827821522414516*^9}, {3.88417983211945*^9, 
   3.8841798350370817`*^9}},ExpressionUUID->"32ec701f-f1d5-495c-aa58-\
f708b0e687ec"],

Cell[BoxData[
 RowBox[{"DoPlotNew1", "[", 
  RowBox[{
   RowBox[{"-", "2.1"}], ",", 
   RowBox[{"{", 
    RowBox[{"12", ",", "13", ",", "14"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Red", ",", "Blue"}], "}"}], ",", "0.12"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.827495818581908*^9, 3.8274958307421703`*^9}},
 CellLabel->
  "In[356]:=",ExpressionUUID->"f863e273-e276-4ef9-a395-8b8c594b443a"],

Cell[BoxData[
 RowBox[{"DoPlotNew1", "[", 
  RowBox[{
   RowBox[{"-", "2.0"}], ",", 
   RowBox[{"{", 
    RowBox[{"12", ",", "13", ",", "14"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Red", ",", "Red"}], "}"}], ",", "0.12"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.827195757988599*^9, 3.8271957583746233`*^9}, {
  3.827319284823934*^9, 3.8273193111554747`*^9}, {3.8274958016861887`*^9, 
  3.827495803636792*^9}},
 CellLabel->
  "In[354]:=",ExpressionUUID->"22c99837-3804-4815-96ea-1d9910982c6b"],

Cell[BoxData[
 RowBox[{"DoPlotNew1", "[", 
  RowBox[{
   RowBox[{"-", "1.3"}], ",", 
   RowBox[{"{", 
    RowBox[{"12", ",", "13", ",", "14"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Red", ",", "Blue"}], "}"}], ",", "0.12"}], 
  "]"}]], "Input",
 CellChangeTimes->{
  3.8004467921834497`*^9, {3.802854946661337*^9, 3.802855012409944*^9}, {
   3.80285596405858*^9, 3.8028560231044397`*^9}, {3.802856088455488*^9, 
   3.802856113082529*^9}, {3.82715536323489*^9, 3.8271554153783407`*^9}, {
   3.827175120324882*^9, 3.827175141536503*^9}, {3.827319263286726*^9, 
   3.827319263461385*^9}},
 CellLabel->
  "In[345]:=",ExpressionUUID->"2d066bdd-40ed-401e-991b-370e423216d4"],

Cell[BoxData[
 RowBox[{"DoPlotNew1", "[", 
  RowBox[{"1.3", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Blue", ",", "Blue"}], "}"}], ",", "0.05"}], "]"}]], "Input",
 CellChangeTimes->{{3.800258275130823*^9, 3.8002582752436857`*^9}, {
  3.800268119749817*^9, 3.800268125434306*^9}, {3.800285862119404*^9, 
  3.8002858627091427`*^9}, {3.8028566007468224`*^9, 3.8028566163840103`*^9}},
 CellLabel->
  "In[346]:=",ExpressionUUID->"10b5cc2d-2b8a-4804-b3c6-be26254cade3"],

Cell[BoxData[
 RowBox[{"DoPlotNew1", "[", 
  RowBox[{"1.9", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Blue", ",", "Blue", ",", "Blue"}], "}"}], ",", "0.05"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.8002576906508217`*^9, 3.800257692223637*^9}, {
  3.800257938437278*^9, 3.80025793889532*^9}, {3.8002582100210533`*^9, 
  3.800258214139785*^9}, {3.80025874372337*^9, 3.8002587483884087`*^9}, {
  3.800258907996606*^9, 3.800258909949038*^9}, {3.800285868072916*^9, 
  3.800285868976248*^9}, {3.8028381829411497`*^9, 3.802838183103404*^9}, {
  3.802856707586871*^9, 3.802856744816948*^9}, {3.827152959659368*^9, 
  3.8271529601648293`*^9}, {3.827319337600263*^9, 3.8273193377551517`*^9}, {
  3.82749690739419*^9, 3.827496909297347*^9}},
 CellLabel->
  "In[366]:=",ExpressionUUID->"27a2da86-7d2a-4107-9ea5-2eecac752062"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dop", "=", "2.3"}], ";", " ", 
  RowBox[{"Plot3D", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "dop", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "dop", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Branch", "[", "dop", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"3", ",", "1"}], "]"}], "]"}], "@@", 
       RowBox[{"Folding", "[", 
        RowBox[{"{", 
         RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"kx", ",", 
      RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ky", ",", 
      RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}], ",", 
    RowBox[{"AxesLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<kx\>\"", ",", "\"\<ky\>\"", ",", "\"\<\[Epsilon]\>\""}], 
      "}"}]}], ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.05"}], ",", "0.00"}], "}"}]}], ",", 
    RowBox[{"ClippingStyle", "\[Rule]", "None"}], ",", 
    RowBox[{"PlotPoints", "\[Rule]", "60"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.770976315540504*^9, 3.770976323972142*^9}, {
   3.770977427607894*^9, 3.7709774375174093`*^9}, {3.770977486576233*^9, 
   3.770977503264715*^9}, {3.80027386431108*^9, 3.800273875280264*^9}, {
   3.8002864341875753`*^9, 3.8002864451186*^9}, {3.800286794749537*^9, 
   3.800286802278803*^9}, {3.800291332576191*^9, 3.8002913581182413`*^9}, {
   3.80285618428789*^9, 3.8028561991493187`*^9}, {3.827762359944632*^9, 
   3.827762411837953*^9}, {3.827762563859645*^9, 3.827762568168804*^9}, 
   3.827762964902733*^9, {3.82781328791849*^9, 3.827813291268223*^9}, {
   3.827813497649226*^9, 3.827813518560028*^9}, {3.827813550873509*^9, 
   3.827813581395101*^9}, {3.827815211152018*^9, 3.8278152113013477`*^9}, 
   3.827815830438526*^9},
 CellLabel->
  "In[395]:=",ExpressionUUID->"ce5b8af9-2b0c-4deb-873c-79c6eb8901f8"],

Cell[BoxData[
 RowBox[{"DoPlotNew1", "[", 
  RowBox[{"2.1", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Blue", ",", "Blue"}], "}"}], ",", "0.05"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.827496879168096*^9, 3.827496881037447*^9}, {
  3.8274969311432333`*^9, 3.82749695216346*^9}, {3.884179799528928*^9, 
  3.8841797997098427`*^9}},ExpressionUUID->"42445e35-1215-4fb1-8811-\
13a761e27cc8"],

Cell[BoxData[
 RowBox[{"DoPlotNew1", "[", 
  RowBox[{"2.9", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Blue", ",", "Blue"}], "}"}], ",", "0.05"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.827497007675736*^9, 3.827497007980132*^9}},
 CellLabel->
  "In[371]:=",ExpressionUUID->"cee77dfc-d9b3-471d-88cb-6d796e91c82f"],

Cell[BoxData[
 RowBox[{"DoPlotNew1", "[", 
  RowBox[{"3.6", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Blue", ",", "Blue"}], "}"}], ",", "0.05"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.8274970424368773`*^9, 3.827497052325555*^9}, {
  3.8274971984492493`*^9, 3.827497198855401*^9}},
 CellLabel->
  "In[374]:=",ExpressionUUID->"142f9788-b25f-4fb4-a32c-1fccce189967"],

Cell[BoxData[
 RowBox[{"DoPlotNew1", "[", 
  RowBox[{"3.9", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Red", ",", "Blue"}], "}"}], ",", "0.05"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.8274970424368773`*^9, 3.827497052325555*^9}, {
  3.8274971984492493`*^9, 3.827497198855401*^9}, {3.827497230130373*^9, 
  3.827497230460165*^9}, {3.827497295913361*^9, 3.827497297898179*^9}},
 CellLabel->
  "In[376]:=",ExpressionUUID->"5be21e0a-e3c5-4a21-b379-7f3a6e202194"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dop", "=", "3.9"}], ";", 
  RowBox[{"shift", "=", "0.0015"}], ";", " ", 
  RowBox[{"Plot3D", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"shift", "+", 
       RowBox[{
        RowBox[{
         RowBox[{"Branch", "[", "dop", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}], "@@", 
        RowBox[{"Folding", "[", 
         RowBox[{"{", 
          RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}]}], ",", 
      RowBox[{"shift", "+", 
       RowBox[{
        RowBox[{
         RowBox[{"Branch", "[", "dop", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"2", ",", "1"}], "]"}], "]"}], "@@", 
        RowBox[{"Folding", "[", 
         RowBox[{"{", 
          RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}]}], ",", 
      RowBox[{"shift", "+", 
       RowBox[{
        RowBox[{
         RowBox[{"Branch", "[", "dop", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "1"}], "]"}], "]"}], "@@", 
        RowBox[{"Folding", "[", 
         RowBox[{"{", 
          RowBox[{"kx", ",", "ky"}], "}"}], "]"}]}]}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"kx", ",", 
      RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"ky", ",", 
      RowBox[{"-", "0.1"}], ",", "0.1"}], "}"}], ",", 
    RowBox[{"AxesLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<kx\>\"", ",", "\"\<ky\>\"", ",", "\"\<\[Epsilon]\>\""}], 
      "}"}]}], ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.05"}], ",", "0.00"}], "}"}]}], ",", 
    RowBox[{"ClippingStyle", "\[Rule]", "None"}], ",", 
    RowBox[{"PlotPoints", "\[Rule]", "60"}], ",", " ", 
    RowBox[{"PlotStyle", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Directive", "[", 
        RowBox[{"Opacity", "[", "1", "]"}], "]"}], ",", 
       RowBox[{"Directive", "[", 
        RowBox[{"Opacity", "[", "0.7", "]"}], "]"}], ",", 
       RowBox[{"Directive", "[", 
        RowBox[{"Opacity", "[", "0.7", "]"}], "]"}]}], "}"}]}], ",", 
    RowBox[{"Mesh", "->", "None"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.770976315540504*^9, 3.770976323972142*^9}, {
   3.770977427607894*^9, 3.7709774375174093`*^9}, {3.770977486576233*^9, 
   3.770977503264715*^9}, {3.80027386431108*^9, 3.800273875280264*^9}, {
   3.8002864341875753`*^9, 3.8002864451186*^9}, {3.800286794749537*^9, 
   3.800286802278803*^9}, {3.800291332576191*^9, 3.8002913581182413`*^9}, {
   3.80285618428789*^9, 3.8028561991493187`*^9}, {3.827762359944632*^9, 
   3.827762411837953*^9}, {3.827762563859645*^9, 3.827762568168804*^9}, 
   3.827762964902733*^9, {3.82781328791849*^9, 3.827813291268223*^9}, {
   3.827813497649226*^9, 3.827813518560028*^9}, {3.827813550873509*^9, 
   3.827813581395101*^9}, {3.827813678352931*^9, 3.8278136803345222`*^9}, {
   3.827813761165164*^9, 3.827813761440053*^9}, 3.8278138985748243`*^9, {
   3.827813932512492*^9, 3.827813994000977*^9}, 3.827814365641213*^9, {
   3.8278149347648897`*^9, 3.827814934860799*^9}, {3.8278150014079523`*^9, 
   3.827815001570714*^9}, {3.827815391381629*^9, 3.8278153916787863`*^9}, {
   3.827815665607458*^9, 3.827815668336993*^9}, {3.827817740638742*^9, 
   3.827817761033678*^9}, {3.827817814207506*^9, 3.827817836780178*^9}, {
   3.8278179023831987`*^9, 3.827817936809043*^9}},
 CellLabel->
  "In[401]:=",ExpressionUUID->"cb6bc9eb-395a-4b32-b0ef-c94fcefef9c5"],

Cell[BoxData[
 RowBox[{"DoPlotNew1", "[", 
  RowBox[{"1", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2", ",", "3"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Red", ",", "Blue"}], "}"}], ",", "0.1"}], 
  "]"}]], "Input",
 CellChangeTimes->{
  3.800450196599285*^9, {3.801749947057272*^9, 3.80174995413976*^9}, {
   3.80285680073798*^9, 3.8028568371689663`*^9}, {3.827175059972172*^9, 
   3.827175061329455*^9}},
 CellLabel->
  "In[349]:=",ExpressionUUID->"e407c645-9c91-4e69-a866-2d078fd5dbff"],

Cell[BoxData[
 RowBox[{"DoPlotNew", "[", 
  RowBox[{
   RowBox[{"-", "1.2"}], ",", 
   RowBox[{"{", 
    RowBox[{"13", ",", "14"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Blue"}], "}"}], ",", "0.1"}], "]"}]], "Input",
 CellChangeTimes->{{3.8271223214700727`*^9, 3.8271224049965773`*^9}, 
   3.827175070140579*^9, {3.8272086541182013`*^9, 3.827208656832604*^9}, {
   3.827256124566883*^9, 3.827256139255311*^9}},
 CellLabel->
  "In[350]:=",ExpressionUUID->"3a56cfce-b4b5-4f1e-a54d-e74b1927e4d0"],

Cell[BoxData[
 RowBox[{"DoPlotNew", "[", 
  RowBox[{"2.8", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"Red", ",", "Blue"}], "}"}], ",", "0.1"}], "]"}]], "Input",
 CellChangeTimes->{{3.771225237561871*^9, 3.771225255967105*^9}, 
   3.771225308021965*^9, {3.771226565744959*^9, 3.771226565955859*^9}, {
   3.771226602211121*^9, 3.771226602380039*^9}, {3.800256719339843*^9, 
   3.8002567291696787`*^9}, {3.800258668262735*^9, 3.800258694973958*^9}, {
   3.800258754132316*^9, 3.800258759411289*^9}, {3.800258867006421*^9, 
   3.800258869058968*^9}, {3.800285875896304*^9, 3.800285877012005*^9}, {
   3.8028382212479153`*^9, 3.802838222355062*^9}, {3.8272178961461077`*^9, 
   3.827217937034906*^9}, {3.827256109216261*^9, 3.827256109384384*^9}},
 CellLabel->
  "In[351]:=",ExpressionUUID->"46344c0b-9ba1-4cc8-b860-8ed75dd62919"],

Cell[CellGroupData[{

Cell["\<\
Find Hall and direct conductance following the low-tau approximation\
\>", "Subsubsection",
 CellChangeTimes->{{3.769496738837791*^9, 
  3.769496760489695*^9}},ExpressionUUID->"d4712df9-684f-4bea-ab9f-\
33b424f95e74"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"nF", "[", "EE_", "]"}], "=", 
   RowBox[{"Piecewise", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"EE", ">", "15"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{"EE", "<", 
          RowBox[{"-", "15"}]}]}], "}"}]}], "}"}], ",", 
     RowBox[{"1", "/", 
      RowBox[{"(", 
       RowBox[{"1", "+", 
        RowBox[{"Exp", "[", "EE", "]"}]}], ")"}]}]}], "]"}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.6894307651920433`*^9, 3.689430770975663*^9}, 
   3.75017275540396*^9},
 CellLabel->"In[555]:=",
 $CellContext`InitializationGroup -> 
 True,ExpressionUUID->"32058b1e-893f-4dd4-9959-3ea2982bb4c1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dnF", "[", "EE_", "]"}], "=", 
   RowBox[{"Piecewise", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"EE", ">", "15"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"EE", "<", 
          RowBox[{"-", "15"}]}]}], "}"}]}], "}"}], ",", 
     RowBox[{"Evaluate", "[", 
      RowBox[{"-", 
       RowBox[{"D", "[", 
        RowBox[{
         RowBox[{"1", "/", 
          RowBox[{"(", 
           RowBox[{"1", "+", 
            RowBox[{"Exp", "[", "EE", "]"}]}], ")"}]}], ",", "EE"}], "]"}]}], 
      "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.750195727491542*^9, 3.750195773237707*^9}, 
   3.769500492485611*^9},
 CellLabel->
  "In[556]:=",ExpressionUUID->"7b9a387d-d4f1-42b9-9718-cdd152da927a"],

Cell[BoxData[
 RowBox[{"BZwithHole", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"MoireBZ1Cond", " ", "&&", " ", 
     RowBox[{"!", "subtractRegionCond"}]}], "//", "LogicalExpand"}], "//", 
   "FullSimplify"}]}]], "Input",
 CellChangeTimes->{{3.7698636591444902`*^9, 3.769863702465725*^9}},
 CellLabel->
  "In[557]:=",ExpressionUUID->"2da8041a-f649-4835-a62e-bf556294a1f1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Vtensor", "[", 
   RowBox[{"n_", ",", "band_", ",", 
    RowBox[{"T_", "?", "NumericQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ebranch", "=", 
       RowBox[{
        RowBox[{"Branch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"band", ",", "1"}], "]"}], "]"}]}], ",", " ", "vxbranch", 
      ",", "vybranch", ",", 
      RowBox[{"kxmin", "=", 
       RowBox[{"-", "0.08001"}]}], ",", 
      RowBox[{"kxmax", "=", "0.08"}], ",", 
      RowBox[{"kymin", "=", 
       RowBox[{"-", "0.08001"}]}], ",", 
      RowBox[{"kymax", "=", "0.08"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"vxbranch", "=", 
      RowBox[{"Interpolation", "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"kx", ",", "ky"}], "}"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Derivative", "[", 
                RowBox[{"1", ",", "0"}], "]"}], "[", "ebranch", "]"}], "[", 
              RowBox[{"kx", ",", "ky"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"kx", ",", "kxmin", ",", "kxmax", ",", "0.0005"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"ky", ",", "kymin", ",", "kymax", ",", "0.0005"}], 
            "}"}]}], "]"}], ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vybranch", "=", 
      RowBox[{"Interpolation", "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"kx", ",", "ky"}], "}"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Derivative", "[", 
                RowBox[{"0", ",", "1"}], "]"}], "[", "ebranch", "]"}], "[", 
              RowBox[{"kx", ",", "ky"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"kx", ",", "kxmin", ",", "kxmax", ",", "0.0005"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"ky", ",", "kymin", ",", "kymax", ",", "0.0005"}], 
            "}"}]}], "]"}], ",", "1"}], "]"}], "]"}]}], ";", " ", 
     RowBox[{"NIntegrate", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"dnF", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"ebranch", "[", 
             RowBox[{"px", ",", "py"}], "]"}], ")"}], "/", "T"}], "]"}], "/", 
         "T"}], "  ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"vxbranch", "[", 
           RowBox[{"px", ",", "py"}], "]"}], ")"}], "^", "2"}]}], " ", ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"px", ",", "py"}], "}"}], "\[Element]", " ", "MoireBZ0"}], 
       ",", " ", 
       RowBox[{"Method", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Automatic", ",", 
          RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], "}"}]}], 
       ",", 
       RowBox[{"MaxPoints", "\[Rule]", "1400000"}], ",", 
       RowBox[{"MinRecursion", "\[Rule]", "9"}], ",", 
       RowBox[{"MaxRecursion", "\[Rule]", "12"}], ",", " ", 
       RowBox[{"PrecisionGoal", "\[Rule]", "3"}]}], "]"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.753887247605385*^9, 3.753887298751005*^9}, {
   3.7538889862694607`*^9, 3.753889023922168*^9}, {3.753889131761965*^9, 
   3.753889273592278*^9}, {3.75388931264493*^9, 3.7538893216691923`*^9}, {
   3.75388935574133*^9, 3.753889357578952*^9}, {3.753889444818417*^9, 
   3.753889445226377*^9}, {3.753889739931999*^9, 3.753889785780443*^9}, 
   3.753889842072155*^9, {3.7538899259402933`*^9, 3.753889926514268*^9}, {
   3.753889959661661*^9, 3.753889980353368*^9}, {3.753890033326243*^9, 
   3.753890033423443*^9}, 3.753890208064417*^9, {3.753896705397715*^9, 
   3.753896705553259*^9}, {3.7538971833864326`*^9, 3.75389718365016*^9}, {
   3.7694969009701157`*^9, 3.7694969132686243`*^9}, {3.76949772659816*^9, 
   3.7694977705152063`*^9}, {3.769497803247076*^9, 3.769497872333831*^9}, {
   3.76949864967554*^9, 3.76949868936318*^9}, {3.769499037702585*^9, 
   3.769499038048455*^9}, {3.7695003734138527`*^9, 3.7695003816515217`*^9}, 
   3.769788562288945*^9, 3.769788658861236*^9, {3.7698631905247383`*^9, 
   3.769863199422248*^9}, {3.769863606943468*^9, 3.769863623884675*^9}, {
   3.7698637337145576`*^9, 3.7698637381290092`*^9}, 3.769864048960801*^9, {
   3.769864147329002*^9, 3.769864147567967*^9}, {3.769936255350651*^9, 
   3.7699362595808764`*^9}, {3.769960689373075*^9, 3.7699606916740837`*^9}, {
   3.769971674444355*^9, 3.769971686098089*^9}, {3.770102895933137*^9, 
   3.770102929808647*^9}, 3.7701029643930492`*^9, {3.802865035223894*^9, 
   3.802865035322715*^9}},
 CellLabel->
  "In[3480]:=",ExpressionUUID->"22863588-9169-43b1-9cd1-72d251517bc8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"VtensorAll", "[", 
   RowBox[{"n_", ",", "nbands_", ",", 
    RowBox[{"T_", "?", "NumericQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"band", ",", 
      RowBox[{"ebranch", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Branch", "[", "n", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"band", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"band", ",", "nbands"}], "}"}]}], "]"}]}], ",", " ", 
      "vxbranch", ",", "vybranch", ",", 
      RowBox[{"kxmin", "=", 
       RowBox[{"-", "0.08001"}]}], ",", 
      RowBox[{"kxmax", "=", "0.08"}], ",", 
      RowBox[{"kymin", "=", 
       RowBox[{"-", "0.08001"}]}], ",", 
      RowBox[{"kymax", "=", "0.08"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"vxbranch", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Interpolation", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"kx", ",", "ky"}], "}"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Derivative", "[", 
                  RowBox[{"1", ",", "0"}], "]"}], "[", 
                 RowBox[{"ebranch", "[", 
                  RowBox[{"[", "band", "]"}], "]"}], "]"}], "[", 
                RowBox[{"kx", ",", "ky"}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"kx", ",", "kxmin", ",", "kxmax", ",", "0.0005"}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"ky", ",", "kymin", ",", "kymax", ",", "0.0005"}], 
              "}"}]}], "]"}], ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"band", ",", "nbands"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vybranch", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Interpolation", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"kx", ",", "ky"}], "}"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Derivative", "[", 
                  RowBox[{"0", ",", "1"}], "]"}], "[", 
                 RowBox[{"ebranch", "[", 
                  RowBox[{"[", "band", "]"}], "]"}], "]"}], "[", 
                RowBox[{"kx", ",", "ky"}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"kx", ",", "kxmin", ",", "kxmax", ",", "0.0005"}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"ky", ",", "kymin", ",", "kymax", ",", "0.0005"}], 
              "}"}]}], "]"}], ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"band", ",", "nbands"}], "}"}]}], "]"}]}], ";", " ", 
     RowBox[{"NIntegrate", "[", 
      RowBox[{
       RowBox[{"Total", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"dnF", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ebranch", "[", 
                 RowBox[{"[", "band", "]"}], "]"}], "[", 
                RowBox[{"px", ",", "py"}], "]"}], ")"}], "/", "T"}], "]"}], 
            "/", "T"}], "  ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"vxbranch", "[", 
               RowBox[{"[", "band", "]"}], "]"}], "[", 
              RowBox[{"px", ",", "py"}], "]"}], ")"}], "^", "2"}]}], " ", ",", 
          RowBox[{"{", 
           RowBox[{"band", ",", "nbands"}], "}"}]}], "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"px", ",", "py"}], "}"}], "\[Element]", " ", "MoireBZ0"}], 
       ",", " ", 
       RowBox[{"Method", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Automatic", ",", 
          RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], "}"}]}], 
       ",", 
       RowBox[{"MaxPoints", "\[Rule]", "1400000"}], ",", 
       RowBox[{"MinRecursion", "\[Rule]", "9"}], ",", 
       RowBox[{"MaxRecursion", "\[Rule]", "12"}], ",", " ", 
       RowBox[{"PrecisionGoal", "\[Rule]", "3"}]}], "]"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.771064264988267*^9, 3.771064423224599*^9}, {
  3.7710644651385517`*^9, 3.771064615882023*^9}, {3.802865045459783*^9, 
  3.802865045574235*^9}},
 CellLabel->
  "In[3481]:=",ExpressionUUID->"35a62e18-5f2d-4242-abb9-bb8a957670c6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Ttensor", "[", 
   RowBox[{"n_", ",", "band_", ",", 
    RowBox[{"T_", "?", "NumericQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ebranch", "=", 
       RowBox[{
        RowBox[{"Branch", "[", "n", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"band", ",", "1"}], "]"}], "]"}]}], ",", " ", "vxbranch", 
      ",", "vybranch", ",", 
      RowBox[{"kxmin", "=", 
       RowBox[{"-", "0.08001"}]}], ",", 
      RowBox[{"kxmax", "=", "0.08"}], ",", 
      RowBox[{"kymin", "=", 
       RowBox[{"-", "0.08001"}]}], ",", 
      RowBox[{"kymax", "=", "0.08"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"vxbranch", "=", 
      RowBox[{"Interpolation", "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"kx", ",", "ky"}], "}"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Derivative", "[", 
                RowBox[{"1", ",", "0"}], "]"}], "[", "ebranch", "]"}], "[", 
              RowBox[{"kx", ",", "ky"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"kx", ",", "kxmin", ",", "kxmax", ",", "0.0005"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"ky", ",", "kymin", ",", "kymax", ",", "0.0005"}], 
            "}"}]}], "]"}], ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vybranch", "=", 
      RowBox[{"Interpolation", "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"kx", ",", "ky"}], "}"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Derivative", "[", 
                RowBox[{"0", ",", "1"}], "]"}], "[", "ebranch", "]"}], "[", 
              RowBox[{"kx", ",", "ky"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"kx", ",", "kxmin", ",", "kxmax", ",", "0.0005"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"ky", ",", "kymin", ",", "kymax", ",", "0.0005"}], 
            "}"}]}], "]"}], ",", "1"}], "]"}], "]"}]}], ";", 
     RowBox[{"NIntegrate", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"dnF", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"ebranch", "[", 
             RowBox[{"px", ",", "py"}], "]"}], ")"}], "/", "T"}], "]"}], "/", 
         "T"}], "  ", 
        RowBox[{"vxbranch", "[", 
         RowBox[{"px", ",", "py"}], "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"vybranch", "[", 
            RowBox[{"px", ",", "py"}], "]"}], "  ", 
           RowBox[{
            RowBox[{
             RowBox[{"Derivative", "[", 
              RowBox[{"1", ",", "0"}], "]"}], "[", "vybranch", "]"}], "[", 
            RowBox[{"px", ",", "py"}], "]"}]}], " ", "-", " ", 
          RowBox[{
           RowBox[{"vxbranch", "[", 
            RowBox[{"px", ",", "py"}], "]"}], "  ", 
           RowBox[{
            RowBox[{
             RowBox[{"Derivative", "[", 
              RowBox[{"0", ",", "1"}], "]"}], "[", "vybranch", "]"}], "[", 
            RowBox[{"px", ",", "py"}], "]"}]}]}], ")"}]}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"px", ",", "py"}], "}"}], "\[Element]", " ", "MoireBZ0"}], 
       ",", " ", 
       RowBox[{"Method", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Automatic", ",", 
          RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], "}"}]}], 
       ",", 
       RowBox[{"MaxPoints", "\[Rule]", "2500000"}], ",", 
       RowBox[{"MinRecursion", "\[Rule]", "12"}], ",", 
       RowBox[{"MaxRecursion", "\[Rule]", "17"}], ",", " ", 
       RowBox[{"PrecisionGoal", "\[Rule]", "4"}]}], "]"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.76949876663461*^9, 3.7694987922691097`*^9}, {
   3.769498915541684*^9, 3.76949891697398*^9}, {3.769498955036318*^9, 
   3.769498958847389*^9}, {3.7694990229283733`*^9, 3.769499034445294*^9}, {
   3.7695003680142317`*^9, 3.769500387203788*^9}, 3.769788577266054*^9, 
   3.769788645055018*^9, {3.769863878042181*^9, 3.76986388260748*^9}, 
   3.7698640447592363`*^9, {3.7698641435577*^9, 3.769864143768774*^9}, {
   3.769936177382559*^9, 3.769936242517007*^9}, {3.769960705565794*^9, 
   3.769960706594055*^9}, {3.7699609783933153`*^9, 3.769960984969574*^9}, 
   3.76997165184303*^9, {3.76997169215419*^9, 3.769971692318161*^9}, {
   3.7701020998060427`*^9, 3.7701021444801807`*^9}, {3.77010222114581*^9, 
   3.770102423760449*^9}, {3.770102455562261*^9, 3.770102571481102*^9}, 
   3.7701028229066477`*^9, {3.7701028699902143`*^9, 3.7701028725690517`*^9}, 
   3.770102968921596*^9, {3.770104896553341*^9, 3.770104902762882*^9}, {
   3.770105087835194*^9, 3.770105097978228*^9}, {3.8028650509899673`*^9, 
   3.8028650511041117`*^9}},
 CellLabel->
  "In[3491]:=",ExpressionUUID->"8541fb3f-6aa1-4afb-babd-3c29960e00ff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TtensorAll", "[", 
   RowBox[{"n_", ",", "nbands_", ",", 
    RowBox[{"T_", "?", "NumericQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"band", ",", 
      RowBox[{"ebranch", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Branch", "[", "n", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"band", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"band", ",", "nbands"}], "}"}]}], "]"}]}], ",", " ", 
      "vxbranch", ",", "vybranch", ",", 
      RowBox[{"kxmin", "=", 
       RowBox[{"-", "0.08001"}]}], ",", 
      RowBox[{"kxmax", "=", "0.08"}], ",", 
      RowBox[{"kymin", "=", 
       RowBox[{"-", "0.08001"}]}], ",", 
      RowBox[{"kymax", "=", "0.08"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{"vxbranch", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Interpolation", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"kx", ",", "ky"}], "}"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Derivative", "[", 
                  RowBox[{"1", ",", "0"}], "]"}], "[", 
                 RowBox[{"ebranch", "[", 
                  RowBox[{"[", "band", "]"}], "]"}], "]"}], "[", 
                RowBox[{"kx", ",", "ky"}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"kx", ",", "kxmin", ",", "kxmax", ",", "0.0005"}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"ky", ",", "kymin", ",", "kymax", ",", "0.0005"}], 
              "}"}]}], "]"}], ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"band", ",", "nbands"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vybranch", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Interpolation", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"kx", ",", "ky"}], "}"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Derivative", "[", 
                  RowBox[{"0", ",", "1"}], "]"}], "[", 
                 RowBox[{"ebranch", "[", 
                  RowBox[{"[", "band", "]"}], "]"}], "]"}], "[", 
                RowBox[{"kx", ",", "ky"}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"kx", ",", "kxmin", ",", "kxmax", ",", "0.0005"}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"ky", ",", "kymin", ",", "kymax", ",", "0.0005"}], 
              "}"}]}], "]"}], ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"band", ",", "nbands"}], "}"}]}], "]"}]}], ";", " ", 
     RowBox[{"NIntegrate", "[", 
      RowBox[{
       RowBox[{"Total", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"dnF", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"ebranch", "[", 
                 RowBox[{"[", "band", "]"}], "]"}], "[", 
                RowBox[{"px", ",", "py"}], "]"}], ")"}], "/", "T"}], "]"}], 
            "/", "T"}], "  ", 
           RowBox[{
            RowBox[{"vxbranch", "[", 
             RowBox[{"[", "band", "]"}], "]"}], "[", 
            RowBox[{"px", ",", "py"}], "]"}], " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"vybranch", "[", 
                RowBox[{"[", "band", "]"}], "]"}], "[", 
               RowBox[{"px", ",", "py"}], "]"}], "  ", 
              RowBox[{
               RowBox[{
                RowBox[{"Derivative", "[", 
                 RowBox[{"1", ",", "0"}], "]"}], "[", 
                RowBox[{"vybranch", "[", 
                 RowBox[{"[", "band", "]"}], "]"}], "]"}], "[", 
               RowBox[{"px", ",", "py"}], "]"}]}], " ", "-", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"vxbranch", "[", 
                RowBox[{"[", "band", "]"}], "]"}], "[", 
               RowBox[{"px", ",", "py"}], "]"}], "  ", 
              RowBox[{
               RowBox[{
                RowBox[{"Derivative", "[", 
                 RowBox[{"0", ",", "1"}], "]"}], "[", 
                RowBox[{"vybranch", "[", 
                 RowBox[{"[", "band", "]"}], "]"}], "]"}], "[", 
               RowBox[{"px", ",", "py"}], "]"}]}]}], ")"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"band", ",", "nbands"}], "}"}]}], "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"px", ",", "py"}], "}"}], "\[Element]", " ", "MoireBZ0"}], 
       ",", " ", 
       RowBox[{"Method", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Automatic", ",", 
          RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], "}"}]}], 
       ",", 
       RowBox[{"MaxPoints", "\[Rule]", "2500000"}], ",", 
       RowBox[{"MinRecursion", "\[Rule]", "12"}], ",", 
       RowBox[{"MaxRecursion", "\[Rule]", "17"}], ",", " ", 
       RowBox[{"PrecisionGoal", "\[Rule]", "4"}]}], "]"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.77106464309035*^9, 3.771064643424323*^9}, {
  3.7710648241164093`*^9, 3.771064944910183*^9}, {3.802865058240705*^9, 
  3.802865058303236*^9}},
 CellLabel->
  "In[3483]:=",ExpressionUUID->"131f1366-9ec4-4575-9025-62eddc72304a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Ttensor1", "[", 
   RowBox[{"n_", ",", "band_", ",", 
    RowBox[{"T_", "?", "NumericQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ebranch", "=", 
      RowBox[{
       RowBox[{"Branch", "[", "n", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"band", ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
    RowBox[{"NIntegrate", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"dnF", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"ebranch", "[", 
            RowBox[{"px", ",", "py"}], "]"}], ")"}], "/", "T"}], "]"}], "/", 
        "T"}], "  ", 
       RowBox[{
        RowBox[{
         RowBox[{"Derivative", "[", 
          RowBox[{"1", ",", "0"}], "]"}], "[", "ebranch", "]"}], "[", 
        RowBox[{"px", ",", "py"}], "]"}], " ", 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Derivative", "[", 
             RowBox[{"0", ",", "1"}], "]"}], "[", "ebranch", "]"}], "[", 
           RowBox[{"px", ",", "py"}], "]"}], "  ", 
          RowBox[{
           RowBox[{
            RowBox[{"Derivative", "[", 
             RowBox[{"1", ",", "1"}], "]"}], "[", "ebranch", "]"}], "[", 
           RowBox[{"px", ",", "py"}], "]"}]}], " ", "-", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Derivative", "[", 
             RowBox[{"1", ",", "0"}], "]"}], "[", "ebranch", "]"}], "[", 
           RowBox[{"px", ",", "py"}], "]"}], "  ", 
          RowBox[{
           RowBox[{
            RowBox[{"Derivative", "[", 
             RowBox[{"0", ",", "2"}], "]"}], "[", "ebranch", "]"}], "[", 
           RowBox[{"px", ",", "py"}], "]"}]}]}], ")"}]}], ",", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"px", ",", "py"}], "}"}], "\[Element]", "MoireBZ1"}], ",", 
      " ", 
      RowBox[{"Method", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"Automatic", ",", 
         RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], "}"}]}], 
      ",", 
      RowBox[{"MaxPoints", "\[Rule]", "1500000"}], ",", 
      RowBox[{"MinRecursion", "\[Rule]", "11"}], ",", 
      RowBox[{"MaxRecursion", "\[Rule]", "15"}], ",", " ", 
      RowBox[{"PrecisionGoal", "\[Rule]", "3"}]}], "]"}]}], "]"}]}]], "Input",\

 CellChangeTimes->{{3.770037982939774*^9, 3.770037997603532*^9}, {
  3.802869902813634*^9, 
  3.802869902867319*^9}},ExpressionUUID->"3b8ee68c-387e-4380-8b48-\
cf7efd9cb8ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Ttensor2", "[", 
   RowBox[{"n_", ",", "band_", ",", 
    RowBox[{"T_", "?", "NumericQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ebranch", "=", 
      RowBox[{
       RowBox[{"Branch", "[", "n", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"band", ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
    RowBox[{"NIntegrate", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"dnF", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"ebranch", "[", 
            RowBox[{"px", ",", "py"}], "]"}], ")"}], "/", "T"}], "]"}], "/", 
        "T"}], "  ", 
       RowBox[{
        RowBox[{
         RowBox[{"Derivative", "[", 
          RowBox[{"1", ",", "0"}], "]"}], "[", "ebranch", "]"}], "[", 
        RowBox[{"px", ",", "py"}], "]"}], " ", 
       RowBox[{"(", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Derivative", "[", 
             RowBox[{"0", ",", "1"}], "]"}], "[", "ebranch", "]"}], "[", 
           RowBox[{"px", ",", "py"}], "]"}], "  ", 
          RowBox[{
           RowBox[{
            RowBox[{"Derivative", "[", 
             RowBox[{"1", ",", "1"}], "]"}], "[", "ebranch", "]"}], "[", 
           RowBox[{"px", ",", "py"}], "]"}]}], " ", "-", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Derivative", "[", 
             RowBox[{"1", ",", "0"}], "]"}], "[", "ebranch", "]"}], "[", 
           RowBox[{"px", ",", "py"}], "]"}], "  ", 
          RowBox[{
           RowBox[{
            RowBox[{"Derivative", "[", 
             RowBox[{"0", ",", "2"}], "]"}], "[", "ebranch", "]"}], "[", 
           RowBox[{"px", ",", "py"}], "]"}]}]}], ")"}]}], ",", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"px", ",", "py"}], "}"}], "\[Element]", "MoireBZ2"}], ",", 
      " ", 
      RowBox[{"Method", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"Automatic", ",", 
         RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], "}"}]}], 
      ",", 
      RowBox[{"MaxPoints", "\[Rule]", "1500000"}], ",", 
      RowBox[{"MinRecursion", "\[Rule]", "11"}], ",", 
      RowBox[{"MaxRecursion", "\[Rule]", "15"}], ",", " ", 
      RowBox[{"PrecisionGoal", "\[Rule]", "4"}]}], "]"}]}], "]"}]}]], "Input",\

 CellChangeTimes->{{3.770037638243227*^9, 3.770037682462407*^9}, {
  3.7701048876326847`*^9, 3.7701048878662*^9}, {3.8028650685290318`*^9, 
  3.80286506859661*^9}},
 CellLabel->
  "In[3485]:=",ExpressionUUID->"993dc8ba-2d8f-460a-9bbf-4ba6e730f96a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"VtensorBulk", "[", 
   RowBox[{"n_", ",", 
    RowBox[{"T_", "?", "NumericQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ebranches", "=", 
      RowBox[{"OrdinaryBranch", "[", "n", "]"}]}], "}"}], ",", 
    RowBox[{"NIntegrate", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Total", "[", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"dnF", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"#", "[", 
                  RowBox[{"px", ",", "py"}], "]"}], ")"}], "/", "T"}], "]"}], 
              "/", "T"}], "  ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Derivative", "[", 
                  RowBox[{"1", ",", "0"}], "]"}], "[", "#", "]"}], "[", 
                RowBox[{"px", ",", "py"}], "]"}], ")"}], "^", "2"}]}], ")"}], 
           "&"}], ",", "ebranches"}], "]"}], "]"}], " ", 
       RowBox[{"Boole", "[", 
        RowBox[{"subtractRegionCond", "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "\[Rule]", "px"}], ",", 
           RowBox[{"y", "\[Rule]", "py"}]}], "}"}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"px", ",", 
        RowBox[{"-", "0.04"}], ",", "0.04"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"py", ",", 
        RowBox[{"-", "0.04"}], ",", "0.04"}], "}"}], ",", " ", 
      RowBox[{"Method", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"Automatic", ",", 
         RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], "}"}]}], 
      ",", 
      RowBox[{"MaxPoints", "\[Rule]", "40000"}], ",", 
      RowBox[{"MinRecursion", "\[Rule]", "7"}], ",", 
      RowBox[{"MaxRecursion", "\[Rule]", "10"}], ",", " ", 
      RowBox[{"PrecisionGoal", "\[Rule]", "2"}]}], "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.769511813998623*^9, 3.769511818862578*^9}, {
  3.769511948742831*^9, 3.769511954430785*^9}, {3.769511994175325*^9, 
  3.769512109758891*^9}, {3.769512161073988*^9, 3.769512162054853*^9}, {
  3.769512279474399*^9, 3.769512292302593*^9}, {3.769863810751471*^9, 
  3.7698638290756207`*^9}, {3.769863978218129*^9, 3.769864028035565*^9}, {
  3.769864139629571*^9, 3.769864139847134*^9}, {3.7699607206946373`*^9, 
  3.7699607217702837`*^9}, {3.769968487543026*^9, 3.769968492431128*^9}, {
  3.769968524432502*^9, 3.769968526579938*^9}},
 CellLabel->
  "In[3486]:=",ExpressionUUID->"2b9647d5-89d2-4053-8b70-97072cd9730b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TtensorBulk", "[", 
   RowBox[{"n_", ",", 
    RowBox[{"T_", "?", "NumericQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ebranches", "=", 
      RowBox[{"OrdinaryBranch", "[", "n", "]"}]}], "}"}], ",", 
    RowBox[{"NIntegrate", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Total", "[", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"dnF", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"#", "[", 
                  RowBox[{"px", ",", "py"}], "]"}], ")"}], "/", "T"}], "]"}], 
              "/", "T"}], "  ", 
             RowBox[{
              RowBox[{
               RowBox[{"Derivative", "[", 
                RowBox[{"1", ",", "0"}], "]"}], "[", "#", "]"}], "[", 
              RowBox[{"px", ",", "py"}], "]"}], " ", 
             RowBox[{"(", " ", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Derivative", "[", 
                   RowBox[{"0", ",", "1"}], "]"}], "[", "#", "]"}], "[", 
                 RowBox[{"px", ",", "py"}], "]"}], "  ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Derivative", "[", 
                   RowBox[{"1", ",", "1"}], "]"}], "[", "#", "]"}], "[", 
                 RowBox[{"px", ",", "py"}], "]"}]}], " ", "-", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Derivative", "[", 
                   RowBox[{"1", ",", "0"}], "]"}], "[", "#", "]"}], "[", 
                 RowBox[{"px", ",", "py"}], "]"}], "  ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Derivative", "[", 
                   RowBox[{"0", ",", "2"}], "]"}], "[", "#", "]"}], "[", 
                 RowBox[{"px", ",", "py"}], "]"}]}]}], ")"}]}], ")"}], "&"}], 
          ",", "ebranches"}], "]"}], "]"}], " ", "*", " ", 
       RowBox[{"Boole", "[", 
        RowBox[{"subtractRegionCond", "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "\[Rule]", "px"}], ",", 
           RowBox[{"y", "\[Rule]", "py"}]}], "}"}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"px", ",", 
        RowBox[{"-", "0.04"}], ",", "0.04"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"py", ",", 
        RowBox[{"-", "0.04"}], ",", "0.04"}], "}"}], ",", " ", 
      RowBox[{"Method", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"Automatic", ",", 
         RowBox[{"\"\<SymbolicProcessing\>\"", "\[Rule]", "0"}]}], "}"}]}], 
      ",", 
      RowBox[{"MaxPoints", "\[Rule]", "40000"}], ",", 
      RowBox[{"MinRecursion", "\[Rule]", "7"}], ",", 
      RowBox[{"MaxRecursion", "\[Rule]", "10"}], ",", " ", 
      RowBox[{"PrecisionGoal", "\[Rule]", "2"}]}], "]"}]}], "]"}]}]], "Input",\

 CellChangeTimes->{{3.769511813998623*^9, 3.769511818862578*^9}, {
   3.769511948742831*^9, 3.769511954430785*^9}, {3.769511994175325*^9, 
   3.769512109758891*^9}, {3.769512161073988*^9, 3.769512162054853*^9}, {
   3.769512279474399*^9, 3.769512309670794*^9}, {3.769512356433818*^9, 
   3.769512394886794*^9}, {3.769863047265184*^9, 3.769863114585164*^9}, 
   3.769863157252556*^9, {3.7698637638889647`*^9, 3.769863772219967*^9}, {
   3.7698638973569508`*^9, 3.7698639076282587`*^9}, 3.7698640536806307`*^9, {
   3.769864135781898*^9, 3.769864135964795*^9}, {3.769960727344886*^9, 
   3.7699607285630493`*^9}, {3.769968506714922*^9, 3.769968533751889*^9}},
 CellLabel->
  "In[3487]:=",ExpressionUUID->"d5a45c9b-b6a9-4aa0-887c-7e52c9a0fda6"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
  "Add", " ", "few", " ", "bulk", " ", "spectrum", " ", "branches", " ", "in",
    " ", "the", " ", "subttactRegion"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.769510197992989*^9, 3.76951024626025*^9}},
 CellLabel->
  "In[3488]:=",ExpressionUUID->"fc95c435-b7d3-44db-8a2d-db68672b2b07"],

Cell[BoxData[
 RowBox[{
  RowBox[{"temp", "=", "0.0003"}], ";"}]], "Input",
 CellChangeTimes->{{3.76986663065938*^9, 3.769866635401675*^9}, {
  3.769960739916841*^9, 3.7699607407937613`*^9}, {3.7699714904355793`*^9, 
  3.769971490611*^9}, {3.770103276996423*^9, 3.770103277415584*^9}, {
  3.7701051165585527`*^9, 3.770105116689115*^9}},
 CellLabel->
  "In[3492]:=",ExpressionUUID->"69b802c0-d684-4f5f-ab61-cfb789744c5b"],

Cell[BoxData[
 RowBox[{"Tfun", "=", 
  RowBox[{"Interpolation", "[", 
   RowBox[{
    RowBox[{"ParallelTable", "[", 
     RowBox[{
      RowBox[{"Quiet", "@", 
       RowBox[{"{", 
        RowBox[{"n", ",", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"TtensorBulk", "[", 
            RowBox[{"n", ",", "0.001"}], "]"}], "+"}], "*)"}], 
         RowBox[{
          RowBox[{"Ttensor", "[", 
           RowBox[{"n", ",", "1", ",", "temp"}], "]"}], "+", 
          RowBox[{"Ttensor", "[", 
           RowBox[{"n", ",", "2", ",", "temp"}], "]"}], "+", 
          RowBox[{"Ttensor", "[", 
           RowBox[{"n", ",", "13", ",", "temp"}], "]"}], "+", 
          RowBox[{"Ttensor", "[", 
           RowBox[{"n", ",", "14", ",", "temp"}], "]"}]}]}], "}"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"n", ",", 
        RowBox[{"-", "3.97"}], ",", "4", ",", "0.1"}], "}"}]}], "]"}], ",", 
    RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.753891461078082*^9, 3.753891510877968*^9}, {
   3.753891576804295*^9, 3.753891607411458*^9}, {3.753891947283473*^9, 
   3.753891978840287*^9}, {3.753893024880086*^9, 3.7538930421868467`*^9}, {
   3.753893078677247*^9, 3.753893080262137*^9}, 3.753896689640356*^9, {
   3.753898853558641*^9, 3.753898856408762*^9}, {3.76949884771445*^9, 
   3.769498874587716*^9}, {3.769498940257635*^9, 3.76949894866529*^9}, {
   3.769499055985736*^9, 3.7694990667578783`*^9}, {3.769500478590526*^9, 
   3.769500479042901*^9}, {3.7695008696380167`*^9, 3.769500877435781*^9}, {
   3.769504056243072*^9, 3.769504060783145*^9}, {3.769505826328926*^9, 
   3.769505857872808*^9}, {3.769512624563483*^9, 3.769512646615047*^9}, {
   3.769515717964128*^9, 3.769515725041144*^9}, {3.769516286234696*^9, 
   3.769516289421377*^9}, {3.769598364724329*^9, 3.769598372799534*^9}, {
   3.769864107713331*^9, 3.769864110545279*^9}, {3.769866576036345*^9, 
   3.769866604524205*^9}, {3.769968390736672*^9, 3.7699683960158987`*^9}, {
   3.769971504899085*^9, 3.769971505378521*^9}, {3.770104696196725*^9, 
   3.7701047000811977`*^9}, {3.770971526776945*^9, 3.7709715330472527`*^9}, {
   3.7709716046105213`*^9, 3.770971607895082*^9}, {3.771086351192588*^9, 
   3.771086382608019*^9}, {3.7721192428409033`*^9, 3.772119246284618*^9}, {
   3.802869948365923*^9, 3.802869978559689*^9}},
 CellLabel->
  "In[3493]:=",ExpressionUUID->"5c8b6e06-0291-4add-90ff-20b3101afdc2"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"TfunBulk", "=", 
   RowBox[{"Interpolation", "[", 
    RowBox[{
     RowBox[{"ParallelTable", "[", 
      RowBox[{
       RowBox[{"Quiet", "@", 
        RowBox[{"{", 
         RowBox[{"n", ",", " ", 
          RowBox[{"TtensorBulk", "[", 
           RowBox[{"n", ",", "temp"}], "]"}]}], "}"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", 
         RowBox[{"-", "3.97"}], ",", "4", ",", "0.1"}], "}"}]}], "]"}], ",", 
     RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], " ", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.76996841274944*^9, 3.769968440475425*^9}, {
  3.7702294020380287`*^9, 3.77022940511598*^9}},
 CellLabel->
  "In[184]:=",ExpressionUUID->"9ce9033b-ad4e-4e40-a369-cda49f6e6f56"],

Cell[BoxData[
 RowBox[{"Vfun", "=", 
  RowBox[{"Interpolation", "[", 
   RowBox[{
    RowBox[{"ParallelTable", "[", 
     RowBox[{
      RowBox[{"Quiet", "@", 
       RowBox[{"{", 
        RowBox[{"n", ",", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"VtensorBulk", "[", 
            RowBox[{"n", ",", "0.001"}], "]"}], "+"}], "*)"}], 
         RowBox[{
          RowBox[{"Vtensor", "[", 
           RowBox[{"n", ",", "1", ",", "temp"}], "]"}], "+", 
          RowBox[{"Vtensor", "[", 
           RowBox[{"n", ",", "2", ",", "temp"}], "]"}], "+", 
          RowBox[{"Vtensor", "[", 
           RowBox[{"n", ",", "13", ",", "temp"}], "]"}], "+", 
          RowBox[{"Vtensor", "[", 
           RowBox[{"n", ",", "14", ",", "temp"}], "]"}]}]}], "}"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"n", ",", 
        RowBox[{"-", "3.97"}], ",", "4", ",", "0.1"}], "}"}]}], "]"}], ",", 
    RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7694990806248283`*^9, 3.7694990884142923`*^9}, {
  3.769500471894321*^9, 3.7695004724346952`*^9}, {3.76950088156483*^9, 
  3.7695008875957727`*^9}, {3.769504071250396*^9, 3.769504075782939*^9}, {
  3.7695057249077587`*^9, 3.7695057408328123`*^9}, {3.7695057888205967`*^9, 
  3.769505801216593*^9}, {3.769512656955147*^9, 3.76951267190331*^9}, {
  3.7695157332899847`*^9, 3.769515735521632*^9}, {3.769516278238632*^9, 
  3.7695162932265*^9}, {3.769598381442737*^9, 3.769598385375581*^9}, {
  3.769866049297525*^9, 3.769866050974142*^9}, {3.769866549362578*^9, 
  3.769866569565835*^9}, {3.769866610408743*^9, 3.769866625889501*^9}, {
  3.77097154210561*^9, 3.770971549887248*^9}, {3.770971616639947*^9, 
  3.77097162052796*^9}, {3.7710864093653383`*^9, 3.771086427388617*^9}, {
  3.772119266100628*^9, 3.772119271220875*^9}, {3.802870011311098*^9, 
  3.8028700224077177`*^9}},
 CellLabel->
  "In[3494]:=",ExpressionUUID->"9d93e614-3099-4e83-abe1-146c7ef58b56"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"VfunBulk", "=", 
   RowBox[{"Interpolation", "[", 
    RowBox[{
     RowBox[{"ParallelTable", "[", 
      RowBox[{
       RowBox[{"Quiet", "@", 
        RowBox[{"{", 
         RowBox[{"n", ",", " ", 
          RowBox[{"VtensorBulk", "[", 
           RowBox[{"n", ",", "temp"}], "]"}]}], "}"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", 
         RowBox[{"-", "3.97"}], ",", "4", ",", "0.1"}], "}"}]}], "]"}], ",", 
     RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], " ", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.769968572940201*^9, 3.769968597333489*^9}, {
  3.770229410736002*^9, 3.770229413600115*^9}},
 CellLabel->
  "In[186]:=",ExpressionUUID->"559eb81d-b77b-4504-a140-1e78a6dde61d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"RHall", "[", "ee_", "]"}], "=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"2", " ", "\[Pi]"}], ")"}], "^", "2"}], " ", 
    RowBox[{
     RowBox[{"Tfun", "[", "ee", "]"}], "/", 
     RowBox[{"(", 
      RowBox[{"4", " ", "e", " ", 
       RowBox[{
        RowBox[{"Vfun", "[", "ee", "]"}], "^", "2"}]}], ")"}]}], " ", 
    RowBox[{"Co", " ", "/", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"kUnit", " ", "m"}], ")"}], "^", "2"}]}]}], " ", "//.", 
   "Valuesh", " ", 
   RowBox[{"(*", " ", 
    RowBox[{"in", " ", 
     RowBox[{
      RowBox[{"m", "^", "2"}], "/", "C"}], "  ", "units"}], " ", 
    "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.753893197984851*^9, 3.753893251711445*^9}, {
  3.753896560496397*^9, 3.7538966021818657`*^9}, {3.753900276338346*^9, 
  3.753900276461708*^9}, {3.7694999129644012`*^9, 3.7694999585868692`*^9}, {
  3.7695002139030724`*^9, 3.7695002141872597`*^9}, {3.769500333462859*^9, 
  3.769500333875155*^9}},
 CellLabel->
  "In[3495]:=",ExpressionUUID->"36532b37-1a52-4192-87bf-e2376dd7088c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Rxx", "[", 
   RowBox[{"ee_", ",", "\[Tau]_"}], "]"}], "=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"(", "h", ")"}], "^", "2"}], "/", 
     RowBox[{"(", 
      RowBox[{"4", " ", 
       RowBox[{"e", "^", "2"}], " ", 
       RowBox[{"Vfun", "[", "ee", "]"}], " ", "\[Tau]", " ", "eV"}], ")"}]}], 
    "//.", "Valuesh"}], "/.", "removeDim", " ", 
   RowBox[{"(*", " ", 
    RowBox[{"in", " ", "Ohm", "  ", "units"}], " ", "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.753896728288344*^9, 3.753896775741643*^9}, {
  3.753896899508786*^9, 3.7538969023896437`*^9}, {3.753897475193533*^9, 
  3.753897477404797*^9}, {3.753897608378396*^9, 3.753897647779405*^9}, {
  3.7538978003987083`*^9, 3.753897805905908*^9}, {3.753900279223138*^9, 
  3.7539002793384647`*^9}, {3.7694999816603737`*^9, 3.769500005595402*^9}, {
  3.769500054454818*^9, 3.769500057763514*^9}, {3.769500146758741*^9, 
  3.769500147803278*^9}},
 CellLabel->
  "In[3496]:=",ExpressionUUID->"167cd3f4-a08d-4773-98fd-1c86fa0b16d5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Save", "[", 
   RowBox[{
    RowBox[{"path", "<>", "\"\<TfunMoireEps27Thesis8\>\""}], ",", 
    RowBox[{"{", 
     RowBox[{"Tfun", ",", "Vfun"}], "}"}]}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.769501915024065*^9, 3.769501944628852*^9}, {
   3.769502029312253*^9, 3.769502031660307*^9}, {3.769936287161562*^9, 
   3.769936288644153*^9}, {3.770229426563994*^9, 3.7702294289809303`*^9}, {
   3.7703535125849752`*^9, 3.770353533257203*^9}, {3.770971575014776*^9, 
   3.770971581463192*^9}, {3.771146770920978*^9, 3.771146772187188*^9}, 
   3.771395890057548*^9, {3.772119301352789*^9, 3.772119304100739*^9}, {
   3.772119335393484*^9, 3.772119337613784*^9}, {3.7870796679987507`*^9, 
   3.787079669972987*^9}, {3.789309929316931*^9, 3.789309932272726*^9}, {
   3.789424501375061*^9, 3.789424512060437*^9}, {3.802864947538505*^9, 
   3.802864951681693*^9}},
 CellLabel->
  "In[3497]:=",ExpressionUUID->"18290f27-1e7e-4bb4-be7c-7aa632794f28"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"<<", 
   RowBox[{"(", 
    RowBox[{"path", "<>", "\"\<TfunMoireEps30Thesis\>\""}], ")"}]}], "  ", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.769519301860731*^9, 3.769519307164557*^9}, {
  3.769939812197185*^9, 3.76993981464694*^9}, {3.797758351213632*^9, 
  3.7977583757049417`*^9}, {3.802864955091186*^9, 3.802864957749577*^9}},
 CellLabel->
  "In[3498]:=",ExpressionUUID->"dc98d73c-3e40-4ad6-8f57-d7216ff5c83b"],

Cell[BoxData[
 RowBox[{"Tprefactor", "=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"e", "^", "3"}], "  ", 
      RowBox[{"s", "^", "2"}], " ", "Tesla", " ", 
      RowBox[{
       RowBox[{"eV", "^", "2"}], "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"\[Pi]", "^", "2"}], " ", 
         RowBox[{"\[HBar]", "^", "4"}], " ", 
         RowBox[{"kUnit", "^", "2"}]}], ")"}]}]}], " ", "//.", "Valuesh"}], 
    ")"}], "/.", "removeDim", "   ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"in", " ", "Siemens", " ", "units"}], " ", ",", "  ", 
     RowBox[{
     "factor", " ", "of", " ", "4", " ", "from", " ", "degeneracies", " ", 
      "is", " ", "included", " ", "here"}]}], "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.7697813655184813`*^9, 3.76978141333797*^9}, {
   3.769782152174597*^9, 3.769782169302105*^9}, {3.7697851111129827`*^9, 
   3.769785111332893*^9}, {3.769786445171814*^9, 3.7697865452445097`*^9}, 
   3.7697872896156807`*^9},
 CellLabel->
  "In[3499]:=",ExpressionUUID->"e0a3e54f-e0cf-4005-a296-4497d2dd3eb9"],

Cell[BoxData[
 RowBox[{"Vprefactor", "=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"e", "^", "2"}], "  ", "s", "  ", 
      RowBox[{"eV", "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"\[Pi]", "^", "2"}], " ", 
         RowBox[{"\[HBar]", "^", "2"}]}], ")"}]}]}], " ", "//.", "Valuesh"}], 
    ")"}], "/.", "removeDim", "    ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"in", " ", "Siemens", " ", "units"}], " ", ",", "  ", 
     RowBox[{
     "factor", " ", "of", " ", "4", " ", "from", " ", "degeneracies", " ", 
      "is", " ", "included", " ", "here"}]}], "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.7697877117399187`*^9, 3.7697877121625338`*^9}, {
  3.769787807267734*^9, 3.769787879116156*^9}},
 CellLabel->
  "In[3500]:=",ExpressionUUID->"b66d534f-9f09-4be1-a482-2901451ee077"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"e", "^", "2"}], "/", "h"}], "//.", "Valuesh"}]], "Input",
 CellChangeTimes->{{3.769785789181841*^9, 3.7697857988705177`*^9}},
 CellLabel->
  "In[3501]:=",ExpressionUUID->"87fb9654-10a7-405b-ab80-1cd3acea238f"],

Cell[BoxData[
 RowBox[{"Tfun", "[", 
  RowBox[{"-", "5"}], "]"}]], "Input",
 CellChangeTimes->{{3.77097446710793*^9, 3.77097447113734*^9}},
 CellLabel->
  "In[3502]:=",ExpressionUUID->"0f481f10-328e-4e3b-87ec-61a5c5e1651b"],

Cell[BoxData[
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"1", "/", "0.25"}], " ", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"5", "*", 
       RowBox[{"10", "^", 
        RowBox[{"-", "13"}]}]}], " ", ")"}], "^", "2"}], "Tprefactor", " ", 
    RowBox[{"(", 
     RowBox[{"Tfun", "[", "n", "]"}], ")"}]}], ",", 
   RowBox[{"{", 
    RowBox[{"n", ",", 
     RowBox[{"-", "5"}], ",", "5"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.7709743701005096`*^9, 3.7709743727454023`*^9}},
 CellLabel->
  "In[3503]:=",ExpressionUUID->"9a7b5a72-bb1d-405f-90c8-3ae48ccc7407"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1918, 1016},
WindowMargins->{{1, Automatic}, {0, Automatic}},
TaggingRules->{"Salvaged" -> True},
FrontEndVersion->"12.0 for Linux x86 (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 283, 5, 31, "Input",ExpressionUUID->"fbc5bcd9-63b5-42b3-b035-7b17f9a2e9ce"],
Cell[CellGroupData[{
Cell[866, 29, 249, 4, 46, "Subsubsection",ExpressionUUID->"49a94d6b-8711-45ea-915f-081fe95058f9"],
Cell[1118, 35, 363, 7, 31, "Input",ExpressionUUID->"85cf049b-9954-4a6d-9315-7cc3e680a3e2"],
Cell[1484, 44, 1064, 20, 31, "Input",ExpressionUUID->"8f17d1ba-40f2-428b-b029-eccad248496e"],
Cell[2551, 66, 729, 18, 31, "Input",ExpressionUUID->"c957dc19-042f-4285-9d26-08a52727f215"],
Cell[3283, 86, 689, 16, 31, "Input",ExpressionUUID->"ac848a87-acde-4f5f-828a-6710b96ed730"],
Cell[3975, 104, 503, 14, 31, "Input",ExpressionUUID->"fc4e306c-f1ad-4a80-b409-11ba95c4b69b"],
Cell[4481, 120, 4343, 121, 101, "Input",ExpressionUUID->"1807dfc2-d7f4-4887-96ae-d94a8a71340e"],
Cell[8827, 243, 2713, 79, 170, "Input",ExpressionUUID->"cd7550ef-498b-4efe-a39d-872fc1c4d9da"],
Cell[11543, 324, 1696, 40, 51, "Input",ExpressionUUID->"a6b49869-f653-4dde-9e71-3062dfb46aa6"],
Cell[13242, 366, 397, 11, 31, "Input",ExpressionUUID->"18cade7e-0039-4c9d-8760-e904b5076231"],
Cell[13642, 379, 438, 12, 31, "Input",ExpressionUUID->"a5fe49b3-79e4-47ce-a50b-536bb5fd3f88"],
Cell[14083, 393, 386, 10, 31, "Input",ExpressionUUID->"3650f239-918b-4aa8-911c-9ada2bbd585e"],
Cell[14472, 405, 290, 6, 31, "Input",ExpressionUUID->"03ccd545-9585-4303-b4fe-0be829c1aa76"],
Cell[14765, 413, 848, 23, 31, "Input",ExpressionUUID->"f177c360-3f6c-4074-b641-c9caf7cce5e0"],
Cell[15616, 438, 596, 18, 31, "Input",ExpressionUUID->"6e31d307-3343-43d6-a1e5-eadef13b15f9"],
Cell[16215, 458, 335, 9, 31, "Input",ExpressionUUID->"b512c14d-f4d2-44b6-981f-885332631c30"],
Cell[16553, 469, 470, 14, 31, "Input",ExpressionUUID->"920dc996-881e-4987-a43e-8437ec8b193f"],
Cell[17026, 485, 831, 20, 31, "Input",ExpressionUUID->"dc968a0a-3bc6-4498-81a0-9d6ccba9cf4d"],
Cell[17860, 507, 675, 17, 78, "Input",ExpressionUUID->"e095fe2e-cdfb-49d7-b2b0-9d6066afb7e9"],
Cell[18538, 526, 370, 10, 31, "Input",ExpressionUUID->"6fd5080c-719c-4071-849c-283453c8c66f"],
Cell[18911, 538, 797, 22, 31, "Input",ExpressionUUID->"2de8e3c7-8678-48c3-9091-2acde57c36b9"],
Cell[19711, 562, 835, 19, 31, "Input",ExpressionUUID->"918b9294-29fb-4e45-95e5-8bd380ca0014"],
Cell[20549, 583, 1025, 28, 31, "Input",ExpressionUUID->"898ec61a-cef8-4e99-a6e0-49638d8c350b"],
Cell[21577, 613, 553, 14, 55, "Input",ExpressionUUID->"b752e6e0-4916-4bcb-abdc-d8ac614c68e5"],
Cell[22133, 629, 318, 7, 31, "Input",ExpressionUUID->"a444f39c-f355-46d6-9240-1a4ced6cf748"],
Cell[22454, 638, 403, 11, 31, "Input",ExpressionUUID->"68e9b24f-0826-4d54-9329-6263229c47ea"],
Cell[22860, 651, 264, 6, 31, "Input",ExpressionUUID->"6ead5444-ea78-4cb3-a750-8f65756f5baa"],
Cell[23127, 659, 484, 13, 31, "Input",ExpressionUUID->"7afe9636-a82b-461f-a813-9fd55cc2b434"],
Cell[23614, 674, 477, 13, 31, "Input",ExpressionUUID->"2197cf5f-2628-4af2-b638-1d1cd399cae5"],
Cell[24094, 689, 461, 12, 31, "Input",ExpressionUUID->"72e86b07-e303-416b-9856-1c5037e4fab0"],
Cell[24558, 703, 297, 6, 31, "Input",ExpressionUUID->"6712a925-064e-4ea4-a7c4-669eddc1df95"],
Cell[24858, 711, 201, 3, 36, "Text",ExpressionUUID->"1ac2fd32-dffa-4fe2-9bbb-c9da6dace3cd"],
Cell[25062, 716, 1543, 50, 147, "Input",ExpressionUUID->"f75662fd-7174-4e21-a892-24bee05fc3fd"]
}, Open  ]],
Cell[CellGroupData[{
Cell[26642, 771, 253, 4, 55, "Subsection",ExpressionUUID->"24cf012f-15df-4d2f-b135-be6d2516ce21"],
Cell[26898, 777, 2181, 50, 193, "Input",ExpressionUUID->"e07025ff-2a81-4c69-a42c-240ea0dd7af7"],
Cell[29082, 829, 223, 4, 31, "Input",ExpressionUUID->"460bada1-5d00-4903-a557-030e687c3224"],
Cell[29308, 835, 554, 15, 31, "Input",ExpressionUUID->"a4ea8601-a348-402e-b414-bfbd01930117"],
Cell[29865, 852, 505, 14, 31, "Input",ExpressionUUID->"9126eef7-1d37-4243-9d23-3921cb19f0c3"],
Cell[30373, 868, 3238, 70, 55, "Input",ExpressionUUID->"15611549-5512-446d-a927-49f6b26c62ee"],
Cell[33614, 940, 6015, 127, 101, "Input",ExpressionUUID->"3d8813ea-5e41-47f6-a8d6-5859c1a5e6ae"],
Cell[39632, 1069, 4047, 102, 101, "Input",ExpressionUUID->"d329ecc7-ac88-440c-b55f-baf9d68cdc8c"],
Cell[43682, 1173, 297, 6, 31, "Input",ExpressionUUID->"a883a547-4047-4ef8-aa60-9c093f748b2a"],
Cell[43982, 1181, 614, 11, 31, "Input",ExpressionUUID->"5e167c0c-9443-40b0-b128-d3648ec52ddc"],
Cell[44599, 1194, 2226, 51, 31, "Input",ExpressionUUID->"650aa29f-7cf7-4c81-b2ef-8fafc526ea6c"],
Cell[46828, 1247, 325, 6, 31, "Input",ExpressionUUID->"45e29553-4b2d-4d14-8850-3372b5765fce"],
Cell[47156, 1255, 1404, 38, 31, "Input",ExpressionUUID->"30aedefa-321d-4b44-b231-8f37bd1e5f41"],
Cell[48563, 1295, 1637, 43, 31, "Input",ExpressionUUID->"460cf1b8-f601-4af9-8ef2-b701c288dddb"],
Cell[50203, 1340, 237, 4, 31, "Input",ExpressionUUID->"2f79dbe6-0345-4711-994f-b981f4784f98"],
Cell[50443, 1346, 2132, 50, 31, "Input",ExpressionUUID->"6092a7a7-45b1-42e6-a056-1a6e81d0a5f3"],
Cell[52578, 1398, 1635, 43, 31, "Input",ExpressionUUID->"49d5625c-8340-4851-98c9-c546f35c97b1"],
Cell[54216, 1443, 294, 5, 31, "Input",ExpressionUUID->"31563ae1-740a-438f-a473-e5d4ca93a338"],
Cell[54513, 1450, 585, 12, 31, "Input",ExpressionUUID->"3de0f436-9a2f-448e-99e6-06a12bfd167e"],
Cell[55101, 1464, 218, 4, 31, "Input",ExpressionUUID->"91b933c2-7435-4a55-bb21-98459a024c82"],
Cell[55322, 1470, 485, 12, 31, "Input",ExpressionUUID->"f13df249-5f52-4ba0-8f54-d37a049bedd1"],
Cell[55810, 1484, 1613, 46, 78, "Input",ExpressionUUID->"7c627738-adcc-44eb-b537-f5404de11431"],
Cell[57426, 1532, 805, 17, 31, "Input",ExpressionUUID->"83d1d531-0ab2-4f36-ab6f-ddb9d461519c"],
Cell[58234, 1551, 916, 22, 55, "Input",ExpressionUUID->"255b6977-199b-4051-b205-2c6feac3282b"],
Cell[59153, 1575, 858, 22, 31, "Input",ExpressionUUID->"597ccff0-b8dd-4106-8af9-9d59580d337a"],
Cell[60014, 1599, 402, 11, 31, "Input",ExpressionUUID->"a59ae8a9-e497-4f9c-977d-efacee36820c"],
Cell[60419, 1612, 441, 11, 31, "Input",ExpressionUUID->"2d2209d8-b8f6-406f-b7e6-9f9d95a3f52e"],
Cell[60863, 1625, 524, 13, 31, "Input",ExpressionUUID->"31f8949d-c572-4637-9dd1-285af500f4a9"],
Cell[61390, 1640, 669, 17, 31, "Input",ExpressionUUID->"eb763495-73e9-473b-9be6-830499f971cc"],
Cell[62062, 1659, 1019, 16, 31, "Input",ExpressionUUID->"872f91fc-9be7-4614-a0d3-53c1fd23f745"],
Cell[63084, 1677, 1010, 25, 31, "Input",ExpressionUUID->"52a02c04-a738-4c51-9479-ca8932185ca7"],
Cell[64097, 1704, 1245, 32, 55, "Input",ExpressionUUID->"e027b9c5-fb3b-408d-a66f-9e64e6bbe5ba"],
Cell[65345, 1738, 4892, 112, 124, "Input",ExpressionUUID->"d68ca6f1-2c09-401e-a135-fbca485dbbec"],
Cell[70240, 1852, 1402, 32, 31, "Input",ExpressionUUID->"c70e7d72-d032-45d5-a29c-67a38f94ff63"],
Cell[71645, 1886, 817, 24, 31, "Input",ExpressionUUID->"34495ccb-731d-44db-957c-44dbbcba0e20"],
Cell[72465, 1912, 1354, 32, 31, "Input",ExpressionUUID->"9ae5d193-5951-43f9-bf4f-dfe26cfe47c7"],
Cell[73822, 1946, 834, 25, 31, "Input",ExpressionUUID->"e92e65d5-c5a3-47f4-9dcd-ac66133cca7d"],
Cell[74659, 1973, 281, 6, 31, "Input",ExpressionUUID->"2f31ee07-9815-44e6-bdee-5eca63a7cbf4"],
Cell[74943, 1981, 230, 5, 31, "Input",ExpressionUUID->"e700b1b1-55fb-4493-8cbc-61792b9a89c0"],
Cell[75176, 1988, 377, 7, 31, "Input",ExpressionUUID->"c5d83ee8-460a-4b1f-8603-ea8531b8c2e9"],
Cell[75556, 1997, 11182, 264, 377, "Input",ExpressionUUID->"5ae539fe-b1b2-4c3f-a0d1-aa481ced1b34"],
Cell[86741, 2263, 10118, 261, 285, "Input",ExpressionUUID->"1a39292d-cd99-44f4-b2d9-454eaaad985d"],
Cell[96862, 2526, 271, 8, 31, "Input",ExpressionUUID->"5baf7e01-a9ee-497e-8cb0-dbb91312b3ec"],
Cell[97136, 2536, 832, 16, 31, "Input",ExpressionUUID->"7fd9e6d8-7e75-4e1f-82d4-e9683cc6510d"],
Cell[CellGroupData[{
Cell[97993, 2556, 225, 5, 46, "Subsubsection",ExpressionUUID->"4253705d-4291-4026-8477-f83f70ccb27c"],
Cell[98221, 2563, 1064, 30, 31, "Input",ExpressionUUID->"4d391f04-292d-4dc5-85e8-ea1acf95c1d7"],
Cell[99288, 2595, 185, 3, 31, "Input",ExpressionUUID->"da960dd0-294e-46c9-9978-dcc0a6a780dc"],
Cell[99476, 2600, 222, 5, 31, "Input",ExpressionUUID->"af4de08b-e20e-4d02-8c6b-ec1f432202ee"],
Cell[99701, 2607, 12197, 288, 423, "Input",ExpressionUUID->"f7504dcd-fac0-4e89-8d48-60edc238512e"],
Cell[111901, 2897, 225, 6, 31, "Input",ExpressionUUID->"74f3f29a-b1bb-4bf4-8408-20f60abf6503"],
Cell[112129, 2905, 1792, 52, 124, "Input",ExpressionUUID->"d2a747a7-0baf-4c20-94b0-425a0e148e05"],
Cell[113924, 2959, 203, 4, 31, "Input",ExpressionUUID->"c7d41c4f-12ad-446b-ac18-44b852cb3568"],
Cell[114130, 2965, 728, 21, 31, "Input",ExpressionUUID->"0c34780d-d747-4e55-8167-4d7deb7cedfd"],
Cell[114861, 2988, 828, 25, 55, "Input",ExpressionUUID->"c14f5f9b-9373-4f9e-99ff-3f457d35f7bc"],
Cell[115692, 3015, 1067, 28, 55, "Input",ExpressionUUID->"6873da32-2552-4522-8c6c-c090315b97e8"],
Cell[116762, 3045, 4295, 108, 124, "Input",ExpressionUUID->"e22dd971-0a28-4f01-9125-8e6545d305d1"],
Cell[121060, 3155, 3446, 95, 101, "Input",ExpressionUUID->"badca6ea-f032-4dd0-bc99-91e0cfa1c704"],
Cell[124509, 3252, 527, 12, 31, "Input",ExpressionUUID->"3bea85c0-bdb4-44c0-b691-b56592d8ddc0"],
Cell[125039, 3266, 2097, 46, 55, "Input",ExpressionUUID->"b84ced9f-c6ee-4311-b4c3-f61a58b7ec7c"],
Cell[127139, 3314, 1045, 22, 31, "Input",ExpressionUUID->"5c5b8777-b6e4-4176-b0fa-0932ce9f1a5f"],
Cell[128187, 3338, 292, 6, 31, "Input",ExpressionUUID->"d346f16e-dc08-4237-a213-03b3cf4d633b"],
Cell[128482, 3346, 392, 10, 31, "Input",ExpressionUUID->"726e0406-4ef7-4032-bcf6-756076d7202d"],
Cell[128877, 3358, 941, 19, 31, "Input",ExpressionUUID->"6d845c55-a078-4464-9c27-0c2da46104de"],
Cell[129821, 3379, 426, 11, 31, "Input",ExpressionUUID->"c738bb13-86a7-4c2d-8c1f-509510e459ed"]
}, Open  ]],
Cell[CellGroupData[{
Cell[130284, 3395, 192, 3, 46, "Subsubsection",ExpressionUUID->"1d49cf78-46fd-4116-a870-007344145e53"],
Cell[130479, 3400, 787, 24, 31, "Input",ExpressionUUID->"698c6ace-122c-477d-8a4f-cd8cfac3017c"],
Cell[131269, 3426, 2263, 53, 78, "Input",ExpressionUUID->"3e16542d-2cbd-4e77-aebd-d51c1e6968f1"],
Cell[133535, 3481, 1774, 45, 31, "Input",ExpressionUUID->"a4a52c9a-7592-4bb0-b931-26c92b92ca1c"],
Cell[135312, 3528, 833, 23, 31, "Input",ExpressionUUID->"bd98820a-c59f-44e8-887d-77c25fb213b1"],
Cell[136148, 3553, 1259, 34, 55, "Input",ExpressionUUID->"7463fefa-dff7-4b65-af16-74bf3c10a0ca"],
Cell[137410, 3589, 493, 14, 31, "Input",ExpressionUUID->"2df46e57-7731-4066-af59-21666b039aab"],
Cell[137906, 3605, 162, 4, 31, "Input",ExpressionUUID->"35607c69-c464-4085-af81-e6f07cd15749"],
Cell[138071, 3611, 830, 24, 31, "Input",ExpressionUUID->"6766f8f1-63f3-47bd-a60f-1e2c3d140e21"],
Cell[138904, 3637, 1700, 47, 55, "Input",ExpressionUUID->"f02eb37e-7202-4b1a-bbc9-f36f5ab789f3"],
Cell[140607, 3686, 19377, 455, 562, "Input",ExpressionUUID->"a99d30f2-9c5d-472b-b3a5-d785c29f958f"],
Cell[159987, 4143, 5774, 144, 217, "Input",ExpressionUUID->"34a2f599-2370-43d0-8dec-c53ae780e83f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[165798, 4292, 224, 5, 46, "Subsubsection",ExpressionUUID->"38a906b4-8957-4973-92d7-00c9c19b29a5"],
Cell[166025, 4299, 7618, 196, 492, "Input",ExpressionUUID->"b6c4c3c9-e6fd-4ad7-8f55-6142aff8b312"],
Cell[173646, 4497, 4441, 109, 147, "Input",ExpressionUUID->"274c8d5d-f92d-4b8f-bd97-65bd773dfd3e"],
Cell[178090, 4608, 5034, 98, 170, "Input",ExpressionUUID->"007b4ca5-bd6d-4ffa-b91d-968653ff6167"],
Cell[183127, 4708, 5623, 122, 331, "Input",ExpressionUUID->"2ee92818-082b-41bc-9b65-ee7884ebb645"],
Cell[188753, 4832, 454, 14, 31, "Input",ExpressionUUID->"d866fd60-ae85-46dc-9255-932825050486"],
Cell[189210, 4848, 223, 5, 31, "Input",ExpressionUUID->"acb51225-3d15-4766-8265-15174d884a49"],
Cell[189436, 4855, 533, 14, 31, "Input",ExpressionUUID->"5650da93-3ee0-44ef-af97-c1db289027d7"],
Cell[189972, 4871, 259, 5, 31, "Input",ExpressionUUID->"6391a25d-1738-4dfa-9baa-5f23623d6b04"],
Cell[190234, 4878, 805, 20, 31, "Input",ExpressionUUID->"93868f96-4deb-4884-9de0-c2c8edfb8c8e"],
Cell[191042, 4900, 734, 22, 31, "Input",ExpressionUUID->"a9a96965-1242-4962-be76-d8b107fe74c1"],
Cell[191779, 4924, 826, 23, 31, "Input",ExpressionUUID->"4e2867da-8802-490c-8ed9-d8f116b7fe56"],
Cell[192608, 4949, 170, 4, 31, "Input",ExpressionUUID->"b09440a0-9949-46a1-ae5d-4675de940063"],
Cell[192781, 4955, 1350, 30, 31, "Input",ExpressionUUID->"450edf26-4bd4-47a4-8cd9-cb8222eaf1ce"],
Cell[194134, 4987, 340, 7, 31, "Input",ExpressionUUID->"88f2c191-660a-497f-8a77-db36c5cac642"],
Cell[194477, 4996, 1037, 27, 31, "Input",ExpressionUUID->"e2ceb268-0db8-4835-ae11-a3b713491fb3"],
Cell[195517, 5025, 924, 25, 31, "Input",ExpressionUUID->"52338ece-0cb2-46af-b50d-3dbb19416990"],
Cell[196444, 5052, 983, 27, 31, "Input",ExpressionUUID->"bdb3c85d-400f-4ad1-96a1-b1c8ad60408b"],
Cell[197430, 5081, 1304, 34, 31, "Input",ExpressionUUID->"fff5092f-91fb-4c63-bc47-5fc367e68f89"],
Cell[198737, 5117, 308, 7, 31, "Input",ExpressionUUID->"de89712c-4941-42ab-87f0-b971cad051f0"],
Cell[199048, 5126, 2017, 32, 31, "Input",ExpressionUUID->"7455c5ca-2c44-4c4f-b056-5d0d37b56fd9"],
Cell[201068, 5160, 1006, 27, 55, "Input",ExpressionUUID->"015a9733-27fc-4c7d-a5d1-c6acfbe82764"],
Cell[202077, 5189, 458, 11, 31, "Input",ExpressionUUID->"55864ca2-304a-4456-b64a-3e44018848e8"],
Cell[202538, 5202, 461, 11, 31, "Input",ExpressionUUID->"9b451fc8-0657-466b-b6f5-75e83de13767"],
Cell[203002, 5215, 885, 24, 31, "Input",ExpressionUUID->"f7084978-6622-435a-8b47-0c86726478ea"],
Cell[203890, 5241, 1200, 34, 55, "Input",ExpressionUUID->"8ccce1e8-a436-4066-b3b1-6c6287029ef1"],
Cell[205093, 5277, 1647, 33, 31, "Input",ExpressionUUID->"1fb19a4d-6932-4033-ae3a-a661cb976cb3"],
Cell[206743, 5312, 1032, 30, 31, "Input",ExpressionUUID->"593232fd-7013-4b14-8d2d-465f6a465dee"],
Cell[207778, 5344, 1085, 28, 39, "Input",ExpressionUUID->"38177dbb-f60f-45ae-9cde-f79fc77e0e28"],
Cell[208866, 5374, 364, 9, 31, "Input",ExpressionUUID->"5fcca4ec-8016-4285-862e-89eb36e12e36"],
Cell[209233, 5385, 2205, 54, 69, "Input",ExpressionUUID->"76e12f14-032e-49ec-97b5-2440fc27bdc8"]
}, Open  ]],
Cell[CellGroupData[{
Cell[211475, 5444, 177, 3, 46, "Subsubsection",ExpressionUUID->"efd1eaac-9bd1-427d-a2bb-c7fde3ebc7f2"],
Cell[211655, 5449, 296, 6, 31, "Input",ExpressionUUID->"d4b50d6a-4b8a-468a-bd2b-3339832e598f"],
Cell[211954, 5457, 624, 18, 31, "Input",ExpressionUUID->"32779f9b-64af-4f2d-8e92-8403c69089b6"],
Cell[212581, 5477, 1200, 34, 55, "Input",ExpressionUUID->"497948ad-44fc-478c-a0e4-0d31a166827c"],
Cell[213784, 5513, 354, 7, 31, "Input",ExpressionUUID->"346f6c48-faec-44f6-837e-ce6c82a6317e"],
Cell[214141, 5522, 278, 7, 31, "Input",ExpressionUUID->"915e4098-355c-48c2-9807-2528052bb0e7"],
Cell[214422, 5531, 568, 13, 31, "Input",ExpressionUUID->"cabe12a6-71f1-493f-9c65-d7f27810dbf1"],
Cell[214993, 5546, 358, 9, 31, "Input",ExpressionUUID->"5758717a-c149-4abf-8a6f-acaad110e36c"],
Cell[215354, 5557, 358, 9, 31, "Input",ExpressionUUID->"0970a56f-4c9f-4340-88b9-c34c8946f2f7"],
Cell[215715, 5568, 360, 9, 31, "Input",ExpressionUUID->"597d1753-49e1-4a4b-8116-0bc98175d65c"],
Cell[216078, 5579, 212, 4, 31, "Input",ExpressionUUID->"7ec20cc9-bf99-4c39-9b42-3041cdc5cf58"],
Cell[216293, 5585, 424, 10, 31, "Input",ExpressionUUID->"5df856c1-a352-4208-b655-9f9edf4b3fbe"]
}, Open  ]],
Cell[CellGroupData[{
Cell[216754, 5600, 213, 4, 46, "Subsubsection",ExpressionUUID->"5ed24085-0c71-42b6-a228-0e362efd3c4b"],
Cell[216970, 5606, 595, 13, 31, "Input",ExpressionUUID->"2b63f5f9-e8be-4753-a470-039a38d02ab4"],
Cell[217568, 5621, 223, 5, 31, "Input",ExpressionUUID->"fa429598-c7fd-4f75-a9bd-b48033641e1c"],
Cell[217794, 5628, 533, 14, 31, "Input",ExpressionUUID->"5b2f124c-99de-4041-8389-f1954f47dbec"],
Cell[218330, 5644, 259, 5, 31, "Input",ExpressionUUID->"c7e78ada-6468-42f1-ae52-e8c4c98d52f2"],
Cell[218592, 5651, 1332, 37, 55, "Input",ExpressionUUID->"192c1118-d3bf-4ca7-9b5b-6524f791d7a2"],
Cell[219927, 5690, 461, 11, 31, "Input",ExpressionUUID->"4f8cb151-c690-4b5d-b29f-36484001053f"],
Cell[220391, 5703, 885, 24, 31, "Input",ExpressionUUID->"53ff7f9f-fdcf-4e7e-bde4-250c15eab455"],
Cell[221279, 5729, 1844, 36, 31, "Input",ExpressionUUID->"30aa2fa0-da6c-421b-99a5-988aee72ba68"],
Cell[223126, 5767, 905, 25, 39, "Input",ExpressionUUID->"e92fcdfa-522b-4de0-b513-ef4b5808953c"],
Cell[224034, 5794, 722, 21, 31, "Input",ExpressionUUID->"59614ef2-d15c-47dd-919e-ddaab12d5bc9"],
Cell[224759, 5817, 312, 7, 31, "Input",ExpressionUUID->"18fba55a-95b3-432a-95e6-6ba783deb459"],
Cell[225074, 5826, 497, 10, 31, "Input",ExpressionUUID->"e82a0814-290a-490e-b7f2-012516c3e831"],
Cell[225574, 5838, 1257, 35, 31, "Input",ExpressionUUID->"ca1b5ffb-51f1-4d01-a8b8-ba2a4e0ace1f"],
Cell[226834, 5875, 1187, 34, 31, "Input",ExpressionUUID->"73c132c1-9a9a-4877-8e23-43033deec2d6"],
Cell[228024, 5911, 1289, 36, 31, "Input",ExpressionUUID->"54f2fdeb-0060-4b4b-bb88-22dfe98c68e4"],
Cell[229316, 5949, 1291, 36, 31, "Input",ExpressionUUID->"26459371-c727-4cda-b88f-435b2a9b4cbd"],
Cell[230610, 5987, 1266, 36, 31, "Input",ExpressionUUID->"20b8b190-fd74-430b-9e7d-07e89560f523"],
Cell[231879, 6025, 1264, 36, 31, "Input",ExpressionUUID->"e72cc15a-cb7b-4abe-9a8c-0e4392e10c6a"],
Cell[233146, 6063, 386, 10, 31, "Input",ExpressionUUID->"14fd0723-7eda-474c-a3fa-a715bcf6f823"],
Cell[233535, 6075, 386, 10, 31, "Input",ExpressionUUID->"e268f994-8d0b-4b6b-a08c-695e38acf5ba"],
Cell[233924, 6087, 390, 10, 31, "Input",ExpressionUUID->"c1d0a7b4-6b05-488b-adc5-68d75123aeff"],
Cell[234317, 6099, 386, 10, 31, "Input",ExpressionUUID->"202eb550-5aa5-4c78-8b92-c4a923c48845"],
Cell[234706, 6111, 712, 20, 31, "Input",ExpressionUUID->"88c47a26-0e08-4313-92a6-41f3ebe47d3b"],
Cell[235421, 6133, 792, 22, 31, "Input",ExpressionUUID->"f1fbd689-3bf0-4e4e-9a9e-fb917d3ed16c"],
Cell[236216, 6157, 798, 22, 31, "Input",ExpressionUUID->"000d225a-0918-47f1-83a5-98e07bd85002"],
Cell[237017, 6181, 796, 22, 31, "Input",ExpressionUUID->"57313a9e-e133-4bbf-854f-0f06d5b8af43"],
Cell[237816, 6205, 1370, 34, 39, "Input",ExpressionUUID->"278d1930-3dd5-428b-b851-0d8e9f8ecd08"],
Cell[239189, 6241, 425, 10, 31, "Input",ExpressionUUID->"0ad28f61-dadf-4d9d-bc31-daa531e0384a"],
Cell[239617, 6253, 185, 3, 31, "Input",ExpressionUUID->"2a24f437-a11c-4add-bda1-4a35ed63e29c"],
Cell[239805, 6258, 1538, 40, 69, "Input",ExpressionUUID->"a18199f3-6b02-4962-a50c-524aa21a1746"],
Cell[241346, 6300, 1224, 20, 31, "Input",ExpressionUUID->"39aa315f-9d35-45fd-8a1e-3bda29332e92"]
}, Closed]],
Cell[CellGroupData[{
Cell[242607, 6325, 164, 3, 38, "Subsubsection",ExpressionUUID->"0c131b81-5765-4250-a4d3-826901dfb991"],
Cell[242774, 6330, 418, 11, 31, "Input",ExpressionUUID->"b83d5c9f-bdd1-46c4-80ab-6eb56fd924bb"],
Cell[243195, 6343, 223, 5, 31, "Input",ExpressionUUID->"9d149ec9-6c73-49f1-b158-049525677d91"],
Cell[243421, 6350, 533, 14, 31, "Input",ExpressionUUID->"ac820f34-36d6-414f-9b68-6c38724a4bfe"],
Cell[243957, 6366, 259, 5, 31, "Input",ExpressionUUID->"122b3b6f-c4fe-452c-924d-8e51d1b39e80"],
Cell[244219, 6373, 1200, 34, 55, "Input",ExpressionUUID->"bb4aee88-a11f-4440-9158-43784f62beca"],
Cell[245422, 6409, 461, 11, 31, "Input",ExpressionUUID->"cca2784f-fb2d-457c-bdda-553abae0944b"],
Cell[245886, 6422, 885, 24, 31, "Input",ExpressionUUID->"ea91f3c6-abbb-4321-9448-b398e83ad4d2"],
Cell[246774, 6448, 1647, 33, 31, "Input",ExpressionUUID->"411ca99e-48e4-4a1b-8d62-71465b69c519"],
Cell[248424, 6483, 905, 25, 39, "Input",ExpressionUUID->"4d92fa38-bb7b-47cd-88f2-e5df5fbb4eac"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[249378, 6514, 161, 3, 55, "Subsection",ExpressionUUID->"aaefed61-d328-401d-9a0c-e224b1ea4dbc"],
Cell[249542, 6519, 349, 10, 31, "Input",ExpressionUUID->"cef19a74-2f0c-410f-a9e3-5fe96020bf2b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[249928, 6534, 177, 3, 55, "Subsection",ExpressionUUID->"d55ee351-ed8b-4195-934f-19a890ca2f4e"],
Cell[250108, 6539, 407, 10, 31, "Input",ExpressionUUID->"346b8f7f-b567-435c-86c7-be345c9b5bba"],
Cell[250518, 6551, 880, 22, 31, "Input",ExpressionUUID->"d514712e-154f-4663-8009-e8bc879a15c9"],
Cell[251401, 6575, 879, 22, 31, "Input",ExpressionUUID->"9960ad0b-f91d-417b-89b4-b9b5ff66b744"],
Cell[252283, 6599, 853, 21, 31, "Input",ExpressionUUID->"07473e82-d08a-4d3e-8ca0-8b1d8d498401"],
Cell[253139, 6622, 1026, 24, 31, "Input",ExpressionUUID->"e70d6529-a9b3-4369-82d7-c766180ac9d7"],
Cell[254168, 6648, 333, 8, 31, "Input",ExpressionUUID->"8f609db0-d198-4e2c-8d80-40ccc12688c9"],
Cell[254504, 6658, 204, 4, 31, "Input",ExpressionUUID->"888ab80c-7496-40f3-bce1-4294a1da048e"],
Cell[254711, 6664, 990, 26, 31, "Input",ExpressionUUID->"98422401-6a41-4ffa-9e85-6d3382aef272"],
Cell[255704, 6692, 417, 12, 31, "Input",ExpressionUUID->"c8bfa95d-09b8-4933-9dd8-5ae2186ef6d1"],
Cell[256124, 6706, 450, 13, 31, "Input",ExpressionUUID->"006c9196-3e2a-47f7-abea-fb12b981e65f"],
Cell[256577, 6721, 913, 27, 31, "Input",ExpressionUUID->"1477a417-1d50-4364-9854-be8f25667e5a"],
Cell[257493, 6750, 753, 22, 31, "Input",ExpressionUUID->"734e89ad-4cb3-4179-ada8-5abd3aac7c35"],
Cell[258249, 6774, 1429, 35, 55, "Input",ExpressionUUID->"29da0194-d015-4814-bf28-8cd69e7f4e5d"],
Cell[259681, 6811, 796, 25, 31, "Input",ExpressionUUID->"28b77a28-d46f-4000-ad42-f73bb4237957"],
Cell[260480, 6838, 224, 4, 31, "Input",ExpressionUUID->"ad622b4f-b440-410c-acea-cf87e90bd241"],
Cell[260707, 6844, 1468, 37, 31, "Input",ExpressionUUID->"204fbc63-7880-4b23-aa33-1af969482587"],
Cell[262178, 6883, 1137, 31, 31, "Input",ExpressionUUID->"128719b0-de6f-49f0-831d-ed1b10f356f9"],
Cell[263318, 6916, 1156, 30, 31, "Input",ExpressionUUID->"8a17b706-279c-4621-a984-0b8d38d56d02"],
Cell[264477, 6948, 943, 26, 31, "Input",ExpressionUUID->"442dc9cb-ed51-41dc-85c6-5ef7a3ee9f34"],
Cell[265423, 6976, 392, 9, 31, "Input",ExpressionUUID->"a50d5eff-c5ef-42f0-bb4f-d456f711246d"],
Cell[265818, 6987, 1057, 30, 31, "Input",ExpressionUUID->"0fa0333d-fb31-43cb-be1e-e5a0e0880dd6"],
Cell[266878, 7019, 262, 6, 31, "Input",ExpressionUUID->"4d7fb728-4687-4a71-a9b0-713ce214c186"],
Cell[267143, 7027, 1772, 46, 31, "Input",ExpressionUUID->"4d031e5b-8bad-4583-8f3e-be16f89a1cd1"],
Cell[268918, 7075, 280, 7, 31, "Input",ExpressionUUID->"753f08d7-905b-455a-a71a-81d108e03c5a"],
Cell[269201, 7084, 946, 26, 31, "Input",ExpressionUUID->"11efb39c-3a2c-400b-99bb-25649b2f16d6"],
Cell[270150, 7112, 1034, 27, 31, "Input",ExpressionUUID->"271fd118-8d6f-4f60-84bb-0ef9fbc5c2a0"],
Cell[271187, 7141, 380, 7, 31, "Input",ExpressionUUID->"c65d4366-a0e7-4659-b0b9-50ffa2acd8c5"],
Cell[271570, 7150, 1144, 34, 31, "Input",ExpressionUUID->"562b882b-de31-49e3-b4c1-93426c99d93b"],
Cell[272717, 7186, 381, 9, 31, "Input",ExpressionUUID->"7853ad54-ae03-47b9-a410-95559dbaec3f"],
Cell[273101, 7197, 235, 5, 31, "Input",ExpressionUUID->"9d44c29c-cea8-42d0-a61e-618d238900d3"],
Cell[273339, 7204, 1252, 26, 31, "Input",ExpressionUUID->"dd745587-6132-4b55-abb7-3e89733e9ef5"],
Cell[274594, 7232, 595, 16, 31, "Input",ExpressionUUID->"46befc28-33a1-4e70-88a4-268f4c9a3ca8"],
Cell[275192, 7250, 633, 16, 31, "Input",ExpressionUUID->"f2b8113a-929d-4d6d-8022-e564dde24a11"],
Cell[275828, 7268, 415, 9, 31, "Input",ExpressionUUID->"860174a8-9f7f-439e-96ba-bcfcc2fde5b9"],
Cell[CellGroupData[{
Cell[276268, 7281, 198, 3, 46, "Subsubsection",ExpressionUUID->"1a8aa1d9-a347-4064-b30b-549e06066848"],
Cell[276469, 7286, 6423, 164, 239, "Input",ExpressionUUID->"0f6b3dc1-25ce-4bec-9ec8-0560517e6d62"],
Cell[282895, 7452, 2349, 48, 31, "Input",ExpressionUUID->"89e33bdf-2a67-4655-9a34-e08e997f3899"],
Cell[285247, 7502, 745, 21, 31, "Input",ExpressionUUID->"2922273c-6ecb-4aae-9688-786a7a804afa"],
Cell[285995, 7525, 337, 8, 31, "Input",ExpressionUUID->"0a244af9-bfbd-42a9-b914-6e8f4b25b98b"],
Cell[286335, 7535, 1730, 27, 31, "Input",ExpressionUUID->"fb8a20e9-e0fb-47d0-aa9f-4377ac139f9e"],
Cell[288068, 7564, 403, 9, 31, "Input",ExpressionUUID->"2b172dbd-22b5-461a-9eb4-e84a98203d57"],
Cell[288474, 7575, 648, 19, 31, "Input",ExpressionUUID->"bdfed843-2be3-4709-8d4c-8223b016642f"],
Cell[289125, 7596, 645, 18, 31, "Input",ExpressionUUID->"f054fbff-4122-49ab-8289-1927a8d6777a"],
Cell[289773, 7616, 511, 11, 31, "Input",ExpressionUUID->"1aac7d6a-8584-4d6e-adc6-112817804eab"],
Cell[290287, 7629, 860, 22, 31, "Input",ExpressionUUID->"71402810-029b-4e70-bf4d-79257d6a036b"],
Cell[291150, 7653, 238, 5, 31, "Input",ExpressionUUID->"7f324b77-607e-4364-a826-ecfe19e79442"],
Cell[291391, 7660, 7473, 164, 193, "Input",ExpressionUUID->"5c4570e1-a863-40fb-8507-d6382adeacdb"],
Cell[298867, 7826, 3378, 86, 124, "Input",ExpressionUUID->"525ebcb4-170f-40fc-8512-37940fb8ea7c"],
Cell[302248, 7914, 600, 16, 31, "Input",ExpressionUUID->"aae43b48-b728-4010-8980-656dee89114b"],
Cell[302851, 7932, 549, 14, 27, "Input",ExpressionUUID->"475778f4-13ad-4045-871b-b242c3fa5041"],
Cell[303403, 7948, 425, 12, 27, "Input",ExpressionUUID->"cf654af9-f765-4544-b975-74f66e70f532"],
Cell[303831, 7962, 520, 14, 27, "Input",ExpressionUUID->"807cd1e7-a053-4eb5-adf0-01a86de4a482"],
Cell[304354, 7978, 410, 11, 27, "Input",ExpressionUUID->"c54bbacb-ff8d-410c-94c7-b1544df42232"],
Cell[304767, 7991, 389, 10, 27, "Input",ExpressionUUID->"ae5b378f-aa98-4793-9cb4-0c25c1e16931"],
Cell[305159, 8003, 448, 11, 27, "Input",ExpressionUUID->"8a1d30cc-70a0-4fd6-be12-3cb5129d221a"],
Cell[305610, 8016, 466, 11, 27, "Input",ExpressionUUID->"0f095dd3-6a83-4839-839a-922dbf500f56"],
Cell[306079, 8029, 179, 3, 27, "Input",ExpressionUUID->"1807ac40-42b5-4b51-878f-f28723f4e03b"],
Cell[306261, 8034, 347, 9, 31, "Input",ExpressionUUID->"f796bc5c-7b8c-41ba-8482-eb4ec84cdaf4"],
Cell[306611, 8045, 590, 12, 27, "Input",ExpressionUUID->"ef80128c-0aef-4af7-80e5-f44eccf01ad0"],
Cell[307204, 8059, 414, 11, 27, "Input",ExpressionUUID->"fec03556-7f4d-44dd-bcae-34551a6b7783"],
Cell[307621, 8072, 484, 12, 27, "Input",ExpressionUUID->"ea403e1d-140e-4350-a19a-2775d7ec7804"]
}, Open  ]],
Cell[CellGroupData[{
Cell[308142, 8089, 167, 3, 46, "Subsubsection",ExpressionUUID->"5830d457-c132-42a5-859e-f3bc716806dc"],
Cell[308312, 8094, 18507, 423, 538, "Input",ExpressionUUID->"c0cac0e7-472c-4e58-b610-81bab6460a38"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[326868, 8523, 199, 3, 55, "Subsection",ExpressionUUID->"58e99f97-18fa-407e-a271-28394414f688"],
Cell[327070, 8528, 2746, 56, 55, "Input",ExpressionUUID->"3e71a3c8-8f6f-4658-9abf-1933a64dd6c3"],
Cell[329819, 8586, 389, 10, 31, "Input",ExpressionUUID->"780dda66-5363-4fff-9074-c05359837437"],
Cell[330211, 8598, 620, 13, 31, "Input",ExpressionUUID->"636d581d-5a18-486a-aa51-ad1e08adb0e8"],
Cell[330834, 8613, 739, 20, 31, "Input",ExpressionUUID->"13601ffa-a59d-4d48-80c6-b14a9bb6ba38"],
Cell[331576, 8635, 709, 20, 31, "Input",ExpressionUUID->"8b5e984e-ef4b-457a-bfab-3b92dc5b4adc"],
Cell[332288, 8657, 3135, 74, 78, "Input",ExpressionUUID->"e8d2089f-def7-4ea6-bf27-42066323eab5"],
Cell[335426, 8733, 3297, 86, 99, "Input",ExpressionUUID->"2dc7c35d-86c3-49be-aee2-acde5b0abf54"],
Cell[338726, 8821, 555, 12, 31, "Input",ExpressionUUID->"66f19b22-d7a9-40f9-bdff-56a30c8b9906"],
Cell[339284, 8835, 3513, 82, 92, "Input",ExpressionUUID->"9554032b-fe78-4567-b60f-f73fd49b052f"],
Cell[342800, 8919, 3299, 86, 99, "Input",ExpressionUUID->"7c0a2e9f-308f-40bd-9e08-f8943d6b7ed6"],
Cell[346102, 9007, 533, 12, 31, "Input",ExpressionUUID->"768a1e01-c9c1-40ca-bbf9-160c8630420d"],
Cell[346638, 9021, 482, 11, 31, "Input",ExpressionUUID->"5c9bccf6-bade-48eb-923c-334b4dd83320"],
Cell[347123, 9034, 1283, 33, 55, "Input",ExpressionUUID->"cfdc8ad4-253e-4e30-b69f-2d76c57b16b3"],
Cell[348409, 9069, 796, 25, 31, "Input",ExpressionUUID->"f9340707-0cc7-4e0c-be97-e2bf1fd6fe78"],
Cell[349208, 9096, 1470, 37, 31, "Input",ExpressionUUID->"2f817d62-49ed-4241-acfd-2c2161b361b8"],
Cell[350681, 9135, 672, 18, 31, "Input",ExpressionUUID->"63454f06-024d-4d17-9dc6-16b91df90ce2"],
Cell[351356, 9155, 8339, 197, 285, "Input",ExpressionUUID->"1a40ef39-d22b-40d1-9b21-a0c417fc2d9b"],
Cell[359698, 9354, 2661, 68, 101, "Input",ExpressionUUID->"099e2ab3-3697-4d81-9c19-59f09ea2c34b"],
Cell[362362, 9424, 1786, 52, 55, "Input",ExpressionUUID->"16f0119e-e609-4362-a30f-c886e118d046"],
Cell[364151, 9478, 779, 16, 31, "Input",ExpressionUUID->"d3dddecb-f529-43b5-97f8-de47b678bcad"],
Cell[364933, 9496, 1714, 49, 55, "Input",ExpressionUUID->"969409ac-f973-4d5c-9dbc-2c4ab0a8e6cc"],
Cell[366650, 9547, 461, 12, 31, "Input",ExpressionUUID->"9a18ff82-c298-4325-bfa9-0c2d716ea795"],
Cell[367114, 9561, 2220, 57, 55, "Input",ExpressionUUID->"3da948cd-ba84-456e-8792-a6e5eb9be930"],
Cell[369337, 9620, 410, 11, 31, "Input",ExpressionUUID->"2535407c-9ce6-47d2-bf10-efab68ad6f1f"],
Cell[369750, 9633, 412, 11, 31, "Input",ExpressionUUID->"dc63683c-557b-45c9-b4f2-580302bc1bfc"],
Cell[370165, 9646, 509, 13, 31, "Input",ExpressionUUID->"104d7a0c-41ab-4c5f-abca-7cfdb234849f"],
Cell[370677, 9661, 459, 12, 31, "Input",ExpressionUUID->"ba47beca-72a2-4109-b899-0db07fb258ba"],
Cell[371139, 9675, 2781, 70, 55, "Input",ExpressionUUID->"0bcf34a0-2678-4b8e-9ff0-929142093eaa"],
Cell[373923, 9747, 2746, 67, 55, "Input",ExpressionUUID->"32ec701f-f1d5-495c-aa58-f708b0e687ec"],
Cell[376672, 9816, 412, 11, 31, "Input",ExpressionUUID->"f863e273-e276-4ef9-a395-8b8c594b443a"],
Cell[377087, 9829, 513, 13, 31, "Input",ExpressionUUID->"22c99837-3804-4815-96ea-1d9910982c6b"],
Cell[377603, 9844, 685, 16, 31, "Input",ExpressionUUID->"2d066bdd-40ed-401e-991b-370e423216d4"],
Cell[378291, 9862, 516, 11, 31, "Input",ExpressionUUID->"10b5cc2d-2b8a-4804-b3c6-be26254cade3"],
Cell[378810, 9875, 880, 17, 31, "Input",ExpressionUUID->"27a2da86-7d2a-4107-9ea5-2eecac752062"],
Cell[379693, 9894, 2396, 59, 55, "Input",ExpressionUUID->"ce5b8af9-2b0c-4deb-873c-79c6eb8901f8"],
Cell[382092, 9955, 464, 11, 31, "Input",ExpressionUUID->"42445e35-1215-4fb1-8811-13a761e27cc8"],
Cell[382559, 9968, 389, 10, 31, "Input",ExpressionUUID->"cee77dfc-d9b3-471d-88cb-6d796e91c82f"],
Cell[382951, 9980, 442, 11, 31, "Input",ExpressionUUID->"142f9788-b25f-4fb4-a32c-1fccce189967"],
Cell[383396, 9993, 536, 12, 31, "Input",ExpressionUUID->"5be21e0a-e3c5-4a21-b379-7f3a6e202194"],
Cell[383935, 10007, 3431, 79, 101, "Input",ExpressionUUID->"cb6bc9eb-395a-4b32-b0ef-c94fcefef9c5"],
Cell[387369, 10088, 510, 13, 31, "Input",ExpressionUUID->"e407c645-9c91-4e69-a866-2d078fd5dbff"],
Cell[387882, 10103, 510, 12, 31, "Input",ExpressionUUID->"3a56cfce-b4b5-4f1e-a54d-e74b1927e4d0"],
Cell[388395, 10117, 877, 16, 31, "Input",ExpressionUUID->"46344c0b-9ba1-4cc8-b860-8ed75dd62919"],
Cell[CellGroupData[{
Cell[389297, 10137, 227, 5, 46, "Subsubsection",ExpressionUUID->"d4712df9-684f-4bea-ab9f-33b424f95e74"],
Cell[389527, 10144, 756, 24, 31, "Input",ExpressionUUID->"32058b1e-893f-4dd4-9959-3ea2982bb4c1"],
Cell[390286, 10170, 858, 27, 31, "Input",ExpressionUUID->"7b9a387d-d4f1-42b9-9718-cdd152da927a"],
Cell[391147, 10199, 370, 9, 31, "Input",ExpressionUUID->"2da8041a-f649-4835-a62e-bf556294a1f1"],
Cell[391520, 10210, 4931, 115, 101, "Input",ExpressionUUID->"22863588-9169-43b1-9cd1-72d251517bc8"],
Cell[396454, 10327, 4648, 122, 124, "Input",ExpressionUUID->"35a62e18-5f2d-4242-abb9-bb8a957670c6"],
Cell[401105, 10451, 5114, 125, 124, "Input",ExpressionUUID->"8541fb3f-6aa1-4afb-babd-3c29960e00ff"],
Cell[406222, 10578, 5653, 146, 147, "Input",ExpressionUUID->"131f1366-9ec4-4575-9025-62eddc72304a"],
Cell[411878, 10726, 2504, 69, 101, "Input",ExpressionUUID->"3b8ee68c-387e-4380-8b48-cf7efd9cb8ca"],
Cell[414385, 10797, 2578, 70, 101, "Input",ExpressionUUID->"993dc8ba-2d8f-460a-9bbf-4ba6e730f96a"],
Cell[416966, 10869, 2616, 64, 78, "Input",ExpressionUUID->"2b9647d5-89d2-4053-8b70-97072cd9730b"],
Cell[419585, 10935, 3693, 88, 101, "Input",ExpressionUUID->"d5a45c9b-b6a9-4aa0-887c-7e52c9a0fda6"],
Cell[423281, 11025, 337, 7, 31, "Input",ExpressionUUID->"fc95c435-b7d3-44db-8a2d-db68672b2b07"],
Cell[423621, 11034, 420, 8, 31, "Input",ExpressionUUID->"69b802c0-d684-4f5f-ab61-cfb789744c5b"],
Cell[424044, 11044, 2430, 46, 31, "Input",ExpressionUUID->"5c8b6e06-0291-4add-90ff-20b3101afdc2"],
Cell[426477, 11092, 761, 20, 31, "Input",ExpressionUUID->"9ce9033b-ad4e-4e40-a369-cda49f6e6f56"],
Cell[427241, 11114, 1958, 40, 31, "Input",ExpressionUUID->"9d93e614-3099-4e83-abe1-146c7ef58b56"],
Cell[429202, 11156, 761, 20, 31, "Input",ExpressionUUID->"559eb81d-b77b-4504-a140-1e78a6dde61d"],
Cell[429966, 11178, 1091, 30, 31, "Input",ExpressionUUID->"36532b37-1a52-4192-87bf-e2376dd7088c"],
Cell[431060, 11210, 1045, 24, 31, "Input",ExpressionUUID->"167cd3f4-a08d-4773-98fd-1c86fa0b16d5"],
Cell[432108, 11236, 979, 18, 31, "Input",ExpressionUUID->"18290f27-1e7e-4bb4-be7c-7aa632794f28"],
Cell[433090, 11256, 459, 10, 31, "Input",ExpressionUUID->"dc98d73c-3e40-4ad6-8f57-d7216ff5c83b"],
Cell[433552, 11268, 1074, 27, 31, "Input",ExpressionUUID->"e0a3e54f-e0cf-4005-a296-4497d2dd3eb9"],
Cell[434629, 11297, 837, 22, 31, "Input",ExpressionUUID->"b66d534f-9f09-4be1-a482-2901451ee077"],
Cell[435469, 11321, 256, 6, 31, "Input",ExpressionUUID->"87fb9654-10a7-405b-ab80-1cd3acea238f"],
Cell[435728, 11329, 223, 5, 31, "Input",ExpressionUUID->"0f481f10-328e-4e3b-87ec-61a5c5e1651b"],
Cell[435954, 11336, 586, 17, 31, "Input",ExpressionUUID->"9a7b5a72-bb1d-405f-90c8-3ae48ccc7407"]
}, Open  ]]
}, Open  ]]
}
]
*)

